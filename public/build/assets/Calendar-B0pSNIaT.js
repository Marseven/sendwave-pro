import{o as a,c as d,b as t,d as q,r as u,k as x,m as J,n as R,p as U,j as z,x as o,y as r,F as L,q as O,t as i,w as M,f as w,v as y,g as D}from"./main-CH1OB-Uu.js";import{_ as Y,k as I,i as K,m as $,c as G}from"./api-BQzzbFMM.js";import{c as _}from"./campaignService-RrToS48m.js";import{a as S,b as j,s as Q}from"./notifications-CHQAjgV4.js";import{r as W}from"./PencilIcon-Dn7OK8cz.js";import{r as A}from"./XMarkIcon-Beo2UNWI.js";import{r as X}from"./BellAlertIcon-D-vNAVWh.js";function ee(H,f){return a(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z"})])}const te={class:"p-8"},se={key:0,class:"flex items-center justify-center py-12"},ne={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},oe={class:"lg:col-span-2 rounded-lg border bg-card p-6"},re={class:"flex items-center gap-2 mb-4"},ie={key:0,class:"text-center py-12"},ae={key:1,class:"space-y-3"},le={class:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center font-semibold"},de={class:"text-center"},ue={class:"text-xs"},ce={class:"text-lg"},me={class:"flex-1"},fe={class:"font-medium"},pe={class:"flex items-center gap-2 text-sm text-muted-foreground"},ge={class:"flex items-center gap-2"},ve={class:"text-xs px-2 py-1 rounded-full bg-warning/10 text-warning flex items-center gap-1"},he=["onClick"],be=["onClick"],xe={class:"rounded-lg border bg-card p-6"},we={class:"flex items-center gap-2 mb-4"},ye={class:"text-2xl font-bold mb-2"},_e={class:"mt-6 space-y-2"},ke={class:"flex items-center justify-between text-sm"},Ce={class:"font-semibold"},Me={class:"flex items-center justify-between text-sm"},De={class:"font-semibold"},$e={class:"bg-background rounded-lg shadow-lg w-full max-w-md p-6"},Se={class:"flex items-center justify-between mb-6"},je={class:"space-y-2"},Ae={class:"grid grid-cols-2 gap-4"},He={class:"space-y-2"},Ve={class:"space-y-2"},Ze={class:"flex gap-3 pt-4 border-t"},Ee=["disabled"],Fe={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Ue=q({__name:"Calendar",setup(H){z();const f=u(!0),c=u(!1),h=u(!1),k=u([]),p=u(null),l=u({name:"",scheduled_date:"",scheduled_time:""}),m=x(()=>{const s=["Planifié","planifié","scheduled","draft"];return k.value.filter(e=>{var n;return s.includes(((n=e.status)==null?void 0:n.toLowerCase())||"")||s.includes(e.status||"")}).filter(e=>e.scheduled_at).sort((e,n)=>new Date(e.scheduled_at).getTime()-new Date(n.scheduled_at).getTime())}),C=x(()=>{const s=new Date,e=new Date(s.getTime()+7*24*60*60*1e3);return m.value.filter(n=>{const v=new Date(n.scheduled_at);return v>=s&&v<=e}).length}),V=x(()=>{const s=new Date;return m.value.filter(e=>{const n=new Date(e.scheduled_at);return n.getMonth()===s.getMonth()&&n.getFullYear()===s.getFullYear()}).length});function Z(s){return s?["Jan","Fév","Mar","Avr","Mai","Juin","Juil","Aoû","Sep","Oct","Nov","Déc"][new Date(s).getMonth()]:""}function E(s){return s?new Date(s).getDate().toString().padStart(2,"0"):""}function F(s){if(!s)return"";const e=new Date(s);return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}function N(s){return s>=1e3?`${(s/1e3).toFixed(1)}K`:s.toString()}async function b(){try{f.value=!0,k.value=await _.getAll()}catch(s){console.error("Error loading campaigns:",s)}finally{f.value=!1}}function T(s){p.value=s;const e=new Date(s.scheduled_at);l.value={name:s.name,scheduled_date:e.toISOString().split("T")[0],scheduled_time:`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},h.value=!0}function g(){h.value=!1,p.value=null}async function B(){var s,e;if(p.value){c.value=!0;try{const n=`${l.value.scheduled_date} ${l.value.scheduled_time}`;await _.update(p.value.id,{scheduled_at:n}),S("Campagne reprogrammée avec succès"),g(),await b()}catch(n){j(((e=(s=n.response)==null?void 0:s.data)==null?void 0:e.message)||n.message||"Erreur lors de la reprogrammation")}finally{c.value=!1}}}async function P(s){if(await Q("Annuler la campagne ?",`Êtes-vous sûr de vouloir annuler la campagne "${s.name}" ?`))try{await _.delete(s.id),S("Campagne annulée avec succès"),await b()}catch(n){j(n.message||"Erreur lors de l'annulation")}}return J(()=>{b()}),(s,e)=>(a(),R(Y,null,{default:U(()=>[t("div",te,[e[14]||(e[14]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-bold"},"Calendrier"),t("p",{class:"text-muted-foreground mt-2"},"Planifiez vos campagnes SMS")],-1)),f.value?(a(),d("div",se,[...e[4]||(e[4]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):(a(),d("div",ne,[t("div",oe,[t("div",re,[o(r(I),{class:"w-5 h-5 text-primary"}),e[5]||(e[5]=t("h3",{class:"font-semibold"},"Campagnes planifiées",-1))]),m.value.length===0?(a(),d("div",ie,[o(r(ee),{class:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e[7]||(e[7]=t("p",{class:"text-muted-foreground"},"Aucune campagne planifiée",-1)),t("button",{onClick:e[0]||(e[0]=n=>s.$router.push("/campaign/create")),class:"mt-4 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[o(r(K),{class:"w-4 h-4"}),e[6]||(e[6]=t("span",null,"Planifier une campagne",-1))])])):(a(),d("div",ae,[(a(!0),d(L,null,O(m.value,n=>(a(),d("div",{key:n.id,class:"flex items-center gap-4 p-4 border rounded-lg hover:bg-muted/50 transition-colors group"},[t("div",le,[t("div",de,[t("div",ue,i(Z(n.scheduled_at)),1),t("div",ce,i(E(n.scheduled_at)),1)])]),t("div",me,[t("div",fe,i(n.name),1),t("div",pe,[o(r($),{class:"w-4 h-4"}),t("span",null,i(F(n.scheduled_at)),1),e[8]||(e[8]=t("span",null,"•",-1)),o(r(G),{class:"w-4 h-4"}),t("span",null,i(N(n.messages_sent||0))+" destinataires",1)])]),t("div",ge,[t("span",ve,[o(r($),{class:"w-3 h-3"}),e[9]||(e[9]=t("span",null,"Planifiée",-1))]),t("button",{onClick:v=>T(n),class:"opacity-0 group-hover:opacity-100 transition-opacity inline-flex items-center justify-center rounded-md text-sm font-medium hover:bg-accent h-8 w-8",title:"Modifier"},[o(r(W),{class:"w-4 h-4"})],8,he),t("button",{onClick:v=>P(n),class:"opacity-0 group-hover:opacity-100 transition-opacity inline-flex items-center justify-center rounded-md text-sm font-medium hover:bg-destructive/10 hover:text-destructive h-8 w-8",title:"Annuler"},[o(r(A),{class:"w-4 h-4"})],8,be)])]))),128))]))]),t("div",xe,[t("div",we,[o(r(X),{class:"w-5 h-5 text-primary"}),e[10]||(e[10]=t("h3",{class:"font-semibold"},"À venir",-1))]),t("div",ye,i(C.value)+" campagne"+i(C.value>1?"s":""),1),e[13]||(e[13]=t("p",{class:"text-sm text-muted-foreground"},"dans les 7 prochains jours",-1)),t("div",_e,[t("div",ke,[e[11]||(e[11]=t("span",{class:"text-muted-foreground"},"Ce mois-ci",-1)),t("span",Ce,i(V.value),1)]),t("div",Me,[e[12]||(e[12]=t("span",{class:"text-muted-foreground"},"Total planifiées",-1)),t("span",De,i(m.value.length),1)])])])]))]),h.value?(a(),d("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:M(g,["self"])},[t("div",$e,[t("div",Se,[e[15]||(e[15]=t("h2",{class:"text-xl font-bold"},"Reprogrammer la campagne",-1)),t("button",{onClick:g,class:"hover:bg-accent rounded-full p-1"},[o(r(A),{class:"w-5 h-5"})])]),t("form",{onSubmit:M(B,["prevent"]),class:"space-y-4"},[t("div",je,[e[16]||(e[16]=t("label",{class:"text-sm font-medium"},"Nom de la campagne",-1)),w(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>l.value.name=n),type:"text",readonly:"",class:"flex h-10 w-full rounded-md border border-input bg-muted px-3 py-2 text-sm"},null,512),[[y,l.value.name]])]),t("div",Ae,[t("div",He,[e[17]||(e[17]=t("label",{class:"text-sm font-medium"},"Date *",-1)),w(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>l.value.scheduled_date=n),type:"date",required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[y,l.value.scheduled_date]])]),t("div",Ve,[e[18]||(e[18]=t("label",{class:"text-sm font-medium"},"Heure *",-1)),w(t("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>l.value.scheduled_time=n),type:"time",required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[y,l.value.scheduled_time]])])]),t("div",Ze,[t("button",{type:"button",onClick:g,class:"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Annuler "),t("button",{type:"submit",disabled:c.value,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[c.value?(a(),d("div",Fe)):D("",!0),t("span",null,i(c.value?"Enregistrement...":"Reprogrammer"),1)],8,Ee)])],32)])])):D("",!0)]),_:1}))}});export{Ue as default};
