import{d as ce,u as ue,k as me,r as I,l as ve,m as fe,n as W,o as i,p as _e,b as e,t as n,c as a,q,s as f,F as z,x as g,y as x,z as Y,i as Z,A as ge}from"./main-Is5TlHEk.js";import{r as G,a as xe,b as be,_ as pe}from"./api-DOf-pn4k.js";import{a as he}from"./analyticsService-JIXza-Nz.js";import{c as ye}from"./campaignService-Dyln-AgI.js";import{r as ee}from"./CheckCircleIcon-BG4_XIyi.js";const we={class:"p-8"},Ce={class:"mb-8 flex justify-between items-center"},ke={class:"text-muted-foreground mt-2"},$e={class:"flex gap-2"},Ae=["onClick"],je={key:0,class:"flex items-center justify-center py-12"},De={key:1},Fe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},Se={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-6"},Te={class:"flex items-center justify-between"},Le={class:"text-3xl font-bold mt-2"},Re={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-6"},Be={class:"flex items-center justify-between"},Me={class:"text-3xl font-bold mt-2"},Ee={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-6"},Ie={class:"flex items-center justify-between"},Ne={class:"text-3xl font-bold mt-2"},Pe={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-6"},qe={class:"flex items-center justify-between"},ze={class:"text-3xl font-bold mt-2"},Ve={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8"},Ke={class:"rounded-lg border bg-card shadow-sm"},Oe={class:"p-6"},Ue={key:0,class:"space-y-4"},Xe={class:"flex items-center justify-between"},Ge={class:"font-medium"},He={class:"text-sm text-muted-foreground"},Je={class:"w-full bg-muted rounded-full h-2"},Qe={class:"flex justify-between text-xs text-muted-foreground"},We={key:1,class:"text-center text-muted-foreground py-8"},Ye={class:"rounded-lg border bg-card shadow-sm"},Ze={class:"p-6"},et={key:0,class:"space-y-4"},tt={class:"text-center"},st={class:"text-5xl font-bold text-primary"},rt={class:"w-full bg-muted rounded-full h-3"},ot={class:"flex justify-between text-xs text-muted-foreground"},nt={key:1,class:"text-center text-muted-foreground py-8"},dt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},it={class:"rounded-lg border bg-card text-card-foreground shadow-sm"},lt={class:"p-6"},at={key:0},ct={class:"flex items-center justify-between mb-2"},ut={class:"font-medium"},mt={class:"flex items-center gap-4 text-sm text-muted-foreground"},vt={class:"flex items-center gap-1"},ft={class:"flex items-center gap-1"},_t={key:1,class:"text-center text-muted-foreground py-8"},gt={class:"rounded-lg border bg-card text-card-foreground shadow-sm"},xt={class:"p-6"},bt={key:0},pt={class:"flex-1"},ht={class:"text-sm font-medium"},yt={class:"text-xs text-muted-foreground mt-1"},wt={key:1,class:"text-center text-muted-foreground py-8"},Ft=ce({__name:"Dashboard",setup(Ct){const te=ue(),N=me(()=>te.user),se=[{value:"today",label:"Aujourd'hui"},{value:"week",label:"Cette semaine"},{value:"month",label:"Ce mois"},{value:"year",label:"Cette année"}],P=I("today"),r=I(null),V=I([]),K=I([]),O=I(!1);function _(s){return s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(1)}K`:s.toString()}function H(s){return`${s.toLocaleString("fr-FR")} XAF`}function U(s){return s?s>0?"text-success":s<0?"text-destructive":"text-muted-foreground":"text-muted-foreground"}function X(s){return s?`${s>0?"+":""}${s.toFixed(1)}% vs période précédente`:"Aucun changement"}function re(s){return s?s>=95?"text-success":s>=85?"text-warning":"text-destructive":"text-muted-foreground"}function oe(s){return s?s>=95?"Excellent":s>=85?"Bon":"À améliorer":"Aucune donnée"}function J(s,t){return t?s/t*100:0}function ne(s,t){const l=J(s,t);return l>50?"bg-success":l>20?"bg-warning":"bg-destructive"}async function Q(){var s,t,l,u,c,m,b,p,h,y,w,C,k,$,A,j,D,F,S,T,L,R,B,M,o;O.value=!0;try{const[v,E]=await Promise.all([he.getDashboard(P.value),ye.getAll()]),d=v.data;r.value={total_sent:((s=d.overview)==null?void 0:s.sms_sent)||0,total_delivered:((t=d.overview)==null?void 0:t.sms_delivered)||0,total_failed:((l=d.overview)==null?void 0:l.sms_failed)||0,delivery_rate:((u=d.overview)==null?void 0:u.success_rate)||0,total_cost:((c=d.overview)==null?void 0:c.total_cost)||0,campaigns_executed:((m=d.overview)==null?void 0:m.campaigns_executed)||0,contacts_added:((b=d.overview)==null?void 0:b.contacts_added)||0,trends:{sent:((p=d.trends)==null?void 0:p.sms_sent_change)||0,delivered:((h=d.trends)==null?void 0:h.success_rate_change)||0,cost:((y=d.trends)==null?void 0:y.cost_change)||0,campaigns:((w=d.trends)==null?void 0:w.campaigns_change)||0},by_provider:{Airtel:{sent:((k=(C=d.providers)==null?void 0:C.airtel)==null?void 0:k.count)||0,delivered_rate:((A=($=d.providers)==null?void 0:$.airtel)==null?void 0:A.percentage)||0,total_cost:((j=d.cost_analysis)==null?void 0:j.airtel_cost)||0},Moov:{sent:((F=(D=d.providers)==null?void 0:D.moov)==null?void 0:F.count)||0,delivered_rate:((T=(S=d.providers)==null?void 0:S.moov)==null?void 0:T.percentage)||0,total_cost:((L=d.cost_analysis)==null?void 0:L.moov_cost)||0}},credits_remaining:((R=N.value)==null?void 0:R.credits)||0,initial_credits:((B=N.value)==null?void 0:B.initial_credits)||((M=N.value)==null?void 0:M.credits)||1e3},V.value=((o=d.campaigns)==null?void 0:o.length)>0?d.campaigns.slice(0,3):E.slice(0,3),K.value=de(E)}catch(v){console.error("Error loading dashboard data:",v)}finally{O.value=!1}}ve(P,()=>{Q()});function de(s){const t=[];return s.slice(0,4).forEach(l=>{(l.messages_sent||l.sent)&&t.push({id:`campaign-${l.id}`,icon:G,title:`Campagne "${l.name}" envoyée à ${l.messages_sent||l.sent} contacts`,time:ie(l.created_at)})}),t.slice(0,4)}function ie(s){if(!s)return"Récemment";const t=new Date(s),u=new Date().getTime()-t.getTime(),c=Math.floor(u/(1e3*60*60)),m=Math.floor(u/(1e3*60*60*24));return c<1?"Il y a quelques minutes":c<24?`Il y a ${c} heure${c>1?"s":""}`:m===1?"Il y a 1 jour":`Il y a ${m} jours`}function le(s){const t=s==null?void 0:s.toLowerCase();return t==="active"||t==="actif"?"bg-success/10 text-success":t==="scheduled"||t==="planifié"?"bg-warning/10 text-warning":"bg-muted text-muted-foreground"}function ae(s){const t=s==null?void 0:s.toLowerCase();return t==="active"||t==="actif"?"Active":t==="scheduled"||t==="planifié"?"Planifiée":t==="completed"||t==="terminé"?"Terminée":s||"Inconnu"}return fe(()=>{Q()}),(s,t)=>(i(),W(pe,null,{default:_e(()=>{var l,u,c,m,b,p,h,y,w,C,k,$,A,j,D,F,S,T,L,R,B,M;return[e("div",we,[e("div",Ce,[e("div",null,[t[0]||(t[0]=e("h1",{class:"text-3xl font-bold text-foreground"},"Tableau de bord",-1)),e("p",ke,"Bienvenue "+n((l=N.value)==null?void 0:l.name),1)]),e("div",$e,[(i(),a(z,null,q(se,o=>e("button",{key:o.value,onClick:v=>P.value=o.value,class:f(["px-4 py-2 rounded-lg text-sm font-medium transition-colors",P.value===o.value?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"])},n(o.label),11,Ae)),64))])]),O.value?(i(),a("div",je,[...t[1]||(t[1]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):(i(),a("div",De,[e("div",Fe,[e("div",Se,[e("div",Te,[t[2]||(t[2]=e("h3",{class:"text-sm font-medium text-muted-foreground"},"Messages Envoyés",-1)),g(x(G),{class:"w-8 h-8 text-primary"})]),e("p",Le,n(_(((u=r.value)==null?void 0:u.total_sent)||0)),1),e("p",{class:f(["text-xs mt-2",U((m=(c=r.value)==null?void 0:c.trends)==null?void 0:m.sent)])},n(X((p=(b=r.value)==null?void 0:b.trends)==null?void 0:p.sent)),3)]),e("div",Re,[e("div",Be,[t[3]||(t[3]=e("h3",{class:"text-sm font-medium text-muted-foreground"},"Messages Livrés",-1)),g(x(ee),{class:"w-8 h-8 text-success"})]),e("p",Me,n(_(((h=r.value)==null?void 0:h.total_delivered)||0)),1),e("p",{class:f(["text-xs mt-2",U((w=(y=r.value)==null?void 0:y.trends)==null?void 0:w.delivered)])},n(X((k=(C=r.value)==null?void 0:C.trends)==null?void 0:k.delivered)),3)]),e("div",Ee,[e("div",Ie,[t[4]||(t[4]=e("h3",{class:"text-sm font-medium text-muted-foreground"},"Taux de Livraison",-1)),g(x(xe),{class:"w-8 h-8 text-primary"})]),e("p",Ne,n(((A=($=r.value)==null?void 0:$.delivery_rate)==null?void 0:A.toFixed(1))||0)+"%",1),e("p",{class:f(["text-xs mt-2",re((j=r.value)==null?void 0:j.delivery_rate)])},n(oe((D=r.value)==null?void 0:D.delivery_rate)),3)]),e("div",Pe,[e("div",qe,[t[5]||(t[5]=e("h3",{class:"text-sm font-medium text-muted-foreground"},"Coût Total",-1)),g(x(be),{class:"w-8 h-8 text-primary"})]),e("p",ze,n(H(((F=r.value)==null?void 0:F.total_cost)||0)),1),e("p",{class:f(["text-xs mt-2",U((T=(S=r.value)==null?void 0:S.trends)==null?void 0:T.cost)])},n(X((R=(L=r.value)==null?void 0:L.trends)==null?void 0:R.cost)),3)])]),e("div",Ve,[e("div",Ke,[t[7]||(t[7]=e("div",{class:"p-6 border-b border-border"},[e("h2",{class:"text-xl font-semibold"},"Répartition par Fournisseur")],-1)),e("div",Oe,[(B=r.value)!=null&&B.by_provider&&Object.keys(r.value.by_provider).length>0?(i(),a("div",Ue,[(i(!0),a(z,null,q(r.value.by_provider,(o,v)=>{var E;return i(),a("div",{key:v,class:"space-y-2"},[e("div",Xe,[e("span",Ge,n(v),1),e("span",He,n(_(o.sent))+" messages",1)]),e("div",Je,[e("div",{class:f(["h-2 rounded-full",v==="Airtel"?"bg-red-500":"bg-yellow-500"]),style:Y({width:`${(o.sent/r.value.total_sent*100).toFixed(1)}%`})},null,6)]),e("div",Qe,[e("span",null,"Livrés: "+n((E=o.delivered_rate)==null?void 0:E.toFixed(1))+"%",1),e("span",null,"Coût: "+n(H(o.total_cost)),1)])])}),128))])):(i(),a("div",We,[...t[6]||(t[6]=[e("p",{class:"text-sm"},"Aucune donnée disponible",-1)])]))])]),e("div",Ye,[t[10]||(t[10]=e("div",{class:"p-6 border-b border-border"},[e("h2",{class:"text-xl font-semibold"},"Crédits Restants")],-1)),e("div",Ze,[((M=r.value)==null?void 0:M.credits_remaining)!==void 0?(i(),a("div",et,[e("div",tt,[e("p",st,n(_(r.value.credits_remaining)),1),t[8]||(t[8]=e("p",{class:"text-sm text-muted-foreground mt-2"},"crédits disponibles",-1))]),e("div",rt,[e("div",{class:f(["h-3 rounded-full transition-all",ne(r.value.credits_remaining,r.value.initial_credits)]),style:Y({width:`${J(r.value.credits_remaining,r.value.initial_credits)}%`})},null,6)]),e("div",ot,[e("span",null,"Utilisés: "+n(_((r.value.initial_credits||0)-r.value.credits_remaining)),1),e("span",null,"Total: "+n(_(r.value.initial_credits||0)),1)])])):(i(),a("div",nt,[...t[9]||(t[9]=[e("p",{class:"text-sm"},"Aucune donnée disponible",-1)])]))])])]),e("div",dt,[e("div",it,[t[12]||(t[12]=e("div",{class:"p-6 border-b border-border"},[e("h2",{class:"text-xl font-semibold"},"Campagnes Récentes")],-1)),e("div",lt,[V.value.length>0?(i(),a("div",at,[(i(!0),a(z,null,q(V.value,o=>(i(),a("div",{key:o.id,class:"mb-4 last:mb-0 pb-4 last:pb-0 border-b last:border-b-0 border-border"},[e("div",ct,[e("h3",ut,n(o.name),1),e("span",{class:f(["text-xs px-2 py-1 rounded-full",le(o.status)])},n(ae(o.status)),3)]),e("div",mt,[e("span",vt,[g(x(G),{class:"w-4 h-4"}),Z(" "+n(o.messages_sent||o.sent||0)+" envoyés ",1)]),e("span",ft,[g(x(ee),{class:"w-4 h-4"}),Z(" "+n(o.delivery_rate||o.delivered||0)+"% livrés ",1)])])]))),128))])):(i(),a("div",_t,[...t[11]||(t[11]=[e("p",{class:"text-sm"},"Aucune campagne récente",-1)])]))])]),e("div",gt,[t[14]||(t[14]=e("div",{class:"p-6 border-b border-border"},[e("h2",{class:"text-xl font-semibold"},"Activité Récente")],-1)),e("div",xt,[K.value.length>0?(i(),a("div",bt,[(i(!0),a(z,null,q(K.value,o=>(i(),a("div",{key:o.id,class:"mb-4 last:mb-0 flex items-start gap-3"},[(i(),W(ge(o.icon),{class:"w-5 h-5 text-muted-foreground flex-shrink-0 mt-0.5"})),e("div",pt,[e("p",ht,n(o.title),1),e("p",yt,n(o.time),1)])]))),128))])):(i(),a("div",wt,[...t[13]||(t[13]=[e("p",{class:"text-sm"},"Aucune activité récente",-1)])]))])])])]))])]}),_:1}))}});export{Ft as default};
