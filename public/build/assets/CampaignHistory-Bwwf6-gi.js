import{o as u,c as f,b as e,d as H,r as p,k as L,m as U,n as q,p as _,G,x as a,y as d,f as h,v as k,C as R,t as r,F as A,q as M,s as V,i as b,g as C,w as X}from"./main-CH1OB-Uu.js";import{f as $,_ as I,m as J,i as z,k as K,c as O,d as Q,a as W}from"./api-BQzzbFMM.js";import{b as Y}from"./notifications-CHQAjgV4.js";import{r as Z}from"./EyeIcon-DSQfRtze.js";import{r as ee,a as te,b as se}from"./ChevronRightIcon-0vsgKZXA.js";import{r as oe}from"./XMarkIcon-Beo2UNWI.js";function ne(g,m){return u(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776"})])}const re={async getAll(g){const m=await $.get("/campaigns/history",{params:g});return m.data.data||m.data},async getById(g){const m=await $.get(`/campaigns/${g}`);return m.data.data||m.data},async getStats(){const g=await $.get("/campaigns/stats");return g.data.data||g.data}},ie={class:"p-8"},le={class:"mb-8 flex items-center justify-between"},ae={class:"flex items-center gap-2"},de={class:"mb-6 grid grid-cols-1 md:grid-cols-4 gap-4"},ue={key:0,class:"flex justify-center items-center py-12"},ce={key:1,class:"text-center py-16"},fe={class:"text-muted-foreground mb-6"},me={key:2,class:"space-y-4"},ge={class:"flex items-start justify-between mb-4"},ve={class:"flex-1"},pe={class:"flex items-center gap-3 mb-2"},be={class:"text-lg font-semibold"},xe={class:"text-sm text-muted-foreground line-clamp-2"},he=["onClick"],ye={class:"grid grid-cols-2 md:grid-cols-5 gap-4 pt-4 border-t"},we={class:"text-sm font-medium flex items-center gap-1.5"},_e={class:"text-sm font-medium flex items-center gap-1.5"},ke={class:"text-sm font-medium flex items-center gap-1.5"},Ce={class:"text-sm font-medium flex items-center gap-1.5"},$e={class:"text-sm font-bold text-primary flex items-center gap-1.5"},Te={key:3,class:"mt-6 flex justify-center gap-2"},De=["disabled"],Fe={class:"inline-flex items-center px-4 text-sm"},Se=["disabled"],je={class:"bg-background rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},Le={class:"p-6 border-b flex items-center justify-between"},Ae={class:"p-6 space-y-6"},Me={class:"text-muted-foreground"},Ve={class:"p-4 bg-muted/50 rounded-lg font-mono text-sm whitespace-pre-wrap"},ze={class:"grid grid-cols-2 gap-4"},Be={class:"text-muted-foreground"},Ee={class:"grid grid-cols-2 gap-4"},Ne={class:"text-2xl font-bold text-primary"},Pe={class:"text-2xl font-bold text-primary"},He={class:"grid grid-cols-2 gap-4"},Ue={class:"text-2xl font-bold"},qe={class:"text-2xl font-bold text-primary"},Ge={key:0},Re={class:"flex flex-wrap gap-2"},Xe={class:"p-6 border-t flex justify-end"},T=10,Ye=H({__name:"CampaignHistory",setup(g){const m=p([]),y=p(!1),i=p(null),v=p(1),n=p({search:"",status:"",dateFrom:"",dateTo:""}),D=L(()=>{let o=m.value;if(n.value.search){const s=n.value.search.toLowerCase();o=o.filter(c=>c.name.toLowerCase().includes(s)||c.message.toLowerCase().includes(s))}n.value.status&&(o=o.filter(s=>x(s.status)===n.value.status)),n.value.dateFrom&&(o=o.filter(s=>{const c=s.sent_at||s.scheduled_at;return c&&c>=n.value.dateFrom})),n.value.dateTo&&(o=o.filter(s=>{const c=s.sent_at||s.scheduled_at;return c&&c<=n.value.dateTo}));const t=(v.value-1)*T,l=t+T;return o.slice(t,l)}),w=L(()=>{let o=m.value;if(n.value.search||n.value.status||n.value.dateFrom||n.value.dateTo){const t=n.value.search.toLowerCase();o=o.filter(l=>{const s=!n.value.search||l.name.toLowerCase().includes(t)||l.message.toLowerCase().includes(t),c=!n.value.status||x(l.status)===n.value.status,N=!n.value.dateFrom||(l.sent_at||l.scheduled_at||"")>=n.value.dateFrom,P=!n.value.dateTo||(l.sent_at||l.scheduled_at||"")<=n.value.dateTo;return s&&c&&N&&P})}return Math.ceil(o.length/T)});function x(o){const t=(o==null?void 0:o.toLowerCase())||"";return t==="actif"||t==="sending"?"sending":t==="terminé"||t==="termine"?"completed":t==="planifié"||t==="planifie"?"scheduled":t}function F(o){const t=x(o);return{draft:"bg-muted text-muted-foreground",scheduled:"bg-primary/10 text-primary",sending:"bg-warning/10 text-warning",completed:"bg-success/10 text-success",failed:"bg-destructive/10 text-destructive",cancelled:"bg-muted text-muted-foreground"}[t]||"bg-muted text-muted-foreground"}function S(o){const t=x(o);return{draft:"Brouillon",scheduled:"Planifié",sending:"En cours",completed:"Terminé",failed:"Échoué",cancelled:"Annulé"}[t]||o}function j(o){return o?new Date(o).toLocaleString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}function B(o){i.value=o}async function E(){var o,t;y.value=!0;try{m.value=await re.getAll()}catch(l){console.error("Error loading campaigns:",l),Y(((t=(o=l.response)==null?void 0:o.data)==null?void 0:t.message)||"Erreur lors du chargement des campagnes")}finally{y.value=!1}}return U(()=>{E()}),(o,t)=>{const l=G("router-link");return u(),q(I,null,{default:_(()=>[e("div",ie,[e("div",le,[e("div",null,[e("div",ae,[a(d(J),{class:"w-8 h-8 text-primary"}),t[9]||(t[9]=e("h1",{class:"text-3xl font-bold"},"Historique des campagnes",-1))]),t[10]||(t[10]=e("p",{class:"text-muted-foreground mt-2"},"Consultez toutes vos campagnes envoyées",-1))]),a(l,{to:"/campaigns/create",class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},{default:_(()=>[a(d(z),{class:"w-4 h-4"}),t[11]||(t[11]=e("span",null,"Nouvelle campagne",-1))]),_:1})]),e("div",de,[e("div",null,[h(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>n.value.search=s),type:"text",placeholder:"Rechercher...",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[k,n.value.search]])]),e("div",null,[h(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>n.value.status=s),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...t[12]||(t[12]=[e("option",{value:""},"Tous les statuts",-1),e("option",{value:"draft"},"Brouillon",-1),e("option",{value:"scheduled"},"Planifié",-1),e("option",{value:"sending"},"En cours",-1),e("option",{value:"completed"},"Terminé",-1),e("option",{value:"failed"},"Échoué",-1),e("option",{value:"cancelled"},"Annulé",-1)])],512),[[R,n.value.status]])]),e("div",null,[h(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.value.dateFrom=s),type:"date",placeholder:"Date de début",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[k,n.value.dateFrom]])]),e("div",null,[h(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.value.dateTo=s),type:"date",placeholder:"Date de fin",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[k,n.value.dateTo]])])]),y.value?(u(),f("div",ue,[...t[13]||(t[13]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):D.value.length===0?(u(),f("div",ce,[a(d(ne),{class:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),t[15]||(t[15]=e("h3",{class:"text-lg font-semibold mb-2"},"Aucune campagne trouvée",-1)),e("p",fe,r(n.value.search||n.value.status?"Essayez de modifier vos filtres":"Commencez par créer votre première campagne"),1),a(l,{to:"/campaigns/create",class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},{default:_(()=>[a(d(z),{class:"w-4 h-4"}),t[14]||(t[14]=e("span",null,"Créer une campagne",-1))]),_:1})])):(u(),f("div",me,[(u(!0),f(A,null,M(D.value,s=>(u(),f("div",{key:s.id,class:"rounded-lg border bg-card shadow-sm p-6 hover:shadow-md transition-shadow"},[e("div",ge,[e("div",ve,[e("div",pe,[e("h3",be,r(s.name),1),e("span",{class:V(["px-2.5 py-0.5 rounded-full text-xs font-medium",F(s.status)])},r(S(s.status)),3)]),e("p",xe,r(s.message),1)]),e("button",{onClick:c=>B(s),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"},[a(d(Z),{class:"w-4 h-4"}),t[16]||(t[16]=e("span",null,"Détails",-1))],8,he)]),e("div",ye,[e("div",null,[t[17]||(t[17]=e("p",{class:"text-xs text-muted-foreground mb-1"},"Date d'envoi",-1)),e("p",we,[a(d(K),{class:"w-4 h-4 text-muted-foreground"}),b(" "+r(j(s.sent_at||s.scheduled_at)),1)])]),e("div",null,[t[18]||(t[18]=e("p",{class:"text-xs text-muted-foreground mb-1"},"Destinataires",-1)),e("p",_e,[a(d(O),{class:"w-4 h-4 text-muted-foreground"}),b(" "+r(s.recipients_count),1)])]),e("div",null,[t[19]||(t[19]=e("p",{class:"text-xs text-muted-foreground mb-1"},"SMS envoyés",-1)),e("p",ke,[a(d(Q),{class:"w-4 h-4 text-muted-foreground"}),b(" "+r(s.sms_count),1)])]),e("div",null,[t[20]||(t[20]=e("p",{class:"text-xs text-muted-foreground mb-1"},"Taux de livraison",-1)),e("p",Ce,[a(d(W),{class:"w-4 h-4 text-muted-foreground"}),b(" "+r(s.delivery_rate)+"% ",1)])]),e("div",null,[t[21]||(t[21]=e("p",{class:"text-xs text-muted-foreground mb-1"},"Coût total",-1)),e("p",$e,[a(d(ee),{class:"w-4 h-4"}),b(" "+r(s.cost)+" XAF ",1)])])])]))),128))])),w.value>1?(u(),f("div",Te,[e("button",{onClick:t[4]||(t[4]=s=>v.value--),disabled:v.value===1,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"},[a(d(te),{class:"w-4 h-4"})],8,De),e("span",Fe," Page "+r(v.value)+" sur "+r(w.value),1),e("button",{onClick:t[5]||(t[5]=s=>v.value++),disabled:v.value===w.value,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"},[a(d(se),{class:"w-4 h-4"})],8,Se)])):C("",!0)]),i.value?(u(),f("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:t[8]||(t[8]=X(s=>i.value=null,["self"]))},[e("div",je,[e("div",Le,[t[22]||(t[22]=e("h2",{class:"text-2xl font-bold"},"Détails de la campagne",-1)),e("button",{onClick:t[6]||(t[6]=s=>i.value=null),class:"text-muted-foreground hover:text-foreground transition-colors"},[a(d(oe),{class:"w-6 h-6"})])]),e("div",Ae,[e("div",null,[t[23]||(t[23]=e("h3",{class:"font-semibold mb-2"},"Nom de la campagne",-1)),e("p",Me,r(i.value.name),1)]),e("div",null,[t[24]||(t[24]=e("h3",{class:"font-semibold mb-2"},"Message",-1)),e("div",Ve,r(i.value.message),1)]),e("div",ze,[e("div",null,[t[25]||(t[25]=e("h3",{class:"font-semibold mb-2"},"Statut",-1)),e("span",{class:V(["inline-block px-3 py-1 rounded-full text-sm font-medium",F(i.value.status)])},r(S(i.value.status)),3)]),e("div",null,[t[26]||(t[26]=e("h3",{class:"font-semibold mb-2"},"Date d'envoi",-1)),e("p",Be,r(j(i.value.sent_at||i.value.scheduled_at)),1)])]),e("div",Ee,[e("div",null,[t[27]||(t[27]=e("h3",{class:"font-semibold mb-2"},"Destinataires",-1)),e("p",Ne,r(i.value.recipients_count),1)]),e("div",null,[t[28]||(t[28]=e("h3",{class:"font-semibold mb-2"},"SMS envoyés",-1)),e("p",Pe,r(i.value.sms_count),1)])]),e("div",He,[e("div",null,[t[29]||(t[29]=e("h3",{class:"font-semibold mb-2"},"Taux de livraison",-1)),e("p",Ue,r(i.value.delivery_rate)+"%",1)]),e("div",null,[t[30]||(t[30]=e("h3",{class:"font-semibold mb-2"},"Coût total",-1)),e("p",qe,r(i.value.cost)+" XAF",1)])]),i.value.groups&&i.value.groups.length>0?(u(),f("div",Ge,[t[31]||(t[31]=e("h3",{class:"font-semibold mb-2"},"Groupes ciblés",-1)),e("div",Re,[(u(!0),f(A,null,M(i.value.groups,s=>(u(),f("span",{key:s.id,class:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm"},r(s.name),1))),128))])])):C("",!0)]),e("div",Xe,[e("button",{onClick:t[7]||(t[7]=s=>i.value=null),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Fermer ")])])])):C("",!0)]),_:1})}}});export{Ye as default};
