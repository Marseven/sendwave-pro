import{o as u,c,b as e,d as G,r as x,k as E,m as I,n as M,p as C,j as J,E as K,x as a,y as d,f as h,v as $,C as O,t as i,F as V,q as z,s as B,i as w,g as S,w as Q}from"./main-Cv9Y2Kpn.js";import{f as j,_ as W,i as Y,m as N,o as Z,c as ee,d as se,a as te,h as oe}from"./api-Bkh_GQOt.js";import{c as ne}from"./campaignService-CGB0P2R9.js";import{b as P,a as re}from"./notifications-CHQAjgV4.js";import{r as ie}from"./DocumentDuplicateIcon-ZLQ_QkJn.js";import{r as le}from"./EyeIcon-CRuGXftZ.js";import{r as ae}from"./BanknotesIcon-Cyz28SSb.js";import{r as de}from"./ChevronLeftIcon-BF2zoNyJ.js";import{r as ue}from"./ChevronRightIcon-DsEVTV81.js";function me(f,p){return u(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776"})])}const ce={async getAll(f){const p=await j.get("/campaigns/history",{params:f});return p.data.data||p.data},async getById(f){const p=await j.get(`/campaigns/${f}`);return p.data.data||p.data},async getStats(){const f=await j.get("/campaigns/stats");return f.data.data||f.data}},fe={class:"p-4 sm:p-6 lg:p-8"},pe={class:"mb-4 sm:mb-8 flex flex-col sm:flex-row sm:items-center justify-between gap-3 sm:gap-4"},ge={class:"flex items-center gap-2"},xe={class:"mb-4 sm:mb-6 grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-4"},be={class:"col-span-2 md:col-span-1"},ve={key:0,class:"flex justify-center items-center py-12"},he={key:1,class:"text-center py-16"},we={class:"text-muted-foreground mb-6"},ye={key:2,class:"space-y-3 sm:space-y-4"},_e={class:"flex flex-col sm:flex-row sm:items-start justify-between gap-3 sm:gap-4 mb-3 sm:mb-4"},ke={class:"flex-1 min-w-0"},Ce={class:"flex flex-wrap items-center gap-2 sm:gap-3 mb-2"},$e={class:"text-base sm:text-lg font-semibold truncate"},Se={class:"text-xs sm:text-sm text-muted-foreground line-clamp-2"},je={class:"flex items-center gap-2 flex-shrink-0"},De=["onClick","disabled"],Fe={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"},Te=["onClick"],Le={class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-4 pt-3 sm:pt-4 border-t"},Ae={class:"text-xs sm:text-sm font-medium flex items-center gap-1"},Ee={class:"truncate"},Me={class:"text-xs sm:text-sm font-medium flex items-center gap-1"},Ve={class:"text-xs sm:text-sm font-medium flex items-center gap-1"},ze={class:"text-xs sm:text-sm font-medium flex items-center gap-1"},Be={class:"text-xs sm:text-sm font-bold text-primary flex items-center gap-1"},Ne={key:3,class:"mt-4 sm:mt-6 flex justify-center gap-2"},Pe=["disabled"],He={class:"inline-flex items-center px-2 sm:px-4 text-xs sm:text-sm"},Ue=["disabled"],qe={class:"bg-background rounded-lg shadow-xl w-full max-w-sm sm:max-w-2xl max-h-[90vh] overflow-y-auto"},Re={class:"p-4 sm:p-6 border-b flex items-center justify-between"},Xe={class:"p-4 sm:p-6 space-y-4 sm:space-y-6"},Ge={class:"text-sm text-muted-foreground"},Ie={class:"p-3 sm:p-4 bg-muted/50 rounded-lg font-mono text-xs sm:text-sm whitespace-pre-wrap"},Je={class:"grid grid-cols-2 gap-3 sm:gap-4"},Ke={class:"text-xs sm:text-sm text-muted-foreground"},Oe={class:"grid grid-cols-2 gap-3 sm:gap-4"},Qe={class:"text-xl sm:text-2xl font-bold text-primary"},We={class:"text-xl sm:text-2xl font-bold text-primary"},Ye={class:"grid grid-cols-2 gap-3 sm:gap-4"},Ze={class:"text-xl sm:text-2xl font-bold"},es={class:"text-xl sm:text-2xl font-bold text-primary"},ss={key:0},ts={class:"flex flex-wrap gap-2"},os={class:"p-4 sm:p-6 border-t flex justify-end"},D=10,fs=G({__name:"CampaignHistory",setup(f){const p=J(),y=x([]),_=x(!1),b=x(null),l=x(null),g=x(1),n=x({search:"",status:"",dateFrom:"",dateTo:""}),F=E(()=>{let o=y.value;if(n.value.search){const t=n.value.search.toLowerCase();o=o.filter(m=>m.name.toLowerCase().includes(t)||m.message.toLowerCase().includes(t))}n.value.status&&(o=o.filter(t=>v(t.status)===n.value.status)),n.value.dateFrom&&(o=o.filter(t=>{const m=t.sent_at||t.scheduled_at;return m&&m>=n.value.dateFrom})),n.value.dateTo&&(o=o.filter(t=>{const m=t.sent_at||t.scheduled_at;return m&&m<=n.value.dateTo}));const s=(g.value-1)*D,r=s+D;return o.slice(s,r)}),k=E(()=>{let o=y.value;if(n.value.search||n.value.status||n.value.dateFrom||n.value.dateTo){const s=n.value.search.toLowerCase();o=o.filter(r=>{const t=!n.value.search||r.name.toLowerCase().includes(s)||r.message.toLowerCase().includes(s),m=!n.value.status||v(r.status)===n.value.status,R=!n.value.dateFrom||(r.sent_at||r.scheduled_at||"")>=n.value.dateFrom,X=!n.value.dateTo||(r.sent_at||r.scheduled_at||"")<=n.value.dateTo;return t&&m&&R&&X})}return Math.ceil(o.length/D)});function v(o){const s=(o==null?void 0:o.toLowerCase())||"";return s==="actif"||s==="sending"?"sending":s==="terminé"||s==="termine"?"completed":s==="planifié"||s==="planifie"?"scheduled":s}function T(o){const s=v(o);return{draft:"bg-muted text-muted-foreground",scheduled:"bg-primary/10 text-primary",sending:"bg-warning/10 text-warning",completed:"bg-success/10 text-success",failed:"bg-destructive/10 text-destructive",cancelled:"bg-muted text-muted-foreground"}[s]||"bg-muted text-muted-foreground"}function L(o){const s=v(o);return{draft:"Brouillon",scheduled:"Planifié",sending:"En cours",completed:"Terminé",failed:"Échoué",cancelled:"Annulé"}[s]||o}function A(o){return o?new Date(o).toLocaleString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}function H(o){l.value=o}async function U(o){var s,r;b.value=o.id;try{const t=await ne.clone(o.id);re(`Campagne "${t.name}" créée avec succès`),p.push("/campaign/create")}catch(t){console.error("Error cloning campaign:",t),P(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Erreur lors du clonage de la campagne")}finally{b.value=null}}async function q(){var o,s;_.value=!0;try{y.value=await ce.getAll()}catch(r){console.error("Error loading campaigns:",r),P(((s=(o=r.response)==null?void 0:o.data)==null?void 0:s.message)||"Erreur lors du chargement des campagnes")}finally{_.value=!1}}return I(()=>{q()}),(o,s)=>{const r=K("router-link");return u(),M(W,null,{default:C(()=>[e("div",fe,[e("div",pe,[e("div",null,[e("div",ge,[a(d(Y),{class:"w-6 h-6 sm:w-8 sm:h-8 text-primary"}),s[9]||(s[9]=e("h1",{class:"text-xl sm:text-3xl font-bold"},"Historique des campagnes",-1))]),s[10]||(s[10]=e("p",{class:"text-sm text-muted-foreground mt-1 sm:mt-2"},"Consultez toutes vos campagnes envoyées",-1))]),a(r,{to:"/campaigns/create",class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-9 sm:h-10 px-3 sm:px-4 py-2"},{default:C(()=>[a(d(N),{class:"w-4 h-4"}),s[11]||(s[11]=e("span",{class:"hidden sm:inline"},"Nouvelle campagne",-1)),s[12]||(s[12]=e("span",{class:"sm:hidden"},"Nouvelle",-1))]),_:1})]),e("div",xe,[e("div",be,[h(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>n.value.search=t),type:"text",placeholder:"Rechercher...",class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-xs sm:text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[$,n.value.search]])]),e("div",null,[h(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>n.value.status=t),class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-2 sm:px-3 py-2 text-xs sm:text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...s[13]||(s[13]=[e("option",{value:""},"Tous statuts",-1),e("option",{value:"draft"},"Brouillon",-1),e("option",{value:"scheduled"},"Planifié",-1),e("option",{value:"sending"},"En cours",-1),e("option",{value:"completed"},"Terminé",-1),e("option",{value:"failed"},"Échoué",-1),e("option",{value:"cancelled"},"Annulé",-1)])],512),[[O,n.value.status]])]),e("div",null,[h(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>n.value.dateFrom=t),type:"date",placeholder:"Date de début",class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-2 sm:px-3 py-2 text-xs sm:text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[$,n.value.dateFrom]])]),e("div",null,[h(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>n.value.dateTo=t),type:"date",placeholder:"Date de fin",class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-2 sm:px-3 py-2 text-xs sm:text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[$,n.value.dateTo]])])]),_.value?(u(),c("div",ve,[...s[14]||(s[14]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):F.value.length===0?(u(),c("div",he,[a(d(me),{class:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),s[16]||(s[16]=e("h3",{class:"text-lg font-semibold mb-2"},"Aucune campagne trouvée",-1)),e("p",we,i(n.value.search||n.value.status?"Essayez de modifier vos filtres":"Commencez par créer votre première campagne"),1),a(r,{to:"/campaigns/create",class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},{default:C(()=>[a(d(N),{class:"w-4 h-4"}),s[15]||(s[15]=e("span",null,"Créer une campagne",-1))]),_:1})])):(u(),c("div",ye,[(u(!0),c(V,null,z(F.value,t=>(u(),c("div",{key:t.id,class:"rounded-lg border bg-card shadow-sm p-4 sm:p-6 hover:shadow-md transition-shadow"},[e("div",_e,[e("div",ke,[e("div",Ce,[e("h3",$e,i(t.name),1),e("span",{class:B(["px-2 py-0.5 rounded-full text-xs font-medium flex-shrink-0",T(t.status)])},i(L(t.status)),3)]),e("p",Se,i(t.message),1)]),e("div",je,[e("button",{onClick:m=>U(t),disabled:b.value===t.id,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 sm:h-9 px-2 sm:px-3",title:"Dupliquer"},[b.value!==t.id?(u(),M(d(ie),{key:0,class:"w-4 h-4"})):(u(),c("div",Fe))],8,De),e("button",{onClick:m=>H(t),class:"inline-flex items-center justify-center gap-1.5 sm:gap-2 whitespace-nowrap rounded-md text-xs sm:text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 sm:h-9 px-2 sm:px-3"},[a(d(le),{class:"w-4 h-4"}),s[17]||(s[17]=e("span",{class:"hidden sm:inline"},"Détails",-1))],8,Te)])]),e("div",Le,[e("div",null,[s[18]||(s[18]=e("p",{class:"text-xs text-muted-foreground mb-0.5 sm:mb-1"},"Date",-1)),e("p",Ae,[a(d(Z),{class:"w-3 h-3 sm:w-4 sm:h-4 text-muted-foreground hidden sm:block"}),e("span",Ee,i(A(t.sent_at||t.scheduled_at)),1)])]),e("div",null,[s[19]||(s[19]=e("p",{class:"text-xs text-muted-foreground mb-0.5 sm:mb-1"},"Destinataires",-1)),e("p",Me,[a(d(ee),{class:"w-3 h-3 sm:w-4 sm:h-4 text-muted-foreground hidden sm:block"}),w(" "+i(t.recipients_count),1)])]),e("div",null,[s[20]||(s[20]=e("p",{class:"text-xs text-muted-foreground mb-0.5 sm:mb-1"},"SMS",-1)),e("p",Ve,[a(d(se),{class:"w-3 h-3 sm:w-4 sm:h-4 text-muted-foreground hidden sm:block"}),w(" "+i(t.sms_count),1)])]),e("div",null,[s[21]||(s[21]=e("p",{class:"text-xs text-muted-foreground mb-0.5 sm:mb-1"},"Livraison",-1)),e("p",ze,[a(d(te),{class:"w-3 h-3 sm:w-4 sm:h-4 text-muted-foreground hidden sm:block"}),w(" "+i(t.delivery_rate)+"% ",1)])]),e("div",null,[s[22]||(s[22]=e("p",{class:"text-xs text-muted-foreground mb-0.5 sm:mb-1"},"Coût",-1)),e("p",Be,[a(d(ae),{class:"w-3 h-3 sm:w-4 sm:h-4 hidden sm:block"}),w(" "+i(t.cost)+" XAF ",1)])])])]))),128))])),k.value>1?(u(),c("div",Ne,[e("button",{onClick:s[4]||(s[4]=t=>g.value--),disabled:g.value===1,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 sm:h-9 px-2 sm:px-3"},[a(d(de),{class:"w-4 h-4"})],8,Pe),e("span",He,i(g.value)+"/"+i(k.value),1),e("button",{onClick:s[5]||(s[5]=t=>g.value++),disabled:g.value===k.value,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 sm:h-9 px-2 sm:px-3"},[a(d(ue),{class:"w-4 h-4"})],8,Ue)])):S("",!0)]),l.value?(u(),c("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-3 sm:p-4",onClick:s[8]||(s[8]=Q(t=>l.value=null,["self"]))},[e("div",qe,[e("div",Re,[s[23]||(s[23]=e("h2",{class:"text-lg sm:text-2xl font-bold"},"Détails de la campagne",-1)),e("button",{onClick:s[6]||(s[6]=t=>l.value=null),class:"text-muted-foreground hover:text-foreground transition-colors"},[a(d(oe),{class:"w-5 h-5 sm:w-6 sm:h-6"})])]),e("div",Xe,[e("div",null,[s[24]||(s[24]=e("h3",{class:"font-semibold text-sm sm:text-base mb-1 sm:mb-2"},"Nom de la campagne",-1)),e("p",Ge,i(l.value.name),1)]),e("div",null,[s[25]||(s[25]=e("h3",{class:"font-semibold text-sm sm:text-base mb-1 sm:mb-2"},"Message",-1)),e("div",Ie,i(l.value.message),1)]),e("div",Je,[e("div",null,[s[26]||(s[26]=e("h3",{class:"font-semibold text-sm sm:text-base mb-1 sm:mb-2"},"Statut",-1)),e("span",{class:B(["inline-block px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-xs sm:text-sm font-medium",T(l.value.status)])},i(L(l.value.status)),3)]),e("div",null,[s[27]||(s[27]=e("h3",{class:"font-semibold text-sm sm:text-base mb-1 sm:mb-2"},"Date d'envoi",-1)),e("p",Ke,i(A(l.value.sent_at||l.value.scheduled_at)),1)])]),e("div",Oe,[e("div",null,[s[28]||(s[28]=e("h3",{class:"font-semibold text-sm sm:text-base mb-1 sm:mb-2"},"Destinataires",-1)),e("p",Qe,i(l.value.recipients_count),1)]),e("div",null,[s[29]||(s[29]=e("h3",{class:"font-semibold text-sm sm:text-base mb-1 sm:mb-2"},"SMS envoyés",-1)),e("p",We,i(l.value.sms_count),1)])]),e("div",Ye,[e("div",null,[s[30]||(s[30]=e("h3",{class:"font-semibold text-sm sm:text-base mb-1 sm:mb-2"},"Taux livraison",-1)),e("p",Ze,i(l.value.delivery_rate)+"%",1)]),e("div",null,[s[31]||(s[31]=e("h3",{class:"font-semibold text-sm sm:text-base mb-1 sm:mb-2"},"Coût total",-1)),e("p",es,i(l.value.cost)+" XAF",1)])]),l.value.groups&&l.value.groups.length>0?(u(),c("div",ss,[s[32]||(s[32]=e("h3",{class:"font-semibold text-sm sm:text-base mb-1 sm:mb-2"},"Groupes ciblés",-1)),e("div",ts,[(u(!0),c(V,null,z(l.value.groups,t=>(u(),c("span",{key:t.id,class:"px-2 sm:px-3 py-0.5 sm:py-1 bg-primary/10 text-primary rounded-full text-xs sm:text-sm"},i(t.name),1))),128))])])):S("",!0)]),e("div",os,[e("button",{onClick:s[7]||(s[7]=t=>l.value=null),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 sm:h-10 px-3 sm:px-4 py-2"}," Fermer ")])])])):S("",!0)]),_:1})}}});export{fs as default};
