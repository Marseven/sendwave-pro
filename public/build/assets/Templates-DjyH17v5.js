import{d as J,r as l,k as j,l as K,m as $,n as O,j as Q,o as r,b as e,p as c,q as f,t as i,c as a,F as S,x as T,y as W,s as X,w as V,f as g,v as A,A as k,g as E}from"./main-QOMeYZLg.js";import{_ as Y,h as Z,i as _,r as ee,j as se}from"./api-BdomKYOb.js";import{t as p}from"./templateService-Dy4Whud_.js";import{a as C,b as N,s as te}from"./notifications-CHQAjgV4.js";import{r as oe}from"./PencilIcon-CQf5oVaA.js";import{r as ne}from"./TrashIcon-XbWTkXzE.js";import{r as ie}from"./XMarkIcon-BZI0ZsR5.js";import{r as re,a as le,b as ae,c as de}from"./SunIcon-BUHnk8tV.js";import{r as ue}from"./CheckCircleIcon-Ci5j4t4y.js";const ce={class:"p-8"},fe={class:"mb-8 flex items-center justify-between"},me={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},ge={class:"rounded-lg border bg-card p-4"},ve={class:"text-2xl font-bold mt-1"},pe={class:"rounded-lg border bg-card p-4"},be={class:"text-2xl font-bold mt-1 text-success"},xe={class:"rounded-lg border bg-card p-4"},ye={class:"text-2xl font-bold mt-1 text-primary"},he={key:0,class:"flex items-center justify-center py-12"},we={key:1,class:"flex flex-col items-center justify-center py-12 rounded-lg border bg-card"},ke={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},_e={class:"p-6"},Ce={class:"flex items-start justify-between mb-4"},Me={class:"flex items-center gap-3"},je={class:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center"},$e={class:"font-semibold"},Se={class:"text-xs text-muted-foreground"},Te={class:"mb-4 p-3 bg-muted/50 rounded-lg"},Ve={class:"text-sm text-muted-foreground line-clamp-3"},Ae={class:"flex items-center justify-between text-xs text-muted-foreground mb-4"},Ee={class:"flex gap-2"},Ne=["onClick"],Ue=["onClick"],ze=["onClick"],qe={class:"bg-background rounded-lg shadow-lg w-full max-w-2xl p-6 max-h-[90vh] overflow-y-auto"},Ie={class:"flex items-center justify-between mb-6"},Be={class:"text-xl font-bold"},De={class:"grid grid-cols-2 gap-4"},Fe={class:"space-y-2"},Re={class:"space-y-2"},Le={class:"space-y-2"},Ge={class:"flex items-center justify-between"},Pe={class:"text-xs text-muted-foreground"},He={class:"p-4 bg-muted/50 rounded-lg"},Je={class:"flex flex-wrap gap-2"},Ke=["onClick"],Oe={class:"grid grid-cols-2 gap-4"},Qe={class:"space-y-2"},We={class:"space-y-2"},Xe={class:"flex gap-3 pt-4 border-t"},Ye=["disabled"],Ze={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},us=J({__name:"Templates",setup(es){const U=Q(),b=l(!1),x=l(!1),u=l([]),y=l(!1),m=l(!1),M=l(""),d=l(null),z=["{{name}}","{{email}}","{{phone}}","{{code}}"],n=l({name:"",category:"",message:"",icon:"document",status:"active"}),q={hand:re,sun:le,check:ue,calendar:se,cake:ae,gift:de,document:_};function I(o){return q[o]||_}const B=j(()=>u.value.filter(o=>o.status==="active").length),D=j(()=>u.value.reduce((o,s)=>o+(s.uses||0),0));async function h(){y.value=!0,M.value="";try{u.value=await p.getAll()}catch(o){M.value=o.message||"Erreur lors du chargement des modèles",console.error("Error loading templates:",o)}finally{y.value=!1}}function F(){d.value=null,n.value={name:"",category:"",message:"",icon:"document",status:"active"},b.value=!0}function R(o){d.value=o,n.value={name:o.name,category:o.category,message:o.message,icon:o.icon||"document",status:o.status},x.value=!0}function v(){b.value=!1,x.value=!1,d.value=null}function L(o){n.value.message+=o}async function G(){var o,s;m.value=!0;try{d.value?(await p.update(d.value.id,n.value),C("Modèle modifié avec succès")):(await p.create(n.value),C("Modèle créé avec succès")),v(),await h()}catch(t){N(((s=(o=t.response)==null?void 0:o.data)==null?void 0:s.message)||t.message||"Erreur lors de l'enregistrement")}finally{m.value=!1}}async function P(o){if(await te("Supprimer le modèle ?",`Êtes-vous sûr de vouloir supprimer "${o.name}" ?`))try{await p.delete(o.id),C("Modèle supprimé avec succès"),await h()}catch(t){N(t.message||"Erreur lors de la suppression")}}function H(o){U.push({path:"/campaign/create",query:{templateId:o.id.toString()}})}return K(()=>{h()}),(o,s)=>(r(),$(Y,null,{default:O(()=>[e("div",ce,[e("div",fe,[s[6]||(s[6]=e("div",null,[e("h1",{class:"text-3xl font-bold"},"Modèles SMS"),e("p",{class:"text-muted-foreground mt-2"},"Créez et gérez vos modèles de messages")],-1)),e("button",{onClick:F,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[c(f(Z),{class:"w-4 h-4"}),s[5]||(s[5]=e("span",null,"Nouveau modèle",-1))])]),e("div",me,[e("div",ge,[s[7]||(s[7]=e("div",{class:"text-sm text-muted-foreground"},"Total modèles",-1)),e("div",ve,i(u.value.length),1)]),e("div",pe,[s[8]||(s[8]=e("div",{class:"text-sm text-muted-foreground"},"Actifs",-1)),e("div",be,i(B.value),1)]),e("div",xe,[s[9]||(s[9]=e("div",{class:"text-sm text-muted-foreground"},"Utilisations",-1)),e("div",ye,i(D.value.toLocaleString("fr-FR")),1)])]),y.value?(r(),a("div",he,[...s[10]||(s[10]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):u.value.length===0?(r(),a("div",we,[c(f(_),{class:"w-16 h-16 text-muted-foreground mb-4"}),s[11]||(s[11]=e("p",{class:"text-lg font-medium"},"Aucun modèle trouvé",-1)),s[12]||(s[12]=e("p",{class:"text-sm text-muted-foreground mt-1"},"Créez votre premier modèle pour commencer",-1))])):(r(),a("div",ke,[(r(!0),a(S,null,T(u.value,t=>(r(),a("div",{key:t.id,class:"rounded-lg border bg-card shadow-sm hover:shadow-md transition-shadow"},[e("div",_e,[e("div",Ce,[e("div",Me,[e("div",je,[(r(),$(W(I(t.icon)),{class:"w-6 h-6 text-primary"}))]),e("div",null,[e("h3",$e,i(t.name),1),e("p",Se,i(t.category),1)])]),e("span",{class:X(["text-xs px-2 py-1 rounded-full",t.status==="active"?"bg-success/10 text-success":"bg-muted text-muted-foreground"])},i(t.status==="active"?"Actif":"Inactif"),3)]),e("div",Te,[e("p",Ve,i(t.message),1)]),e("div",Ae,[e("span",null,i(t.uses||0)+" utilisations",1),e("span",null,i(t.message.length)+" caractères",1)]),e("div",Ee,[e("button",{onClick:w=>R(t),class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9"},[c(f(oe),{class:"w-4 h-4"}),s[13]||(s[13]=e("span",null,"Modifier",-1))],8,Ne),e("button",{onClick:w=>P(t),class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-destructive/10 hover:text-destructive h-9 w-9"},[c(f(ne),{class:"w-4 h-4"})],8,Ue),e("button",{onClick:w=>H(t),class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9"},[c(f(ee),{class:"w-4 h-4"}),s[14]||(s[14]=e("span",null,"Utiliser",-1))],8,ze)])])]))),128))]))]),b.value||x.value?(r(),a("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:V(v,["self"])},[e("div",qe,[e("div",Ie,[e("h2",Be,i(d.value?"Modifier le modèle":"Nouveau modèle"),1),e("button",{onClick:v,class:"hover:bg-accent rounded-full p-1"},[c(f(ie),{class:"w-5 h-5"})])]),e("form",{onSubmit:V(G,["prevent"]),class:"space-y-4"},[e("div",De,[e("div",Fe,[s[15]||(s[15]=e("label",{class:"text-sm font-medium"},"Nom du modèle *",-1)),g(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>n.value.name=t),type:"text",required:"",placeholder:"Promotion été",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[A,n.value.name]])]),e("div",Re,[s[17]||(s[17]=e("label",{class:"text-sm font-medium"},"Catégorie *",-1)),g(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>n.value.category=t),required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...s[16]||(s[16]=[e("option",{value:""},"Sélectionner...",-1),e("option",{value:"Marketing"},"Marketing",-1),e("option",{value:"Transactionnel"},"Transactionnel",-1),e("option",{value:"Notification"},"Notification",-1),e("option",{value:"Rappel"},"Rappel",-1),e("option",{value:"Confirmation"},"Confirmation",-1)])],512),[[k,n.value.category]])])]),e("div",Le,[e("div",Ge,[s[18]||(s[18]=e("label",{class:"text-sm font-medium"},"Message *",-1)),e("span",Pe,i(n.value.message.length)+"/320 caractères",1)]),g(e("textarea",{"onUpdate:modelValue":s[2]||(s[2]=t=>n.value.message=t),required:"",rows:"6",maxlength:"320",placeholder:"Votre message avec des variables {{name}}, {{email}}, etc.",class:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 resize-none font-mono"},null,512),[[A,n.value.message]])]),e("div",He,[s[19]||(s[19]=e("p",{class:"text-sm font-medium mb-3"},"Variables disponibles :",-1)),e("div",Je,[(r(),a(S,null,T(z,t=>e("button",{key:t,type:"button",onClick:w=>L(t),class:"text-xs px-3 py-1.5 rounded-md bg-background hover:bg-primary hover:text-primary-foreground border border-border hover:border-primary transition-colors font-mono"},i(t),9,Ke)),64))])]),e("div",Oe,[e("div",Qe,[s[21]||(s[21]=e("label",{class:"text-sm font-medium"},"Icône",-1)),g(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>n.value.icon=t),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...s[20]||(s[20]=[e("option",{value:"document"},"Document",-1),e("option",{value:"hand"},"Main levée",-1),e("option",{value:"sun"},"Soleil",-1),e("option",{value:"check"},"Check",-1),e("option",{value:"calendar"},"Calendrier",-1),e("option",{value:"cake"},"Gâteau",-1),e("option",{value:"gift"},"Cadeau",-1)])],512),[[k,n.value.icon]])]),e("div",We,[s[23]||(s[23]=e("label",{class:"text-sm font-medium"},"Statut",-1)),g(e("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>n.value.status=t),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...s[22]||(s[22]=[e("option",{value:"active"},"Actif",-1),e("option",{value:"inactive"},"Inactif",-1)])],512),[[k,n.value.status]])])]),e("div",Xe,[e("button",{type:"button",onClick:v,class:"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Annuler "),e("button",{type:"submit",disabled:m.value,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[m.value?(r(),a("div",Ze)):E("",!0),e("span",null,i(m.value?"Enregistrement...":d.value?"Modifier":"Créer"),1)],8,Ye)])],32)])])):E("",!0)]),_:1}))}});export{us as default};
