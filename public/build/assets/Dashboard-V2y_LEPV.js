import{d as V,u as z,k as l,r as c,l as K,m as w,o as d,n as W,b as e,t as n,p as u,q as m,s as C,c as i,F as A,x as $,i as k,y as G}from"./main-CoGMHHt9.js";import{r as _,a as D,b as H,_ as J}from"./api-Cjgg3nLh.js";import{c as O}from"./contactService-R_PMywlp.js";import{c as Q}from"./campaignService-Dd1J1zio.js";import{r as S}from"./CheckCircleIcon-CWAwbvpF.js";const U={class:"p-8"},X={class:"mb-8"},Y={class:"text-muted-foreground mt-2"},Z={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},ee={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-6"},te={class:"flex items-center justify-between"},se={class:"text-3xl font-bold mt-2"},oe={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-6"},re={class:"flex items-center justify-between"},ne={class:"text-3xl font-bold mt-2"},ae={class:"text-xs text-muted-foreground mt-2"},de={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-6"},le={class:"flex items-center justify-between"},ie={class:"text-3xl font-bold mt-2"},ce={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-6"},ue={class:"flex items-center justify-between"},me={class:"text-3xl font-bold mt-2"},fe={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},xe={class:"rounded-lg border bg-card text-card-foreground shadow-sm"},ge={class:"p-6"},ve={key:0},_e={class:"flex items-center justify-between mb-2"},pe={class:"font-medium"},he={class:"flex items-center gap-4 text-sm text-muted-foreground"},be={class:"flex items-center gap-1"},ye={class:"flex items-center gap-1"},we={key:1,class:"text-center text-muted-foreground py-8"},Ce={class:"rounded-lg border bg-card text-card-foreground shadow-sm"},Ae={class:"p-6"},$e={key:0},ke={class:"flex-1"},De={class:"text-sm font-medium"},Se={class:"text-xs text-muted-foreground mt-1"},Re={key:1,class:"text-center text-muted-foreground py-8"},Ie=V({__name:"Dashboard",setup(Te){const R=z(),T=l(()=>R.user),x=c([]),f=c([]),p=c([]);c(null);const h=c(!1),j=l(()=>p.value.length),B=l(()=>f.value.filter(s=>s.status==="active"||s.status==="Actif").length),F=l(()=>f.value.filter(s=>s.status==="scheduled"||s.status==="Planifié").length),L=l(()=>{const s=f.value.reduce((t,r)=>t+(r.messages_sent||r.sent||0),0);return s>=1e3?`${(s/1e3).toFixed(1)}K`:s.toString()}),g=l(()=>{const s=f.value.filter(r=>r.delivery_rate||r.delivered);return s.length===0?0:(s.reduce((r,o)=>r+(o.delivery_rate||o.delivered||0),0)/s.length).toFixed(1)}),E=l(()=>{const s=parseFloat(g.value);return s>=95?"text-success":s>=85?"text-warning":"text-destructive"}),I=l(()=>{const s=parseFloat(g.value);return s>=95?"Excellent":s>=85?"Bon":s>0?"À améliorer":"Aucune donnée"}),v=c([]);async function M(){h.value=!0;try{const[s,t]=await Promise.all([Q.getAll(),O.getAll()]);f.value=s,x.value=s.slice(0,3),p.value=t,v.value=q(s,t)}catch(s){console.error("Error loading dashboard data:",s)}finally{h.value=!1}}function q(s,t){const r=[];s.slice(0,2).forEach(a=>{(a.messages_sent||a.sent)&&r.push({id:`campaign-${a.id}`,icon:_,title:`Campagne "${a.name}" envoyée à ${a.messages_sent||a.sent} contacts`,time:b(a.created_at)})});const o=t.slice(0,1);return o.length>0&&r.push({id:"contacts-recent",icon:D,title:`${o.length} nouveau(x) contact(s) importé(s)`,time:b(o[0].created_at)}),r.slice(0,4)}function b(s){if(!s)return"Récemment";const t=new Date(s),o=new Date().getTime()-t.getTime(),a=Math.floor(o/(1e3*60*60)),y=Math.floor(o/(1e3*60*60*24));return a<1?"Il y a quelques minutes":a<24?`Il y a ${a} heure${a>1?"s":""}`:y===1?"Il y a 1 jour":`Il y a ${y} jours`}function N(s){const t=s==null?void 0:s.toLowerCase();return t==="active"||t==="actif"?"bg-success/10 text-success":t==="scheduled"||t==="planifié"?"bg-warning/10 text-warning":"bg-muted text-muted-foreground"}function P(s){const t=s==null?void 0:s.toLowerCase();return t==="active"||t==="actif"?"Active":t==="scheduled"||t==="planifié"?"Planifiée":t==="completed"||t==="terminé"?"Terminée":s||"Inconnu"}return K(()=>{M()}),(s,t)=>(d(),w(J,null,{default:W(()=>{var r;return[e("div",U,[e("div",X,[t[0]||(t[0]=e("h1",{class:"text-3xl font-bold text-foreground"},"Tableau de bord",-1)),e("p",Y,"Bienvenue "+n((r=T.value)==null?void 0:r.name),1)]),e("div",Z,[e("div",ee,[e("div",te,[t[1]||(t[1]=e("h3",{class:"text-sm font-medium text-muted-foreground"},"Total Contacts",-1)),u(m(D),{class:"w-8 h-8 text-primary"})]),e("p",se,n(j.value),1),t[2]||(t[2]=e("p",{class:"text-xs text-muted-foreground mt-2"}," ",-1))]),e("div",oe,[e("div",re,[t[3]||(t[3]=e("h3",{class:"text-sm font-medium text-muted-foreground"},"Campagnes Actives",-1)),u(m(H),{class:"w-8 h-8 text-primary"})]),e("p",ne,n(B.value),1),e("p",ae,n(F.value)+" planifiées",1)]),e("div",de,[e("div",le,[t[4]||(t[4]=e("h3",{class:"text-sm font-medium text-muted-foreground"},"Messages Envoyés",-1)),u(m(_),{class:"w-8 h-8 text-primary"})]),e("p",ie,n(L.value),1),t[5]||(t[5]=e("p",{class:"text-xs text-muted-foreground mt-2"}," ",-1))]),e("div",ce,[e("div",ue,[t[6]||(t[6]=e("h3",{class:"text-sm font-medium text-muted-foreground"},"Taux de Livraison",-1)),u(m(S),{class:"w-8 h-8 text-success"})]),e("p",me,n(g.value)+"%",1),e("p",{class:C(["text-xs",E.value])},n(I.value),3)])]),e("div",fe,[e("div",xe,[t[8]||(t[8]=e("div",{class:"p-6 border-b border-border"},[e("h2",{class:"text-xl font-semibold"},"Campagnes Récentes")],-1)),e("div",ge,[x.value.length>0?(d(),i("div",ve,[(d(!0),i(A,null,$(x.value,o=>(d(),i("div",{key:o.id,class:"mb-4 last:mb-0 pb-4 last:pb-0 border-b last:border-b-0 border-border"},[e("div",_e,[e("h3",pe,n(o.name),1),e("span",{class:C(["text-xs px-2 py-1 rounded-full",N(o.status)])},n(P(o.status)),3)]),e("div",he,[e("span",be,[u(m(_),{class:"w-4 h-4"}),k(" "+n(o.messages_sent||o.sent||0)+" envoyés ",1)]),e("span",ye,[u(m(S),{class:"w-4 h-4"}),k(" "+n(o.delivery_rate||o.delivered||0)+"% livrés ",1)])])]))),128))])):(d(),i("div",we,[...t[7]||(t[7]=[e("p",{class:"text-sm"},"Aucune campagne récente",-1)])]))])]),e("div",Ce,[t[10]||(t[10]=e("div",{class:"p-6 border-b border-border"},[e("h2",{class:"text-xl font-semibold"},"Activité Récente")],-1)),e("div",Ae,[v.value.length>0?(d(),i("div",$e,[(d(!0),i(A,null,$(v.value,o=>(d(),i("div",{key:o.id,class:"mb-4 last:mb-0 flex items-start gap-3"},[(d(),w(G(o.icon),{class:"w-5 h-5 text-muted-foreground flex-shrink-0 mt-0.5"})),e("div",ke,[e("p",De,n(o.title),1),e("p",Se,n(o.time),1)])]))),128))])):(d(),i("div",Re,[...t[9]||(t[9]=[e("p",{class:"text-sm"},"Aucune activité récente",-1)])]))])])])])]}),_:1}))}});export{Ie as default};
