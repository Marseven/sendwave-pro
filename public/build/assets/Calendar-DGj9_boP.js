import{d as H,r as u,k as x,l as J,m as R,n as U,j as z,o as l,b as e,c as d,p as o,q as r,F as O,x as Y,t as i,w as D,f as y,v as _,g as $}from"./main-QOMeYZLg.js";import{_ as I,j as K,h as L,l as M,a as G}from"./api-BdomKYOb.js";import{c as w}from"./campaignService-D8bkkWI1.js";import{a as S,b as j,s as Q}from"./notifications-CHQAjgV4.js";import{r as W}from"./CalendarDaysIcon-AyD0u1cy.js";import{r as X}from"./PencilIcon-CQf5oVaA.js";import{r as E}from"./XMarkIcon-BZI0ZsR5.js";import{r as Z}from"./BellAlertIcon-BvrxWtFX.js";const ee={class:"p-8"},te={key:0,class:"flex items-center justify-center py-12"},se={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ne={class:"lg:col-span-2 rounded-lg border bg-card p-6"},oe={class:"flex items-center gap-2 mb-4"},re={key:0,class:"text-center py-12"},ie={key:1,class:"space-y-3"},ae={class:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center font-semibold"},le={class:"text-center"},de={class:"text-xs"},ue={class:"text-lg"},ce={class:"flex-1"},me={class:"font-medium"},fe={class:"flex items-center gap-2 text-sm text-muted-foreground"},pe={class:"flex items-center gap-2"},ge={class:"text-xs px-2 py-1 rounded-full bg-warning/10 text-warning flex items-center gap-1"},ve=["onClick"],be=["onClick"],he={class:"rounded-lg border bg-card p-6"},xe={class:"flex items-center gap-2 mb-4"},ye={class:"text-2xl font-bold mb-2"},_e={class:"mt-6 space-y-2"},we={class:"flex items-center justify-between text-sm"},ke={class:"font-semibold"},Ce={class:"flex items-center justify-between text-sm"},De={class:"font-semibold"},$e={class:"bg-background rounded-lg shadow-lg w-full max-w-md p-6"},Me={class:"flex items-center justify-between mb-6"},Se={class:"space-y-2"},je={class:"grid grid-cols-2 gap-4"},Ee={class:"space-y-2"},Fe={class:"space-y-2"},Ae={class:"flex gap-3 pt-4 border-t"},Ne=["disabled"],Te={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Oe=H({__name:"Calendar",setup(Ve){z();const v=u(!0),c=u(!1),b=u(!1),k=u([]),f=u(null),a=u({name:"",scheduled_date:"",scheduled_time:""}),m=x(()=>k.value.filter(s=>s.status==="Planifié"||s.status==="scheduled").filter(s=>s.scheduled_at).sort((s,t)=>new Date(s.scheduled_at).getTime()-new Date(t.scheduled_at).getTime())),C=x(()=>{const s=new Date,t=new Date(s.getTime()+7*24*60*60*1e3);return m.value.filter(n=>{const g=new Date(n.scheduled_at);return g>=s&&g<=t}).length}),F=x(()=>{const s=new Date;return m.value.filter(t=>{const n=new Date(t.scheduled_at);return n.getMonth()===s.getMonth()&&n.getFullYear()===s.getFullYear()}).length});function A(s){return s?["Jan","Fév","Mar","Avr","Mai","Juin","Juil","Aoû","Sep","Oct","Nov","Déc"][new Date(s).getMonth()]:""}function N(s){return s?new Date(s).getDate().toString().padStart(2,"0"):""}function T(s){if(!s)return"";const t=new Date(s);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}function V(s){return s>=1e3?`${(s/1e3).toFixed(1)}K`:s.toString()}async function h(){try{v.value=!0,k.value=await w.getAll()}catch(s){console.error("Error loading campaigns:",s)}finally{v.value=!1}}function B(s){f.value=s;const t=new Date(s.scheduled_at);a.value={name:s.name,scheduled_date:t.toISOString().split("T")[0],scheduled_time:`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},b.value=!0}function p(){b.value=!1,f.value=null}async function P(){var s,t;if(f.value){c.value=!0;try{const n=`${a.value.scheduled_date} ${a.value.scheduled_time}`;await w.update(f.value.id,{scheduled_at:n}),S("Campagne reprogrammée avec succès"),p(),await h()}catch(n){j(((t=(s=n.response)==null?void 0:s.data)==null?void 0:t.message)||n.message||"Erreur lors de la reprogrammation")}finally{c.value=!1}}}async function q(s){if(await Q("Annuler la campagne ?",`Êtes-vous sûr de vouloir annuler la campagne "${s.name}" ?`))try{await w.delete(s.id),S("Campagne annulée avec succès"),await h()}catch(n){j(n.message||"Erreur lors de l'annulation")}}return J(()=>{h()}),(s,t)=>(l(),R(I,null,{default:U(()=>[e("div",ee,[t[14]||(t[14]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold"},"Calendrier"),e("p",{class:"text-muted-foreground mt-2"},"Planifiez vos campagnes SMS")],-1)),v.value?(l(),d("div",te,[...t[4]||(t[4]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):(l(),d("div",se,[e("div",ne,[e("div",oe,[o(r(K),{class:"w-5 h-5 text-primary"}),t[5]||(t[5]=e("h3",{class:"font-semibold"},"Campagnes planifiées",-1))]),m.value.length===0?(l(),d("div",re,[o(r(W),{class:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),t[7]||(t[7]=e("p",{class:"text-muted-foreground"},"Aucune campagne planifiée",-1)),e("button",{onClick:t[0]||(t[0]=n=>s.$router.push("/campaign/create")),class:"mt-4 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[o(r(L),{class:"w-4 h-4"}),t[6]||(t[6]=e("span",null,"Planifier une campagne",-1))])])):(l(),d("div",ie,[(l(!0),d(O,null,Y(m.value,n=>(l(),d("div",{key:n.id,class:"flex items-center gap-4 p-4 border rounded-lg hover:bg-muted/50 transition-colors group"},[e("div",ae,[e("div",le,[e("div",de,i(A(n.scheduled_at)),1),e("div",ue,i(N(n.scheduled_at)),1)])]),e("div",ce,[e("div",me,i(n.name),1),e("div",fe,[o(r(M),{class:"w-4 h-4"}),e("span",null,i(T(n.scheduled_at)),1),t[8]||(t[8]=e("span",null,"•",-1)),o(r(G),{class:"w-4 h-4"}),e("span",null,i(V(n.messages_sent||0))+" destinataires",1)])]),e("div",pe,[e("span",ge,[o(r(M),{class:"w-3 h-3"}),t[9]||(t[9]=e("span",null,"Planifiée",-1))]),e("button",{onClick:g=>B(n),class:"opacity-0 group-hover:opacity-100 transition-opacity inline-flex items-center justify-center rounded-md text-sm font-medium hover:bg-accent h-8 w-8",title:"Modifier"},[o(r(X),{class:"w-4 h-4"})],8,ve),e("button",{onClick:g=>q(n),class:"opacity-0 group-hover:opacity-100 transition-opacity inline-flex items-center justify-center rounded-md text-sm font-medium hover:bg-destructive/10 hover:text-destructive h-8 w-8",title:"Annuler"},[o(r(E),{class:"w-4 h-4"})],8,be)])]))),128))]))]),e("div",he,[e("div",xe,[o(r(Z),{class:"w-5 h-5 text-primary"}),t[10]||(t[10]=e("h3",{class:"font-semibold"},"À venir",-1))]),e("div",ye,i(C.value)+" campagne"+i(C.value>1?"s":""),1),t[13]||(t[13]=e("p",{class:"text-sm text-muted-foreground"},"dans les 7 prochains jours",-1)),e("div",_e,[e("div",we,[t[11]||(t[11]=e("span",{class:"text-muted-foreground"},"Ce mois-ci",-1)),e("span",ke,i(F.value),1)]),e("div",Ce,[t[12]||(t[12]=e("span",{class:"text-muted-foreground"},"Total planifiées",-1)),e("span",De,i(m.value.length),1)])])])]))]),b.value?(l(),d("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:D(p,["self"])},[e("div",$e,[e("div",Me,[t[15]||(t[15]=e("h2",{class:"text-xl font-bold"},"Reprogrammer la campagne",-1)),e("button",{onClick:p,class:"hover:bg-accent rounded-full p-1"},[o(r(E),{class:"w-5 h-5"})])]),e("form",{onSubmit:D(P,["prevent"]),class:"space-y-4"},[e("div",Se,[t[16]||(t[16]=e("label",{class:"text-sm font-medium"},"Nom de la campagne",-1)),y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>a.value.name=n),type:"text",readonly:"",class:"flex h-10 w-full rounded-md border border-input bg-muted px-3 py-2 text-sm"},null,512),[[_,a.value.name]])]),e("div",je,[e("div",Ee,[t[17]||(t[17]=e("label",{class:"text-sm font-medium"},"Date *",-1)),y(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>a.value.scheduled_date=n),type:"date",required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[_,a.value.scheduled_date]])]),e("div",Fe,[t[18]||(t[18]=e("label",{class:"text-sm font-medium"},"Heure *",-1)),y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>a.value.scheduled_time=n),type:"time",required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[_,a.value.scheduled_time]])])]),e("div",Ae,[e("button",{type:"button",onClick:p,class:"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Annuler "),e("button",{type:"submit",disabled:c.value,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[c.value?(l(),d("div",Te)):$("",!0),e("span",null,i(c.value?"Enregistrement...":"Reprogrammer"),1)],8,Ne)])],32)])])):$("",!0)]),_:1}))}});export{Oe as default};
