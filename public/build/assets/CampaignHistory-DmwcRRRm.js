import{d as B,r as p,k as T,l as U,m as H,n as w,I as q,o as c,b as e,p as a,q as d,f as x,v as _,A as I,c as f,t as l,F as A,x as L,s as M,i as b,g as k,w as R}from"./main-QOMeYZLg.js";import{e as C,_ as X,l as G,h as V,j as J,a as K,c as O,b as Q}from"./api-BdomKYOb.js";import{b as W}from"./notifications-CHQAjgV4.js";import{r as Y}from"./FolderOpenIcon-BzKA73zu.js";import{r as Z}from"./EyeIcon-CdJQ5_-h.js";import{r as ee,a as te,b as se}from"./ChevronRightIcon-BhH_CpAE.js";import{r as oe}from"./XMarkIcon-BZI0ZsR5.js";const ne={async getAll(g){const m=await C.get("/campaigns/history",{params:g});return m.data.data||m.data},async getById(g){const m=await C.get(`/campaigns/${g}`);return m.data.data||m.data},async getStats(){const g=await C.get("/campaigns/stats");return g.data.data||g.data}},le={class:"p-8"},re={class:"mb-8 flex items-center justify-between"},ie={class:"flex items-center gap-2"},ae={class:"mb-6 grid grid-cols-1 md:grid-cols-4 gap-4"},de={key:0,class:"flex justify-center items-center py-12"},ue={key:1,class:"text-center py-16"},ce={class:"text-muted-foreground mb-6"},fe={key:2,class:"space-y-4"},me={class:"flex items-start justify-between mb-4"},ge={class:"flex-1"},ve={class:"flex items-center gap-3 mb-2"},pe={class:"text-lg font-semibold"},be={class:"text-sm text-muted-foreground line-clamp-2"},xe=["onClick"],he={class:"grid grid-cols-2 md:grid-cols-5 gap-4 pt-4 border-t"},ye={class:"text-sm font-medium flex items-center gap-1.5"},we={class:"text-sm font-medium flex items-center gap-1.5"},_e={class:"text-sm font-medium flex items-center gap-1.5"},ke={class:"text-sm font-medium flex items-center gap-1.5"},Ce={class:"text-sm font-bold text-primary flex items-center gap-1.5"},$e={key:3,class:"mt-6 flex justify-center gap-2"},De=["disabled"],Fe={class:"inline-flex items-center px-4 text-sm"},je=["disabled"],Se={class:"bg-background rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},Te={class:"p-6 border-b flex items-center justify-between"},Ae={class:"p-6 space-y-6"},Le={class:"text-muted-foreground"},Me={class:"p-4 bg-muted/50 rounded-lg font-mono text-sm whitespace-pre-wrap"},Ve={class:"grid grid-cols-2 gap-4"},Ee={class:"text-muted-foreground"},Ne={class:"grid grid-cols-2 gap-4"},Pe={class:"text-2xl font-bold text-primary"},ze={class:"text-2xl font-bold text-primary"},Be={class:"grid grid-cols-2 gap-4"},Ue={class:"text-2xl font-bold"},He={class:"text-2xl font-bold text-primary"},qe={key:0},Ie={class:"flex flex-wrap gap-2"},Re={class:"p-6 border-t flex justify-end"},$=10,Ye=B({__name:"CampaignHistory",setup(g){const m=p([]),h=p(!1),r=p(null),v=p(1),o=p({search:"",status:"",dateFrom:"",dateTo:""}),D=T(()=>{let n=m.value;if(o.value.search){const s=o.value.search.toLowerCase();n=n.filter(u=>u.name.toLowerCase().includes(s)||u.message.toLowerCase().includes(s))}o.value.status&&(n=n.filter(s=>s.status===o.value.status)),o.value.dateFrom&&(n=n.filter(s=>{const u=s.sent_at||s.scheduled_at;return u&&u>=o.value.dateFrom})),o.value.dateTo&&(n=n.filter(s=>{const u=s.sent_at||s.scheduled_at;return u&&u<=o.value.dateTo}));const t=(v.value-1)*$,i=t+$;return n.slice(t,i)}),y=T(()=>{let n=m.value;if(o.value.search||o.value.status||o.value.dateFrom||o.value.dateTo){const t=o.value.search.toLowerCase();n=n.filter(i=>{const s=!o.value.search||i.name.toLowerCase().includes(t)||i.message.toLowerCase().includes(t),u=!o.value.status||i.status===o.value.status,P=!o.value.dateFrom||(i.sent_at||i.scheduled_at||"")>=o.value.dateFrom,z=!o.value.dateTo||(i.sent_at||i.scheduled_at||"")<=o.value.dateTo;return s&&u&&P&&z})}return Math.ceil(n.length/$)});function F(n){return{completed:"bg-success/10 text-success",scheduled:"bg-primary/10 text-primary",cancelled:"bg-muted text-muted-foreground",failed:"bg-destructive/10 text-destructive"}[n]||"bg-muted text-muted-foreground"}function j(n){return{completed:"Envoyé",scheduled:"Planifié",cancelled:"Annulé",failed:"Échoué"}[n]||n}function S(n){return n?new Date(n).toLocaleString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}function E(n){r.value=n}async function N(){var n,t;h.value=!0;try{m.value=await ne.getAll()}catch(i){console.error("Error loading campaigns:",i),W(((t=(n=i.response)==null?void 0:n.data)==null?void 0:t.message)||"Erreur lors du chargement des campagnes")}finally{h.value=!1}}return U(()=>{N()}),(n,t)=>{const i=q("router-link");return c(),H(X,null,{default:w(()=>[e("div",le,[e("div",re,[e("div",null,[e("div",ie,[a(d(G),{class:"w-8 h-8 text-primary"}),t[9]||(t[9]=e("h1",{class:"text-3xl font-bold"},"Historique des campagnes",-1))]),t[10]||(t[10]=e("p",{class:"text-muted-foreground mt-2"},"Consultez toutes vos campagnes envoyées",-1))]),a(i,{to:"/campaigns/create",class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},{default:w(()=>[a(d(V),{class:"w-4 h-4"}),t[11]||(t[11]=e("span",null,"Nouvelle campagne",-1))]),_:1})]),e("div",ae,[e("div",null,[x(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.value.search=s),type:"text",placeholder:"Rechercher...",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[_,o.value.search]])]),e("div",null,[x(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>o.value.status=s),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...t[12]||(t[12]=[e("option",{value:""},"Tous les statuts",-1),e("option",{value:"completed"},"Envoyé",-1),e("option",{value:"scheduled"},"Planifié",-1),e("option",{value:"cancelled"},"Annulé",-1),e("option",{value:"failed"},"Échoué",-1)])],512),[[I,o.value.status]])]),e("div",null,[x(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>o.value.dateFrom=s),type:"date",placeholder:"Date de début",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[_,o.value.dateFrom]])]),e("div",null,[x(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.dateTo=s),type:"date",placeholder:"Date de fin",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[_,o.value.dateTo]])])]),h.value?(c(),f("div",de,[...t[13]||(t[13]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):D.value.length===0?(c(),f("div",ue,[a(d(Y),{class:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),t[15]||(t[15]=e("h3",{class:"text-lg font-semibold mb-2"},"Aucune campagne trouvée",-1)),e("p",ce,l(o.value.search||o.value.status?"Essayez de modifier vos filtres":"Commencez par créer votre première campagne"),1),a(i,{to:"/campaigns/create",class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},{default:w(()=>[a(d(V),{class:"w-4 h-4"}),t[14]||(t[14]=e("span",null,"Créer une campagne",-1))]),_:1})])):(c(),f("div",fe,[(c(!0),f(A,null,L(D.value,s=>(c(),f("div",{key:s.id,class:"rounded-lg border bg-card shadow-sm p-6 hover:shadow-md transition-shadow"},[e("div",me,[e("div",ge,[e("div",ve,[e("h3",pe,l(s.name),1),e("span",{class:M(["px-2.5 py-0.5 rounded-full text-xs font-medium",F(s.status)])},l(j(s.status)),3)]),e("p",be,l(s.message),1)]),e("button",{onClick:u=>E(s),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"},[a(d(Z),{class:"w-4 h-4"}),t[16]||(t[16]=e("span",null,"Détails",-1))],8,xe)]),e("div",he,[e("div",null,[t[17]||(t[17]=e("p",{class:"text-xs text-muted-foreground mb-1"},"Date d'envoi",-1)),e("p",ye,[a(d(J),{class:"w-4 h-4 text-muted-foreground"}),b(" "+l(S(s.sent_at||s.scheduled_at)),1)])]),e("div",null,[t[18]||(t[18]=e("p",{class:"text-xs text-muted-foreground mb-1"},"Destinataires",-1)),e("p",we,[a(d(K),{class:"w-4 h-4 text-muted-foreground"}),b(" "+l(s.recipients_count),1)])]),e("div",null,[t[19]||(t[19]=e("p",{class:"text-xs text-muted-foreground mb-1"},"SMS envoyés",-1)),e("p",_e,[a(d(O),{class:"w-4 h-4 text-muted-foreground"}),b(" "+l(s.sms_count),1)])]),e("div",null,[t[20]||(t[20]=e("p",{class:"text-xs text-muted-foreground mb-1"},"Taux de livraison",-1)),e("p",ke,[a(d(Q),{class:"w-4 h-4 text-muted-foreground"}),b(" "+l(s.delivery_rate)+"% ",1)])]),e("div",null,[t[21]||(t[21]=e("p",{class:"text-xs text-muted-foreground mb-1"},"Coût total",-1)),e("p",Ce,[a(d(ee),{class:"w-4 h-4"}),b(" "+l(s.cost)+" XAF ",1)])])])]))),128))])),y.value>1?(c(),f("div",$e,[e("button",{onClick:t[4]||(t[4]=s=>v.value--),disabled:v.value===1,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"},[a(d(te),{class:"w-4 h-4"})],8,De),e("span",Fe," Page "+l(v.value)+" sur "+l(y.value),1),e("button",{onClick:t[5]||(t[5]=s=>v.value++),disabled:v.value===y.value,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"},[a(d(se),{class:"w-4 h-4"})],8,je)])):k("",!0)]),r.value?(c(),f("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:t[8]||(t[8]=R(s=>r.value=null,["self"]))},[e("div",Se,[e("div",Te,[t[22]||(t[22]=e("h2",{class:"text-2xl font-bold"},"Détails de la campagne",-1)),e("button",{onClick:t[6]||(t[6]=s=>r.value=null),class:"text-muted-foreground hover:text-foreground transition-colors"},[a(d(oe),{class:"w-6 h-6"})])]),e("div",Ae,[e("div",null,[t[23]||(t[23]=e("h3",{class:"font-semibold mb-2"},"Nom de la campagne",-1)),e("p",Le,l(r.value.name),1)]),e("div",null,[t[24]||(t[24]=e("h3",{class:"font-semibold mb-2"},"Message",-1)),e("div",Me,l(r.value.message),1)]),e("div",Ve,[e("div",null,[t[25]||(t[25]=e("h3",{class:"font-semibold mb-2"},"Statut",-1)),e("span",{class:M(["inline-block px-3 py-1 rounded-full text-sm font-medium",F(r.value.status)])},l(j(r.value.status)),3)]),e("div",null,[t[26]||(t[26]=e("h3",{class:"font-semibold mb-2"},"Date d'envoi",-1)),e("p",Ee,l(S(r.value.sent_at||r.value.scheduled_at)),1)])]),e("div",Ne,[e("div",null,[t[27]||(t[27]=e("h3",{class:"font-semibold mb-2"},"Destinataires",-1)),e("p",Pe,l(r.value.recipients_count),1)]),e("div",null,[t[28]||(t[28]=e("h3",{class:"font-semibold mb-2"},"SMS envoyés",-1)),e("p",ze,l(r.value.sms_count),1)])]),e("div",Be,[e("div",null,[t[29]||(t[29]=e("h3",{class:"font-semibold mb-2"},"Taux de livraison",-1)),e("p",Ue,l(r.value.delivery_rate)+"%",1)]),e("div",null,[t[30]||(t[30]=e("h3",{class:"font-semibold mb-2"},"Coût total",-1)),e("p",He,l(r.value.cost)+" XAF",1)])]),r.value.groups&&r.value.groups.length>0?(c(),f("div",qe,[t[31]||(t[31]=e("h3",{class:"font-semibold mb-2"},"Groupes ciblés",-1)),e("div",Ie,[(c(!0),f(A,null,L(r.value.groups,s=>(c(),f("span",{key:s.id,class:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm"},l(s.name),1))),128))])])):k("",!0)]),e("div",Re,[e("button",{onClick:t[7]||(t[7]=s=>r.value=null),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Fermer ")])])])):k("",!0)]),_:1})}}});export{Ye as default};
