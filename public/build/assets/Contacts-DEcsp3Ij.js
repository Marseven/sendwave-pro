import{d as Ke,r as a,j as C,l as Je,m as ae,n as Qe,o as l,b as e,c as r,s as c,x as d,t as n,g as m,f as v,v as D,C as X,F as j,p as $,q,w as Y,B as de,z as R}from"./main-GXHSoYD-.js";import{_ as We,f as Z,h as he,o as ye,c as Xe,i as ue,g as Ye}from"./api--QcLuAnz.js";import{c as z}from"./contactService-BLehVF1M.js";import{a as U,b as h,s as Ze}from"./notifications-CHQAjgV4.js";import{r as et}from"./ArrowUpTrayIcon-DsYz98hN.js";import{r as _e}from"./ArrowDownTrayIcon-cTceKpqc.js";import{r as we}from"./PencilIcon-gTEbJ3sV.js";import{r as ee}from"./TrashIcon-BOZy2fVK.js";import{r as tt}from"./TagIcon-BHB5d3lU.js";import{r as st}from"./DocumentArrowUpIcon-BABGRWyF.js";import{r as ot}from"./InformationCircleIcon-DhA7yhJ5.js";import{r as nt}from"./ExclamationTriangleIcon-HOr1Nho5.js";import{r as lt}from"./CheckCircleIcon-Bokxsqig.js";const rt={class:"p-4 sm:p-6 lg:p-8"},it={class:"mb-4 sm:mb-6 lg:mb-8"},at={class:"flex flex-col gap-4"},dt={class:"flex flex-wrap gap-2"},ut=["disabled"],ct={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"},mt={class:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6 mb-4 sm:mb-6 lg:mb-8"},pt={class:"rounded-lg border bg-card p-3 sm:p-4"},ft={class:"text-xl sm:text-2xl font-bold mt-1"},vt={class:"rounded-lg border bg-card p-3 sm:p-4"},gt={class:"text-xl sm:text-2xl font-bold mt-1 text-success"},xt={class:"rounded-lg border bg-card p-3 sm:p-4"},bt={class:"text-xl sm:text-2xl font-bold mt-1 text-muted-foreground"},ht={class:"rounded-lg border bg-card p-3 sm:p-4"},yt={class:"text-xl sm:text-2xl font-bold mt-1 text-primary"},_t={class:"rounded-lg border bg-card shadow-sm mb-4 sm:mb-6 p-3 sm:p-4 lg:p-6"},wt={class:"flex flex-col sm:flex-row gap-3 sm:gap-4"},kt={class:"flex-1"},Ct={class:"rounded-lg border bg-card shadow-sm"},jt={key:0,class:"flex items-center justify-center py-8 sm:py-12"},$t={key:1,class:"flex flex-col items-center justify-center py-8 sm:py-12 px-4"},At={key:2},St={class:"hidden md:block overflow-x-auto"},Et={class:"w-full"},Vt={class:"border-b bg-muted/50"},Mt={class:"h-10 sm:h-12 px-3 sm:px-4 text-left align-middle font-medium text-muted-foreground text-xs sm:text-sm"},Ft=["checked"],It={class:"p-3 sm:p-4"},Dt=["checked","onChange"],zt={class:"p-3 sm:p-4 font-medium text-sm"},Ut={class:"p-3 sm:p-4 text-xs sm:text-sm text-muted-foreground truncate max-w-[150px]"},Gt={class:"p-3 sm:p-4 text-xs sm:text-sm"},Nt={class:"p-3 sm:p-4"},Tt={class:"p-3 sm:p-4 text-xs sm:text-sm text-muted-foreground hidden lg:table-cell"},Lt={class:"p-3 sm:p-4"},Bt={class:"flex gap-1"},qt=["onClick"],Rt=["onClick"],Ot={class:"md:hidden divide-y"},Pt={class:"flex items-start justify-between gap-3"},Ht={class:"flex items-start gap-3 flex-1 min-w-0"},Kt=["checked","onChange"],Jt={class:"flex-1 min-w-0"},Qt={class:"font-medium text-sm truncate"},Wt={class:"text-xs text-muted-foreground truncate"},Xt={class:"text-xs text-muted-foreground truncate"},Yt={class:"flex flex-wrap items-center gap-2 mt-2"},Zt={class:"text-xs text-muted-foreground"},es={class:"flex gap-1 flex-shrink-0"},ts=["onClick"],ss=["onClick"],os={class:"flex flex-col sm:flex-row items-center justify-between gap-3 mt-4 sm:mt-6"},ns={class:"text-xs sm:text-sm text-muted-foreground text-center sm:text-left"},ls={class:"bg-background rounded-lg shadow-lg w-full max-w-sm sm:max-w-md p-4 sm:p-6 max-h-[90vh] overflow-y-auto"},rs={class:"flex items-center justify-between mb-6"},is={class:"text-xl font-bold"},as={class:"space-y-2"},ds={class:"space-y-2"},us={class:"space-y-2"},cs={class:"space-y-2"},ms={class:"space-y-3 pt-4 border-t"},ps={class:"flex items-center justify-between"},fs={key:0,class:"space-y-2"},vs={class:"flex-1"},gs={class:"text-xs font-medium text-muted-foreground"},xs={class:"text-sm"},bs=["onClick"],hs={class:"space-y-2 p-3 bg-muted/30 rounded-lg"},ys={class:"grid grid-cols-2 gap-2"},_s={class:"flex gap-3 pt-4 border-t"},ws=["disabled"],ks={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Cs={class:"bg-background rounded-lg shadow-lg w-full max-w-sm sm:max-w-2xl lg:max-w-4xl max-h-[90vh] overflow-y-auto p-4 sm:p-6"},js={class:"flex items-center justify-between mb-6"},$s={key:0,class:"space-y-6"},As={class:"border-2 border-dashed rounded-lg p-8 text-center"},Ss={key:0,class:"p-4 bg-muted rounded-lg"},Es={class:"flex items-center justify-between"},Vs={class:"flex items-center gap-3"},Ms={class:"font-medium"},Fs={class:"text-xs text-muted-foreground"},Is={class:"space-y-3"},Ds={class:"grid grid-cols-1 sm:grid-cols-3 gap-3"},zs={class:"p-4 bg-primary/10 rounded-lg border border-primary/20"},Us={class:"flex items-start gap-3"},Gs={class:"flex justify-end gap-3 pt-4 border-t"},Ns=["disabled"],Ts={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Ls={key:1,class:"space-y-6"},Bs={class:"p-4 bg-muted/50 rounded-lg"},qs={class:"text-xs text-muted-foreground"},Rs={class:"space-y-4"},Os={class:"p-3 bg-muted rounded-lg"},Ps={class:"font-medium"},Hs={class:"text-xs text-muted-foreground mt-1"},Ks={class:"space-y-2"},Js=["onUpdate:modelValue"],Qs={class:"p-4 bg-warning/10 rounded-lg border border-warning/20"},Ws={class:"flex items-start gap-3"},Xs={class:"flex justify-between gap-3 pt-4 border-t"},Ys=["disabled"],Zs={key:2,class:"space-y-6"},eo={class:"p-4 bg-muted/50 rounded-lg"},to={class:"flex items-center justify-between"},so={class:"text-xs text-muted-foreground"},oo={class:"text-right"},no={class:"text-2xl font-bold text-primary"},lo={class:"rounded-lg border overflow-hidden max-h-64 overflow-y-auto"},ro={class:"w-full"},io={class:"border-b bg-muted/50 sticky top-0"},ao={key:0,class:"text-primary"},uo={key:0,class:"text-center text-sm text-muted-foreground"},co={class:"p-4 bg-primary/5 rounded-lg border"},mo={class:"grid grid-cols-2 gap-2 text-sm"},po={class:"font-medium"},fo={class:"font-medium"},vo={class:"font-medium"},go={class:"flex justify-between gap-3 pt-4 border-t"},xo=["disabled"],bo={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},ho={key:3,class:"space-y-6"},yo={class:"text-center py-6"},_o={key:0,class:"space-y-4"},wo={class:"grid grid-cols-3 gap-4 max-w-md mx-auto"},ko={class:"p-4 bg-success/10 rounded-lg"},Co={class:"text-2xl font-bold text-success"},jo={class:"p-4 bg-primary/10 rounded-lg"},$o={class:"text-2xl font-bold text-primary"},Ao={class:"p-4 bg-muted rounded-lg"},So={class:"text-2xl font-bold"},Eo={key:0,class:"mt-4 text-left max-h-40 overflow-y-auto"},Vo={class:"p-4 bg-destructive/10 rounded-lg border border-destructive/20"},Mo={class:"text-sm font-medium text-destructive mb-2"},Fo={class:"text-xs text-muted-foreground space-y-1"},Io={key:0,class:"text-xs text-muted-foreground mt-2"},Do={class:"bg-background rounded-lg shadow-lg w-full max-w-sm sm:max-w-md"},zo={class:"border-b p-6"},Uo={class:"flex items-center justify-between"},Go={class:"text-sm text-muted-foreground mt-2"},No={class:"p-6 space-y-4"},To={key:0,class:"text-center py-6"},Lo={key:1,class:"space-y-2"},Bo=["value"],qo={class:"flex gap-3 pt-4 border-t"},Ro=["disabled"],Oo={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},ln=Ke({__name:"Contacts",setup(Po){const O=a(""),P=a("all"),te=a(!1),se=a(!1),oe=a(!1),ne=a(!1),w=a([]),H=a([]),f=a([]),S=a(null),le=a(!1),G=a(!1),K=a(!1),ce=a(""),N=a(!1),p=a({name:"",email:"",phone:"",status:"active",custom_fields:{}}),E=a(null),V=a(""),F=a(""),y=a(1),g=a(null),T=a([]),L=a([]),_=a({}),x=a("skip"),k=a(0),I=a(!1),B=a(!1),ke=a(0),b=a(null),Ce=a(null),je=T,me=L,M=C(()=>{let o=w.value;if(O.value){const t=O.value.toLowerCase();o=o.filter(i=>i.name.toLowerCase().includes(t)||i.email.toLowerCase().includes(t)||i.phone.includes(t))}return P.value!=="all"&&(o=o.filter(t=>t.status===P.value)),o}),$e=C(()=>w.value.length),Ae=C(()=>w.value.filter(o=>o.status==="active").length),Se=C(()=>w.value.filter(o=>o.status==="inactive").length),Ee=C(()=>{const o=new Date;return o.setDate(o.getDate()-30),w.value.filter(t=>new Date(t.created_at||"")>=o).length}),Ve=C(()=>Object.values(_.value).filter(t=>t).includes("phone"));C(()=>L.value.map(o=>{const t={status:"active"};return T.value.forEach((i,s)=>{const u=_.value[i];u&&o[s]&&(t[u]=o[s])}),t}).filter(o=>o.phone));const pe=C(()=>M.value.length>0&&M.value.every(o=>f.value.includes(o.id))),Me=C(()=>f.value.length>0);function fe(o){return o?new Date(o).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"-"}async function re(){le.value=!0,ce.value="";try{const o=await z.getAll();console.log("Contacts loaded:",o),w.value=o}catch(o){ce.value=o.message||"Erreur lors du chargement des contacts",console.error("Error loading contacts:",o)}finally{le.value=!1}}async function Fe(){var o,t;K.value=!0;try{const i=await z.exportCsv(),s=`contacts_${new Date().toISOString().slice(0,10)}.csv`;z.downloadFile(i,s),U("Contacts exportés avec succès")}catch(i){console.error("Error exporting contacts:",i),h(((t=(o=i.response)==null?void 0:o.data)==null?void 0:t.message)||"Erreur lors de l'export des contacts")}finally{K.value=!1}}function Ie(){E.value=null,p.value={name:"",email:"",phone:"",status:"active",custom_fields:{}},V.value="",F.value="",te.value=!0}function ve(o){E.value=o,p.value={name:o.name,email:o.email,phone:o.phone,status:o.status,custom_fields:o.custom_fields||{}},V.value="",F.value="",se.value=!0}function De(){if(!V.value.trim()){h("Le nom du champ est requis");return}p.value.custom_fields[V.value]=F.value,V.value="",F.value=""}function ze(o){delete p.value.custom_fields[o]}function J(){te.value=!1,se.value=!1,E.value=null}async function Ue(){var o,t;G.value=!0;try{E.value?(await z.update(E.value.id,p.value),U("Contact modifié avec succès")):(await z.create(p.value),U("Contact ajouté avec succès")),J(),await re()}catch(i){h(((t=(o=i.response)==null?void 0:o.data)==null?void 0:t.message)||i.message||"Erreur lors de l'enregistrement")}finally{G.value=!1}}async function ge(o){if(await Ze("Supprimer le contact ?",`Êtes-vous sûr de vouloir supprimer ${o.name} ?`))try{await z.delete(o.id),U("Contact supprimé avec succès"),w.value=w.value.filter(i=>i.id!==o.id)}catch(i){h(i.message||"Erreur lors de la suppression"),console.error("Error deleting contact:",i)}}function Q(){oe.value=!1,y.value=1,g.value=null,T.value=[],L.value=[],_.value={},x.value="skip",k.value=0,b.value=null,ke.value=0}function Ge(o){return o<1024?o+" B":o<1024*1024?(o/1024).toFixed(2)+" KB":(o/(1024*1024)).toFixed(2)+" MB"}function Ne(o){return{name:"Nom",email:"Email",phone:"Téléphone",group:"Groupe",status:"Statut"}[o]||o}function Te(o){return{skip:"Ignorer les doublons",update:"Mettre à jour les doublons",create:"Créer malgré les doublons"}[o]||o}function Le(o){const t=o.target;t.files&&t.files[0]&&(g.value=t.files[0])}async function Be(){var o,t;if(g.value){I.value=!0;try{const i=new FormData;i.append("file",g.value);const s=await Z.post("/contacts/preview-import",i,{headers:{"Content-Type":"multipart/form-data"}});if(!s.data.success){h(s.data.message||"Erreur lors de l'analyse du fichier"),I.value=!1;return}T.value=s.data.headers,L.value=s.data.preview,k.value=s.data.total_rows,_.value=s.data.suggested_mapping||{},y.value=2}catch(i){h("Erreur lors de la lecture du fichier: "+(((t=(o=i.response)==null?void 0:o.data)==null?void 0:t.message)||i.message))}finally{I.value=!1}}}async function qe(){var o,t;if(!(!g.value||k.value===0)){B.value=!0;try{const i=new FormData;i.append("file",g.value),i.append("duplicate_action",x.value);for(const[u,A]of Object.entries(_.value))A&&i.append(`column_mapping[${u}]`,A);const s=await Z.post("/contacts/import",i,{headers:{"Content-Type":"multipart/form-data"}});s.data.success?(b.value={imported:s.data.imported||0,updated:s.data.updated||0,skipped:s.data.skipped||0,errors:s.data.errors||[],total_errors:s.data.total_errors||0},y.value=4,await re(),U(s.data.message)):h(s.data.message||"Erreur lors de l'importation")}catch(i){h(((t=(o=i.response)==null?void 0:o.data)==null?void 0:t.message)||i.message||"Erreur lors de l'importation")}finally{B.value=!1}}}function Re(){pe.value?f.value=[]:f.value=M.value.map(o=>o.id)}function xe(o){const t=f.value.indexOf(o);t>-1?f.value.splice(t,1):f.value.push(o)}function be(o){return f.value.includes(o)}async function Oe(){try{const o=await Z.get("/contact-groups");H.value=o.data.data}catch(o){console.error("Error loading groups:",o)}}function Pe(){if(f.value.length===0){h("Veuillez sélectionner au moins un contact");return}S.value=null,ne.value=!0}function W(){ne.value=!1,S.value=null}async function He(){var o,t;if(!S.value){h("Veuillez sélectionner un groupe");return}N.value=!0;try{await Z.post(`/contact-groups/${S.value}/contacts/add`,{contact_ids:f.value}),U(`${f.value.length} contact(s) ajouté(s) au groupe`),f.value=[],W()}catch(i){h(((t=(o=i.response)==null?void 0:o.data)==null?void 0:t.message)||"Erreur lors de l'ajout au groupe")}finally{N.value=!1}}return Je(()=>{re(),Oe()}),(o,t)=>(l(),ae(We,null,{default:Qe(()=>{var i;return[e("div",rt,[e("div",it,[e("div",at,[t[24]||(t[24]=e("div",null,[e("h1",{class:"text-2xl sm:text-3xl font-bold"},"Contacts"),e("p",{class:"text-sm text-muted-foreground mt-1 sm:mt-2"},"Gérez votre liste de contacts")],-1)),e("div",dt,[Me.value?(l(),r("button",{key:0,onClick:Pe,class:"inline-flex items-center justify-center gap-1 sm:gap-2 whitespace-nowrap rounded-md text-xs sm:text-sm font-medium transition-colors border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 sm:h-10 px-3 sm:px-4 py-2"},[c(d(he),{class:"w-4 h-4"}),t[18]||(t[18]=e("span",{class:"hidden sm:inline"},"Ajouter à un groupe",-1)),t[19]||(t[19]=e("span",{class:"sm:hidden"},"Groupe",-1)),e("span",null,"("+n(f.value.length)+")",1)])):m("",!0),e("button",{onClick:Fe,disabled:K.value,class:"inline-flex items-center justify-center gap-1 sm:gap-2 whitespace-nowrap rounded-md text-xs sm:text-sm font-medium transition-colors border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 sm:h-10 px-3 sm:px-4 py-2 disabled:opacity-50"},[K.value?(l(),r("div",ct)):(l(),ae(d(et),{key:0,class:"w-4 h-4"})),t[20]||(t[20]=e("span",{class:"hidden sm:inline"},"Exporter",-1))],8,ut),e("button",{onClick:t[0]||(t[0]=s=>oe.value=!0),class:"inline-flex items-center justify-center gap-1 sm:gap-2 whitespace-nowrap rounded-md text-xs sm:text-sm font-medium transition-colors border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 sm:h-10 px-3 sm:px-4 py-2"},[c(d(_e),{class:"w-4 h-4"}),t[21]||(t[21]=e("span",{class:"hidden sm:inline"},"Importer",-1))]),e("button",{onClick:Ie,class:"inline-flex items-center justify-center gap-1 sm:gap-2 whitespace-nowrap rounded-md text-xs sm:text-sm font-medium transition-colors bg-primary text-primary-foreground hover:bg-primary/90 h-9 sm:h-10 px-3 sm:px-4 py-2"},[c(d(ye),{class:"w-4 h-4"}),t[22]||(t[22]=e("span",{class:"hidden sm:inline"},"Nouveau contact",-1)),t[23]||(t[23]=e("span",{class:"sm:hidden"},"Nouveau",-1))])])])]),e("div",mt,[e("div",pt,[t[25]||(t[25]=e("div",{class:"text-xs sm:text-sm text-muted-foreground"},"Total contacts",-1)),e("div",ft,n($e.value),1)]),e("div",vt,[t[26]||(t[26]=e("div",{class:"text-xs sm:text-sm text-muted-foreground"},"Actifs",-1)),e("div",gt,n(Ae.value),1)]),e("div",xt,[t[27]||(t[27]=e("div",{class:"text-xs sm:text-sm text-muted-foreground"},"Inactifs",-1)),e("div",bt,n(Se.value),1)]),e("div",ht,[t[28]||(t[28]=e("div",{class:"text-xs sm:text-sm text-muted-foreground"},"Nouveaux (30j)",-1)),e("div",yt,n(Ee.value),1)])]),e("div",_t,[e("div",wt,[e("div",kt,[v(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>O.value=s),type:"text",placeholder:"Rechercher...",class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-xs sm:text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},null,512),[[D,O.value]])]),v(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>P.value=s),class:"flex h-9 sm:h-10 rounded-md border border-input bg-background px-3 py-2 text-xs sm:text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"},[...t[29]||(t[29]=[e("option",{value:"all"},"Tous les statuts",-1),e("option",{value:"active"},"Actifs",-1),e("option",{value:"inactive"},"Inactifs",-1)])],512),[[X,P.value]])])]),e("div",Ct,[le.value?(l(),r("div",jt,[...t[30]||(t[30]=[e("div",{class:"animate-spin rounded-full h-10 w-10 sm:h-12 sm:w-12 border-b-2 border-primary"},null,-1)])])):M.value.length===0?(l(),r("div",$t,[c(d(Xe),{class:"w-12 h-12 sm:w-16 sm:h-16 text-muted-foreground mb-3 sm:mb-4"}),t[31]||(t[31]=e("p",{class:"text-base sm:text-lg font-medium text-center"},"Aucun contact trouvé",-1)),t[32]||(t[32]=e("p",{class:"text-xs sm:text-sm text-muted-foreground mt-1 text-center"},"Commencez par ajouter ou importer des contacts",-1))])):(l(),r("div",At,[e("div",St,[e("table",Et,[e("thead",Vt,[e("tr",null,[e("th",Mt,[e("input",{type:"checkbox",checked:pe.value,onChange:Re,class:"rounded border-gray-300 cursor-pointer"},null,40,Ft)]),t[33]||(t[33]=e("th",{class:"h-10 sm:h-12 px-3 sm:px-4 text-left align-middle font-medium text-muted-foreground text-xs sm:text-sm"},"Nom",-1)),t[34]||(t[34]=e("th",{class:"h-10 sm:h-12 px-3 sm:px-4 text-left align-middle font-medium text-muted-foreground text-xs sm:text-sm"},"Email",-1)),t[35]||(t[35]=e("th",{class:"h-10 sm:h-12 px-3 sm:px-4 text-left align-middle font-medium text-muted-foreground text-xs sm:text-sm"},"Téléphone",-1)),t[36]||(t[36]=e("th",{class:"h-10 sm:h-12 px-3 sm:px-4 text-left align-middle font-medium text-muted-foreground text-xs sm:text-sm"},"Statut",-1)),t[37]||(t[37]=e("th",{class:"h-10 sm:h-12 px-3 sm:px-4 text-left align-middle font-medium text-muted-foreground text-xs sm:text-sm hidden lg:table-cell"},"Date d'ajout",-1)),t[38]||(t[38]=e("th",{class:"h-10 sm:h-12 px-3 sm:px-4 text-left align-middle font-medium text-muted-foreground text-xs sm:text-sm"},"Actions",-1))])]),e("tbody",null,[(l(!0),r(j,null,$(M.value,s=>(l(),r("tr",{key:s.id,class:"border-b transition-colors hover:bg-muted/50"},[e("td",It,[e("input",{type:"checkbox",checked:be(s.id),onChange:u=>xe(s.id),class:"rounded border-gray-300 cursor-pointer"},null,40,Dt)]),e("td",zt,n(s.name),1),e("td",Ut,n(s.email),1),e("td",Gt,n(s.phone),1),e("td",Nt,[e("span",{class:q(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold",s.status==="active"?"bg-success/10 text-success":"bg-muted text-muted-foreground"])},n(s.status==="active"?"Actif":"Inactif"),3)]),e("td",Tt,n(fe(s.created_at)),1),e("td",Lt,[e("div",Bt,[e("button",{onClick:u=>ve(s),class:"inline-flex items-center justify-center rounded-md hover:bg-accent hover:text-accent-foreground h-8 w-8",title:"Modifier"},[c(d(we),{class:"w-4 h-4"})],8,qt),e("button",{onClick:u=>ge(s),class:"inline-flex items-center justify-center rounded-md hover:bg-destructive/10 hover:text-destructive h-8 w-8",title:"Supprimer"},[c(d(ee),{class:"w-4 h-4"})],8,Rt)])])]))),128))])])]),e("div",Ot,[(l(!0),r(j,null,$(M.value,s=>(l(),r("div",{key:s.id,class:"p-3 sm:p-4 hover:bg-muted/30"},[e("div",Pt,[e("div",Ht,[e("input",{type:"checkbox",checked:be(s.id),onChange:u=>xe(s.id),class:"rounded border-gray-300 cursor-pointer mt-1"},null,40,Kt),e("div",Jt,[e("p",Qt,n(s.name),1),e("p",Wt,n(s.phone),1),e("p",Xt,n(s.email),1),e("div",Yt,[e("span",{class:q(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold",s.status==="active"?"bg-success/10 text-success":"bg-muted text-muted-foreground"])},n(s.status==="active"?"Actif":"Inactif"),3),e("span",Zt,n(fe(s.created_at)),1)])])]),e("div",es,[e("button",{onClick:u=>ve(s),class:"p-2 hover:bg-accent rounded"},[c(d(we),{class:"w-4 h-4"})],8,ts),e("button",{onClick:u=>ge(s),class:"p-2 hover:bg-destructive/10 text-destructive rounded"},[c(d(ee),{class:"w-4 h-4"})],8,ss)])])]))),128))])]))]),e("div",os,[e("p",ns,n(M.value.length)+" sur "+n(w.value.length)+" contacts ",1),t[39]||(t[39]=e("div",{class:"flex gap-2"},[e("button",{class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-xs sm:text-sm font-medium border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 sm:h-9 px-2 sm:px-3"}," Précédent "),e("button",{class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-xs sm:text-sm font-medium border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 sm:h-9 px-2 sm:px-3"}," Suivant ")],-1))])]),te.value||se.value?(l(),r("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:Y(J,["self"])},[e("div",ls,[e("div",rs,[e("h2",is,n(E.value?"Modifier le contact":"Nouveau contact"),1),e("button",{onClick:J,class:"hover:bg-accent rounded-full p-1"},[c(d(ue),{class:"w-5 h-5"})])]),e("form",{onSubmit:Y(Ue,["prevent"]),class:"space-y-4"},[e("div",as,[t[40]||(t[40]=e("label",{class:"text-sm font-medium"},"Nom complet *",-1)),v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>p.value.name=s),type:"text",required:"",placeholder:"Jean Dupont",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[D,p.value.name]])]),e("div",ds,[t[41]||(t[41]=e("label",{class:"text-sm font-medium"},"Email *",-1)),v(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>p.value.email=s),type:"email",required:"",placeholder:"jean.dupont@example.com",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[D,p.value.email]])]),e("div",us,[t[42]||(t[42]=e("label",{class:"text-sm font-medium"},"Téléphone *",-1)),v(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>p.value.phone=s),type:"tel",required:"",placeholder:"+24177000000",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[D,p.value.phone]])]),e("div",cs,[t[44]||(t[44]=e("label",{class:"text-sm font-medium"},"Statut",-1)),v(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>p.value.status=s),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...t[43]||(t[43]=[e("option",{value:"active"},"Actif",-1),e("option",{value:"inactive"},"Inactif",-1)])],512),[[X,p.value.status]])]),e("div",ms,[e("div",ps,[t[45]||(t[45]=e("label",{class:"text-sm font-medium"},"Champs personnalisés",-1)),c(d(tt),{class:"w-4 h-4 text-muted-foreground"})]),Object.keys(p.value.custom_fields).length>0?(l(),r("div",fs,[(l(!0),r(j,null,$(p.value.custom_fields,(s,u)=>(l(),r("div",{key:u,class:"flex items-center gap-2 p-2 bg-muted/50 rounded border"},[e("div",vs,[e("p",gs,n(u),1),e("p",xs,n(s),1)]),e("button",{type:"button",onClick:A=>ze(u),class:"text-destructive hover:bg-destructive/10 rounded p-1"},[c(d(ee),{class:"w-4 h-4"})],8,bs)]))),128))])):m("",!0),e("div",hs,[t[47]||(t[47]=e("p",{class:"text-xs text-muted-foreground"},"Ajouter un nouveau champ",-1)),e("div",ys,[v(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>V.value=s),type:"text",placeholder:"Nom du champ",class:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[D,V.value]]),v(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>F.value=s),type:"text",placeholder:"Valeur",class:"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[D,F.value]])]),e("button",{type:"button",onClick:De,class:"w-full inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9"},[c(d(ye),{class:"w-4 h-4"}),t[46]||(t[46]=e("span",null,"Ajouter",-1))])])]),e("div",_s,[e("button",{type:"button",onClick:J,class:"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Annuler "),e("button",{type:"submit",disabled:G.value,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[G.value?(l(),r("div",ks)):m("",!0),e("span",null,n(G.value?"Enregistrement...":E.value?"Modifier":"Ajouter"),1)],8,ws)])],32)])])):m("",!0),oe.value?(l(),r("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:Y(Q,["self"])},[e("div",Cs,[e("div",js,[t[48]||(t[48]=e("div",null,[e("h2",{class:"text-xl font-bold"},"Importer des contacts"),e("p",{class:"text-sm text-muted-foreground mt-1"},"Importez vos contacts depuis un fichier CSV, Excel (.xlsx) ou .xls")],-1)),e("button",{onClick:Q,class:"hover:bg-accent rounded-full p-1"},[c(d(ue),{class:"w-5 h-5"})])]),y.value===1?(l(),r("div",$s,[e("div",As,[c(d(st),{class:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),t[49]||(t[49]=e("div",{class:"space-y-2"},[e("p",{class:"text-sm font-medium"},"Glissez-déposez votre fichier ici"),e("p",{class:"text-xs text-muted-foreground"},"CSV, Excel (.xlsx, .xls) - Max 20MB")],-1)),e("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:Le,class:"hidden",ref_key:"fileInput",ref:Ce},null,544),e("button",{onClick:t[9]||(t[9]=s=>{var u;return(u=o.$refs.fileInput)==null?void 0:u.click()}),class:"mt-4 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"}," Sélectionner un fichier ")]),g.value?(l(),r("div",Ss,[e("div",Es,[e("div",Vs,[c(d(Ye),{class:"w-8 h-8 text-primary"}),e("div",null,[e("p",Ms,n(g.value.name),1),e("p",Fs,n(Ge(g.value.size)),1)])]),e("button",{onClick:t[10]||(t[10]=s=>g.value=null),class:"text-destructive hover:bg-destructive/10 rounded p-2"},[c(d(ee),{class:"w-4 h-4"})])])])):m("",!0),e("div",Is,[t[53]||(t[53]=e("label",{class:"text-sm font-medium"},"Gestion des doublons",-1)),e("div",Ds,[e("label",{class:q(["flex items-start gap-3 p-3 border rounded-lg cursor-pointer transition-colors",x.value==="skip"?"border-primary bg-primary/5":"hover:bg-accent"])},[v(e("input",{type:"radio","onUpdate:modelValue":t[11]||(t[11]=s=>x.value=s),value:"skip",class:"mt-1"},null,512),[[de,x.value]]),t[50]||(t[50]=e("div",null,[e("p",{class:"font-medium text-sm"},"Ignorer"),e("p",{class:"text-xs text-muted-foreground"},"Les doublons sont ignorés")],-1))],2),e("label",{class:q(["flex items-start gap-3 p-3 border rounded-lg cursor-pointer transition-colors",x.value==="update"?"border-primary bg-primary/5":"hover:bg-accent"])},[v(e("input",{type:"radio","onUpdate:modelValue":t[12]||(t[12]=s=>x.value=s),value:"update",class:"mt-1"},null,512),[[de,x.value]]),t[51]||(t[51]=e("div",null,[e("p",{class:"font-medium text-sm"},"Mettre à jour"),e("p",{class:"text-xs text-muted-foreground"},"Les doublons sont mis à jour")],-1))],2),e("label",{class:q(["flex items-start gap-3 p-3 border rounded-lg cursor-pointer transition-colors",x.value==="create"?"border-primary bg-primary/5":"hover:bg-accent"])},[v(e("input",{type:"radio","onUpdate:modelValue":t[13]||(t[13]=s=>x.value=s),value:"create",class:"mt-1"},null,512),[[de,x.value]]),t[52]||(t[52]=e("div",null,[e("p",{class:"font-medium text-sm"},"Créer"),e("p",{class:"text-xs text-muted-foreground"},"Créer même si doublon")],-1))],2)])]),e("div",zs,[e("div",Us,[c(d(ot),{class:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),t[54]||(t[54]=e("div",{class:"text-sm"},[e("p",{class:"font-medium mb-2"},"Formats supportés :"),e("ul",{class:"space-y-1 text-muted-foreground"},[e("li",null,[R("• "),e("strong",null,"CSV"),R(" : Séparateur virgule, encodage UTF-8")]),e("li",null,[R("• "),e("strong",null,"Excel"),R(" : Formats .xlsx et .xls")]),e("li",null,"• La première ligne doit contenir les en-têtes"),e("li",null,"• Colonnes requises : téléphone (obligatoire), nom, email")])],-1))])]),e("div",Gs,[e("button",{onClick:Q,class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Annuler "),e("button",{onClick:Be,disabled:!g.value||I.value,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[I.value?(l(),r("div",Ts)):m("",!0),e("span",null,n(I.value?"Analyse...":"Continuer"),1)],8,Ns)])])):m("",!0),y.value===2?(l(),r("div",Ls,[e("div",Bs,[t[55]||(t[55]=e("p",{class:"text-sm font-medium mb-2"},"Mappage des colonnes",-1)),e("p",qs," Associez les colonnes de votre fichier CSV aux champs du système. "+n(d(me).length)+" lignes détectées. ",1)]),e("div",Rs,[(l(!0),r(j,null,$(d(je),(s,u)=>{var A;return l(),r("div",{key:u,class:"grid grid-cols-2 gap-4 items-center"},[e("div",Os,[t[56]||(t[56]=e("p",{class:"text-xs text-muted-foreground mb-1"},"Colonne CSV",-1)),e("p",Ps,n(s),1),e("p",Hs,"Exemple: "+n(((A=d(me)[0])==null?void 0:A[u])||"-"),1)]),e("div",Ks,[t[58]||(t[58]=e("label",{class:"text-xs text-muted-foreground"},"Associer à",-1)),v(e("select",{"onUpdate:modelValue":ie=>_.value[s]=ie,class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...t[57]||(t[57]=[e("option",{value:""},"-- Ne pas importer --",-1),e("option",{value:"name"},"Nom",-1),e("option",{value:"email"},"Email",-1),e("option",{value:"phone"},"Téléphone",-1),e("option",{value:"group"},"Groupe",-1),e("option",{value:"status"},"Statut",-1)])],8,Js),[[X,_.value[s]]])])])}),128))]),e("div",Qs,[e("div",Ws,[c(d(nt),{class:"w-5 h-5 text-warning flex-shrink-0 mt-0.5"}),t[59]||(t[59]=e("div",{class:"text-sm"},[e("p",{class:"font-medium mb-1"},"Champ obligatoire"),e("p",{class:"text-muted-foreground"},"Le champ Téléphone est obligatoire pour chaque contact. Les doublons sont détectés par téléphone ou email.")],-1))])]),e("div",Xs,[e("button",{onClick:t[14]||(t[14]=s=>y.value=1),class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Retour "),e("button",{onClick:t[15]||(t[15]=s=>y.value=3),disabled:!Ve.value,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"}," Continuer ",8,Ys)])])):m("",!0),y.value===3?(l(),r("div",Zs,[e("div",eo,[e("div",to,[e("div",null,[t[60]||(t[60]=e("p",{class:"text-sm font-medium mb-1"},"Prêt à importer",-1)),e("p",so,n(k.value)+" lignes détectées dans le fichier ",1)]),e("div",oo,[e("p",no,n(k.value),1),t[61]||(t[61]=e("p",{class:"text-xs text-muted-foreground"},"contacts",-1))])])]),e("div",lo,[e("table",ro,[e("thead",io,[e("tr",null,[(l(!0),r(j,null,$(T.value,s=>(l(),r("th",{key:s,class:"h-10 px-4 text-left align-middle font-medium text-muted-foreground text-xs"},[R(n(s)+" ",1),_.value[s]?(l(),r("span",ao,"("+n(Ne(_.value[s]))+")",1)):m("",!0)]))),128))])]),e("tbody",null,[(l(!0),r(j,null,$(L.value.slice(0,5),(s,u)=>(l(),r("tr",{key:u,class:"border-b"},[(l(!0),r(j,null,$(s,(A,ie)=>(l(),r("td",{key:ie,class:"p-3 text-sm truncate max-w-[150px]"},n(A||"-"),1))),128))]))),128))])])]),k.value>5?(l(),r("div",uo," Aperçu des 5 premières lignes sur "+n(k.value),1)):m("",!0),e("div",co,[t[65]||(t[65]=e("p",{class:"text-sm font-medium mb-2"},"Récapitulatif",-1)),e("div",mo,[t[62]||(t[62]=e("div",{class:"text-muted-foreground"},"Fichier :",-1)),e("div",po,n((i=g.value)==null?void 0:i.name),1),t[63]||(t[63]=e("div",{class:"text-muted-foreground"},"Gestion doublons :",-1)),e("div",fo,n(Te(x.value)),1),t[64]||(t[64]=e("div",{class:"text-muted-foreground"},"Colonnes mappées :",-1)),e("div",vo,n(Object.values(_.value).filter(s=>s).length),1)])]),e("div",go,[e("button",{onClick:t[16]||(t[16]=s=>y.value=2),class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Retour "),e("button",{onClick:qe,disabled:B.value||k.value===0,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-success text-success-foreground hover:bg-success/90 h-10 px-4 py-2"},[B.value?(l(),r("div",bo)):(l(),ae(d(_e),{key:1,class:"w-4 h-4"})),e("span",null,n(B.value?"Importation...":`Importer ${k.value} contacts`),1)],8,xo)])])):m("",!0),y.value===4?(l(),r("div",ho,[e("div",yo,[b.value?(l(),r("div",_o,[c(d(lt),{class:"w-16 h-16 mx-auto text-success"}),t[69]||(t[69]=e("h3",{class:"text-xl font-bold"},"Importation terminée",-1)),e("div",wo,[e("div",ko,[e("p",Co,n(b.value.imported),1),t[66]||(t[66]=e("p",{class:"text-xs text-muted-foreground"},"Importés",-1))]),e("div",jo,[e("p",$o,n(b.value.updated),1),t[67]||(t[67]=e("p",{class:"text-xs text-muted-foreground"},"Mis à jour",-1))]),e("div",Ao,[e("p",So,n(b.value.skipped),1),t[68]||(t[68]=e("p",{class:"text-xs text-muted-foreground"},"Ignorés",-1))])]),b.value.errors.length>0?(l(),r("div",Eo,[e("div",Vo,[e("p",Mo,n(b.value.total_errors)+" erreur(s) rencontrée(s) ",1),e("ul",Fo,[(l(!0),r(j,null,$(b.value.errors.slice(0,10),(s,u)=>(l(),r("li",{key:u},n(s),1))),128))]),b.value.total_errors>10?(l(),r("p",Io," ... et "+n(b.value.total_errors-10)+" autres erreurs ",1)):m("",!0)])])):m("",!0)])):m("",!0)]),e("div",{class:"flex justify-center gap-3 pt-4 border-t"},[e("button",{onClick:Q,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-6 py-2"}," Fermer ")])])):m("",!0)])])):m("",!0),ne.value?(l(),r("div",{key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:Y(W,["self"])},[e("div",Do,[e("div",zo,[e("div",Uo,[t[70]||(t[70]=e("h2",{class:"text-xl font-bold"},"Ajouter à un groupe",-1)),e("button",{onClick:W,class:"hover:bg-accent rounded-full p-1"},[c(d(ue),{class:"w-5 h-5"})])]),e("p",Go,n(f.value.length)+" contact(s) sélectionné(s) ",1)]),e("div",No,[H.value.length===0?(l(),r("div",To,[c(d(he),{class:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),t[71]||(t[71]=e("p",{class:"text-sm text-muted-foreground"},"Aucun groupe disponible",-1)),t[72]||(t[72]=e("p",{class:"text-xs text-muted-foreground mt-1"},"Créez un groupe depuis la page Groupes",-1))])):(l(),r("div",Lo,[t[74]||(t[74]=e("label",{class:"text-sm font-medium"},"Sélectionner un groupe *",-1)),v(e("select",{"onUpdate:modelValue":t[17]||(t[17]=s=>S.value=s),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[t[73]||(t[73]=e("option",{value:null},"-- Choisir un groupe --",-1)),(l(!0),r(j,null,$(H.value,s=>(l(),r("option",{key:s.id,value:s.id},n(s.name)+" ("+n(s.contacts_count)+" contacts) ",9,Bo))),128))],512),[[X,S.value]])])),e("div",qo,[e("button",{type:"button",onClick:W,class:"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Annuler "),e("button",{type:"button",onClick:He,disabled:!S.value||N.value||H.value.length===0,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[N.value?(l(),r("div",Oo)):m("",!0),e("span",null,n(N.value?"Ajout...":"Ajouter"),1)],8,Ro)])])])])):m("",!0)]}),_:1}))}});export{ln as default};
