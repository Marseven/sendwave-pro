import{o as l,c as m,b as e,d as G,r as v,k as $,m as P,n as W,p as X,x as b,y as c,A as I,t as a,q as S,F as A,i as L,s as Z,w as N,f as D,v as V,D as J,g as K}from"./main-BEGAKqNq.js";import{f as u,_ as O,l as j,i as Q,s as Y}from"./api-Buln04ql.js";import{b as f,a as h,s as ee}from"./notifications-CHQAjgV4.js";import{r as te}from"./CheckCircleIcon-BInjln3w.js";import{r as se}from"./ExclamationTriangleIcon-BXGs-tjo.js";import{r as oe}from"./ArrowPathIcon-CR29V2-g.js";function re(o,n){return l(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z"})])}const x={async getAll(){const o=await u.get("/webhooks");return o.data.data||o.data},async getById(o){const n=await u.get(`/webhooks/${o}`);return n.data.data||n.data},async create(o){const n=await u.post("/webhooks",o);return n.data.data||n.data},async update(o,n){const d=await u.put(`/webhooks/${o}`,n);return d.data.data||d.data},async delete(o){await u.delete(`/webhooks/${o}`)},async toggle(o){const n=await u.post(`/webhooks/${o}/toggle`);return n.data.data||n.data},async test(o){return(await u.post(`/webhooks/${o}/test`)).data},async getLogs(o,n){const d=await u.get(`/webhooks/${o}/logs`,{params:n});return d.data.data||d.data},async getStats(o){const n=await u.get(`/webhooks/${o}/stats`);return n.data.data||n.data},async getEvents(){const o=await u.get("/webhooks/events");return o.data.data||o.data}},ne={class:"p-4 sm:p-6 lg:p-8"},ae={class:"mb-4 sm:mb-8 flex flex-col sm:flex-row justify-between sm:items-center gap-3 sm:gap-4"},de={class:"grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 mb-4 sm:mb-8"},le={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-4 sm:p-6"},ie={class:"flex items-center justify-between mb-2"},ue={class:"text-2xl sm:text-3xl font-bold"},ce={class:"text-xs text-muted-foreground mt-1 sm:mt-2"},me={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-4 sm:p-6"},pe={class:"flex items-center justify-between mb-2"},be={class:"text-2xl sm:text-3xl font-bold text-success"},fe={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-4 sm:p-6"},ve={class:"flex items-center justify-between mb-2"},xe={class:"text-2xl sm:text-3xl font-bold text-destructive"},ge={class:"rounded-lg border bg-card shadow-sm mb-4 sm:mb-8"},he={class:"p-4 sm:p-6"},we={class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2 sm:gap-3"},ye={class:"rounded-lg border bg-card shadow-sm"},ke={class:"p-6"},_e={key:0,class:"text-center py-12"},Ce={key:1,class:"text-center py-12"},$e={key:2,class:"overflow-x-auto"},We={class:"w-full"},Se={class:"p-4"},Ae={class:"p-4"},De={class:"text-sm font-mono text-muted-foreground truncate block max-w-xs"},Ee={class:"p-4"},Me={class:"p-4"},Ie={class:"p-4 text-success font-medium"},Le={class:"p-4 text-destructive font-medium"},Ne={class:"p-4"},Ve={class:"flex gap-2"},je=["onClick"],Te=["onClick","title"],ze=["onClick"],Be=["onClick"],qe={class:"rounded-lg border bg-card shadow-sm mt-8"},Ue={class:"p-6 space-y-4 text-sm"},Re={class:"flex items-center gap-2 mb-2"},Fe={class:"flex items-center gap-2 mb-2"},He={class:"flex items-center gap-2 mb-2"},Ge={class:"bg-card rounded-lg shadow-xl max-w-2xl w-full m-4 max-h-[90vh] overflow-y-auto"},Pe={class:"p-6 border-b border-border"},Xe={class:"text-xl font-semibold"},Ze={class:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto p-2 border border-border rounded-lg"},Je=["value"],Ke={class:"text-sm"},Oe={class:"flex gap-3 pt-4"},Qe=["disabled"],nt=G({__name:"Webhooks",setup(o){const n=Y,d=v([]),_=v(!1),w=v(!1),y=v(!1),p=v(null),i=v({name:"",url:"",events:[]}),E=["message.sent","message.delivered","message.failed","campaign.started","campaign.completed","campaign.failed","contact.created","contact.updated","contact.deleted","sub_account.created","sub_account.suspended","blacklist.added"],T=$(()=>d.value.filter(r=>r.is_active).length),z=$(()=>d.value.reduce((r,t)=>r+t.success_count,0)),B=$(()=>d.value.reduce((r,t)=>r+t.failure_count,0));async function k(){_.value=!0;try{d.value=await x.getAll()}catch(r){console.error("Error loading webhooks:",r),f("Impossible de charger les webhooks")}finally{_.value=!1}}function M(){p.value=null,i.value={name:"",url:"",events:[]},y.value=!0}function q(r){p.value=r,i.value={name:r.name,url:r.url,events:[...r.events]},y.value=!0}function C(){y.value=!1,p.value=null}async function U(){if(i.value.events.length===0){f("Veuillez sélectionner au moins un événement");return}w.value=!0;try{p.value?(await x.update(p.value.id,i.value),h("Webhook modifié avec succès")):(await x.create(i.value),h("Webhook créé avec succès")),await k(),C()}catch(r){console.error("Error saving webhook:",r),f("Impossible de sauvegarder le webhook")}finally{w.value=!1}}async function R(r){try{const t=await x.test(r.id);t.success?h(`Test réussi (Code: ${t.response_code})`):f(`Test échoué (Code: ${t.response_code})`)}catch(t){console.error("Error testing webhook:",t),f("Impossible de tester le webhook")}}async function F(r){try{await x.toggle(r.id),h(`Webhook ${r.is_active?"désactivé":"activé"} avec succès`),await k()}catch(t){console.error("Error toggling webhook:",t),f("Impossible de modifier le statut du webhook")}}async function H(r){if(await ee("Êtes-vous sûr de vouloir supprimer ce webhook ?",`Le webhook "${r.name}" sera définitivement supprimé.`))try{await x.delete(r.id),h("Webhook supprimé avec succès"),await k()}catch(s){console.error("Error deleting webhook:",s),f("Impossible de supprimer le webhook")}}return P(()=>{k()}),(r,t)=>(l(),W(O,null,{default:X(()=>[e("div",ne,[e("div",ae,[t[5]||(t[5]=e("div",null,[e("h1",{class:"text-xl sm:text-3xl font-bold text-foreground"},"Webhooks"),e("p",{class:"text-sm text-muted-foreground mt-1 sm:mt-2"},"Intégrez SendWave Pro avec vos applications tierces")],-1)),e("button",{onClick:M,class:"inline-flex items-center justify-center gap-2 px-3 sm:px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors text-sm font-medium h-9 sm:h-10"},[b(c(j),{class:"w-4 h-4 sm:w-5 sm:h-5"}),t[3]||(t[3]=e("span",{class:"hidden sm:inline"},"Nouveau Webhook",-1)),t[4]||(t[4]=e("span",{class:"sm:hidden"},"Nouveau",-1))])]),e("div",de,[e("div",le,[e("div",ie,[t[6]||(t[6]=e("h3",{class:"text-xs sm:text-sm font-medium text-muted-foreground"},"Webhooks Actifs",-1)),(l(),W(I(c(n)),{class:"w-6 h-6 sm:w-8 sm:h-8 text-primary"}))]),e("p",ue,a(T.value),1),e("p",ce,"sur "+a(d.value.length)+" total",1)]),e("div",me,[e("div",pe,[t[7]||(t[7]=e("h3",{class:"text-xs sm:text-sm font-medium text-muted-foreground"},"Livraisons Réussies",-1)),b(c(te),{class:"w-6 h-6 sm:w-8 sm:h-8 text-success"})]),e("p",be,a(z.value),1),t[8]||(t[8]=e("p",{class:"text-xs text-muted-foreground mt-1 sm:mt-2"},"au total",-1))]),e("div",fe,[e("div",ve,[t[9]||(t[9]=e("h3",{class:"text-xs sm:text-sm font-medium text-muted-foreground"},"Échecs",-1)),b(c(se),{class:"w-6 h-6 sm:w-8 sm:h-8 text-destructive"})]),e("p",xe,a(B.value),1),t[10]||(t[10]=e("p",{class:"text-xs text-muted-foreground mt-1 sm:mt-2"},"au total",-1))])]),e("div",ge,[t[11]||(t[11]=e("div",{class:"p-4 sm:p-6 border-b border-border"},[e("h2",{class:"text-base sm:text-xl font-semibold"},"Événements Disponibles"),e("p",{class:"text-xs sm:text-sm text-muted-foreground mt-1"},"12 types d'événements pour déclencher vos webhooks")],-1)),e("div",he,[e("div",we,[(l(),m(A,null,S(E,s=>e("div",{key:s,class:"px-3 py-2 bg-secondary rounded-lg text-sm font-medium text-center"},a(s),1)),64))])])]),e("div",ye,[t[17]||(t[17]=e("div",{class:"p-6 border-b border-border"},[e("h2",{class:"text-xl font-semibold"},"Vos Webhooks"),e("p",{class:"text-sm text-muted-foreground mt-1"},"Gérez vos endpoints de webhooks et surveillez leur statut")],-1)),e("div",ke,[_.value?(l(),m("div",_e,[...t[12]||(t[12]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"},null,-1),e("p",{class:"text-muted-foreground"},"Chargement des webhooks...",-1)])])):d.value.length===0?(l(),m("div",Ce,[(l(),W(I(c(n)),{class:"w-12 h-12 text-muted-foreground mx-auto mb-4"})),t[14]||(t[14]=e("h3",{class:"text-lg font-medium mb-2"},"Aucun webhook configuré",-1)),t[15]||(t[15]=e("p",{class:"text-muted-foreground mb-4"},"Commencez par créer votre premier webhook pour recevoir des événements",-1)),e("button",{onClick:M,class:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors inline-flex items-center gap-2"},[b(c(j),{class:"w-5 h-5"}),t[13]||(t[13]=L(" Créer un Webhook ",-1))])])):(l(),m("div",$e,[e("table",We,[t[16]||(t[16]=e("thead",null,[e("tr",{class:"border-b border-border"},[e("th",{class:"text-left p-4 font-medium text-muted-foreground"},"Nom"),e("th",{class:"text-left p-4 font-medium text-muted-foreground"},"URL"),e("th",{class:"text-left p-4 font-medium text-muted-foreground"},"Événements"),e("th",{class:"text-left p-4 font-medium text-muted-foreground"},"Statut"),e("th",{class:"text-left p-4 font-medium text-muted-foreground"},"Succès"),e("th",{class:"text-left p-4 font-medium text-muted-foreground"},"Échecs"),e("th",{class:"text-left p-4 font-medium text-muted-foreground"},"Actions")])],-1)),e("tbody",null,[(l(!0),m(A,null,S(d.value,s=>(l(),m("tr",{key:s.id,class:"border-b border-border hover:bg-muted/50"},[e("td",Se,a(s.name),1),e("td",Ae,[e("span",De,a(s.url),1)]),e("td",Ee,a(s.events.length)+" événement(s)",1),e("td",Me,[e("span",{class:Z(["px-2 py-1 rounded-full text-xs font-medium",s.is_active?"bg-success/10 text-success":"bg-muted text-muted-foreground"])},a(s.is_active?"Actif":"Inactif"),3)]),e("td",Ie,a(s.success_count),1),e("td",Le,a(s.failure_count),1),e("td",Ne,[e("div",Ve,[e("button",{onClick:g=>R(s),class:"px-3 py-1 text-sm border border-border rounded hover:bg-muted transition-colors",title:"Tester"}," Tester ",8,je),e("button",{onClick:g=>F(s),class:"px-3 py-1 text-sm border border-border rounded hover:bg-muted transition-colors",title:s.is_active?"Désactiver":"Activer"},a(s.is_active?"Désactiver":"Activer"),9,Te),e("button",{onClick:g=>q(s),class:"px-3 py-1 text-sm border border-border rounded hover:bg-muted transition-colors",title:"Modifier"}," Modifier ",8,ze),e("button",{onClick:g=>H(s),class:"px-3 py-1 text-sm border border-destructive text-destructive rounded hover:bg-destructive/10 transition-colors",title:"Supprimer"}," Supprimer ",8,Be)])])]))),128))])])]))])]),e("div",qe,[t[24]||(t[24]=e("div",{class:"p-6 border-b border-border"},[e("h2",{class:"text-xl font-semibold"},"Documentation")],-1)),e("div",Ue,[e("div",null,[e("div",Re,[b(c(re),{class:"w-5 h-5 text-primary"}),t[18]||(t[18]=e("h4",{class:"font-semibold"},"Sécurité",-1))]),t[19]||(t[19]=e("p",{class:"text-muted-foreground"},[L(" Tous les webhooks incluent une signature HMAC-SHA256 dans le header "),e("code",{class:"px-1 py-0.5 bg-secondary rounded"},"X-Webhook-Signature")],-1))]),e("div",null,[e("div",Fe,[b(c(oe),{class:"w-5 h-5 text-primary"}),t[20]||(t[20]=e("h4",{class:"font-semibold"},"Retry Logic",-1))]),t[21]||(t[21]=e("p",{class:"text-muted-foreground"}," Les webhooks échoués sont automatiquement retry jusqu'à 3 fois avec un délai exponentiel (1s, 2s, 4s) ",-1))]),e("div",null,[e("div",He,[b(c(Q),{class:"w-5 h-5 text-primary"}),t[22]||(t[22]=e("h4",{class:"font-semibold"},"Timeout",-1))]),t[23]||(t[23]=e("p",{class:"text-muted-foreground"}," Le timeout par défaut est de 30 secondes, configurable entre 5 et 120 secondes ",-1))])])])]),y.value?(l(),m("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:N(C,["self"])},[e("div",Ge,[e("div",Pe,[e("h2",Xe,a(p.value?"Modifier le webhook":"Créer un nouveau webhook"),1)]),e("form",{onSubmit:N(U,["prevent"]),class:"p-6 space-y-4"},[e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium mb-2"},"Nom du webhook",-1)),D(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>i.value.name=s),type:"text",required:"",class:"w-full px-3 py-2 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Ex: Notification Slack"},null,512),[[V,i.value.name]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium mb-2"},"URL du webhook",-1)),D(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>i.value.url=s),type:"url",required:"",class:"w-full px-3 py-2 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"https://example.com/webhook"},null,512),[[V,i.value.url]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium mb-2"},"Événements à écouter",-1)),e("div",Ze,[(l(),m(A,null,S(E,s=>e("label",{key:s,class:"flex items-center gap-2 p-2 hover:bg-muted rounded cursor-pointer"},[D(e("input",{type:"checkbox",value:s,"onUpdate:modelValue":t[2]||(t[2]=g=>i.value.events=g),class:"w-4 h-4"},null,8,Je),[[J,i.value.events]]),e("span",Ke,a(s),1)])),64))])]),e("div",Oe,[e("button",{type:"submit",disabled:w.value,class:"flex-1 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50"},a(w.value?"Enregistrement...":p.value?"Modifier":"Créer"),9,Qe),e("button",{type:"button",onClick:C,class:"px-4 py-2 border border-border rounded-lg hover:bg-muted transition-colors"}," Annuler ")])],32)])])):K("",!0)]),_:1}))}});export{nt as default};
