import{d as Y,r as m,a as P,m as Z,n as ee,p as se,o as c,b as e,c as p,x as y,y as _,s as h,w as A,f as d,v as a,i as H,g as v,t as w}from"./main-DZEAjZqG.js";import{_ as te,f as $,o as W,h as oe}from"./api-BBBKmr1n.js";import{b as j,a as J}from"./notifications-CHQAjgV4.js";import{r as K}from"./BeakerIcon-Bgu7I59K.js";import{r as re}from"./InformationCircleIcon-Dirpi5U6.js";const ie={class:"p-8"},ne={key:0,class:"flex items-center justify-center py-12"},le={key:1,class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},de={class:"rounded-lg border bg-card shadow-sm"},ae={class:"p-6 border-b"},ue={class:"flex items-center justify-between"},fe={class:"flex items-center gap-3"},ce={class:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center"},pe=["disabled"],be={class:"space-y-2"},ge={class:"grid grid-cols-2 gap-4"},me={class:"space-y-2"},ve={class:"space-y-2"},xe={class:"text-sm font-medium flex items-center gap-2"},ye={key:0,class:"text-xs text-success"},_e=["placeholder"],he={key:0,class:"text-xs text-muted-foreground"},we={class:"grid grid-cols-2 gap-4"},ke={class:"space-y-2"},Ce={class:"space-y-2"},Me={class:"flex gap-3 pt-4 border-t"},Se=["disabled"],Ee={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Ve=["disabled"],Pe={class:"rounded-lg border bg-card shadow-sm"},$e={class:"p-6 border-b"},je={class:"flex items-center justify-between"},Ue={class:"flex items-center gap-3"},Ae={class:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center"},Te=["disabled"],ze={class:"grid grid-cols-2 gap-4"},Fe={class:"space-y-2"},Ne={class:"space-y-2"},De={class:"grid grid-cols-2 gap-4"},Le={class:"space-y-2"},Be={class:"space-y-2"},Ie={class:"text-sm font-medium flex items-center gap-2"},Re={key:0,class:"text-xs text-success"},qe=["placeholder"],Ge={key:0,class:"text-xs text-muted-foreground"},Oe={class:"grid grid-cols-2 gap-4"},He={class:"space-y-2"},We={class:"space-y-2"},Je={class:"flex gap-3 pt-4 border-t"},Ke=["disabled"],Qe={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Xe=["disabled"],Ye={class:"mt-6 p-4 bg-primary/10 rounded-lg border border-primary/20"},Ze={class:"flex items-start gap-3"},es={class:"bg-background rounded-lg shadow-lg w-full max-w-md p-6"},ss={class:"flex items-center justify-between mb-6"},ts={class:"text-xl font-bold"},os={class:"space-y-4"},rs={class:"space-y-2"},is=["placeholder"],ns={class:"space-y-2"},ls={class:"text-sm text-muted-foreground mt-1"},ds={class:"flex gap-3 pt-4 border-t"},as=["disabled"],us={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},vs=Y({__name:"SmsConfig",setup(fs){const U=m(!0),S=m(!1),E=m(!1),T=m(!1),z=m(!1),k=m(!1),V=m("airtel"),C=m(!1),b=m(null),r=P({}),u=P({api_url:"",username:"",password:"",origin_addr:"",cost_per_sms:20}),n=P({api_url:"",port:12775,username:"",password:"",origin_addr:"",cost_per_sms:20}),g=P({phone_number:"",message:""});async function Q(){var i,s;U.value=!0;try{(await $.get("/sms-configs")).data.data.forEach(o=>{o.provider==="airtel"?(r.airtel=o,Object.assign(u,{api_url:o.api_url||"",username:o.username||"",password:"",origin_addr:o.origin_addr||"",cost_per_sms:o.cost_per_sms||20})):o.provider==="moov"&&(r.moov=o,Object.assign(n,{api_url:o.api_url||"",port:o.port||12775,username:o.username||"",password:"",origin_addr:o.origin_addr||"",cost_per_sms:o.cost_per_sms||20}))})}catch(l){j(((s=(i=l.response)==null?void 0:i.data)==null?void 0:s.message)||"Erreur lors du chargement")}finally{U.value=!1}}async function F(i){var f,o;const s=i==="airtel"?u:n,l=i==="airtel"?S:E;l.value=!0;try{const x={...s};x.password||delete x.password;const M=await $.put(`/sms-configs/${i}`,x);i==="airtel"?r.airtel=M.data.data:r.moov=M.data.data,J("Configuration enregistrée")}catch(x){j(((o=(f=x.response)==null?void 0:f.data)==null?void 0:o.message)||"Erreur lors de l'enregistrement")}finally{l.value=!1}}async function N(i){var l,f;const s=i==="airtel"?T:z;s.value=!0;try{const o=await $.post(`/sms-configs/${i}/toggle`);i==="airtel"?r.airtel=o.data.data:r.moov=o.data.data,J(o.data.message)}catch(o){j(((f=(l=o.response)==null?void 0:l.data)==null?void 0:f.message)||"Erreur lors du changement de statut")}finally{s.value=!1}}function D(i){V.value=i,g.phone_number="",g.message="",b.value=null,k.value=!0}async function X(){var i,s,l,f;if(!g.phone_number){j("Veuillez entrer un numéro de test");return}C.value=!0,b.value=null;try{const o=await $.post(`/sms-configs/${V.value}/test`,g);b.value={success:!0,message:o.data.message}}catch(o){b.value={success:!1,message:((s=(i=o.response)==null?void 0:i.data)==null?void 0:s.error)||((f=(l=o.response)==null?void 0:l.data)==null?void 0:f.message)||"Erreur lors du test"}}finally{C.value=!1}}return Z(()=>{Q()}),(i,s)=>(c(),ee(te,null,{default:se(()=>{var l,f,o,x,M,L,B,I,R,q,G,O;return[e("div",ie,[s[40]||(s[40]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold"},"Configuration SMS"),e("p",{class:"text-muted-foreground mt-2"},"Configurez les opérateurs SMS (Airtel et Moov Gabon)")],-1)),U.value?(c(),p("div",ne,[...s[22]||(s[22]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):(c(),p("div",le,[e("div",de,[e("div",ae,[e("div",ue,[e("div",fe,[e("div",ce,[y(_(W),{class:"w-6 h-6 text-red-600"})]),s[23]||(s[23]=e("div",null,[e("h2",{class:"text-xl font-bold"},"Airtel Gabon"),e("p",{class:"text-sm text-muted-foreground"},"Préfixes: 77, 74, 76")],-1))]),e("button",{onClick:s[0]||(s[0]=t=>N("airtel")),disabled:T.value,class:h(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2",(l=r.airtel)!=null&&l.is_active?"bg-success":"bg-muted"])},[e("span",{class:h(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",(f=r.airtel)!=null&&f.is_active?"translate-x-5":"translate-x-0"])},null,2)],10,pe)])]),e("form",{onSubmit:s[7]||(s[7]=A(t=>F("airtel"),["prevent"])),class:"p-6 space-y-4"},[e("div",be,[s[24]||(s[24]=e("label",{class:"text-sm font-medium"},"URL API",-1)),d(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>u.api_url=t),type:"text",placeholder:"https://messaging.airtel.ga:9002/smshttp/qs/",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[a,u.api_url]])]),e("div",ge,[e("div",me,[s[25]||(s[25]=e("label",{class:"text-sm font-medium"},"Nom d'utilisateur",-1)),d(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>u.username=t),type:"text",placeholder:"Username",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[a,u.username]])]),e("div",ve,[e("label",xe,[s[26]||(s[26]=H(" Mot de passe ",-1)),(o=r.airtel)!=null&&o.password_set?(c(),p("span",ye,"(configuré)")):v("",!0)]),d(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>u.password=t),type:"password",placeholder:(x=r.airtel)!=null&&x.password_set?"••••••••":"Entrez le mot de passe",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,8,_e),[[a,u.password]]),(M=r.airtel)!=null&&M.password_set?(c(),p("p",he,"Laissez vide pour conserver l'actuel")):v("",!0)])]),e("div",we,[e("div",ke,[s[27]||(s[27]=e("label",{class:"text-sm font-medium"},"Expéditeur (Origin)",-1)),d(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>u.origin_addr=t),type:"text",placeholder:"SENDWAVE",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[a,u.origin_addr]])]),e("div",Ce,[s[28]||(s[28]=e("label",{class:"text-sm font-medium"},"Coût par SMS (FCFA)",-1)),d(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>u.cost_per_sms=t),type:"number",min:"0",placeholder:"20",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[a,u.cost_per_sms,void 0,{number:!0}]])])]),e("div",Me,[e("button",{type:"submit",disabled:S.value,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[S.value?(c(),p("div",Ee)):v("",!0),e("span",null,w(S.value?"Enregistrement...":"Enregistrer"),1)],8,Se),e("button",{type:"button",onClick:s[6]||(s[6]=t=>D("airtel")),disabled:!((L=r.airtel)!=null&&L.is_active),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"},[y(_(K),{class:"w-4 h-4"}),s[29]||(s[29]=e("span",null,"Tester",-1))],8,Ve)])],32)]),e("div",Pe,[e("div",$e,[e("div",je,[e("div",Ue,[e("div",Ae,[y(_(W),{class:"w-6 h-6 text-blue-600"})]),s[30]||(s[30]=e("div",null,[e("h2",{class:"text-xl font-bold"},"Moov Gabon"),e("p",{class:"text-sm text-muted-foreground"},"Préfixes: 60, 62, 65, 66 (SMPP)")],-1))]),e("button",{onClick:s[8]||(s[8]=t=>N("moov")),disabled:z.value,class:h(["relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2",(B=r.moov)!=null&&B.is_active?"bg-success":"bg-muted"])},[e("span",{class:h(["pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out",(I=r.moov)!=null&&I.is_active?"translate-x-5":"translate-x-0"])},null,2)],10,Te)])]),e("form",{onSubmit:s[16]||(s[16]=A(t=>F("moov"),["prevent"])),class:"p-6 space-y-4"},[s[38]||(s[38]=e("div",{class:"p-3 bg-blue-50 dark:bg-blue-950 rounded-lg border border-blue-200 dark:border-blue-800"},[e("p",{class:"text-sm text-blue-700 dark:text-blue-300"}," Moov utilise le protocole SMPP v3.4 sur le port 12775 ")],-1)),e("div",ze,[e("div",Fe,[s[31]||(s[31]=e("label",{class:"text-sm font-medium"},"Hôte SMPP",-1)),d(e("input",{"onUpdate:modelValue":s[9]||(s[9]=t=>n.api_url=t),type:"text",placeholder:"172.16.59.66",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[a,n.api_url]])]),e("div",Ne,[s[32]||(s[32]=e("label",{class:"text-sm font-medium"},"Port SMPP",-1)),d(e("input",{"onUpdate:modelValue":s[10]||(s[10]=t=>n.port=t),type:"number",placeholder:"12775",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[a,n.port,void 0,{number:!0}]])])]),e("div",De,[e("div",Le,[s[33]||(s[33]=e("label",{class:"text-sm font-medium"},"System ID",-1)),d(e("input",{"onUpdate:modelValue":s[11]||(s[11]=t=>n.username=t),type:"text",placeholder:"system_id",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[a,n.username]])]),e("div",Be,[e("label",Ie,[s[34]||(s[34]=H(" Mot de passe ",-1)),(R=r.moov)!=null&&R.password_set?(c(),p("span",Re,"(configuré)")):v("",!0)]),d(e("input",{"onUpdate:modelValue":s[12]||(s[12]=t=>n.password=t),type:"password",placeholder:(q=r.moov)!=null&&q.password_set?"••••••••":"Entrez le mot de passe",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,8,qe),[[a,n.password]]),(G=r.moov)!=null&&G.password_set?(c(),p("p",Ge,"Laissez vide pour conserver l'actuel")):v("",!0)])]),e("div",Oe,[e("div",He,[s[35]||(s[35]=e("label",{class:"text-sm font-medium"},"Source Address",-1)),d(e("input",{"onUpdate:modelValue":s[13]||(s[13]=t=>n.origin_addr=t),type:"text",placeholder:"SENDWAVE",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[a,n.origin_addr]])]),e("div",We,[s[36]||(s[36]=e("label",{class:"text-sm font-medium"},"Coût par SMS (FCFA)",-1)),d(e("input",{"onUpdate:modelValue":s[14]||(s[14]=t=>n.cost_per_sms=t),type:"number",min:"0",placeholder:"20",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[a,n.cost_per_sms,void 0,{number:!0}]])])]),e("div",Je,[e("button",{type:"submit",disabled:E.value,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[E.value?(c(),p("div",Qe)):v("",!0),e("span",null,w(E.value?"Enregistrement...":"Enregistrer"),1)],8,Ke),e("button",{type:"button",onClick:s[15]||(s[15]=t=>D("moov")),disabled:!((O=r.moov)!=null&&O.is_active),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"},[y(_(K),{class:"w-4 h-4"}),s[37]||(s[37]=e("span",null,"Tester",-1))],8,Xe)])],32)])])),e("div",Ye,[e("div",Ze,[y(_(re),{class:"w-5 h-5 text-primary flex-shrink-0 mt-0.5"}),s[39]||(s[39]=e("div",{class:"text-sm"},[e("p",{class:"font-medium mb-2"},"Configuration des opérateurs"),e("ul",{class:"space-y-1 text-muted-foreground"},[e("li",null,"Les SMS sont automatiquement routés vers l'opérateur approprié selon le préfixe du numéro"),e("li",null,"Airtel: HTTP API classique | Moov: Protocole SMPP v3.4"),e("li",null,"Les mots de passe sont chiffrés en base de données")])],-1))])])]),k.value?(c(),p("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:s[21]||(s[21]=A(t=>k.value=!1,["self"]))},[e("div",es,[e("div",ss,[e("h2",ts,"Tester "+w(V.value==="airtel"?"Airtel":"Moov"),1),e("button",{onClick:s[17]||(s[17]=t=>k.value=!1),class:"hover:bg-accent rounded-full p-1"},[y(_(oe),{class:"w-5 h-5"})])]),e("div",os,[e("div",rs,[s[41]||(s[41]=e("label",{class:"text-sm font-medium"},"Numéro de test *",-1)),d(e("input",{"onUpdate:modelValue":s[18]||(s[18]=t=>g.phone_number=t),type:"tel",placeholder:V.value==="airtel"?"+24177000000":"+24160000000",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,8,is),[[a,g.phone_number]])]),e("div",ns,[s[42]||(s[42]=e("label",{class:"text-sm font-medium"},"Message (optionnel)",-1)),d(e("textarea",{"onUpdate:modelValue":s[19]||(s[19]=t=>g.message=t),rows:"3",placeholder:"Test de configuration API...",class:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[a,g.message]])]),b.value?(c(),p("div",{key:0,class:h(["p-4 rounded-lg",b.value.success?"bg-success/10":"bg-destructive/10"])},[e("p",{class:h(["font-medium",b.value.success?"text-success":"text-destructive"])},w(b.value.success?"Test réussi !":"Test échoué"),3),e("p",ls,w(b.value.message),1)],2)):v("",!0),e("div",ds,[e("button",{type:"button",onClick:s[20]||(s[20]=t=>k.value=!1),class:"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Fermer "),e("button",{type:"button",onClick:X,disabled:C.value||!g.phone_number,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[C.value?(c(),p("div",us)):v("",!0),e("span",null,w(C.value?"Envoi...":"Envoyer le test"),1)],8,as)])])])])):v("",!0)]}),_:1}))}});export{vs as default};
