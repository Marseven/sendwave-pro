import{o as a,c as d,b as e,d as q,r as u,k as x,l as J,m as R,n as U,j as z,p as o,q as r,F as O,x as Y,t as i,w as M,f as w,v as y,g as D}from"./main-CoGMHHt9.js";import{_ as I,j as K,h as L,m as $,a as G}from"./api-Cjgg3nLh.js";import{c as _}from"./campaignService-Dd1J1zio.js";import{a as S,b as j,s as Q}from"./notifications-CHQAjgV4.js";import{r as W}from"./PencilIcon-DC0Nlpe4.js";import{r as A}from"./XMarkIcon-C9QblEve.js";import{r as X}from"./BellAlertIcon-Bkzaa68A.js";function ee(H,f){return a(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z"})])}const te={class:"p-8"},se={key:0,class:"flex items-center justify-center py-12"},ne={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},oe={class:"lg:col-span-2 rounded-lg border bg-card p-6"},re={class:"flex items-center gap-2 mb-4"},ie={key:0,class:"text-center py-12"},ae={key:1,class:"space-y-3"},le={class:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center font-semibold"},de={class:"text-center"},ue={class:"text-xs"},ce={class:"text-lg"},me={class:"flex-1"},fe={class:"font-medium"},pe={class:"flex items-center gap-2 text-sm text-muted-foreground"},ge={class:"flex items-center gap-2"},ve={class:"text-xs px-2 py-1 rounded-full bg-warning/10 text-warning flex items-center gap-1"},he=["onClick"],be=["onClick"],xe={class:"rounded-lg border bg-card p-6"},we={class:"flex items-center gap-2 mb-4"},ye={class:"text-2xl font-bold mb-2"},_e={class:"mt-6 space-y-2"},ke={class:"flex items-center justify-between text-sm"},Ce={class:"font-semibold"},Me={class:"flex items-center justify-between text-sm"},De={class:"font-semibold"},$e={class:"bg-background rounded-lg shadow-lg w-full max-w-md p-6"},Se={class:"flex items-center justify-between mb-6"},je={class:"space-y-2"},Ae={class:"grid grid-cols-2 gap-4"},He={class:"space-y-2"},Ve={class:"space-y-2"},Ze={class:"flex gap-3 pt-4 border-t"},Ee=["disabled"],Fe={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Ue=q({__name:"Calendar",setup(H){z();const f=u(!0),c=u(!1),h=u(!1),k=u([]),p=u(null),l=u({name:"",scheduled_date:"",scheduled_time:""}),m=x(()=>k.value.filter(s=>s.status==="Planifié"||s.status==="scheduled").filter(s=>s.scheduled_at).sort((s,t)=>new Date(s.scheduled_at).getTime()-new Date(t.scheduled_at).getTime())),C=x(()=>{const s=new Date,t=new Date(s.getTime()+7*24*60*60*1e3);return m.value.filter(n=>{const v=new Date(n.scheduled_at);return v>=s&&v<=t}).length}),V=x(()=>{const s=new Date;return m.value.filter(t=>{const n=new Date(t.scheduled_at);return n.getMonth()===s.getMonth()&&n.getFullYear()===s.getFullYear()}).length});function Z(s){return s?["Jan","Fév","Mar","Avr","Mai","Juin","Juil","Aoû","Sep","Oct","Nov","Déc"][new Date(s).getMonth()]:""}function E(s){return s?new Date(s).getDate().toString().padStart(2,"0"):""}function F(s){if(!s)return"";const t=new Date(s);return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}function N(s){return s>=1e3?`${(s/1e3).toFixed(1)}K`:s.toString()}async function b(){try{f.value=!0,k.value=await _.getAll()}catch(s){console.error("Error loading campaigns:",s)}finally{f.value=!1}}function T(s){p.value=s;const t=new Date(s.scheduled_at);l.value={name:s.name,scheduled_date:t.toISOString().split("T")[0],scheduled_time:`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},h.value=!0}function g(){h.value=!1,p.value=null}async function B(){var s,t;if(p.value){c.value=!0;try{const n=`${l.value.scheduled_date} ${l.value.scheduled_time}`;await _.update(p.value.id,{scheduled_at:n}),S("Campagne reprogrammée avec succès"),g(),await b()}catch(n){j(((t=(s=n.response)==null?void 0:s.data)==null?void 0:t.message)||n.message||"Erreur lors de la reprogrammation")}finally{c.value=!1}}}async function P(s){if(await Q("Annuler la campagne ?",`Êtes-vous sûr de vouloir annuler la campagne "${s.name}" ?`))try{await _.delete(s.id),S("Campagne annulée avec succès"),await b()}catch(n){j(n.message||"Erreur lors de l'annulation")}}return J(()=>{b()}),(s,t)=>(a(),R(I,null,{default:U(()=>[e("div",te,[t[14]||(t[14]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold"},"Calendrier"),e("p",{class:"text-muted-foreground mt-2"},"Planifiez vos campagnes SMS")],-1)),f.value?(a(),d("div",se,[...t[4]||(t[4]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):(a(),d("div",ne,[e("div",oe,[e("div",re,[o(r(K),{class:"w-5 h-5 text-primary"}),t[5]||(t[5]=e("h3",{class:"font-semibold"},"Campagnes planifiées",-1))]),m.value.length===0?(a(),d("div",ie,[o(r(ee),{class:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),t[7]||(t[7]=e("p",{class:"text-muted-foreground"},"Aucune campagne planifiée",-1)),e("button",{onClick:t[0]||(t[0]=n=>s.$router.push("/campaign/create")),class:"mt-4 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[o(r(L),{class:"w-4 h-4"}),t[6]||(t[6]=e("span",null,"Planifier une campagne",-1))])])):(a(),d("div",ae,[(a(!0),d(O,null,Y(m.value,n=>(a(),d("div",{key:n.id,class:"flex items-center gap-4 p-4 border rounded-lg hover:bg-muted/50 transition-colors group"},[e("div",le,[e("div",de,[e("div",ue,i(Z(n.scheduled_at)),1),e("div",ce,i(E(n.scheduled_at)),1)])]),e("div",me,[e("div",fe,i(n.name),1),e("div",pe,[o(r($),{class:"w-4 h-4"}),e("span",null,i(F(n.scheduled_at)),1),t[8]||(t[8]=e("span",null,"•",-1)),o(r(G),{class:"w-4 h-4"}),e("span",null,i(N(n.messages_sent||0))+" destinataires",1)])]),e("div",ge,[e("span",ve,[o(r($),{class:"w-3 h-3"}),t[9]||(t[9]=e("span",null,"Planifiée",-1))]),e("button",{onClick:v=>T(n),class:"opacity-0 group-hover:opacity-100 transition-opacity inline-flex items-center justify-center rounded-md text-sm font-medium hover:bg-accent h-8 w-8",title:"Modifier"},[o(r(W),{class:"w-4 h-4"})],8,he),e("button",{onClick:v=>P(n),class:"opacity-0 group-hover:opacity-100 transition-opacity inline-flex items-center justify-center rounded-md text-sm font-medium hover:bg-destructive/10 hover:text-destructive h-8 w-8",title:"Annuler"},[o(r(A),{class:"w-4 h-4"})],8,be)])]))),128))]))]),e("div",xe,[e("div",we,[o(r(X),{class:"w-5 h-5 text-primary"}),t[10]||(t[10]=e("h3",{class:"font-semibold"},"À venir",-1))]),e("div",ye,i(C.value)+" campagne"+i(C.value>1?"s":""),1),t[13]||(t[13]=e("p",{class:"text-sm text-muted-foreground"},"dans les 7 prochains jours",-1)),e("div",_e,[e("div",ke,[t[11]||(t[11]=e("span",{class:"text-muted-foreground"},"Ce mois-ci",-1)),e("span",Ce,i(V.value),1)]),e("div",Me,[t[12]||(t[12]=e("span",{class:"text-muted-foreground"},"Total planifiées",-1)),e("span",De,i(m.value.length),1)])])])]))]),h.value?(a(),d("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:M(g,["self"])},[e("div",$e,[e("div",Se,[t[15]||(t[15]=e("h2",{class:"text-xl font-bold"},"Reprogrammer la campagne",-1)),e("button",{onClick:g,class:"hover:bg-accent rounded-full p-1"},[o(r(A),{class:"w-5 h-5"})])]),e("form",{onSubmit:M(B,["prevent"]),class:"space-y-4"},[e("div",je,[t[16]||(t[16]=e("label",{class:"text-sm font-medium"},"Nom de la campagne",-1)),w(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>l.value.name=n),type:"text",readonly:"",class:"flex h-10 w-full rounded-md border border-input bg-muted px-3 py-2 text-sm"},null,512),[[y,l.value.name]])]),e("div",Ae,[e("div",He,[t[17]||(t[17]=e("label",{class:"text-sm font-medium"},"Date *",-1)),w(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>l.value.scheduled_date=n),type:"date",required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[y,l.value.scheduled_date]])]),e("div",Ve,[t[18]||(t[18]=e("label",{class:"text-sm font-medium"},"Heure *",-1)),w(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>l.value.scheduled_time=n),type:"time",required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[y,l.value.scheduled_time]])])]),e("div",Ze,[e("button",{type:"button",onClick:g,class:"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Annuler "),e("button",{type:"submit",disabled:c.value,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[c.value?(a(),d("div",Fe)):D("",!0),e("span",null,i(c.value?"Enregistrement...":"Reprogrammer"),1)],8,Ee)])],32)])])):D("",!0)]),_:1}))}});export{Ue as default};
