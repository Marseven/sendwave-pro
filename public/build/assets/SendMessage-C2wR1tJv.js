import{d as G,r as u,k as b,l as H,m as A,n as I,o as l,b as e,p as a,q as n,s as C,f as x,z as N,c as i,A as J,F as K,x as O,t as r,g as y,i as $,v as U}from"./main-Bh6i6Ntv.js";import{_ as Q,r as B,a as D,c as W,d as Y,e as Z}from"./api-ClIXpXFz.js";import{c as ee}from"./contactService-DO45XQnE.js";import{s as se,a as te,b as oe}from"./notifications-CHQAjgV4.js";import{r as re}from"./UserIcon-DQNdDwg0.js";import{r as j}from"./PhoneIcon-D4QMqgwX.js";import{r as ne}from"./ExclamationTriangleIcon-CzyH7iW_.js";import{r as le}from"./CheckCircleIcon-DjQlJ1tP.js";import{r as ae,a as ie}from"./XCircleIcon-D-AtwtR4.js";const de={class:"p-8"},ue={class:"mb-8"},ce={class:"flex items-center gap-2"},me={class:"max-w-3xl mx-auto"},ve={class:"rounded-lg border bg-card shadow-sm p-8 space-y-6"},pe={class:"space-y-3"},fe={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},ge={class:"flex-1"},be={class:"flex items-center gap-2"},xe={class:"flex-1"},ye={class:"flex items-center gap-2"},he={class:"flex-1"},_e={class:"flex items-center gap-2"},we={key:0,class:"space-y-2"},Se=["value"],ke={key:1,class:"space-y-2"},Me={class:"text-sm font-medium flex items-center gap-2"},Ce={key:2,class:"space-y-2"},$e={class:"text-sm font-medium flex items-center gap-2"},Ve={class:"text-xs text-muted-foreground"},Ee={class:"font-medium"},Ne={class:"space-y-2"},Ue={class:"flex items-center justify-between"},Fe={class:"text-sm font-medium flex items-center gap-2"},Te={class:"flex items-center gap-3 text-xs"},ze={class:"text-muted-foreground"},Ae={key:0,class:"px-2 py-1 bg-warning/10 text-warning rounded font-medium"},Be={key:0,class:"flex items-center gap-1.5 text-xs text-warning"},De={class:"p-5 bg-gradient-to-r from-primary/10 to-primary/5 border-2 border-primary/20 rounded-lg"},je={class:"flex items-start gap-4"},Pe={class:"flex-1"},Re={class:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm"},Le={class:"text-2xl font-bold text-foreground"},Xe={class:"text-2xl font-bold text-foreground"},qe={class:"md:col-span-3"},Ge={class:"text-3xl font-bold text-primary"},He={key:3,class:"rounded-lg bg-success/10 border border-success/20 p-4"},Ie={class:"flex items-center gap-2 text-success"},Je={class:"font-medium"},Ke={key:4,class:"rounded-lg bg-destructive/10 border border-destructive/20 p-4"},Oe={class:"flex items-center gap-2 text-destructive"},Qe={class:"font-medium"},We={class:"flex gap-3 pt-4 border-t"},Ye=["disabled"],Ze={key:1,class:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"},es=["disabled"],cs=G({__name:"SendMessage",setup(ss){const t=u("contact"),m=u(""),v=u(""),p=u(""),f=u(""),V=u([]),h=u(!1),w=u(""),S=u(""),P=b(()=>f.value.length),d=b(()=>Math.ceil(f.value.length/160)||1),E=b(()=>t.value==="multiple"&&p.value?p.value.split(`
`).filter(c=>c.trim()).length:0),k=b(()=>t.value==="contact"&&m.value||t.value==="phone"&&v.value?1:t.value==="multiple"?E.value:0),M=b(()=>k.value*d.value),F=b(()=>Math.round(M.value*30)),T=b(()=>!(!f.value.trim()||t.value==="contact"&&!m.value||t.value==="phone"&&!v.value.trim()||t.value==="multiple"&&E.value===0));async function R(){try{const c=await ee.getAll();V.value=c.filter(s=>s.status==="active")}catch(c){console.error("Error loading contacts:",c)}}async function L(){var s,o;if(!(!T.value||!await se("Confirmer l'envoi",`Envoyer ${M.value} SMS (${k.value} destinataire(s) × ${d.value} SMS) pour ${F.value} XAF ?`))){h.value=!0,w.value="",S.value="";try{let g=[];if(t.value==="contact"&&m.value){const _=V.value.find(q=>q.id.toString()===m.value);_&&(g=[_.phone])}else t.value==="phone"&&v.value?g=[v.value.trim()]:t.value==="multiple"&&p.value&&(g=p.value.split(`
`).map(_=>_.trim()).filter(_=>_));const X={recipients:g,message:f.value,type:"immediate"};await Z.post("/messages/send",X),te(`${M.value} SMS envoyé(s) avec succès à ${k.value} destinataire(s) !`),setTimeout(()=>{z()},2e3)}catch(g){console.error("Error sending message:",g),oe(((o=(s=g.response)==null?void 0:s.data)==null?void 0:o.message)||"Erreur lors de l'envoi du message")}finally{h.value=!1}}}function z(){t.value="contact",m.value="",v.value="",p.value="",f.value="",w.value="",S.value=""}return H(()=>{R()}),(c,s)=>(l(),A(Q,null,{default:I(()=>[e("div",de,[e("div",ue,[e("div",ce,[a(n(B),{class:"w-8 h-8 text-primary"}),s[7]||(s[7]=e("h1",{class:"text-3xl font-bold"},"Envoyer un message",-1))]),s[8]||(s[8]=e("p",{class:"text-muted-foreground mt-2"},"Envoyez un SMS rapide à un ou plusieurs destinataires",-1))]),e("div",me,[e("div",ve,[e("div",pe,[s[15]||(s[15]=e("label",{class:"text-sm font-medium"},"Type de destinataire",-1)),e("div",fe,[e("label",{class:C(["flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-accent/50 transition-colors",t.value==="contact"?"border-primary bg-primary/5":"border-border"])},[x(e("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>t.value=o),type:"radio",value:"contact",class:"mt-1 w-4 h-4"},null,512),[[N,t.value]]),e("div",ge,[e("div",be,[a(n(re),{class:"w-5 h-5 text-primary"}),s[9]||(s[9]=e("div",{class:"font-semibold text-sm"},"Contact",-1))]),s[10]||(s[10]=e("div",{class:"text-xs text-muted-foreground mt-1"},"Depuis vos contacts",-1))])],2),e("label",{class:C(["flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-accent/50 transition-colors",t.value==="phone"?"border-primary bg-primary/5":"border-border"])},[x(e("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>t.value=o),type:"radio",value:"phone",class:"mt-1 w-4 h-4"},null,512),[[N,t.value]]),e("div",xe,[e("div",ye,[a(n(j),{class:"w-5 h-5 text-primary"}),s[11]||(s[11]=e("div",{class:"font-semibold text-sm"},"Numéro",-1))]),s[12]||(s[12]=e("div",{class:"text-xs text-muted-foreground mt-1"},"Saisir manuellement",-1))])],2),e("label",{class:C(["flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-accent/50 transition-colors",t.value==="multiple"?"border-primary bg-primary/5":"border-border"])},[x(e("input",{"onUpdate:modelValue":s[2]||(s[2]=o=>t.value=o),type:"radio",value:"multiple",class:"mt-1 w-4 h-4"},null,512),[[N,t.value]]),e("div",he,[e("div",_e,[a(n(D),{class:"w-5 h-5 text-primary"}),s[13]||(s[13]=e("div",{class:"font-semibold text-sm"},"Plusieurs",-1))]),s[14]||(s[14]=e("div",{class:"text-xs text-muted-foreground mt-1"},"Multiples numéros",-1))])],2)])]),t.value==="contact"?(l(),i("div",we,[s[17]||(s[17]=e("label",{class:"text-sm font-medium"},"Sélectionner un contact *",-1)),x(e("select",{"onUpdate:modelValue":s[3]||(s[3]=o=>m.value=o),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[s[16]||(s[16]=e("option",{value:""},"Choisir un contact...",-1)),(l(!0),i(K,null,O(V.value,o=>(l(),i("option",{key:o.id,value:o.id},r(o.name)+" ("+r(o.phone)+") ",9,Se))),128))],512),[[J,m.value]])])):y("",!0),t.value==="phone"?(l(),i("div",ke,[e("label",Me,[a(n(j),{class:"w-4 h-4 text-muted-foreground"}),s[18]||(s[18]=$(" Numéro de téléphone * ",-1))]),x(e("input",{"onUpdate:modelValue":s[4]||(s[4]=o=>v.value=o),type:"tel",placeholder:"+33612345678",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[U,v.value]]),s[19]||(s[19]=e("p",{class:"text-xs text-muted-foreground"},"Format international recommandé (ex: +33612345678)",-1))])):y("",!0),t.value==="multiple"?(l(),i("div",Ce,[e("label",$e,[a(n(D),{class:"w-4 h-4 text-muted-foreground"}),s[20]||(s[20]=$(" Numéros de téléphone (un par ligne) * ",-1))]),x(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=o=>p.value=o),placeholder:`+33612345678
+33698765432
+33687654321`,rows:"5",class:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 resize-none font-mono"},null,512),[[U,p.value]]),e("p",Ve,[e("span",Ee,r(E.value),1),s[21]||(s[21]=$(" numéro(s) détecté(s) ",-1))])])):y("",!0),e("div",Ne,[e("div",Ue,[e("label",Fe,[a(n(W),{class:"w-4 h-4 text-muted-foreground"}),s[22]||(s[22]=$(" Message * ",-1))]),e("div",Te,[e("span",ze,r(P.value)+"/160 caractères",1),d.value>1?(l(),i("span",Ae,r(d.value)+" SMS ",1)):y("",!0)])]),x(e("textarea",{"onUpdate:modelValue":s[6]||(s[6]=o=>f.value=o),placeholder:"Votre message SMS...",rows:"6",maxlength:"320",class:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 resize-none font-mono"},null,512),[[U,f.value]]),d.value>1?(l(),i("p",Be,[a(n(ne),{class:"w-4 h-4"}),e("span",null,"Votre message sera envoyé en "+r(d.value)+" SMS (coût multiplié par "+r(d.value)+")",1)])):y("",!0)]),e("div",De,[e("div",je,[a(n(Y),{class:"w-10 h-10 text-primary flex-shrink-0 mt-1"}),e("div",Pe,[s[27]||(s[27]=e("p",{class:"font-bold text-lg mb-2"},"Estimation de l'envoi",-1)),e("div",Re,[e("div",null,[s[23]||(s[23]=e("p",{class:"text-muted-foreground"},"Destinataires",-1)),e("p",Le,r(k.value),1)]),e("div",null,[s[24]||(s[24]=e("p",{class:"text-muted-foreground"},"SMS par message",-1)),e("p",{class:C(["text-2xl font-bold",d.value>1?"text-warning":"text-foreground"])},r(d.value),3)]),e("div",null,[s[25]||(s[25]=e("p",{class:"text-muted-foreground"},"Total SMS",-1)),e("p",Xe,r(M.value),1)]),e("div",qe,[s[26]||(s[26]=e("p",{class:"text-muted-foreground"},"Coût estimé",-1)),e("p",Ge,r(F.value)+" XAF",1)])])])])]),w.value?(l(),i("div",He,[e("div",Ie,[a(n(le),{class:"w-5 h-5"}),e("p",Je,r(w.value),1)])])):y("",!0),S.value?(l(),i("div",Ke,[e("div",Oe,[a(n(ae),{class:"w-5 h-5"}),e("p",Qe,r(S.value),1)])])):y("",!0),e("div",We,[e("button",{onClick:L,disabled:!T.value||h.value,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-success text-success-foreground hover:bg-success/90 h-10 px-6 py-2"},[h.value?(l(),i("div",Ze)):(l(),A(n(B),{key:0,class:"w-5 h-5"})),e("span",null,r(h.value?"Envoi en cours...":"Envoyer maintenant"),1)],8,Ye),e("button",{onClick:z,disabled:h.value,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"},[a(n(ie),{class:"w-4 h-4"}),s[28]||(s[28]=e("span",null,"Réinitialiser",-1))],8,es)])])])])]),_:1}))}});export{cs as default};
