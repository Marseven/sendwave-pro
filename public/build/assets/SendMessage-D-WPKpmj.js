import{d as K,r as m,k as w,l as Q,m as D,n as Y,o as r,b as e,p as d,q as u,s as S,f as _,z as A,c as a,A as Z,F as ee,x as se,t as l,g as c,i as g,v as P}from"./main-QOMeYZLg.js";import{_ as te,r as B,a as j,c as oe,d as le,e as re}from"./api-BdomKYOb.js";import{c as ne}from"./contactService-DM0lV7XT.js";import{s as ie,a as ae,b as ue}from"./notifications-CHQAjgV4.js";import{r as de}from"./UserIcon-B7_3Qs1s.js";import{r as L}from"./PhoneIcon-BA4INBz6.js";import{r as R}from"./CheckCircleIcon-Ci5j4t4y.js";import{r as G,a as ve}from"./XCircleIcon-D4D8hFkk.js";import{r as ce}from"./ExclamationTriangleIcon-D7oYYh82.js";const me={class:"p-8"},pe={class:"mb-8"},fe={class:"flex items-center gap-2"},ge={class:"max-w-3xl mx-auto"},be={class:"rounded-lg border bg-card shadow-sm p-8 space-y-6"},xe={class:"space-y-3"},he={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},ye={class:"flex-1"},we={class:"flex items-center gap-2"},_e={class:"flex-1"},ke={class:"flex items-center gap-2"},Se={class:"flex-1"},Me={class:"flex items-center gap-2"},$e={key:0,class:"space-y-2"},Xe=["value"],Ce={key:1,class:"space-y-2"},Ve={class:"text-sm font-medium flex items-center gap-2"},Ee={key:0,class:"space-y-1"},Ne={key:0,class:"flex items-center gap-1.5 text-xs text-success"},Ae={key:1,class:"flex items-center gap-1.5 text-xs text-destructive"},Pe={key:2,class:"space-y-2"},Fe={class:"text-sm font-medium flex items-center gap-2"},Ue={class:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs"},Te={class:"flex items-center gap-1.5"},ze={key:0,class:"flex items-center gap-1.5"},De={key:1,class:"flex items-center gap-1.5"},Be={key:2,class:"flex items-center gap-1.5"},je={class:"space-y-2"},Le={class:"flex items-center justify-between"},Re={class:"text-sm font-medium flex items-center gap-2"},Ge={class:"flex items-center gap-3 text-xs"},Ie={class:"text-muted-foreground"},qe={key:0,class:"px-2 py-1 bg-warning/10 text-warning rounded font-medium"},Oe={key:0,class:"flex items-center gap-1.5 text-xs text-warning"},We={class:"p-5 bg-gradient-to-r from-primary/10 to-primary/5 border-2 border-primary/20 rounded-lg"},He={class:"flex items-start gap-4"},Je={class:"flex-1"},Ke={class:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm"},Qe={class:"text-2xl font-bold text-foreground"},Ye={class:"text-2xl font-bold text-foreground"},Ze={class:"md:col-span-3"},es={class:"text-3xl font-bold text-primary"},ss={key:3,class:"rounded-lg bg-success/10 border border-success/20 p-4"},ts={class:"flex items-center gap-2 text-success"},os={class:"font-medium"},ls={key:4,class:"rounded-lg bg-destructive/10 border border-destructive/20 p-4"},rs={class:"flex items-center gap-2 text-destructive"},ns={class:"font-medium"},is={class:"flex gap-3 pt-4 border-t"},as=["disabled"],us={key:1,class:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"},ds=["disabled"],ws=K({__name:"SendMessage",setup(vs){const o=m("contact"),h=m(""),p=m(""),b=m(""),y=m(""),V=m([]),k=m(!1),M=m(""),$=m(""),n=m({phone:null,multiple:{airtel:0,moov:0,invalid:0}});function F(v){let t=v.replace(/\D/g,"");if(t.startsWith("241")&&(t=t.substring(3)),t.length!==8)return{valid:!1,message:"Le numéro doit contenir 8 chiffres",operator:"unknown"};const i=t.substring(0,2),N=["77","74","76"],x=["60","62","65","66"];return N.includes(i)?{valid:!0,operator:"airtel",operator_name:"Airtel Gabon",prefix:i,formatted:`+241 ${t.substring(0,2)} ${t.substring(2,4)} ${t.substring(4,6)} ${t.substring(6,8)}`}:x.includes(i)?{valid:!0,operator:"moov",operator_name:"Moov Gabon",prefix:i,formatted:`+241 ${t.substring(0,2)} ${t.substring(2,4)} ${t.substring(4,6)} ${t.substring(6,8)}`}:{valid:!1,message:`Préfixe ${i} non reconnu (Airtel: 77, 74, 76 | Moov: 60, 62, 65, 66)`,operator:"unknown"}}function I(){if(!p.value.trim()){n.value.phone=null;return}n.value.phone=F(p.value)}function q(){const v=b.value.split(`
`).filter(t=>t.trim()),s={airtel:0,moov:0,invalid:0};v.forEach(t=>{const i=F(t);i.operator==="airtel"?s.airtel++:i.operator==="moov"?s.moov++:s.invalid++}),n.value.multiple=s}const O=w(()=>y.value.length),f=w(()=>Math.ceil(y.value.length/160)||1),E=w(()=>o.value==="multiple"&&b.value?b.value.split(`
`).filter(v=>v.trim()).length:0),X=w(()=>o.value==="contact"&&h.value||o.value==="phone"&&p.value?1:o.value==="multiple"?E.value:0),C=w(()=>X.value*f.value),U=w(()=>Math.round(C.value*20)),T=w(()=>!(!y.value.trim()||o.value==="contact"&&!h.value||o.value==="phone"&&!p.value.trim()||o.value==="multiple"&&E.value===0));async function W(){try{const v=await ne.getAll();V.value=v.filter(s=>s.status==="active")}catch(v){console.error("Error loading contacts:",v)}}async function H(){var s,t;if(!(!T.value||!await ie("Confirmer l'envoi",`Envoyer ${C.value} SMS (${X.value} destinataire(s) × ${f.value} SMS) pour ${U.value} XAF ?`))){k.value=!0,M.value="",$.value="";try{let i=[];if(o.value==="contact"&&h.value){const x=V.value.find(J=>J.id.toString()===h.value);x&&(i=[x.phone])}else o.value==="phone"&&p.value?i=[p.value.trim()]:o.value==="multiple"&&b.value&&(i=b.value.split(`
`).map(x=>x.trim()).filter(x=>x));const N={recipients:i,message:y.value,type:"immediate"};await re.post("/messages/send",N),ae(`${C.value} SMS envoyé(s) avec succès à ${X.value} destinataire(s) !`),setTimeout(()=>{z()},2e3)}catch(i){console.error("Error sending message:",i),ue(((t=(s=i.response)==null?void 0:s.data)==null?void 0:t.message)||"Erreur lors de l'envoi du message")}finally{k.value=!1}}}function z(){o.value="contact",h.value="",p.value="",b.value="",y.value="",M.value="",$.value=""}return Q(()=>{W()}),(v,s)=>(r(),D(te,null,{default:Y(()=>[e("div",me,[e("div",pe,[e("div",fe,[d(u(B),{class:"w-8 h-8 text-primary"}),s[7]||(s[7]=e("h1",{class:"text-3xl font-bold"},"Envoyer un message",-1))]),s[8]||(s[8]=e("p",{class:"text-muted-foreground mt-2"},"Envoyez un SMS rapide à un ou plusieurs destinataires",-1))]),e("div",ge,[e("div",be,[e("div",xe,[s[15]||(s[15]=e("label",{class:"text-sm font-medium"},"Type de destinataire",-1)),e("div",he,[e("label",{class:S(["flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-accent/50 transition-colors",o.value==="contact"?"border-primary bg-primary/5":"border-border"])},[_(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>o.value=t),type:"radio",value:"contact",class:"mt-1 w-4 h-4"},null,512),[[A,o.value]]),e("div",ye,[e("div",we,[d(u(de),{class:"w-5 h-5 text-primary"}),s[9]||(s[9]=e("div",{class:"font-semibold text-sm"},"Contact",-1))]),s[10]||(s[10]=e("div",{class:"text-xs text-muted-foreground mt-1"},"Depuis vos contacts",-1))])],2),e("label",{class:S(["flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-accent/50 transition-colors",o.value==="phone"?"border-primary bg-primary/5":"border-border"])},[_(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>o.value=t),type:"radio",value:"phone",class:"mt-1 w-4 h-4"},null,512),[[A,o.value]]),e("div",_e,[e("div",ke,[d(u(L),{class:"w-5 h-5 text-primary"}),s[11]||(s[11]=e("div",{class:"font-semibold text-sm"},"Numéro",-1))]),s[12]||(s[12]=e("div",{class:"text-xs text-muted-foreground mt-1"},"Saisir manuellement",-1))])],2),e("label",{class:S(["flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer hover:bg-accent/50 transition-colors",o.value==="multiple"?"border-primary bg-primary/5":"border-border"])},[_(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>o.value=t),type:"radio",value:"multiple",class:"mt-1 w-4 h-4"},null,512),[[A,o.value]]),e("div",Se,[e("div",Me,[d(u(j),{class:"w-5 h-5 text-primary"}),s[13]||(s[13]=e("div",{class:"font-semibold text-sm"},"Plusieurs",-1))]),s[14]||(s[14]=e("div",{class:"text-xs text-muted-foreground mt-1"},"Multiples numéros",-1))])],2)])]),o.value==="contact"?(r(),a("div",$e,[s[17]||(s[17]=e("label",{class:"text-sm font-medium"},"Sélectionner un contact *",-1)),_(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>h.value=t),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[s[16]||(s[16]=e("option",{value:""},"Choisir un contact...",-1)),(r(!0),a(ee,null,se(V.value,t=>(r(),a("option",{key:t.id,value:t.id},l(t.name)+" ("+l(t.phone)+") ",9,Xe))),128))],512),[[Z,h.value]])])):c("",!0),o.value==="phone"?(r(),a("div",Ce,[e("label",Ve,[d(u(L),{class:"w-4 h-4 text-muted-foreground"}),s[18]||(s[18]=g(" Numéro de téléphone * ",-1))]),_(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>p.value=t),type:"tel",placeholder:"+241 77 75 07 37 ou 77750737",onInput:I,class:S(["flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",n.value.phone&&!n.value.phone.valid?"border-destructive":""])},null,34),[[P,p.value]]),n.value.phone?(r(),a("div",Ee,[n.value.phone.valid?(r(),a("p",Ne,[d(u(R),{class:"w-4 h-4"}),e("span",null,l(n.value.phone.operator_name)+" ("+l(n.value.phone.prefix)+") - Format: "+l(n.value.phone.formatted),1)])):(r(),a("p",Ae,[d(u(G),{class:"w-4 h-4"}),e("span",null,l(n.value.phone.message),1)]))])):c("",!0),s[19]||(s[19]=e("p",{class:"text-xs text-muted-foreground"},[g(" Format: +241 XX XX XX XX ou XX XX XX XX"),e("br"),g(" Airtel: 77, 74, 76 | Moov: 60, 62, 65, 66 ")],-1))])):c("",!0),o.value==="multiple"?(r(),a("div",Pe,[e("label",Fe,[d(u(j),{class:"w-4 h-4 text-muted-foreground"}),s[20]||(s[20]=g(" Numéros de téléphone (un par ligne) * ",-1))]),_(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=t=>b.value=t),onInput:q,placeholder:`+241 77 75 07 37
77 75 07 37
62 34 56 78`,rows:"5",class:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 resize-none font-mono"},null,544),[[P,b.value]]),e("div",Ue,[e("div",Te,[s[22]||(s[22]=e("div",{class:"w-2 h-2 rounded-full bg-primary"},null,-1)),e("span",null,[e("strong",null,l(E.value),1),s[21]||(s[21]=g(" total",-1))])]),n.value.multiple.airtel>0?(r(),a("div",ze,[s[24]||(s[24]=e("div",{class:"w-2 h-2 rounded-full bg-red-500"},null,-1)),e("span",null,[e("strong",null,l(n.value.multiple.airtel),1),s[23]||(s[23]=g(" Airtel",-1))])])):c("",!0),n.value.multiple.moov>0?(r(),a("div",De,[s[26]||(s[26]=e("div",{class:"w-2 h-2 rounded-full bg-blue-500"},null,-1)),e("span",null,[e("strong",null,l(n.value.multiple.moov),1),s[25]||(s[25]=g(" Moov",-1))])])):c("",!0),n.value.multiple.invalid>0?(r(),a("div",Be,[s[28]||(s[28]=e("div",{class:"w-2 h-2 rounded-full bg-destructive"},null,-1)),e("span",null,[e("strong",null,l(n.value.multiple.invalid),1),s[27]||(s[27]=g(" invalide(s)",-1))])])):c("",!0)]),s[29]||(s[29]=e("p",{class:"text-xs text-muted-foreground"}," Airtel: 77, 74, 76 | Moov: 60, 62, 65, 66 ",-1))])):c("",!0),e("div",je,[e("div",Le,[e("label",Re,[d(u(oe),{class:"w-4 h-4 text-muted-foreground"}),s[30]||(s[30]=g(" Message * ",-1))]),e("div",Ge,[e("span",Ie,l(O.value)+"/160 caractères",1),f.value>1?(r(),a("span",qe,l(f.value)+" SMS ",1)):c("",!0)])]),_(e("textarea",{"onUpdate:modelValue":s[6]||(s[6]=t=>y.value=t),placeholder:"Votre message SMS...",rows:"6",maxlength:"320",class:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 resize-none font-mono"},null,512),[[P,y.value]]),f.value>1?(r(),a("p",Oe,[d(u(ce),{class:"w-4 h-4"}),e("span",null,"Votre message sera envoyé en "+l(f.value)+" SMS (coût multiplié par "+l(f.value)+")",1)])):c("",!0)]),e("div",We,[e("div",He,[d(u(le),{class:"w-10 h-10 text-primary flex-shrink-0 mt-1"}),e("div",Je,[s[35]||(s[35]=e("p",{class:"font-bold text-lg mb-2"},"Estimation de l'envoi",-1)),e("div",Ke,[e("div",null,[s[31]||(s[31]=e("p",{class:"text-muted-foreground"},"Destinataires",-1)),e("p",Qe,l(X.value),1)]),e("div",null,[s[32]||(s[32]=e("p",{class:"text-muted-foreground"},"SMS par message",-1)),e("p",{class:S(["text-2xl font-bold",f.value>1?"text-warning":"text-foreground"])},l(f.value),3)]),e("div",null,[s[33]||(s[33]=e("p",{class:"text-muted-foreground"},"Total SMS",-1)),e("p",Ye,l(C.value),1)]),e("div",Ze,[s[34]||(s[34]=e("p",{class:"text-muted-foreground"},"Coût estimé",-1)),e("p",es,l(U.value)+" XAF",1)])])])])]),M.value?(r(),a("div",ss,[e("div",ts,[d(u(R),{class:"w-5 h-5"}),e("p",os,l(M.value),1)])])):c("",!0),$.value?(r(),a("div",ls,[e("div",rs,[d(u(G),{class:"w-5 h-5"}),e("p",ns,l($.value),1)])])):c("",!0),e("div",is,[e("button",{onClick:H,disabled:!T.value||k.value,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-success text-success-foreground hover:bg-success/90 h-10 px-6 py-2"},[k.value?(r(),a("div",us)):(r(),D(u(B),{key:0,class:"w-5 h-5"})),e("span",null,l(k.value?"Envoi en cours...":"Envoyer maintenant"),1)],8,as),e("button",{onClick:z,disabled:k.value,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"},[d(u(ve),{class:"w-4 h-4"}),s[36]||(s[36]=e("span",null,"Réinitialiser",-1))],8,ds)])])])])]),_:1}))}});export{ws as default};
