import{o as d,c,b as e,d as G,r as p,k as A,m as I,n as E,p as C,j as J,E as K,x as a,y as u,f as y,v as $,C as O,t as i,F as M,q as B,s as H,i as b,g as j,w as Q}from"./main-BzIReI80.js";import{f as S,_ as W,h as Y,k as z,m as Z,c as ee,d as te,a as se}from"./api-DhO2lyeo.js";import{c as oe}from"./campaignService-BGZVgZLY.js";import{b as N,a as ne}from"./notifications-CHQAjgV4.js";import{r as re}from"./EyeIcon-BixIg8-S.js";import{r as ie}from"./BanknotesIcon-BL-7ydfi.js";import{r as le,a as ae}from"./ChevronRightIcon-Cuse4nKv.js";import{r as de}from"./XMarkIcon-DdeN09bR.js";function ue(m,g){return d(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"})])}function ce(m,g){return d(),c("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776"})])}const fe={async getAll(m){const g=await S.get("/campaigns/history",{params:m});return g.data.data||g.data},async getById(m){const g=await S.get(`/campaigns/${m}`);return g.data.data||g.data},async getStats(){const m=await S.get("/campaigns/stats");return m.data.data||m.data}},me={class:"p-8"},ge={class:"mb-8 flex items-center justify-between"},ve={class:"flex items-center gap-2"},pe={class:"mb-6 grid grid-cols-1 md:grid-cols-4 gap-4"},be={key:0,class:"flex justify-center items-center py-12"},xe={key:1,class:"text-center py-16"},he={class:"text-muted-foreground mb-6"},ye={key:2,class:"space-y-4"},we={class:"flex items-start justify-between mb-4"},_e={class:"flex-1"},ke={class:"flex items-center gap-3 mb-2"},Ce={class:"text-lg font-semibold"},$e={class:"text-sm text-muted-foreground line-clamp-2"},je={class:"flex items-center gap-2"},Se=["onClick","disabled"],De={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"},Te=["onClick"],Fe={class:"grid grid-cols-2 md:grid-cols-5 gap-4 pt-4 border-t"},Le={class:"text-sm font-medium flex items-center gap-1.5"},Ve={class:"text-sm font-medium flex items-center gap-1.5"},Ae={class:"text-sm font-medium flex items-center gap-1.5"},Ee={class:"text-sm font-medium flex items-center gap-1.5"},Me={class:"text-sm font-bold text-primary flex items-center gap-1.5"},Be={key:3,class:"mt-6 flex justify-center gap-2"},He=["disabled"],ze={class:"inline-flex items-center px-4 text-sm"},Ne=["disabled"],Pe={class:"bg-background rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},Ue={class:"p-6 border-b flex items-center justify-between"},qe={class:"p-6 space-y-6"},Re={class:"text-muted-foreground"},Xe={class:"p-4 bg-muted/50 rounded-lg font-mono text-sm whitespace-pre-wrap"},Ge={class:"grid grid-cols-2 gap-4"},Ie={class:"text-muted-foreground"},Je={class:"grid grid-cols-2 gap-4"},Ke={class:"text-2xl font-bold text-primary"},Oe={class:"text-2xl font-bold text-primary"},Qe={class:"grid grid-cols-2 gap-4"},We={class:"text-2xl font-bold"},Ye={class:"text-2xl font-bold text-primary"},Ze={key:0},et={class:"flex flex-wrap gap-2"},tt={class:"p-6 border-t flex justify-end"},D=10,ut=G({__name:"CampaignHistory",setup(m){const g=J(),w=p([]),_=p(!1),x=p(null),l=p(null),v=p(1),n=p({search:"",status:"",dateFrom:"",dateTo:""}),T=A(()=>{let o=w.value;if(n.value.search){const s=n.value.search.toLowerCase();o=o.filter(f=>f.name.toLowerCase().includes(s)||f.message.toLowerCase().includes(s))}n.value.status&&(o=o.filter(s=>h(s.status)===n.value.status)),n.value.dateFrom&&(o=o.filter(s=>{const f=s.sent_at||s.scheduled_at;return f&&f>=n.value.dateFrom})),n.value.dateTo&&(o=o.filter(s=>{const f=s.sent_at||s.scheduled_at;return f&&f<=n.value.dateTo}));const t=(v.value-1)*D,r=t+D;return o.slice(t,r)}),k=A(()=>{let o=w.value;if(n.value.search||n.value.status||n.value.dateFrom||n.value.dateTo){const t=n.value.search.toLowerCase();o=o.filter(r=>{const s=!n.value.search||r.name.toLowerCase().includes(t)||r.message.toLowerCase().includes(t),f=!n.value.status||h(r.status)===n.value.status,R=!n.value.dateFrom||(r.sent_at||r.scheduled_at||"")>=n.value.dateFrom,X=!n.value.dateTo||(r.sent_at||r.scheduled_at||"")<=n.value.dateTo;return s&&f&&R&&X})}return Math.ceil(o.length/D)});function h(o){const t=(o==null?void 0:o.toLowerCase())||"";return t==="actif"||t==="sending"?"sending":t==="terminé"||t==="termine"?"completed":t==="planifié"||t==="planifie"?"scheduled":t}function F(o){const t=h(o);return{draft:"bg-muted text-muted-foreground",scheduled:"bg-primary/10 text-primary",sending:"bg-warning/10 text-warning",completed:"bg-success/10 text-success",failed:"bg-destructive/10 text-destructive",cancelled:"bg-muted text-muted-foreground"}[t]||"bg-muted text-muted-foreground"}function L(o){const t=h(o);return{draft:"Brouillon",scheduled:"Planifié",sending:"En cours",completed:"Terminé",failed:"Échoué",cancelled:"Annulé"}[t]||o}function V(o){return o?new Date(o).toLocaleString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}function P(o){l.value=o}async function U(o){var t,r;x.value=o.id;try{const s=await oe.clone(o.id);ne(`Campagne "${s.name}" créée avec succès`),g.push("/campaign/create")}catch(s){console.error("Error cloning campaign:",s),N(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Erreur lors du clonage de la campagne")}finally{x.value=null}}async function q(){var o,t;_.value=!0;try{w.value=await fe.getAll()}catch(r){console.error("Error loading campaigns:",r),N(((t=(o=r.response)==null?void 0:o.data)==null?void 0:t.message)||"Erreur lors du chargement des campagnes")}finally{_.value=!1}}return I(()=>{q()}),(o,t)=>{const r=K("router-link");return d(),E(W,null,{default:C(()=>[e("div",me,[e("div",ge,[e("div",null,[e("div",ve,[a(u(Y),{class:"w-8 h-8 text-primary"}),t[9]||(t[9]=e("h1",{class:"text-3xl font-bold"},"Historique des campagnes",-1))]),t[10]||(t[10]=e("p",{class:"text-muted-foreground mt-2"},"Consultez toutes vos campagnes envoyées",-1))]),a(r,{to:"/campaigns/create",class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},{default:C(()=>[a(u(z),{class:"w-4 h-4"}),t[11]||(t[11]=e("span",null,"Nouvelle campagne",-1))]),_:1})]),e("div",pe,[e("div",null,[y(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>n.value.search=s),type:"text",placeholder:"Rechercher...",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[$,n.value.search]])]),e("div",null,[y(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>n.value.status=s),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...t[12]||(t[12]=[e("option",{value:""},"Tous les statuts",-1),e("option",{value:"draft"},"Brouillon",-1),e("option",{value:"scheduled"},"Planifié",-1),e("option",{value:"sending"},"En cours",-1),e("option",{value:"completed"},"Terminé",-1),e("option",{value:"failed"},"Échoué",-1),e("option",{value:"cancelled"},"Annulé",-1)])],512),[[O,n.value.status]])]),e("div",null,[y(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.value.dateFrom=s),type:"date",placeholder:"Date de début",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[$,n.value.dateFrom]])]),e("div",null,[y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.value.dateTo=s),type:"date",placeholder:"Date de fin",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[$,n.value.dateTo]])])]),_.value?(d(),c("div",be,[...t[13]||(t[13]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):T.value.length===0?(d(),c("div",xe,[a(u(ce),{class:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),t[15]||(t[15]=e("h3",{class:"text-lg font-semibold mb-2"},"Aucune campagne trouvée",-1)),e("p",he,i(n.value.search||n.value.status?"Essayez de modifier vos filtres":"Commencez par créer votre première campagne"),1),a(r,{to:"/campaigns/create",class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},{default:C(()=>[a(u(z),{class:"w-4 h-4"}),t[14]||(t[14]=e("span",null,"Créer une campagne",-1))]),_:1})])):(d(),c("div",ye,[(d(!0),c(M,null,B(T.value,s=>(d(),c("div",{key:s.id,class:"rounded-lg border bg-card shadow-sm p-6 hover:shadow-md transition-shadow"},[e("div",we,[e("div",_e,[e("div",ke,[e("h3",Ce,i(s.name),1),e("span",{class:H(["px-2.5 py-0.5 rounded-full text-xs font-medium",F(s.status)])},i(L(s.status)),3)]),e("p",$e,i(s.message),1)]),e("div",je,[e("button",{onClick:f=>U(s),disabled:x.value===s.id,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3",title:"Dupliquer"},[x.value!==s.id?(d(),E(u(ue),{key:0,class:"w-4 h-4"})):(d(),c("div",De))],8,Se),e("button",{onClick:f=>P(s),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"},[a(u(re),{class:"w-4 h-4"}),t[16]||(t[16]=e("span",null,"Détails",-1))],8,Te)])]),e("div",Fe,[e("div",null,[t[17]||(t[17]=e("p",{class:"text-xs text-muted-foreground mb-1"},"Date d'envoi",-1)),e("p",Le,[a(u(Z),{class:"w-4 h-4 text-muted-foreground"}),b(" "+i(V(s.sent_at||s.scheduled_at)),1)])]),e("div",null,[t[18]||(t[18]=e("p",{class:"text-xs text-muted-foreground mb-1"},"Destinataires",-1)),e("p",Ve,[a(u(ee),{class:"w-4 h-4 text-muted-foreground"}),b(" "+i(s.recipients_count),1)])]),e("div",null,[t[19]||(t[19]=e("p",{class:"text-xs text-muted-foreground mb-1"},"SMS envoyés",-1)),e("p",Ae,[a(u(te),{class:"w-4 h-4 text-muted-foreground"}),b(" "+i(s.sms_count),1)])]),e("div",null,[t[20]||(t[20]=e("p",{class:"text-xs text-muted-foreground mb-1"},"Taux de livraison",-1)),e("p",Ee,[a(u(se),{class:"w-4 h-4 text-muted-foreground"}),b(" "+i(s.delivery_rate)+"% ",1)])]),e("div",null,[t[21]||(t[21]=e("p",{class:"text-xs text-muted-foreground mb-1"},"Coût total",-1)),e("p",Me,[a(u(ie),{class:"w-4 h-4"}),b(" "+i(s.cost)+" XAF ",1)])])])]))),128))])),k.value>1?(d(),c("div",Be,[e("button",{onClick:t[4]||(t[4]=s=>v.value--),disabled:v.value===1,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"},[a(u(le),{class:"w-4 h-4"})],8,He),e("span",ze," Page "+i(v.value)+" sur "+i(k.value),1),e("button",{onClick:t[5]||(t[5]=s=>v.value++),disabled:v.value===k.value,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"},[a(u(ae),{class:"w-4 h-4"})],8,Ne)])):j("",!0)]),l.value?(d(),c("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:t[8]||(t[8]=Q(s=>l.value=null,["self"]))},[e("div",Pe,[e("div",Ue,[t[22]||(t[22]=e("h2",{class:"text-2xl font-bold"},"Détails de la campagne",-1)),e("button",{onClick:t[6]||(t[6]=s=>l.value=null),class:"text-muted-foreground hover:text-foreground transition-colors"},[a(u(de),{class:"w-6 h-6"})])]),e("div",qe,[e("div",null,[t[23]||(t[23]=e("h3",{class:"font-semibold mb-2"},"Nom de la campagne",-1)),e("p",Re,i(l.value.name),1)]),e("div",null,[t[24]||(t[24]=e("h3",{class:"font-semibold mb-2"},"Message",-1)),e("div",Xe,i(l.value.message),1)]),e("div",Ge,[e("div",null,[t[25]||(t[25]=e("h3",{class:"font-semibold mb-2"},"Statut",-1)),e("span",{class:H(["inline-block px-3 py-1 rounded-full text-sm font-medium",F(l.value.status)])},i(L(l.value.status)),3)]),e("div",null,[t[26]||(t[26]=e("h3",{class:"font-semibold mb-2"},"Date d'envoi",-1)),e("p",Ie,i(V(l.value.sent_at||l.value.scheduled_at)),1)])]),e("div",Je,[e("div",null,[t[27]||(t[27]=e("h3",{class:"font-semibold mb-2"},"Destinataires",-1)),e("p",Ke,i(l.value.recipients_count),1)]),e("div",null,[t[28]||(t[28]=e("h3",{class:"font-semibold mb-2"},"SMS envoyés",-1)),e("p",Oe,i(l.value.sms_count),1)])]),e("div",Qe,[e("div",null,[t[29]||(t[29]=e("h3",{class:"font-semibold mb-2"},"Taux de livraison",-1)),e("p",We,i(l.value.delivery_rate)+"%",1)]),e("div",null,[t[30]||(t[30]=e("h3",{class:"font-semibold mb-2"},"Coût total",-1)),e("p",Ye,i(l.value.cost)+" XAF",1)])]),l.value.groups&&l.value.groups.length>0?(d(),c("div",Ze,[t[31]||(t[31]=e("h3",{class:"font-semibold mb-2"},"Groupes ciblés",-1)),e("div",et,[(d(!0),c(M,null,B(l.value.groups,s=>(d(),c("span",{key:s.id,class:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm"},i(s.name),1))),128))])])):j("",!0)]),e("div",tt,[e("button",{onClick:t[7]||(t[7]=s=>l.value=null),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Fermer ")])])])):j("",!0)]),_:1})}}});export{ut as default};
