import{d as Q,r as x,k as D,m as W,n as L,p as M,E as Y,o as d,b as e,x as a,y as c,t as i,f as b,v as A,C as B,c as m,F as U,q as N,s as g,A as P,i as H,g as h,w as Z}from"./main-jARQBOon.js";import{f as _,_ as ee,d as R,r as X,v as te,i as E,h as se}from"./api-CKlGjfMy.js";import{b as oe}from"./notifications-CHQAjgV4.js";import{r as q}from"./CheckCircleIcon-DM4_mrR5.js";import{r as ne}from"./ExclamationCircleIcon-BaKv6oiB.js";import{r as ie}from"./BanknotesIcon-C_BTufEp.js";import{r as re}from"./PhoneIcon-LngasIH7.js";import{r as le}from"./EyeIcon-BXunVFFm.js";import{r as ae}from"./ChevronLeftIcon-Dl1YIzxK.js";import{r as de}from"./ChevronRightIcon-BcwDPPup.js";import{r as ue}from"./XCircleIcon-CL0mZ5X1.js";const ce={async getAll(f){const u=await _.get("/messages/history",{params:f});return u.data.data||u.data},async getById(f){const u=await _.get(`/messages/${f}`);return u.data.data||u.data},async getStats(){const f=await _.get("/messages/stats");return f.data.data||f.data},async exportToCsv(f){return(await _.get("/messages/export",{params:f,responseType:"blob"})).data}},me={class:"p-4 sm:p-6 lg:p-8"},fe={class:"mb-4 sm:mb-8 flex flex-col sm:flex-row sm:items-center justify-between gap-3 sm:gap-4"},pe={class:"flex items-center gap-2"},ve={class:"grid grid-cols-2 lg:grid-cols-4 gap-2 sm:gap-4 mb-4 sm:mb-6"},ge={class:"rounded-lg border bg-card p-3 sm:p-6"},xe={class:"flex items-center justify-between"},be={class:"text-lg sm:text-2xl font-bold"},he={class:"rounded-lg border bg-card p-3 sm:p-6"},ye={class:"flex items-center justify-between"},_e={class:"text-lg sm:text-2xl font-bold text-success"},we={class:"rounded-lg border bg-card p-3 sm:p-6"},ke={class:"flex items-center justify-between"},Ce={class:"text-lg sm:text-2xl font-bold text-destructive"},$e={class:"rounded-lg border bg-card p-3 sm:p-6"},Te={class:"flex items-center justify-between"},je={class:"text-lg sm:text-2xl font-bold text-primary"},Fe={class:"mb-4 sm:mb-6 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 sm:gap-4"},Se={class:"col-span-2 sm:col-span-1"},De={key:0,class:"flex justify-center items-center py-12"},Le={key:1,class:"text-center py-16"},Me={class:"text-muted-foreground mb-6"},Ae={key:2,class:"rounded-lg border bg-card shadow-sm overflow-hidden"},Ee={class:"hidden md:block overflow-x-auto"},ze={class:"w-full"},Ve={class:"divide-y"},Ie={class:"p-4 text-sm"},Be={class:"flex items-center gap-2"},Ue={class:"text-xs text-muted-foreground"},Ne={class:"p-4 text-sm"},Pe={class:"flex items-center gap-2"},He={class:"font-medium"},Re={class:"text-xs text-muted-foreground font-mono"},Xe={class:"p-4 text-sm max-w-xs"},qe={class:"truncate font-mono text-xs"},Oe={class:"p-4 text-sm"},Ge={class:"p-4 text-sm"},Je={class:"p-4 text-sm font-semibold text-primary"},Ke={class:"p-4 text-sm"},Qe=["onClick"],We={class:"md:hidden divide-y"},Ye=["onClick"],Ze={class:"flex items-start justify-between mb-2"},et={class:"min-w-0 flex-1"},tt={class:"font-medium text-sm"},st={class:"text-xs text-muted-foreground"},ot={class:"text-xs text-muted-foreground line-clamp-2 mb-2"},nt={class:"flex items-center justify-between text-xs"},it={class:"font-semibold text-primary"},rt={key:3,class:"mt-4 sm:mt-6 flex justify-center gap-2"},lt=["disabled"],at={class:"inline-flex items-center px-2 sm:px-4 text-xs sm:text-sm"},dt=["disabled"],ut={class:"bg-background rounded-lg shadow-xl w-full max-w-sm sm:max-w-2xl max-h-[90vh] overflow-y-auto"},ct={class:"p-6 border-b flex items-center justify-between"},mt={class:"p-6 space-y-6"},ft={class:"grid grid-cols-2 gap-4"},pt={class:"text-muted-foreground"},vt={class:"text-sm text-muted-foreground font-mono mt-1"},gt={class:"text-muted-foreground"},xt={class:"text-sm text-muted-foreground mt-1"},bt={class:"p-4 bg-muted/50 rounded-lg font-mono text-sm whitespace-pre-wrap"},ht={class:"text-xs text-muted-foreground mt-2"},yt={class:"grid grid-cols-3 gap-4"},_t={class:"text-2xl font-bold text-primary"},wt={key:0},kt={class:"text-muted-foreground"},Ct={key:1},$t={class:"text-muted-foreground uppercase"},Tt={key:2,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},jt={class:"text-sm text-destructive"},Ft={class:"p-6 border-t flex justify-end"},z=20,Nt=Q({__name:"MessageHistory",setup(f){const u=x([]),w=x(!1),r=x(null),v=x(1),n=x({search:"",status:"",type:"",dateFrom:"",dateTo:""}),y=D(()=>({total:u.value.length,delivered:u.value.filter(o=>o.status==="delivered"||o.status==="sent").length,failed:u.value.filter(o=>o.status==="failed").length,totalCost:u.value.reduce((o,t)=>o+t.cost,0)})),k=D(()=>{let o=u.value;if(n.value.search){const s=n.value.search.toLowerCase();o=o.filter(p=>p.recipient_phone.includes(s)||p.recipient_name&&p.recipient_name.toLowerCase().includes(s)||p.content.toLowerCase().includes(s))}n.value.status&&(n.value.status==="delivered"?o=o.filter(s=>s.status==="delivered"||s.status==="sent"):o=o.filter(s=>s.status===n.value.status)),n.value.type&&(o=o.filter(s=>s.type===n.value.type)),n.value.dateFrom&&(o=o.filter(s=>s.sent_at>=n.value.dateFrom)),n.value.dateTo&&(o=o.filter(s=>s.sent_at<=n.value.dateTo));const t=(v.value-1)*z,l=t+z;return o.slice(t,l)}),C=D(()=>{let o=u.value;if(n.value.search||n.value.status||n.value.type||n.value.dateFrom||n.value.dateTo){const t=n.value.search.toLowerCase();o=o.filter(l=>{const s=!n.value.search||l.recipient_phone.includes(t)||l.recipient_name&&l.recipient_name.toLowerCase().includes(t)||l.content.toLowerCase().includes(t),p=!n.value.status||(n.value.status==="delivered"?l.status==="delivered"||l.status==="sent":l.status===n.value.status),G=!n.value.type||l.type===n.value.type,J=!n.value.dateFrom||l.sent_at>=n.value.dateFrom,K=!n.value.dateTo||l.sent_at<=n.value.dateTo;return s&&p&&G&&J&&K})}return Math.ceil(o.length/z)});function $(o){return o==="sent"||o==="delivered"?"delivered":o}function T(o){const t=$(o);return{delivered:"bg-success/10 text-success",pending:"bg-warning/10 text-warning",failed:"bg-destructive/10 text-destructive"}[t]||"bg-muted text-muted-foreground"}function j(o){const t=$(o);return{delivered:"Livré",pending:"En attente",failed:"Échoué"}[t]||o}function V(o){const t=$(o);return{delivered:q,pending:E,failed:ue}[t]||E}function F(o){return new Date(o).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"})}function S(o){return new Date(o).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}function I(o){r.value=o}async function O(){var o,t;w.value=!0;try{u.value=await ce.getAll()}catch(l){console.error("Error loading messages:",l),oe(((t=(o=l.response)==null?void 0:o.data)==null?void 0:t.message)||"Erreur lors du chargement des messages")}finally{w.value=!1}}return W(()=>{O()}),(o,t)=>{const l=Y("router-link");return d(),L(ee,null,{default:M(()=>[e("div",me,[e("div",fe,[e("div",null,[e("div",pe,[a(c(R),{class:"w-6 h-6 sm:w-8 sm:h-8 text-primary"}),t[10]||(t[10]=e("h1",{class:"text-xl sm:text-3xl font-bold"},"Historique messages",-1))]),t[11]||(t[11]=e("p",{class:"text-sm text-muted-foreground mt-1 sm:mt-2"},"Consultez tous les SMS envoyés",-1))]),a(l,{to:"/send-message",class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-9 sm:h-10 px-3 sm:px-4 py-2"},{default:M(()=>[a(c(X),{class:"w-4 h-4"}),t[12]||(t[12]=e("span",{class:"hidden sm:inline"},"Envoyer un message",-1)),t[13]||(t[13]=e("span",{class:"sm:hidden"},"Envoyer",-1))]),_:1})]),e("div",ve,[e("div",ge,[e("div",xe,[e("div",null,[t[14]||(t[14]=e("p",{class:"text-xs sm:text-sm text-muted-foreground mb-0.5 sm:mb-1"},"Total",-1)),e("p",be,i(y.value.total),1)]),a(c(R),{class:"w-6 h-6 sm:w-10 sm:h-10 text-primary/20 hidden sm:block"})])]),e("div",he,[e("div",ye,[e("div",null,[t[15]||(t[15]=e("p",{class:"text-xs sm:text-sm text-muted-foreground mb-0.5 sm:mb-1"},"Livrés",-1)),e("p",_e,i(y.value.delivered),1)]),a(c(q),{class:"w-6 h-6 sm:w-10 sm:h-10 text-success/20 hidden sm:block"})])]),e("div",we,[e("div",ke,[e("div",null,[t[16]||(t[16]=e("p",{class:"text-xs sm:text-sm text-muted-foreground mb-0.5 sm:mb-1"},"Échecs",-1)),e("p",Ce,i(y.value.failed),1)]),a(c(ne),{class:"w-6 h-6 sm:w-10 sm:h-10 text-destructive/20 hidden sm:block"})])]),e("div",$e,[e("div",Te,[e("div",null,[t[17]||(t[17]=e("p",{class:"text-xs sm:text-sm text-muted-foreground mb-0.5 sm:mb-1"},"Coût",-1)),e("p",je,i(y.value.totalCost),1)]),a(c(ie),{class:"w-6 h-6 sm:w-10 sm:h-10 text-primary/20 hidden sm:block"})])])]),e("div",Fe,[e("div",Se,[b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>n.value.search=s),type:"text",placeholder:"Rechercher...",class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-xs sm:text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[A,n.value.search]])]),e("div",null,[b(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>n.value.status=s),class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-2 sm:px-3 py-2 text-xs sm:text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...t[18]||(t[18]=[e("option",{value:""},"Statut",-1),e("option",{value:"delivered"},"Livré",-1),e("option",{value:"pending"},"Attente",-1),e("option",{value:"failed"},"Échoué",-1)])],512),[[B,n.value.status]])]),e("div",null,[b(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.value.type=s),class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-2 sm:px-3 py-2 text-xs sm:text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...t[19]||(t[19]=[e("option",{value:""},"Type",-1),e("option",{value:"immediate"},"Immédiat",-1),e("option",{value:"campaign"},"Campagne",-1)])],512),[[B,n.value.type]])]),e("div",null,[b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.value.dateFrom=s),type:"date",class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-2 sm:px-3 py-2 text-xs sm:text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[A,n.value.dateFrom]])]),e("div",null,[b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>n.value.dateTo=s),type:"date",class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-2 sm:px-3 py-2 text-xs sm:text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[A,n.value.dateTo]])])]),w.value?(d(),m("div",De,[...t[20]||(t[20]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):k.value.length===0?(d(),m("div",Le,[a(c(te),{class:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),t[22]||(t[22]=e("h3",{class:"text-lg font-semibold mb-2"},"Aucun message trouvé",-1)),e("p",Me,i(n.value.search||n.value.status?"Essayez de modifier vos filtres":"Commencez par envoyer votre premier message"),1),a(l,{to:"/send-message",class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},{default:M(()=>[a(c(X),{class:"w-4 h-4"}),t[21]||(t[21]=e("span",null,"Envoyer un message",-1))]),_:1})])):(d(),m("div",Ae,[e("div",Ee,[e("table",ze,[t[23]||(t[23]=e("thead",{class:"bg-muted/50"},[e("tr",null,[e("th",{class:"text-left p-4 text-sm font-semibold"},"Date"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Destinataire"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Message"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Type"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Statut"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Coût"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Actions")])],-1)),e("tbody",Ve,[(d(!0),m(U,null,N(k.value,s=>(d(),m("tr",{key:s.id,class:"hover:bg-muted/30 transition-colors"},[e("td",Ie,[e("div",Be,[a(c(E),{class:"w-4 h-4 text-muted-foreground"}),e("div",null,[e("div",null,i(F(s.sent_at)),1),e("div",Ue,i(S(s.sent_at)),1)])])]),e("td",Ne,[e("div",Pe,[a(c(re),{class:"w-4 h-4 text-muted-foreground"}),e("div",null,[e("div",He,i(s.recipient_name||"Anonyme"),1),e("div",Re,i(s.recipient_phone),1)])])]),e("td",Xe,[e("div",qe,i(s.content),1)]),e("td",Oe,[e("span",{class:g(["px-2.5 py-0.5 rounded-full text-xs font-medium",s.type==="campaign"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"])},i(s.type==="campaign"?"Campagne":"Immédiat"),3)]),e("td",Ge,[e("span",{class:g(["inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium",T(s.status)])},[(d(),L(P(V(s.status)),{class:"w-3.5 h-3.5"})),H(" "+i(j(s.status)),1)],2)]),e("td",Je,i(s.cost)+" XAF",1),e("td",Ke,[e("button",{onClick:p=>I(s),class:"text-primary hover:text-primary/80 transition-colors"},[a(c(le),{class:"w-5 h-5"})],8,Qe)])]))),128))])])]),e("div",We,[(d(!0),m(U,null,N(k.value,s=>(d(),m("div",{key:s.id,class:"p-3",onClick:p=>I(s)},[e("div",Ze,[e("div",et,[e("div",tt,i(s.recipient_name||s.recipient_phone),1),e("div",st,i(F(s.sent_at))+" "+i(S(s.sent_at)),1)]),e("span",{class:g(["ml-2 px-2 py-0.5 rounded-full text-xs font-medium flex-shrink-0",T(s.status)])},i(j(s.status)),3)]),e("p",ot,i(s.content),1),e("div",nt,[e("span",{class:g(["px-2 py-0.5 rounded-full",s.type==="campaign"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"])},i(s.type==="campaign"?"Campagne":"Immédiat"),3),e("span",it,i(s.cost)+" XAF",1)])],8,Ye))),128))])])),C.value>1?(d(),m("div",rt,[e("button",{onClick:t[5]||(t[5]=s=>v.value--),disabled:v.value===1,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 sm:h-9 px-2 sm:px-3"},[a(c(ae),{class:"w-4 h-4"})],8,lt),e("span",at,i(v.value)+"/"+i(C.value),1),e("button",{onClick:t[6]||(t[6]=s=>v.value++),disabled:v.value===C.value,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 sm:h-9 px-2 sm:px-3"},[a(c(de),{class:"w-4 h-4"})],8,dt)])):h("",!0)]),r.value?(d(),m("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-3 sm:p-4",onClick:t[9]||(t[9]=Z(s=>r.value=null,["self"]))},[e("div",ut,[e("div",ct,[t[24]||(t[24]=e("h2",{class:"text-2xl font-bold"},"Détails du message",-1)),e("button",{onClick:t[7]||(t[7]=s=>r.value=null),class:"text-muted-foreground hover:text-foreground transition-colors"},[a(c(se),{class:"w-6 h-6"})])]),e("div",mt,[e("div",ft,[e("div",null,[t[25]||(t[25]=e("h3",{class:"font-semibold mb-2"},"Destinataire",-1)),e("p",pt,i(r.value.recipient_name||"Anonyme"),1),e("p",vt,i(r.value.recipient_phone),1)]),e("div",null,[t[26]||(t[26]=e("h3",{class:"font-semibold mb-2"},"Date d'envoi",-1)),e("p",gt,i(F(r.value.sent_at)),1),e("p",xt,i(S(r.value.sent_at)),1)])]),e("div",null,[t[27]||(t[27]=e("h3",{class:"font-semibold mb-2"},"Message",-1)),e("div",bt,i(r.value.content),1),e("p",ht,i(r.value.content.length)+" caractères",1)]),e("div",yt,[e("div",null,[t[28]||(t[28]=e("h3",{class:"font-semibold mb-2"},"Type",-1)),e("span",{class:g(["inline-block px-3 py-1 rounded-full text-sm font-medium",r.value.type==="campaign"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"])},i(r.value.type==="campaign"?"Campagne":"Immédiat"),3)]),e("div",null,[t[29]||(t[29]=e("h3",{class:"font-semibold mb-2"},"Statut",-1)),e("span",{class:g(["inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium",T(r.value.status)])},[(d(),L(P(V(r.value.status)),{class:"w-4 h-4"})),H(" "+i(j(r.value.status)),1)],2)]),e("div",null,[t[30]||(t[30]=e("h3",{class:"font-semibold mb-2"},"Coût",-1)),e("p",_t,i(r.value.cost)+" XAF",1)])]),r.value.campaign_name?(d(),m("div",wt,[t[31]||(t[31]=e("h3",{class:"font-semibold mb-2"},"Campagne associée",-1)),e("p",kt,i(r.value.campaign_name),1)])):h("",!0),r.value.provider?(d(),m("div",Ct,[t[32]||(t[32]=e("h3",{class:"font-semibold mb-2"},"Opérateur",-1)),e("p",$t,i(r.value.provider),1)])):h("",!0),r.value.error_message?(d(),m("div",Tt,[t[33]||(t[33]=e("h3",{class:"font-semibold mb-2 text-destructive"},"Erreur",-1)),e("p",jt,i(r.value.error_message),1)])):h("",!0)]),e("div",Ft,[e("button",{onClick:t[8]||(t[8]=s=>r.value=null),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Fermer ")])])])):h("",!0)]),_:1})}}});export{Nt as default};
