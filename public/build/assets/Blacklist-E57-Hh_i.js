import{d as I,r as d,j,l as J,m as K,n as W,o as n,b as e,s as u,x as c,t as r,f as C,v as $,c as i,F as M,p as R,g as v,w as q,q as F}from"./main-GXHSoYD-.js";import{_ as X,f as P,o as Z,t as S,i as z}from"./api--QcLuAnz.js";import{b as g,a as U,s as ee}from"./notifications-CHQAjgV4.js";import{r as te}from"./MagnifyingGlassIcon-CGZJzAa2.js";import{r as T}from"./TrashIcon-BOZy2fVK.js";import{r as se}from"./CheckIcon-Kd0-nvYI.js";const oe={class:"p-4 sm:p-6 lg:p-8"},ne={class:"mb-4 sm:mb-8 flex flex-col sm:flex-row sm:items-center justify-between gap-3 sm:gap-4"},re={class:"flex gap-2 sm:gap-3"},ie={class:"grid grid-cols-3 gap-2 sm:gap-6 mb-4 sm:mb-8"},le={class:"rounded-lg border bg-card p-3 sm:p-4"},ae={class:"text-lg sm:text-2xl font-bold mt-1"},de={class:"rounded-lg border bg-card p-3 sm:p-4"},ue={class:"text-lg sm:text-2xl font-bold mt-1 text-destructive"},ce={class:"rounded-lg border bg-card p-3 sm:p-4"},fe={class:"text-lg sm:text-2xl font-bold mt-1 text-success"},me={class:"rounded-lg border bg-card shadow-sm mb-4 sm:mb-6 p-3 sm:p-6"},be={class:"rounded-lg border bg-card shadow-sm"},ve={key:0,class:"flex items-center justify-center py-12"},ge={key:1,class:"flex flex-col items-center justify-center py-8 sm:py-12"},pe={class:"hidden md:block overflow-x-auto"},xe={class:"w-full"},he={class:"p-4 font-medium font-mono"},ye={class:"p-4 text-sm text-muted-foreground"},_e={class:"p-4 text-sm text-muted-foreground"},we={class:"p-4"},ke=["onClick"],je={class:"md:hidden divide-y"},Ce={class:"min-w-0 flex-1"},$e={class:"font-medium font-mono text-sm"},Pe={class:"text-xs text-muted-foreground truncate"},Ae={class:"text-xs text-muted-foreground"},Be=["onClick"],Ne={key:0,class:"flex items-center justify-between mt-6"},Ve={class:"text-sm text-muted-foreground"},Me={class:"flex gap-2"},qe=["disabled"],De=["disabled"],Ee={class:"bg-background rounded-lg shadow-lg w-full max-w-sm sm:max-w-md p-4 sm:p-6 max-h-[90vh] overflow-y-auto"},Le={class:"flex items-center justify-between mb-6"},Re={class:"space-y-2"},Fe={class:"space-y-2"},Se={class:"flex gap-3 pt-4 border-t"},ze=["disabled"],Ue={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Te={class:"bg-background rounded-lg shadow-lg w-full max-w-sm sm:max-w-md p-4 sm:p-6 max-h-[90vh] overflow-y-auto"},Ge={class:"flex items-center justify-between mb-6"},Oe={class:"space-y-4"},Qe={class:"space-y-2"},Ye={class:"flex gap-2"},He=["disabled"],Ie={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Je={class:"flex items-center gap-3"},Ke={key:0,class:"w-10 h-10 rounded-full bg-destructive/20 flex items-center justify-center"},We={key:1,class:"w-10 h-10 rounded-full bg-success/20 flex items-center justify-center"},Xe={class:"text-sm text-muted-foreground"},it=I({__name:"Blacklist",setup(Ze){const y=d(""),b=d([]),A=d(!1),p=d(!1),x=d(!1),B=d(!1),_=d(!1),h=d(""),f=d(null),a=d({currentPage:1,lastPage:1,total:0}),m=d({phone_number:"",reason:""}),N=j(()=>{if(!y.value)return b.value;const o=y.value.toLowerCase();return b.value.filter(t=>t.phone_number.toLowerCase().includes(o)||t.reason&&t.reason.toLowerCase().includes(o))}),D=j(()=>a.value.total),G=j(()=>{const o=new Date,t=new Date(o.getFullYear(),o.getMonth(),1);return b.value.filter(s=>new Date(s.added_at||s.created_at)>=t).length}),O=j(()=>D.value*5);function E(o){return o?new Date(o).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}async function w(o=1){var t,s;A.value=!0;try{const l=await P.get("/blacklist",{params:{page:o}});b.value=l.data.data,a.value={currentPage:l.data.current_page,lastPage:l.data.last_page,total:l.data.total}}catch(l){g(((s=(t=l.response)==null?void 0:t.data)==null?void 0:s.message)||"Erreur lors du chargement"),console.error("Error loading blacklist:",l)}finally{A.value=!1}}function Q(){m.value={phone_number:"",reason:""},B.value=!0}function k(){B.value=!1,m.value={phone_number:"",reason:""}}async function Y(){var o,t;if(!m.value.phone_number.trim()){g("Le numéro de téléphone est requis");return}p.value=!0;try{await P.post("/blacklist",m.value),U("Numéro ajouté à la liste noire"),k(),await w()}catch(s){g(((t=(o=s.response)==null?void 0:o.data)==null?void 0:t.message)||"Erreur lors de l'ajout")}finally{p.value=!1}}async function L(o){var s,l;if(await ee("Retirer de la liste noire ?",`Êtes-vous sûr de vouloir débloquer ${o.phone_number} ?`))try{await P.delete(`/blacklist/${o.id}`),U("Numéro retiré de la liste noire"),b.value=b.value.filter(V=>V.id!==o.id),a.value.total--}catch(V){g(((l=(s=V.response)==null?void 0:s.data)==null?void 0:l.message)||"Erreur lors de la suppression")}}async function H(){var o,t;if(!h.value.trim()){g("Veuillez entrer un numéro");return}x.value=!0,f.value=null;try{const s=await P.post("/blacklist/check",{phone_number:h.value});f.value=s.data.is_blacklisted}catch(s){g(((t=(o=s.response)==null?void 0:o.data)==null?void 0:t.message)||"Erreur lors de la vérification")}finally{x.value=!1}}return J(()=>{w()}),(o,t)=>(n(),K(X,null,{default:W(()=>[e("div",oe,[e("div",ne,[t[11]||(t[11]=e("div",null,[e("h1",{class:"text-xl sm:text-3xl font-bold"},"Liste Noire"),e("p",{class:"text-sm text-muted-foreground mt-1 sm:mt-2"},"Gérez les numéros bloqués")],-1)),e("div",re,[e("button",{onClick:t[0]||(t[0]=s=>_.value=!0),class:"inline-flex items-center justify-center gap-1.5 sm:gap-2 whitespace-nowrap rounded-md text-xs sm:text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 sm:h-10 px-2 sm:px-4 py-2"},[u(c(te),{class:"w-4 h-4"}),t[9]||(t[9]=e("span",{class:"hidden sm:inline"},"Vérifier",-1))]),e("button",{onClick:Q,class:"inline-flex items-center justify-center gap-1.5 sm:gap-2 whitespace-nowrap rounded-md text-xs sm:text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-8 sm:h-10 px-2 sm:px-4 py-2"},[u(c(Z),{class:"w-4 h-4"}),t[10]||(t[10]=e("span",{class:"hidden sm:inline"},"Ajouter",-1))])])]),e("div",ie,[e("div",le,[t[12]||(t[12]=e("div",{class:"text-xs sm:text-sm text-muted-foreground"},"Bloqués",-1)),e("div",ae,r(D.value),1)]),e("div",de,[t[13]||(t[13]=e("div",{class:"text-xs sm:text-sm text-muted-foreground"},"Ce mois",-1)),e("div",ue,r(G.value),1)]),e("div",ce,[t[14]||(t[14]=e("div",{class:"text-xs sm:text-sm text-muted-foreground"},"Évités",-1)),e("div",fe,r(O.value),1)])]),e("div",me,[C(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>y.value=s),type:"text",placeholder:"Rechercher...",class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[$,y.value]])]),e("div",be,[A.value?(n(),i("div",ve,[...t[15]||(t[15]=[e("div",{class:"animate-spin rounded-full h-10 w-10 sm:h-12 sm:w-12 border-b-2 border-primary"},null,-1)])])):N.value.length===0?(n(),i("div",ge,[u(c(S),{class:"w-12 h-12 sm:w-16 sm:h-16 text-muted-foreground mb-4"}),t[16]||(t[16]=e("p",{class:"text-base sm:text-lg font-medium"},"Aucun numéro bloqué",-1)),t[17]||(t[17]=e("p",{class:"text-xs sm:text-sm text-muted-foreground mt-1"},"La liste noire est vide",-1))])):(n(),i(M,{key:2},[e("div",pe,[e("table",xe,[t[18]||(t[18]=e("thead",{class:"border-b bg-muted/50"},[e("tr",null,[e("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Numéro"),e("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Raison"),e("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Date d'ajout"),e("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Actions")])],-1)),e("tbody",null,[(n(!0),i(M,null,R(N.value,s=>(n(),i("tr",{key:s.id,class:"border-b transition-colors hover:bg-muted/50"},[e("td",he,r(s.phone_number),1),e("td",ye,r(s.reason||"-"),1),e("td",_e,r(E(s.added_at||s.created_at)),1),e("td",we,[e("button",{onClick:l=>L(s),class:"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-destructive/10 hover:text-destructive h-8 w-8",title:"Retirer"},[u(c(T),{class:"w-4 h-4"})],8,ke)])]))),128))])])]),e("div",je,[(n(!0),i(M,null,R(N.value,s=>(n(),i("div",{key:s.id,class:"p-3 flex items-center justify-between"},[e("div",Ce,[e("div",$e,r(s.phone_number),1),e("div",Pe,r(s.reason||"Aucune raison"),1),e("div",Ae,r(E(s.added_at||s.created_at)),1)]),e("button",{onClick:l=>L(s),class:"ml-2 inline-flex items-center justify-center rounded-md transition-colors hover:bg-destructive/10 hover:text-destructive h-8 w-8"},[u(c(T),{class:"w-4 h-4"})],8,Be)]))),128))])],64))]),a.value.lastPage>1?(n(),i("div",Ne,[e("p",Ve," Page "+r(a.value.currentPage)+" sur "+r(a.value.lastPage)+" ("+r(a.value.total)+" numéros) ",1),e("div",Me,[e("button",{onClick:t[2]||(t[2]=s=>w(a.value.currentPage-1)),disabled:a.value.currentPage<=1,class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"}," Précédent ",8,qe),e("button",{onClick:t[3]||(t[3]=s=>w(a.value.currentPage+1)),disabled:a.value.currentPage>=a.value.lastPage,class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"}," Suivant ",8,De)])])):v("",!0)]),B.value?(n(),i("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-3 sm:p-4",onClick:q(k,["self"])},[e("div",Ee,[e("div",Le,[t[19]||(t[19]=e("h2",{class:"text-xl font-bold"},"Ajouter à la liste noire",-1)),e("button",{onClick:k,class:"hover:bg-accent rounded-full p-1"},[u(c(z),{class:"w-5 h-5"})])]),e("form",{onSubmit:q(Y,["prevent"]),class:"space-y-4"},[e("div",Re,[t[20]||(t[20]=e("label",{class:"text-sm font-medium"},"Numéro de téléphone *",-1)),C(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>m.value.phone_number=s),type:"tel",required:"",placeholder:"+24177000000",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[$,m.value.phone_number]])]),e("div",Fe,[t[21]||(t[21]=e("label",{class:"text-sm font-medium"},"Raison (optionnel)",-1)),C(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=s=>m.value.reason=s),rows:"3",placeholder:"Ex: Demande de désinscription, spam...",class:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[$,m.value.reason]])]),e("div",Se,[e("button",{type:"button",onClick:k,class:"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Annuler "),e("button",{type:"submit",disabled:p.value,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-destructive text-destructive-foreground hover:bg-destructive/90 h-10 px-4 py-2"},[p.value?(n(),i("div",Ue)):v("",!0),e("span",null,r(p.value?"Ajout...":"Bloquer ce numéro"),1)],8,ze)])],32)])])):v("",!0),_.value?(n(),i("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-3 sm:p-4",onClick:t[8]||(t[8]=q(s=>_.value=!1,["self"]))},[e("div",Te,[e("div",Ge,[t[22]||(t[22]=e("h2",{class:"text-xl font-bold"},"Vérifier un numéro",-1)),e("button",{onClick:t[6]||(t[6]=s=>_.value=!1),class:"hover:bg-accent rounded-full p-1"},[u(c(z),{class:"w-5 h-5"})])]),e("div",Oe,[e("div",Qe,[t[23]||(t[23]=e("label",{class:"text-sm font-medium"},"Numéro de téléphone",-1)),e("div",Ye,[C(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>h.value=s),type:"tel",placeholder:"+24177000000",class:"flex-1 h-10 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[$,h.value]]),e("button",{onClick:H,disabled:x.value||!h.value,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[x.value?(n(),i("div",Ie)):v("",!0),e("span",null,r(x.value?"Vérification...":"Vérifier"),1)],8,He)])]),f.value!==null?(n(),i("div",{key:0,class:F(["p-4 rounded-lg",f.value?"bg-destructive/10":"bg-success/10"])},[e("div",Je,[f.value?(n(),i("div",Ke,[u(c(S),{class:"w-5 h-5 text-destructive"})])):(n(),i("div",We,[u(c(se),{class:"w-5 h-5 text-success"})])),e("div",null,[e("p",{class:F(["font-medium",f.value?"text-destructive":"text-success"])},r(f.value?"Numéro bloqué":"Numéro autorisé"),3),e("p",Xe,r(f.value?"Ce numéro est dans la liste noire":"Ce numéro peut recevoir des SMS"),1)])])],2)):v("",!0)])])])):v("",!0)]),_:1}))}});export{it as default};
