import{o,c as r,b as t,d as pe,r as x,k as _,m as he,n as be,p as xe,j as _e,x as u,y as c,F as w,q as D,s as S,t as a,g as v,w as P,f as Z,v as E}from"./main-C4tRhJdU.js";import{_ as ye,m as we,k as De,h as R,c as ke}from"./api-C9Q66dA2.js";import{c as Y}from"./campaignService-D5_194S0.js";import{a as q,b as z,s as Se}from"./notifications-CHQAjgV4.js";import{r as U,a as W}from"./ChevronRightIcon-Bk_3IaCD.js";import{r as Me}from"./PencilIcon-C12LZrng.js";import{r as I}from"./XMarkIcon-6A1kWjjZ.js";import{r as Ce}from"./BellAlertIcon-ChdMerhv.js";function $e(K,M){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z"})])}const Te={class:"p-8"},je={key:0,class:"flex items-center justify-center py-12"},Ae={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Fe={class:"lg:col-span-2 rounded-lg border bg-card p-6"},Ve={class:"flex items-center justify-between mb-4"},He={class:"flex items-center gap-2"},Ne={class:"flex items-center gap-2"},Ze=["onClick"],Ee={key:0,class:"flex items-center justify-between mb-4"},Ye={class:"font-semibold text-lg"},Je={key:1,class:"mb-6"},Oe={class:"grid grid-cols-7 gap-1 mb-2"},Le={class:"grid grid-cols-7 gap-1"},Be=["onClick"],Pe={key:0,class:"space-y-0.5"},Re=["title"],qe={key:0,class:"text-[10px] text-muted-foreground"},ze={key:2,class:"mb-6"},Ue={class:"flex items-center justify-between mb-4"},We={class:"font-semibold"},Ie={class:"grid grid-cols-7 gap-2"},Ke={class:"text-center mb-2"},Ge={class:"text-xs text-muted-foreground"},Qe={key:0,class:"space-y-1"},Xe=["onClick"],et={class:"font-medium truncate"},tt={class:"text-[10px] text-muted-foreground"},st={key:1,class:"text-xs text-muted-foreground text-center mt-4"},nt={key:3,class:"flex items-center gap-2 mb-4"},ot={key:4,class:"text-center py-12"},rt={key:5,class:"space-y-3"},at={class:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center font-semibold"},it={class:"text-center"},lt={class:"text-xs"},dt={class:"text-lg"},ut={class:"flex-1"},ct={class:"font-medium"},mt={class:"flex items-center gap-2 text-sm text-muted-foreground"},gt={class:"flex items-center gap-2"},vt={class:"text-xs px-2 py-1 rounded-full bg-warning/10 text-warning flex items-center gap-1"},ft=["onClick"],pt=["onClick"],ht={class:"rounded-lg border bg-card p-6"},bt={class:"flex items-center gap-2 mb-4"},xt={class:"text-2xl font-bold mb-2"},_t={class:"mt-6 space-y-2"},yt={class:"flex items-center justify-between text-sm"},wt={class:"font-semibold"},Dt={class:"flex items-center justify-between text-sm"},kt={class:"font-semibold"},St={class:"bg-background rounded-lg shadow-lg w-full max-w-md p-6"},Mt={class:"flex items-center justify-between mb-6"},Ct={class:"space-y-2"},$t={class:"grid grid-cols-2 gap-4"},Tt={class:"space-y-2"},jt={class:"space-y-2"},At={class:"flex gap-3 pt-4 border-t"},Ft=["disabled"],Vt={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Bt=pe({__name:"Calendar",setup(K){_e();const M=x(!0),k=x(!1),A=x(!1),J=x([]),C=x(null),G=[{label:"Liste",value:"list"},{label:"Semaine",value:"week"},{label:"Mois",value:"month"}],p=x("month"),l=x(new Date),O=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],F=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],Q=_(()=>F[l.value.getMonth()]),X=_(()=>l.value.getFullYear()),f=x({name:"",scheduled_date:"",scheduled_time:""}),y=_(()=>{const n=["Planifié","planifié","scheduled","draft"];return J.value.filter(e=>{var s;return n.includes(((s=e.status)==null?void 0:s.toLowerCase())||"")||n.includes(e.status||"")}).filter(e=>e.scheduled_at).sort((e,s)=>new Date(e.scheduled_at).getTime()-new Date(s.scheduled_at).getTime())}),L=_(()=>{const n=new Date,e=new Date(n.getTime()+7*24*60*60*1e3);return y.value.filter(s=>{const i=new Date(s.scheduled_at);return i>=n&&i<=e}).length}),ee=_(()=>{const n=new Date;return y.value.filter(e=>{const s=new Date(e.scheduled_at);return s.getMonth()===n.getMonth()&&s.getFullYear()===n.getFullYear()}).length}),te=_(()=>{const n=l.value.getFullYear(),e=l.value.getMonth(),s=new Date(n,e,1),i=new Date(n,e+1,0),g=new Date;let h=s.getDay()-1;h<0&&(h=6);const m=[],ge=new Date(n,e,0);for(let d=h-1;d>=0;d--){const b=ge.getDate()-d,N=`${n}-${String(e).padStart(2,"0")}-${String(b).padStart(2,"0")}`;m.push({date:b,dateStr:N,isCurrentMonth:!1,isToday:!1,campaigns:T(new Date(n,e-1,b))})}for(let d=1;d<=i.getDate();d++){const b=new Date(n,e,d),N=b.toDateString()===g.toDateString(),fe=`${n}-${String(e+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;m.push({date:d,dateStr:fe,isCurrentMonth:!0,isToday:N,campaigns:T(b)})}const ve=42-m.length;for(let d=1;d<=ve;d++){const b=`${n}-${String(e+2).padStart(2,"0")}-${String(d).padStart(2,"0")}`;m.push({date:d,dateStr:b,isCurrentMonth:!1,isToday:!1,campaigns:T(new Date(n,e+1,d))})}return m}),$=_(()=>{const n=new Date,e=new Date(l.value),s=e.getDay(),i=e.getDate()-s+(s===0?-6:1);e.setDate(i);const g=[];for(let h=0;h<7;h++){const m=new Date(e);m.setDate(e.getDate()+h),g.push({date:m.getDate(),dateStr:m.toISOString().split("T")[0],dayName:O[h],isToday:m.toDateString()===n.toDateString(),campaigns:T(m)})}return g}),se=_(()=>{if($.value.length<2)return"";const n=$.value[0],e=$.value[6],s=new Date(n.dateStr),i=new Date(e.dateStr);return`${n.date} ${F[s.getMonth()].slice(0,3)} - ${e.date} ${F[i.getMonth()].slice(0,3)} ${i.getFullYear()}`});function T(n){return y.value.filter(e=>new Date(e.scheduled_at).toDateString()===n.toDateString())}function ne(){l.value=new Date(l.value.getFullYear(),l.value.getMonth()-1,1)}function oe(){l.value=new Date(l.value.getFullYear(),l.value.getMonth()+1,1)}function re(){l.value=new Date(l.value.getTime()-7*24*60*60*1e3)}function ae(){l.value=new Date(l.value.getTime()+7*24*60*60*1e3)}function ie(n){n.campaigns.length===1&&H(n.campaigns[0])}function le(n){return n?["Jan","Fév","Mar","Avr","Mai","Juin","Juil","Aoû","Sep","Oct","Nov","Déc"][new Date(n).getMonth()]:""}function de(n){return n?new Date(n).getDate().toString().padStart(2,"0"):""}function B(n){if(!n)return"";const e=new Date(n);return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}function ue(n){return n>=1e3?`${(n/1e3).toFixed(1)}K`:n.toString()}async function V(){try{M.value=!0,J.value=await Y.getAll()}catch(n){console.error("Error loading campaigns:",n)}finally{M.value=!1}}function H(n){C.value=n;const e=new Date(n.scheduled_at);f.value={name:n.name,scheduled_date:e.toISOString().split("T")[0],scheduled_time:`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},A.value=!0}function j(){A.value=!1,C.value=null}async function ce(){var n,e;if(C.value){k.value=!0;try{const s=`${f.value.scheduled_date} ${f.value.scheduled_time}`;await Y.update(C.value.id,{scheduled_at:s}),q("Campagne reprogrammée avec succès"),j(),await V()}catch(s){z(((e=(n=s.response)==null?void 0:n.data)==null?void 0:e.message)||s.message||"Erreur lors de la reprogrammation")}finally{k.value=!1}}}async function me(n){if(await Se("Annuler la campagne ?",`Êtes-vous sûr de vouloir annuler la campagne "${n.name}" ?`))try{await Y.delete(n.id),q("Campagne annulée avec succès"),await V()}catch(s){z(s.message||"Erreur lors de l'annulation")}}return he(()=>{V()}),(n,e)=>(o(),be(ye,null,{default:xe(()=>[t("div",Te,[e[15]||(e[15]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-bold"},"Calendrier"),t("p",{class:"text-muted-foreground mt-2"},"Planifiez vos campagnes SMS")],-1)),M.value?(o(),r("div",je,[...e[4]||(e[4]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):(o(),r("div",Ae,[t("div",Fe,[t("div",Ve,[t("div",He,[u(c(we),{class:"w-5 h-5 text-primary"}),e[5]||(e[5]=t("h3",{class:"font-semibold"},"Campagnes planifiées",-1))]),t("div",Ne,[(o(),r(w,null,D(G,s=>t("button",{key:s.value,onClick:i=>p.value=s.value,class:S(["px-3 py-1.5 text-xs font-medium rounded-md transition-colors",p.value===s.value?"bg-primary text-primary-foreground":"bg-muted hover:bg-accent"])},a(s.label),11,Ze)),64))])]),p.value==="month"?(o(),r("div",Ee,[t("button",{onClick:ne,class:"p-2 hover:bg-accent rounded-md"},[u(c(U),{class:"w-5 h-5"})]),t("h4",Ye,a(Q.value)+" "+a(X.value),1),t("button",{onClick:oe,class:"p-2 hover:bg-accent rounded-md"},[u(c(W),{class:"w-5 h-5"})])])):v("",!0),p.value==="month"?(o(),r("div",Je,[t("div",Oe,[(o(),r(w,null,D(O,s=>t("div",{key:s,class:"text-center text-xs font-medium text-muted-foreground py-2"},a(s),1)),64))]),t("div",Le,[(o(!0),r(w,null,D(te.value,(s,i)=>(o(),r("div",{key:i,class:S(["min-h-[80px] p-1 border rounded-md transition-colors",[s.isCurrentMonth?"bg-background":"bg-muted/30",s.isToday?"border-primary border-2":"border-border",s.campaigns.length>0?"cursor-pointer hover:bg-accent/50":""]]),onClick:g=>s.campaigns.length>0&&ie(s)},[t("div",{class:S(["text-xs font-medium mb-1",s.isToday?"text-primary":s.isCurrentMonth?"":"text-muted-foreground"])},a(s.date),3),s.campaigns.length>0?(o(),r("div",Pe,[(o(!0),r(w,null,D(s.campaigns.slice(0,2),g=>(o(),r("div",{key:g.id,class:"text-[10px] px-1 py-0.5 rounded bg-primary/10 text-primary truncate",title:g.name},a(g.name),9,Re))),128)),s.campaigns.length>2?(o(),r("div",qe," +"+a(s.campaigns.length-2)+" autres ",1)):v("",!0)])):v("",!0)],10,Be))),128))])])):v("",!0),p.value==="week"?(o(),r("div",ze,[t("div",Ue,[t("button",{onClick:re,class:"p-2 hover:bg-accent rounded-md"},[u(c(U),{class:"w-5 h-5"})]),t("h4",We,a(se.value),1),t("button",{onClick:ae,class:"p-2 hover:bg-accent rounded-md"},[u(c(W),{class:"w-5 h-5"})])]),t("div",Ie,[(o(!0),r(w,null,D($.value,s=>(o(),r("div",{key:s.dateStr,class:S(["border rounded-lg p-2 min-h-[120px]",s.isToday?"border-primary border-2":"border-border"])},[t("div",Ke,[t("div",Ge,a(s.dayName),1),t("div",{class:S(["text-lg font-semibold",s.isToday?"text-primary":""])},a(s.date),3)]),s.campaigns.length>0?(o(),r("div",Qe,[(o(!0),r(w,null,D(s.campaigns,i=>(o(),r("div",{key:i.id,class:"text-xs p-1.5 rounded bg-primary/10 text-primary cursor-pointer hover:bg-primary/20",onClick:g=>H(i)},[t("div",et,a(i.name),1),t("div",tt,a(B(i.scheduled_at)),1)],8,Xe))),128))])):(o(),r("div",st," Aucune "))],2))),128))])])):v("",!0),p.value==="list"?(o(),r("div",nt,[...e[6]||(e[6]=[t("h4",{class:"font-medium text-sm text-muted-foreground"},"Liste des campagnes",-1)])])):v("",!0),p.value==="list"&&y.value.length===0?(o(),r("div",ot,[u(c($e),{class:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e[8]||(e[8]=t("p",{class:"text-muted-foreground"},"Aucune campagne planifiée",-1)),t("button",{onClick:e[0]||(e[0]=s=>n.$router.push("/campaign/create")),class:"mt-4 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[u(c(De),{class:"w-4 h-4"}),e[7]||(e[7]=t("span",null,"Planifier une campagne",-1))])])):v("",!0),p.value==="list"&&y.value.length>0?(o(),r("div",rt,[(o(!0),r(w,null,D(y.value,s=>(o(),r("div",{key:s.id,class:"flex items-center gap-4 p-4 border rounded-lg hover:bg-muted/50 transition-colors group"},[t("div",at,[t("div",it,[t("div",lt,a(le(s.scheduled_at)),1),t("div",dt,a(de(s.scheduled_at)),1)])]),t("div",ut,[t("div",ct,a(s.name),1),t("div",mt,[u(c(R),{class:"w-4 h-4"}),t("span",null,a(B(s.scheduled_at)),1),e[9]||(e[9]=t("span",null,"•",-1)),u(c(ke),{class:"w-4 h-4"}),t("span",null,a(ue(s.messages_sent||0))+" destinataires",1)])]),t("div",gt,[t("span",vt,[u(c(R),{class:"w-3 h-3"}),e[10]||(e[10]=t("span",null,"Planifiée",-1))]),t("button",{onClick:i=>H(s),class:"opacity-0 group-hover:opacity-100 transition-opacity inline-flex items-center justify-center rounded-md text-sm font-medium hover:bg-accent h-8 w-8",title:"Modifier"},[u(c(Me),{class:"w-4 h-4"})],8,ft),t("button",{onClick:i=>me(s),class:"opacity-0 group-hover:opacity-100 transition-opacity inline-flex items-center justify-center rounded-md text-sm font-medium hover:bg-destructive/10 hover:text-destructive h-8 w-8",title:"Annuler"},[u(c(I),{class:"w-4 h-4"})],8,pt)])]))),128))])):v("",!0)]),t("div",ht,[t("div",bt,[u(c(Ce),{class:"w-5 h-5 text-primary"}),e[11]||(e[11]=t("h3",{class:"font-semibold"},"À venir",-1))]),t("div",xt,a(L.value)+" campagne"+a(L.value>1?"s":""),1),e[14]||(e[14]=t("p",{class:"text-sm text-muted-foreground"},"dans les 7 prochains jours",-1)),t("div",_t,[t("div",yt,[e[12]||(e[12]=t("span",{class:"text-muted-foreground"},"Ce mois-ci",-1)),t("span",wt,a(ee.value),1)]),t("div",Dt,[e[13]||(e[13]=t("span",{class:"text-muted-foreground"},"Total planifiées",-1)),t("span",kt,a(y.value.length),1)])])])]))]),A.value?(o(),r("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:P(j,["self"])},[t("div",St,[t("div",Mt,[e[16]||(e[16]=t("h2",{class:"text-xl font-bold"},"Reprogrammer la campagne",-1)),t("button",{onClick:j,class:"hover:bg-accent rounded-full p-1"},[u(c(I),{class:"w-5 h-5"})])]),t("form",{onSubmit:P(ce,["prevent"]),class:"space-y-4"},[t("div",Ct,[e[17]||(e[17]=t("label",{class:"text-sm font-medium"},"Nom de la campagne",-1)),Z(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>f.value.name=s),type:"text",readonly:"",class:"flex h-10 w-full rounded-md border border-input bg-muted px-3 py-2 text-sm"},null,512),[[E,f.value.name]])]),t("div",$t,[t("div",Tt,[e[18]||(e[18]=t("label",{class:"text-sm font-medium"},"Date *",-1)),Z(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>f.value.scheduled_date=s),type:"date",required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[E,f.value.scheduled_date]])]),t("div",jt,[e[19]||(e[19]=t("label",{class:"text-sm font-medium"},"Heure *",-1)),Z(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>f.value.scheduled_time=s),type:"time",required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[E,f.value.scheduled_time]])])]),t("div",At,[t("button",{type:"button",onClick:j,class:"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Annuler "),t("button",{type:"submit",disabled:k.value,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[k.value?(o(),r("div",Vt)):v("",!0),t("span",null,a(k.value?"Enregistrement...":"Reprogrammer"),1)],8,Ft)])],32)])])):v("",!0)]),_:1}))}});export{Bt as default};
