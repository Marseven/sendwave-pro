import{d as B,r as g,a as q,m as F,n as R,p as z,o as a,b as e,x as b,y as v,t as i,f as w,C as G,c as r,q as P,F as A,v as S,s as D,g as f,i as J,w as W}from"./main-D5SOzsMG.js";import{_ as H,f as $,i as L,m as K}from"./api-CuXQ3mux.js";import{b as E,a as Q}from"./notifications-CHQAjgV4.js";import{r as X}from"./ArrowDownTrayIcon-BIze-jQv.js";import{r as Y}from"./EyeIcon-DAtQRyy5.js";const Z={class:"p-4 sm:p-6 lg:p-8"},ee={class:"mb-4 sm:mb-8 flex flex-col sm:flex-row sm:items-center justify-between gap-3 sm:gap-4"},te=["disabled"],se={class:"rounded-lg border bg-card shadow-sm mb-4 sm:mb-6 p-4 sm:p-6"},oe={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4"},ne={class:"space-y-2"},ie=["value"],ae={class:"space-y-2"},de={class:"space-y-2"},re={class:"space-y-2"},le={class:"rounded-lg border bg-card shadow-sm"},ue={key:0,class:"flex items-center justify-center py-12"},ce={key:1,class:"flex flex-col items-center justify-center py-12"},me={key:2,class:"overflow-x-auto"},fe={class:"w-full"},ge={class:"p-4 text-sm text-muted-foreground whitespace-nowrap"},pe={class:"p-4"},be={class:"p-4 text-sm"},ve={key:0},xe={class:"font-medium"},_e={key:1},he={class:"font-medium"},ye={key:2,class:"text-muted-foreground"},ke={class:"p-4 text-sm text-muted-foreground max-w-xs truncate"},we={class:"p-4 text-sm font-mono text-muted-foreground"},Ce={class:"p-4"},je=["onClick"],Pe={key:0,class:"flex items-center justify-between mt-6"},Ae={class:"text-sm text-muted-foreground"},Se={class:"flex gap-2"},De=["disabled"],$e=["disabled"],Le={class:"bg-background rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6"},Ee={class:"flex items-center justify-between mb-6"},Ne={class:"space-y-4"},Ue={class:"grid grid-cols-2 gap-4"},Me={class:"space-y-1"},Oe={class:"font-medium"},Te={class:"space-y-1"},Ve={class:"space-y-1"},Ie={class:"font-medium"},Be={key:0,class:"text-xs text-muted-foreground"},qe={class:"space-y-1"},Fe={class:"font-mono"},Re={key:0,class:"space-y-1"},ze={class:"font-medium"},Ge={key:1,class:"space-y-2"},Je={class:"bg-red-50 dark:bg-red-950 rounded-lg p-4 border border-red-200 dark:border-red-800"},We={class:"text-sm overflow-x-auto"},He={key:2,class:"space-y-2"},Ke={class:"bg-green-50 dark:bg-green-950 rounded-lg p-4 border border-green-200 dark:border-green-800"},Qe={class:"text-sm overflow-x-auto"},Xe={key:3,class:"space-y-1"},Ye={class:"text-sm text-muted-foreground break-all"},it=B({__name:"AuditLogs",setup(Ze){const h=g(!0),x=g(!1),p=g([]),C=g([]),n=g(null),u=g({currentPage:1,lastPage:1,total:0}),l=q({action:"",start_date:"",end_date:""}),N={login:"Connexion",logout:"Déconnexion","message.sent":"SMS envoyé","message.failed":"SMS échoué","campaign.created":"Campagne créée","campaign.sent":"Campagne envoyée","campaign.completed":"Campagne terminée","contact.created":"Contact créé","contact.updated":"Contact modifié","contact.deleted":"Contact supprimé","group.created":"Groupe créé","group.updated":"Groupe modifié","group.deleted":"Groupe supprimé","template.created":"Template créé","template.updated":"Template modifié","template.deleted":"Template supprimé","webhook.created":"Webhook créé","webhook.updated":"Webhook modifié","webhook.deleted":"Webhook supprimé","blacklist.add":"Numéro bloqué","blacklist.remove":"Numéro débloqué","sub_account.created":"Sous-compte créé","sub_account.suspended":"Sous-compte suspendu","sub_account.activated":"Sous-compte activé","api_key.created":"Clé API créée","api_key.revoked":"Clé API révoquée"};function _(s){return N[s]||s.replace(/[._]/g," ")}function y(s){return new Date(s).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}function j(s){return s.includes("delete")||s.includes("remove")||s.includes("failed")||s.includes("suspended")||s.includes("revoked")?"bg-destructive/10 text-destructive":s.includes("create")||s.includes("sent")||s.includes("completed")||s.includes("activated")||s.includes("add")?"bg-success/10 text-success":s.includes("update")||s.includes("updated")?"bg-warning/10 text-warning":"bg-muted text-muted-foreground"}function U(s){if(s.new_values){const t=Object.keys(s.new_values);if(t.length>0)return`${t.slice(0,3).join(", ")}${t.length>3?"...":""}`}return s.model_type?`${s.model_type} #${s.model_id}`:"-"}async function m(s=1){var t,c;h.value=!0;try{const d={page:s};l.action&&(d.action=l.action),l.start_date&&(d.start_date=l.start_date),l.end_date&&(d.end_date=l.end_date);const o=await $.get("/audit-logs",{params:d});p.value=o.data.data,u.value={currentPage:o.data.current_page,lastPage:o.data.last_page,total:o.data.total}}catch(d){E(((c=(t=d.response)==null?void 0:t.data)==null?void 0:c.message)||"Erreur lors du chargement")}finally{h.value=!1}}async function M(){try{const s=await $.get("/audit-logs/actions");C.value=s.data.data}catch(s){console.error("Error loading actions:",s)}}function O(){l.action="",l.start_date="",l.end_date="",m()}function T(s){n.value=s}async function V(){x.value=!0;try{const s=[["Date","Action","Utilisateur","IP","Model","Model ID"].join(","),...p.value.map(d=>{var o,k;return[y(d.created_at),_(d.action),((o=d.sub_account)==null?void 0:o.name)||((k=d.user)==null?void 0:k.name)||"",d.ip_address||"",d.model_type||"",d.model_id||""].map(I=>`"${I}"`).join(",")})].join(`
`),t=new Blob([s],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");c.href=URL.createObjectURL(t),c.download=`audit_logs_${new Date().toISOString().split("T")[0]}.csv`,c.click(),Q("Export terminé")}catch{E("Erreur lors de l'export")}finally{x.value=!1}}return F(()=>{m(),M()}),(s,t)=>(a(),R(H,null,{default:z(()=>{var c,d;return[e("div",Z,[e("div",ee,[t[7]||(t[7]=e("div",null,[e("h1",{class:"text-xl sm:text-3xl font-bold"},"Journal d'Audit"),e("p",{class:"text-sm text-muted-foreground mt-1 sm:mt-2"},"Consultez l'historique des actions sur votre compte")],-1)),e("button",{onClick:V,disabled:x.value||p.value.length===0,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 sm:h-10 px-3 sm:px-4 py-2"},[b(v(X),{class:"w-4 h-4"}),e("span",null,i(x.value?"Export...":"Exporter"),1)],8,te)]),e("div",se,[e("div",oe,[e("div",ne,[t[9]||(t[9]=e("label",{class:"text-sm font-medium"},"Action",-1)),w(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>l.action=o),onChange:m,class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[t[8]||(t[8]=e("option",{value:""},"Toutes les actions",-1)),(a(!0),r(A,null,P(C.value,o=>(a(),r("option",{key:o,value:o},i(_(o)),9,ie))),128))],544),[[G,l.action]])]),e("div",ae,[t[10]||(t[10]=e("label",{class:"text-sm font-medium"},"Date début",-1)),w(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>l.start_date=o),type:"date",onChange:m,class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,544),[[S,l.start_date]])]),e("div",de,[t[11]||(t[11]=e("label",{class:"text-sm font-medium"},"Date fin",-1)),w(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>l.end_date=o),type:"date",onChange:m,class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,544),[[S,l.end_date]])]),e("div",re,[t[13]||(t[13]=e("label",{class:"text-sm font-medium hidden sm:block"}," ",-1)),e("button",{onClick:O,class:"flex h-9 sm:h-10 w-full items-center justify-center gap-2 rounded-md border border-input bg-background px-3 py-2 text-sm font-medium ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[b(v(L),{class:"w-4 h-4"}),t[12]||(t[12]=e("span",null,"Réinitialiser",-1))])])])]),e("div",le,[h.value?(a(),r("div",ue,[...t[14]||(t[14]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):p.value.length===0?(a(),r("div",ce,[b(v(K),{class:"w-16 h-16 text-muted-foreground mb-4"}),t[15]||(t[15]=e("p",{class:"text-lg font-medium"},"Aucun log trouvé",-1)),t[16]||(t[16]=e("p",{class:"text-sm text-muted-foreground mt-1"},"Le journal d'audit est vide pour cette période",-1))])):(a(),r("div",me,[e("table",fe,[t[18]||(t[18]=e("thead",{class:"border-b bg-muted/50"},[e("tr",null,[e("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Date"),e("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Action"),e("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Utilisateur"),e("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Détails"),e("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"IP"),e("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Actions")])],-1)),e("tbody",null,[(a(!0),r(A,null,P(p.value,o=>(a(),r("tr",{key:o.id,class:"border-b transition-colors hover:bg-muted/50"},[e("td",ge,i(y(o.created_at)),1),e("td",pe,[e("span",{class:D(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold",j(o.action)])},i(_(o.action)),3)]),e("td",be,[o.sub_account?(a(),r("div",ve,[e("span",xe,i(o.sub_account.name),1),t[17]||(t[17]=e("span",{class:"text-xs text-muted-foreground ml-1"},"(sous-compte)",-1))])):o.user?(a(),r("div",_e,[e("span",he,i(o.user.name),1)])):(a(),r("span",ye,"-"))]),e("td",ke,i(U(o)),1),e("td",we,i(o.ip_address||"-"),1),e("td",Ce,[e("button",{onClick:k=>T(o),class:"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-8 w-8",title:"Voir les détails"},[b(v(Y),{class:"w-4 h-4"})],8,je)])]))),128))])])]))]),u.value.lastPage>1?(a(),r("div",Pe,[e("p",Ae," Page "+i(u.value.currentPage)+" sur "+i(u.value.lastPage)+" ("+i(u.value.total)+" entrées) ",1),e("div",Se,[e("button",{onClick:t[3]||(t[3]=o=>m(u.value.currentPage-1)),disabled:u.value.currentPage<=1,class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"}," Précédent ",8,De),e("button",{onClick:t[4]||(t[4]=o=>m(u.value.currentPage+1)),disabled:u.value.currentPage>=u.value.lastPage,class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"}," Suivant ",8,$e)])])):f("",!0)]),n.value?(a(),r("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:t[6]||(t[6]=W(o=>n.value=null,["self"]))},[e("div",Le,[e("div",Ee,[t[19]||(t[19]=e("h2",{class:"text-xl font-bold"},"Détails du log",-1)),e("button",{onClick:t[5]||(t[5]=o=>n.value=null),class:"hover:bg-accent rounded-full p-1"},[b(v(L),{class:"w-5 h-5"})])]),e("div",Ne,[e("div",Ue,[e("div",Me,[t[20]||(t[20]=e("label",{class:"text-sm text-muted-foreground"},"Date",-1)),e("p",Oe,i(y(n.value.created_at)),1)]),e("div",Te,[t[21]||(t[21]=e("label",{class:"text-sm text-muted-foreground"},"Action",-1)),e("p",null,[e("span",{class:D(["inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold",j(n.value.action)])},i(_(n.value.action)),3)])]),e("div",Ve,[t[22]||(t[22]=e("label",{class:"text-sm text-muted-foreground"},"Utilisateur",-1)),e("p",Ie,[J(i(((c=n.value.sub_account)==null?void 0:c.name)||((d=n.value.user)==null?void 0:d.name)||"-")+" ",1),n.value.sub_account?(a(),r("span",Be,"(sous-compte)")):f("",!0)])]),e("div",qe,[t[23]||(t[23]=e("label",{class:"text-sm text-muted-foreground"},"Adresse IP",-1)),e("p",Fe,i(n.value.ip_address||"-"),1)])]),n.value.model_type?(a(),r("div",Re,[t[24]||(t[24]=e("label",{class:"text-sm text-muted-foreground"},"Objet concerné",-1)),e("p",ze,i(n.value.model_type)+" #"+i(n.value.model_id),1)])):f("",!0),n.value.old_values&&Object.keys(n.value.old_values).length>0?(a(),r("div",Ge,[t[25]||(t[25]=e("label",{class:"text-sm text-muted-foreground"},"Anciennes valeurs",-1)),e("div",Je,[e("pre",We,i(JSON.stringify(n.value.old_values,null,2)),1)])])):f("",!0),n.value.new_values&&Object.keys(n.value.new_values).length>0?(a(),r("div",He,[t[26]||(t[26]=e("label",{class:"text-sm text-muted-foreground"},"Nouvelles valeurs",-1)),e("div",Ke,[e("pre",Qe,i(JSON.stringify(n.value.new_values,null,2)),1)])])):f("",!0),n.value.user_agent?(a(),r("div",Xe,[t[27]||(t[27]=e("label",{class:"text-sm text-muted-foreground"},"User Agent",-1)),e("p",Ye,i(n.value.user_agent),1)])):f("",!0)])])])):f("",!0)]}),_:1}))}});export{it as default};
