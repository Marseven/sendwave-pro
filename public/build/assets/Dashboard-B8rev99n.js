import{d as ae,u as ue,k as ce,r as _,l as me,m as fe,n as J,o as d,p as ve,b as e,t as n,c as i,q as p,s as a,F as h,x as m,y as f,z as Q,i as W,A as xe}from"./main-CH1OB-Uu.js";import{r as A,a as _e,b as ge,_ as be}from"./api-BQzzbFMM.js";import{a as pe}from"./analyticsService-BOAgcRQI.js";import{c as he}from"./campaignService-RrToS48m.js";import{r as Y}from"./CheckCircleIcon-CI9iP0pi.js";const ye={class:"p-8"},we={class:"mb-8 flex justify-between items-center"},Ce={class:"text-muted-foreground mt-2"},ke={class:"flex gap-2"},$e=["onClick"],Ae={key:0,class:"flex items-center justify-center py-12"},je={key:1},De={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},Fe={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-6"},Se={class:"flex items-center justify-between"},Te={class:"text-3xl font-bold mt-2"},Le={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-6"},Re={class:"flex items-center justify-between"},Be={class:"text-3xl font-bold mt-2"},Me={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-6"},Ee={class:"flex items-center justify-between"},Ie={class:"text-3xl font-bold mt-2"},Ne={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-6"},Pe={class:"flex items-center justify-between"},qe={class:"text-3xl font-bold mt-2"},ze={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8"},Ve={class:"rounded-lg border bg-card shadow-sm"},Ke={class:"p-6"},Oe={key:0,class:"space-y-4"},Ue={class:"flex items-center justify-between"},Xe={class:"font-medium"},Ge={class:"text-sm text-muted-foreground"},He={class:"w-full bg-muted rounded-full h-2"},Je={class:"flex justify-between text-xs text-muted-foreground"},Qe={key:1,class:"text-center text-muted-foreground py-8"},We={class:"rounded-lg border bg-card shadow-sm"},Ye={class:"p-6"},Ze={key:0,class:"space-y-4"},et={class:"text-center"},tt={class:"text-5xl font-bold text-primary"},st={class:"w-full bg-muted rounded-full h-3"},rt={class:"flex justify-between text-xs text-muted-foreground"},ot={key:1,class:"text-center text-muted-foreground py-8"},nt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},dt={class:"rounded-lg border bg-card text-card-foreground shadow-sm"},it={class:"p-6"},lt={key:0},at={class:"flex items-center justify-between mb-2"},ut={class:"font-medium"},ct={class:"flex items-center gap-4 text-sm text-muted-foreground"},mt={class:"flex items-center gap-1"},ft={class:"flex items-center gap-1"},vt={key:1,class:"text-center text-muted-foreground py-8"},xt={class:"rounded-lg border bg-card text-card-foreground shadow-sm"},_t={class:"p-6"},gt={key:0},bt={class:"flex-1"},pt={class:"text-sm font-medium"},ht={class:"text-xs text-muted-foreground mt-1"},yt={key:1,class:"text-center text-muted-foreground py-8"},Dt=ae({__name:"Dashboard",setup(wt){const Z=ue(),ee=ce(()=>Z.user),te=[{value:"today",label:"Aujourd'hui"},{value:"week",label:"Cette semaine"},{value:"month",label:"Ce mois"},{value:"year",label:"Cette année"}],g=_("today"),r=_(null),y=_([]),w=_([]),C=_(!1);function c(s){return s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(1)}K`:s.toString()}function j(s){return`${s.toLocaleString("fr-FR")} XAF`}function k(s){return s?s>0?"text-success":s<0?"text-destructive":"text-muted-foreground":"text-muted-foreground"}function $(s){return s?`${s>0?"+":""}${s.toFixed(1)}% vs période précédente`:"Aucun changement"}function se(s){return s?s>=95?"text-success":s>=85?"text-warning":"text-destructive":"text-muted-foreground"}function re(s){return s?s>=95?"Excellent":s>=85?"Bon":"À améliorer":"Aucune donnée"}function D(s,t){return t?s/t*100:0}function oe(s,t){const l=D(s,t);return l>50?"bg-success":l>20?"bg-warning":"bg-destructive"}async function F(){C.value=!0;try{const[s,t]=await Promise.all([pe.getDashboard(g.value),he.getAll()]);r.value=s.data,y.value=t.slice(0,3),w.value=ne(t)}catch(s){console.error("Error loading dashboard data:",s)}finally{C.value=!1}}me(g,()=>{F()});function ne(s){const t=[];return s.slice(0,4).forEach(l=>{(l.messages_sent||l.sent)&&t.push({id:`campaign-${l.id}`,icon:A,title:`Campagne "${l.name}" envoyée à ${l.messages_sent||l.sent} contacts`,time:de(l.created_at)})}),t.slice(0,4)}function de(s){if(!s)return"Récemment";const t=new Date(s),v=new Date().getTime()-t.getTime(),u=Math.floor(v/(1e3*60*60)),x=Math.floor(v/(1e3*60*60*24));return u<1?"Il y a quelques minutes":u<24?`Il y a ${u} heure${u>1?"s":""}`:x===1?"Il y a 1 jour":`Il y a ${x} jours`}function ie(s){const t=s==null?void 0:s.toLowerCase();return t==="active"||t==="actif"?"bg-success/10 text-success":t==="scheduled"||t==="planifié"?"bg-warning/10 text-warning":"bg-muted text-muted-foreground"}function le(s){const t=s==null?void 0:s.toLowerCase();return t==="active"||t==="actif"?"Active":t==="scheduled"||t==="planifié"?"Planifiée":t==="completed"||t==="terminé"?"Terminée":s||"Inconnu"}return fe(()=>{F()}),(s,t)=>(d(),J(be,null,{default:ve(()=>{var l,v,u,x,S,T,L,R,B,M,E,I,N,P,q,z,V,K,O,U,X,G;return[e("div",ye,[e("div",we,[e("div",null,[t[0]||(t[0]=e("h1",{class:"text-3xl font-bold text-foreground"},"Tableau de bord",-1)),e("p",Ce,"Bienvenue "+n((l=ee.value)==null?void 0:l.name),1)]),e("div",ke,[(d(),i(h,null,p(te,o=>e("button",{key:o.value,onClick:b=>g.value=o.value,class:a(["px-4 py-2 rounded-lg text-sm font-medium transition-colors",g.value===o.value?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"])},n(o.label),11,$e)),64))])]),C.value?(d(),i("div",Ae,[...t[1]||(t[1]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):(d(),i("div",je,[e("div",De,[e("div",Fe,[e("div",Se,[t[2]||(t[2]=e("h3",{class:"text-sm font-medium text-muted-foreground"},"Messages Envoyés",-1)),m(f(A),{class:"w-8 h-8 text-primary"})]),e("p",Te,n(c(((v=r.value)==null?void 0:v.total_sent)||0)),1),e("p",{class:a(["text-xs mt-2",k((x=(u=r.value)==null?void 0:u.trends)==null?void 0:x.sent)])},n($((T=(S=r.value)==null?void 0:S.trends)==null?void 0:T.sent)),3)]),e("div",Le,[e("div",Re,[t[3]||(t[3]=e("h3",{class:"text-sm font-medium text-muted-foreground"},"Messages Livrés",-1)),m(f(Y),{class:"w-8 h-8 text-success"})]),e("p",Be,n(c(((L=r.value)==null?void 0:L.total_delivered)||0)),1),e("p",{class:a(["text-xs mt-2",k((B=(R=r.value)==null?void 0:R.trends)==null?void 0:B.delivered)])},n($((E=(M=r.value)==null?void 0:M.trends)==null?void 0:E.delivered)),3)]),e("div",Me,[e("div",Ee,[t[4]||(t[4]=e("h3",{class:"text-sm font-medium text-muted-foreground"},"Taux de Livraison",-1)),m(f(_e),{class:"w-8 h-8 text-primary"})]),e("p",Ie,n(((N=(I=r.value)==null?void 0:I.delivery_rate)==null?void 0:N.toFixed(1))||0)+"%",1),e("p",{class:a(["text-xs mt-2",se((P=r.value)==null?void 0:P.delivery_rate)])},n(re((q=r.value)==null?void 0:q.delivery_rate)),3)]),e("div",Ne,[e("div",Pe,[t[5]||(t[5]=e("h3",{class:"text-sm font-medium text-muted-foreground"},"Coût Total",-1)),m(f(ge),{class:"w-8 h-8 text-primary"})]),e("p",qe,n(j(((z=r.value)==null?void 0:z.total_cost)||0)),1),e("p",{class:a(["text-xs mt-2",k((K=(V=r.value)==null?void 0:V.trends)==null?void 0:K.cost)])},n($((U=(O=r.value)==null?void 0:O.trends)==null?void 0:U.cost)),3)])]),e("div",ze,[e("div",Ve,[t[7]||(t[7]=e("div",{class:"p-6 border-b border-border"},[e("h2",{class:"text-xl font-semibold"},"Répartition par Fournisseur")],-1)),e("div",Ke,[(X=r.value)!=null&&X.by_provider&&Object.keys(r.value.by_provider).length>0?(d(),i("div",Oe,[(d(!0),i(h,null,p(r.value.by_provider,(o,b)=>{var H;return d(),i("div",{key:b,class:"space-y-2"},[e("div",Ue,[e("span",Xe,n(b),1),e("span",Ge,n(c(o.sent))+" messages",1)]),e("div",He,[e("div",{class:a(["h-2 rounded-full",b==="Airtel"?"bg-red-500":"bg-yellow-500"]),style:Q({width:`${(o.sent/r.value.total_sent*100).toFixed(1)}%`})},null,6)]),e("div",Je,[e("span",null,"Livrés: "+n((H=o.delivered_rate)==null?void 0:H.toFixed(1))+"%",1),e("span",null,"Coût: "+n(j(o.total_cost)),1)])])}),128))])):(d(),i("div",Qe,[...t[6]||(t[6]=[e("p",{class:"text-sm"},"Aucune donnée disponible",-1)])]))])]),e("div",We,[t[10]||(t[10]=e("div",{class:"p-6 border-b border-border"},[e("h2",{class:"text-xl font-semibold"},"Crédits Restants")],-1)),e("div",Ye,[((G=r.value)==null?void 0:G.credits_remaining)!==void 0?(d(),i("div",Ze,[e("div",et,[e("p",tt,n(c(r.value.credits_remaining)),1),t[8]||(t[8]=e("p",{class:"text-sm text-muted-foreground mt-2"},"crédits disponibles",-1))]),e("div",st,[e("div",{class:a(["h-3 rounded-full transition-all",oe(r.value.credits_remaining,r.value.initial_credits)]),style:Q({width:`${D(r.value.credits_remaining,r.value.initial_credits)}%`})},null,6)]),e("div",rt,[e("span",null,"Utilisés: "+n(c((r.value.initial_credits||0)-r.value.credits_remaining)),1),e("span",null,"Total: "+n(c(r.value.initial_credits||0)),1)])])):(d(),i("div",ot,[...t[9]||(t[9]=[e("p",{class:"text-sm"},"Aucune donnée disponible",-1)])]))])])]),e("div",nt,[e("div",dt,[t[12]||(t[12]=e("div",{class:"p-6 border-b border-border"},[e("h2",{class:"text-xl font-semibold"},"Campagnes Récentes")],-1)),e("div",it,[y.value.length>0?(d(),i("div",lt,[(d(!0),i(h,null,p(y.value,o=>(d(),i("div",{key:o.id,class:"mb-4 last:mb-0 pb-4 last:pb-0 border-b last:border-b-0 border-border"},[e("div",at,[e("h3",ut,n(o.name),1),e("span",{class:a(["text-xs px-2 py-1 rounded-full",ie(o.status)])},n(le(o.status)),3)]),e("div",ct,[e("span",mt,[m(f(A),{class:"w-4 h-4"}),W(" "+n(o.messages_sent||o.sent||0)+" envoyés ",1)]),e("span",ft,[m(f(Y),{class:"w-4 h-4"}),W(" "+n(o.delivery_rate||o.delivered||0)+"% livrés ",1)])])]))),128))])):(d(),i("div",vt,[...t[11]||(t[11]=[e("p",{class:"text-sm"},"Aucune campagne récente",-1)])]))])]),e("div",xt,[t[14]||(t[14]=e("div",{class:"p-6 border-b border-border"},[e("h2",{class:"text-xl font-semibold"},"Activité Récente")],-1)),e("div",_t,[w.value.length>0?(d(),i("div",gt,[(d(!0),i(h,null,p(w.value,o=>(d(),i("div",{key:o.id,class:"mb-4 last:mb-0 flex items-start gap-3"},[(d(),J(xe(o.icon),{class:"w-5 h-5 text-muted-foreground flex-shrink-0 mt-0.5"})),e("div",bt,[e("p",pt,n(o.title),1),e("p",ht,n(o.time),1)])]))),128))])):(d(),i("div",yt,[...t[13]||(t[13]=[e("p",{class:"text-sm"},"Aucune activité récente",-1)])]))])])])]))])]}),_:1}))}});export{Dt as default};
