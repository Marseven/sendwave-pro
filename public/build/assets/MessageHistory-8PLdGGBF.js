import{d as K,r as g,k as T,m as O,n as $,p as D,E as Q,o as c,b as e,x as a,y as u,t as i,f as b,v as F,C as P,c as m,F as W,q as Y,s as y,A as B,i as I,g as x,w as Z}from"./main-D64ZRLSk.js";import{f as _,_ as ee,d as U,r as N,t as te,i as S,h as se}from"./api-Bu0S3geY.js";import{b as oe}from"./notifications-CHQAjgV4.js";import{r as H}from"./CheckCircleIcon-12C3S8cI.js";import{r as ne,a as ie}from"./XCircleIcon-C1bLGXdK.js";import{r as re}from"./BanknotesIcon-Bhjpwq5D.js";import{r as le}from"./PhoneIcon-BjdASwcN.js";import{r as ae}from"./EyeIcon-Dhe1HKps.js";import{r as de,a as ue}from"./ChevronRightIcon-CFYbRm1j.js";const ce={async getAll(f){const d=await _.get("/messages/history",{params:f});return d.data.data||d.data},async getById(f){const d=await _.get(`/messages/${f}`);return d.data.data||d.data},async getStats(){const f=await _.get("/messages/stats");return f.data.data||f.data},async exportToCsv(f){return(await _.get("/messages/export",{params:f,responseType:"blob"})).data}},me={class:"p-8"},fe={class:"mb-8 flex items-center justify-between"},ve={class:"flex items-center gap-2"},pe={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},ge={class:"rounded-lg border bg-card p-6"},be={class:"flex items-center justify-between"},xe={class:"text-2xl font-bold"},he={class:"rounded-lg border bg-card p-6"},ye={class:"flex items-center justify-between"},_e={class:"text-2xl font-bold text-success"},we={class:"rounded-lg border bg-card p-6"},ke={class:"flex items-center justify-between"},Ce={class:"text-2xl font-bold text-destructive"},Te={class:"rounded-lg border bg-card p-6"},$e={class:"flex items-center justify-between"},De={class:"text-2xl font-bold text-primary"},Fe={class:"mb-6 grid grid-cols-1 md:grid-cols-5 gap-4"},Se={key:0,class:"flex justify-center items-center py-12"},je={key:1,class:"text-center py-16"},Le={class:"text-muted-foreground mb-6"},Me={key:2,class:"rounded-lg border bg-card shadow-sm overflow-hidden"},Ee={class:"overflow-x-auto"},Ae={class:"w-full"},ze={class:"divide-y"},Ve={class:"p-4 text-sm"},Pe={class:"flex items-center gap-2"},Be={class:"text-xs text-muted-foreground"},Ie={class:"p-4 text-sm"},Ue={class:"flex items-center gap-2"},Ne={class:"font-medium"},He={class:"text-xs text-muted-foreground font-mono"},Re={class:"p-4 text-sm max-w-xs"},Xe={class:"truncate font-mono text-xs"},qe={class:"p-4 text-sm"},Ge={class:"p-4 text-sm"},Je={class:"p-4 text-sm font-semibold text-primary"},Ke={class:"p-4 text-sm"},Oe=["onClick"],Qe={key:3,class:"mt-6 flex justify-center gap-2"},We=["disabled"],Ye={class:"inline-flex items-center px-4 text-sm"},Ze=["disabled"],et={class:"bg-background rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},tt={class:"p-6 border-b flex items-center justify-between"},st={class:"p-6 space-y-6"},ot={class:"grid grid-cols-2 gap-4"},nt={class:"text-muted-foreground"},it={class:"text-sm text-muted-foreground font-mono mt-1"},rt={class:"text-muted-foreground"},lt={class:"text-sm text-muted-foreground mt-1"},at={class:"p-4 bg-muted/50 rounded-lg font-mono text-sm whitespace-pre-wrap"},dt={class:"text-xs text-muted-foreground mt-2"},ut={class:"grid grid-cols-3 gap-4"},ct={class:"text-2xl font-bold text-primary"},mt={key:0},ft={class:"text-muted-foreground"},vt={key:1},pt={class:"text-muted-foreground uppercase"},gt={key:2,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},bt={class:"text-sm text-destructive"},xt={class:"p-6 border-t flex justify-end"},j=20,Ft=K({__name:"MessageHistory",setup(f){const d=g([]),w=g(!1),r=g(null),p=g(1),n=g({search:"",status:"",type:"",dateFrom:"",dateTo:""}),h=T(()=>({total:d.value.length,delivered:d.value.filter(s=>s.status==="delivered"||s.status==="sent").length,failed:d.value.filter(s=>s.status==="failed").length,totalCost:d.value.reduce((s,t)=>s+t.cost,0)})),L=T(()=>{let s=d.value;if(n.value.search){const o=n.value.search.toLowerCase();s=s.filter(v=>v.recipient_phone.includes(o)||v.recipient_name&&v.recipient_name.toLowerCase().includes(o)||v.content.toLowerCase().includes(o))}n.value.status&&(n.value.status==="delivered"?s=s.filter(o=>o.status==="delivered"||o.status==="sent"):s=s.filter(o=>o.status===n.value.status)),n.value.type&&(s=s.filter(o=>o.type===n.value.type)),n.value.dateFrom&&(s=s.filter(o=>o.sent_at>=n.value.dateFrom)),n.value.dateTo&&(s=s.filter(o=>o.sent_at<=n.value.dateTo));const t=(p.value-1)*j,l=t+j;return s.slice(t,l)}),k=T(()=>{let s=d.value;if(n.value.search||n.value.status||n.value.type||n.value.dateFrom||n.value.dateTo){const t=n.value.search.toLowerCase();s=s.filter(l=>{const o=!n.value.search||l.recipient_phone.includes(t)||l.recipient_name&&l.recipient_name.toLowerCase().includes(t)||l.content.toLowerCase().includes(t),v=!n.value.status||(n.value.status==="delivered"?l.status==="delivered"||l.status==="sent":l.status===n.value.status),q=!n.value.type||l.type===n.value.type,G=!n.value.dateFrom||l.sent_at>=n.value.dateFrom,J=!n.value.dateTo||l.sent_at<=n.value.dateTo;return o&&v&&q&&G&&J})}return Math.ceil(s.length/j)});function C(s){return s==="sent"||s==="delivered"?"delivered":s}function M(s){const t=C(s);return{delivered:"bg-success/10 text-success",pending:"bg-warning/10 text-warning",failed:"bg-destructive/10 text-destructive"}[t]||"bg-muted text-muted-foreground"}function E(s){const t=C(s);return{delivered:"Livré",pending:"En attente",failed:"Échoué"}[t]||s}function A(s){const t=C(s);return{delivered:H,pending:S,failed:ie}[t]||S}function z(s){return new Date(s).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"})}function V(s){return new Date(s).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}function R(s){r.value=s}async function X(){var s,t;w.value=!0;try{d.value=await ce.getAll()}catch(l){console.error("Error loading messages:",l),oe(((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"Erreur lors du chargement des messages")}finally{w.value=!1}}return O(()=>{X()}),(s,t)=>{const l=Q("router-link");return c(),$(ee,null,{default:D(()=>[e("div",me,[e("div",fe,[e("div",null,[e("div",ve,[a(u(U),{class:"w-8 h-8 text-primary"}),t[10]||(t[10]=e("h1",{class:"text-3xl font-bold"},"Historique des messages",-1))]),t[11]||(t[11]=e("p",{class:"text-muted-foreground mt-2"},"Consultez tous les messages SMS envoyés",-1))]),a(l,{to:"/send-message",class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},{default:D(()=>[a(u(N),{class:"w-4 h-4"}),t[12]||(t[12]=e("span",null,"Envoyer un message",-1))]),_:1})]),e("div",pe,[e("div",ge,[e("div",be,[e("div",null,[t[13]||(t[13]=e("p",{class:"text-sm text-muted-foreground mb-1"},"Total envoyé",-1)),e("p",xe,i(h.value.total),1)]),a(u(U),{class:"w-10 h-10 text-primary/20"})])]),e("div",he,[e("div",ye,[e("div",null,[t[14]||(t[14]=e("p",{class:"text-sm text-muted-foreground mb-1"},"Livrés",-1)),e("p",_e,i(h.value.delivered),1)]),a(u(H),{class:"w-10 h-10 text-success/20"})])]),e("div",we,[e("div",ke,[e("div",null,[t[15]||(t[15]=e("p",{class:"text-sm text-muted-foreground mb-1"},"Échecs",-1)),e("p",Ce,i(h.value.failed),1)]),a(u(ne),{class:"w-10 h-10 text-destructive/20"})])]),e("div",Te,[e("div",$e,[e("div",null,[t[16]||(t[16]=e("p",{class:"text-sm text-muted-foreground mb-1"},"Coût total",-1)),e("p",De,i(h.value.totalCost)+" XAF",1)]),a(u(re),{class:"w-10 h-10 text-primary/20"})])])]),e("div",Fe,[e("div",null,[b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>n.value.search=o),type:"text",placeholder:"Rechercher destinataire...",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[F,n.value.search]])]),e("div",null,[b(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>n.value.status=o),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...t[17]||(t[17]=[e("option",{value:""},"Tous les statuts",-1),e("option",{value:"delivered"},"Livré",-1),e("option",{value:"pending"},"En attente",-1),e("option",{value:"failed"},"Échoué",-1)])],512),[[P,n.value.status]])]),e("div",null,[b(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>n.value.type=o),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...t[18]||(t[18]=[e("option",{value:""},"Tous les types",-1),e("option",{value:"immediate"},"Immédiat",-1),e("option",{value:"campaign"},"Campagne",-1)])],512),[[P,n.value.type]])]),e("div",null,[b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>n.value.dateFrom=o),type:"date",placeholder:"Date de début",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[F,n.value.dateFrom]])]),e("div",null,[b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>n.value.dateTo=o),type:"date",placeholder:"Date de fin",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[F,n.value.dateTo]])])]),w.value?(c(),m("div",Se,[...t[19]||(t[19]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):L.value.length===0?(c(),m("div",je,[a(u(te),{class:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),t[21]||(t[21]=e("h3",{class:"text-lg font-semibold mb-2"},"Aucun message trouvé",-1)),e("p",Le,i(n.value.search||n.value.status?"Essayez de modifier vos filtres":"Commencez par envoyer votre premier message"),1),a(l,{to:"/send-message",class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},{default:D(()=>[a(u(N),{class:"w-4 h-4"}),t[20]||(t[20]=e("span",null,"Envoyer un message",-1))]),_:1})])):(c(),m("div",Me,[e("div",Ee,[e("table",Ae,[t[22]||(t[22]=e("thead",{class:"bg-muted/50"},[e("tr",null,[e("th",{class:"text-left p-4 text-sm font-semibold"},"Date"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Destinataire"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Message"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Type"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Statut"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Coût"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Actions")])],-1)),e("tbody",ze,[(c(!0),m(W,null,Y(L.value,o=>(c(),m("tr",{key:o.id,class:"hover:bg-muted/30 transition-colors"},[e("td",Ve,[e("div",Pe,[a(u(S),{class:"w-4 h-4 text-muted-foreground"}),e("div",null,[e("div",null,i(z(o.sent_at)),1),e("div",Be,i(V(o.sent_at)),1)])])]),e("td",Ie,[e("div",Ue,[a(u(le),{class:"w-4 h-4 text-muted-foreground"}),e("div",null,[e("div",Ne,i(o.recipient_name||"Anonyme"),1),e("div",He,i(o.recipient_phone),1)])])]),e("td",Re,[e("div",Xe,i(o.content),1)]),e("td",qe,[e("span",{class:y(["px-2.5 py-0.5 rounded-full text-xs font-medium",o.type==="campaign"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"])},i(o.type==="campaign"?"Campagne":"Immédiat"),3)]),e("td",Ge,[e("span",{class:y(["inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium",M(o.status)])},[(c(),$(B(A(o.status)),{class:"w-3.5 h-3.5"})),I(" "+i(E(o.status)),1)],2)]),e("td",Je,i(o.cost)+" XAF",1),e("td",Ke,[e("button",{onClick:v=>R(o),class:"text-primary hover:text-primary/80 transition-colors"},[a(u(ae),{class:"w-5 h-5"})],8,Oe)])]))),128))])])])])),k.value>1?(c(),m("div",Qe,[e("button",{onClick:t[5]||(t[5]=o=>p.value--),disabled:p.value===1,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"},[a(u(de),{class:"w-4 h-4"})],8,We),e("span",Ye," Page "+i(p.value)+" sur "+i(k.value),1),e("button",{onClick:t[6]||(t[6]=o=>p.value++),disabled:p.value===k.value,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"},[a(u(ue),{class:"w-4 h-4"})],8,Ze)])):x("",!0)]),r.value?(c(),m("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:t[9]||(t[9]=Z(o=>r.value=null,["self"]))},[e("div",et,[e("div",tt,[t[23]||(t[23]=e("h2",{class:"text-2xl font-bold"},"Détails du message",-1)),e("button",{onClick:t[7]||(t[7]=o=>r.value=null),class:"text-muted-foreground hover:text-foreground transition-colors"},[a(u(se),{class:"w-6 h-6"})])]),e("div",st,[e("div",ot,[e("div",null,[t[24]||(t[24]=e("h3",{class:"font-semibold mb-2"},"Destinataire",-1)),e("p",nt,i(r.value.recipient_name||"Anonyme"),1),e("p",it,i(r.value.recipient_phone),1)]),e("div",null,[t[25]||(t[25]=e("h3",{class:"font-semibold mb-2"},"Date d'envoi",-1)),e("p",rt,i(z(r.value.sent_at)),1),e("p",lt,i(V(r.value.sent_at)),1)])]),e("div",null,[t[26]||(t[26]=e("h3",{class:"font-semibold mb-2"},"Message",-1)),e("div",at,i(r.value.content),1),e("p",dt,i(r.value.content.length)+" caractères",1)]),e("div",ut,[e("div",null,[t[27]||(t[27]=e("h3",{class:"font-semibold mb-2"},"Type",-1)),e("span",{class:y(["inline-block px-3 py-1 rounded-full text-sm font-medium",r.value.type==="campaign"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"])},i(r.value.type==="campaign"?"Campagne":"Immédiat"),3)]),e("div",null,[t[28]||(t[28]=e("h3",{class:"font-semibold mb-2"},"Statut",-1)),e("span",{class:y(["inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium",M(r.value.status)])},[(c(),$(B(A(r.value.status)),{class:"w-4 h-4"})),I(" "+i(E(r.value.status)),1)],2)]),e("div",null,[t[29]||(t[29]=e("h3",{class:"font-semibold mb-2"},"Coût",-1)),e("p",ct,i(r.value.cost)+" XAF",1)])]),r.value.campaign_name?(c(),m("div",mt,[t[30]||(t[30]=e("h3",{class:"font-semibold mb-2"},"Campagne associée",-1)),e("p",ft,i(r.value.campaign_name),1)])):x("",!0),r.value.provider?(c(),m("div",vt,[t[31]||(t[31]=e("h3",{class:"font-semibold mb-2"},"Provider",-1)),e("p",pt,i(r.value.provider),1)])):x("",!0),r.value.error_message?(c(),m("div",gt,[t[32]||(t[32]=e("h3",{class:"font-semibold mb-2 text-destructive"},"Erreur",-1)),e("p",bt,i(r.value.error_message),1)])):x("",!0)]),e("div",xt,[e("button",{onClick:t[8]||(t[8]=o=>r.value=null),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Fermer ")])])])):x("",!0)]),_:1})}}});export{Ft as default};
