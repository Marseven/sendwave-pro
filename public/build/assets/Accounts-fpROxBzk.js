import{o as n,c as r,b as e,d as ee,r as u,C as se,l as te,m as ie,n as oe,p as m,q as f,F as U,x as z,t as d,s as B,D as ne,g as v,w as P,f as p,v as j,A as D,B as F}from"./main-oWKmIcvx.js";import{_ as re,e as b,h as le}from"./api-CKpQafZN.js";import{b as w,a as y,s as L}from"./notifications-CHQAjgV4.js";import{r as ae}from"./PencilIcon-Df9w2yyE.js";import{r as de}from"./KeyIcon-Bh11PzD3.js";import{r as ue}from"./TrashIcon-DccpfCeT.js";import{r as I}from"./XMarkIcon-CXznneDH.js";function ce(A,x){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"})])}function me(A,x){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 10.5V6.75a4.5 4.5 0 1 1 9 0v3.75M3.75 21.75h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H3.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"})])}function fe(A,x){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"})])}const ve={class:"p-8"},pe={class:"mb-8 flex items-center justify-between"},ge={key:0,class:"flex items-center justify-center py-12"},be={key:1,class:"flex flex-col items-center justify-center py-12 rounded-lg border bg-card"},xe={key:2,class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6"},he={class:"p-6"},we={class:"flex items-start justify-between mb-4"},ye={class:"flex-1"},_e={class:"font-semibold text-lg"},ke={class:"text-sm text-muted-foreground mt-1"},Ce={class:"flex items-center gap-2 mb-4"},Me={class:"space-y-3 mb-4"},Se={class:"flex justify-between items-center text-sm"},je={class:"font-semibold"},Ae={class:"flex justify-between items-center text-sm"},$e={key:0,class:"w-full bg-gray-200 rounded-full h-2"},Ee={key:1,class:"text-xs text-muted-foreground"},Ve={class:"border-t p-4 bg-muted/30 flex gap-2"},qe=["onClick"],Pe=["onClick"],Ue=["onClick"],ze=["onClick"],Be=["onClick"],De={class:"bg-background rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto"},Fe={class:"sticky top-0 bg-background border-b p-6"},Le={class:"flex items-center justify-between"},Ie={class:"text-xl font-bold"},Ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ze={class:"space-y-2"},Ge={class:"space-y-2"},Re=["disabled"],He={key:0,class:"space-y-2"},Te=["required"],Je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Oe={class:"space-y-2"},Ke={class:"space-y-2"},Qe={class:"space-y-2"},We={class:"flex gap-2"},Xe=["disabled"],Ye={class:"inline-flex items-center gap-2 px-4 py-2 border rounded-md cursor-pointer hover:bg-accent"},es={class:"flex gap-3 pt-4 border-t"},ss=["disabled"],ts={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},is={class:"bg-background rounded-lg shadow-lg w-full max-w-lg"},os={class:"border-b p-6"},ns={class:"flex items-center justify-between"},rs={class:"text-sm text-muted-foreground mt-1"},ls={class:"p-6 space-y-4"},as=["value","id"],ds=["for"],us={class:"font-medium"},cs={class:"text-sm text-muted-foreground"},ms={class:"border-t p-6 flex gap-3"},fs=["disabled"],vs={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},_s=ee({__name:"Accounts",setup(A){const x=u([]),$=u(!1),_=u(!1),k=u(!1),E=u(!1),V=u(!1),q=u(!1),l=u(null),g=u(!1),C=u([]),a=u({name:"",email:"",password:"",role:"sender",status:"active",sms_credit_limit:null}),N={admin:"Administrateur",manager:"Manager",sender:"Expéditeur",viewer:"Observateur"},Z={active:"Actif",suspended:"Suspendu",inactive:"Inactif"},G=[{value:"send_sms",label:"Envoyer SMS",description:"Permet d'envoyer des SMS individuels et en masse"},{value:"view_history",label:"Voir l'historique",description:"Consulter l'historique des SMS envoyés"},{value:"manage_contacts",label:"Gérer les contacts",description:"Ajouter, modifier et supprimer des contacts"},{value:"manage_groups",label:"Gérer les groupes",description:"Créer et gérer des groupes de contacts"},{value:"create_campaigns",label:"Créer des campagnes",description:"Créer et lancer des campagnes SMS"},{value:"view_analytics",label:"Voir les statistiques",description:"Accéder aux rapports et statistiques"},{value:"manage_templates",label:"Gérer les modèles",description:"Créer et modifier des modèles de messages"},{value:"export_data",label:"Exporter les données",description:"Exporter les données en CSV/Excel"}];se(g,i=>{i&&(a.value.sms_credit_limit=null)});async function h(){var i,s;$.value=!0;try{const o=await b.get("/sub-accounts");x.value=o.data.data}catch(o){w(((s=(i=o.response)==null?void 0:i.data)==null?void 0:s.message)||"Erreur lors du chargement")}finally{$.value=!1}}function R(){l.value=null,a.value={name:"",email:"",password:"",role:"sender",status:"active",sms_credit_limit:null},g.value=!0,E.value=!0}function H(i){l.value=i,a.value={name:i.name,email:i.email,password:"",role:i.role,status:i.status,sms_credit_limit:i.sms_credit_limit},g.value=i.sms_credit_limit===null,V.value=!0}function T(i){l.value=i,C.value=[...i.permissions||[]],q.value=!0}function M(){E.value=!1,V.value=!1,l.value=null}function S(){q.value=!1,l.value=null,C.value=[]}async function J(){var i,s;_.value=!0;try{const o={...a.value};g.value&&(o.sms_credit_limit=null),l.value&&!o.password&&delete o.password,l.value?(await b.put(`/sub-accounts/${l.value.id}`,o),y("Sous-compte modifié avec succès")):(await b.post("/sub-accounts",o),y("Sous-compte créé avec succès")),M(),await h()}catch(o){w(((s=(i=o.response)==null?void 0:i.data)==null?void 0:s.message)||"Erreur lors de l'enregistrement")}finally{_.value=!1}}async function O(){var i,s;if(l.value){k.value=!0;try{await b.post(`/sub-accounts/${l.value.id}/permissions`,{permissions:C.value}),y("Permissions mises à jour avec succès"),S(),await h()}catch(o){w(((s=(i=o.response)==null?void 0:i.data)==null?void 0:s.message)||"Erreur lors de la mise à jour")}finally{k.value=!1}}}async function K(i){var o,t;if(await L("Suspendre le compte ?",`Voulez-vous vraiment suspendre "${i.name}" ? Il ne pourra plus se connecter.`))try{await b.post(`/sub-accounts/${i.id}/suspend`),y("Compte suspendu avec succès"),await h()}catch(c){w(((t=(o=c.response)==null?void 0:o.data)==null?void 0:t.message)||"Erreur lors de la suspension")}}async function Q(i){var s,o;try{await b.post(`/sub-accounts/${i.id}/activate`),y("Compte activé avec succès"),await h()}catch(t){w(((o=(s=t.response)==null?void 0:s.data)==null?void 0:o.message)||"Erreur lors de l'activation")}}async function W(i){var o,t;if(await L("Supprimer le compte ?",`Êtes-vous sûr de vouloir supprimer "${i.name}" ? Cette action est irréversible.`))try{await b.delete(`/sub-accounts/${i.id}`),y("Compte supprimé avec succès"),await h()}catch(c){w(((t=(o=c.response)==null?void 0:o.data)==null?void 0:t.message)||"Erreur lors de la suppression")}}function X(i){return i.sms_credit_limit===null?0:Math.min(100,i.sms_used/i.sms_credit_limit*100)}function Y(i){const s=new Date(i);return new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(s)}return te(()=>{h()}),(i,s)=>(n(),ie(re,null,{default:oe(()=>{var o;return[e("div",ve,[e("div",pe,[s[9]||(s[9]=e("div",null,[e("h1",{class:"text-3xl font-bold"},"Sous-comptes"),e("p",{class:"text-muted-foreground mt-2"},"Gérez les accès cloisonnés avec permissions et crédits SMS")],-1)),e("button",{onClick:R,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[m(f(le),{class:"w-4 h-4"}),s[8]||(s[8]=e("span",null,"Ajouter un sous-compte",-1))])]),$.value?(n(),r("div",ge,[...s[10]||(s[10]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):x.value.length===0?(n(),r("div",be,[m(f(fe),{class:"w-16 h-16 text-muted-foreground mb-4"}),s[11]||(s[11]=e("p",{class:"text-lg font-medium"},"Aucun sous-compte trouvé",-1)),s[12]||(s[12]=e("p",{class:"text-sm text-muted-foreground mt-1"},"Créez des comptes avec accès cloisonné",-1))])):(n(),r("div",xe,[(n(!0),r(U,null,z(x.value,t=>(n(),r("div",{key:t.id,class:"rounded-lg border bg-card shadow-sm hover:shadow-md transition-shadow"},[e("div",he,[e("div",we,[e("div",ye,[e("h3",_e,d(t.name),1),e("p",ke,d(t.email),1)]),e("span",{class:B(["text-xs px-2.5 py-1 rounded-full font-medium",{"bg-green-100 text-green-700":t.status==="active","bg-red-100 text-red-700":t.status==="suspended","bg-gray-100 text-gray-700":t.status==="inactive"}])},d(Z[t.status]),3)]),e("div",Ce,[e("span",{class:B(["text-xs px-2.5 py-1 rounded-md font-medium",{"bg-purple-100 text-purple-700":t.role==="admin","bg-blue-100 text-blue-700":t.role==="manager","bg-teal-100 text-teal-700":t.role==="sender","bg-gray-100 text-gray-700":t.role==="viewer"}])},d(N[t.role]),3)]),e("div",Me,[e("div",Se,[s[13]||(s[13]=e("span",{class:"text-muted-foreground"},"Crédits SMS",-1)),e("span",je,d(t.remaining_credits===null?"Illimité":t.remaining_credits.toLocaleString("fr-FR")),1)]),e("div",Ae,[s[14]||(s[14]=e("span",{class:"text-muted-foreground"},"Utilisés",-1)),e("span",null,d((t.sms_used||0).toLocaleString("fr-FR")),1)]),t.remaining_credits!==null?(n(),r("div",$e,[e("div",{class:"bg-primary h-2 rounded-full transition-all",style:ne({width:X(t)+"%"})},null,4)])):v("",!0),t.last_connection?(n(),r("div",Ee," Dernière connexion: "+d(Y(t.last_connection)),1)):v("",!0)])]),e("div",Ve,[e("button",{onClick:c=>H(t),class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9"},[m(f(ae),{class:"w-4 h-4"}),s[15]||(s[15]=e("span",null,"Modifier",-1))],8,qe),e("button",{onClick:c=>T(t),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"},[m(f(de),{class:"w-4 h-4"})],8,Pe),t.status==="active"?(n(),r("button",{key:0,onClick:c=>K(t),class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 hover:bg-destructive/10 hover:text-destructive h-9 w-9"},[m(f(ce),{class:"w-4 h-4"})],8,Ue)):t.status==="suspended"?(n(),r("button",{key:1,onClick:c=>Q(t),class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 hover:bg-success/10 hover:text-success h-9 w-9"},[m(f(me),{class:"w-4 h-4"})],8,ze)):v("",!0),e("button",{onClick:c=>W(t),class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 hover:bg-destructive/10 hover:text-destructive h-9 w-9"},[m(f(ue),{class:"w-4 h-4"})],8,Be)])]))),128))]))]),E.value||V.value?(n(),r("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:P(M,["self"])},[e("div",De,[e("div",Fe,[e("div",Le,[e("h2",Ie,d(l.value?"Modifier le sous-compte":"Nouveau sous-compte"),1),e("button",{onClick:M,class:"hover:bg-accent rounded-full p-1"},[m(f(I),{class:"w-5 h-5"})])])]),e("form",{onSubmit:P(J,["prevent"]),class:"p-6 space-y-6"},[e("div",Ne,[e("div",Ze,[s[16]||(s[16]=e("label",{class:"text-sm font-medium"},"Nom complet *",-1)),p(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>a.value.name=t),type:"text",required:"",placeholder:"Jean Dupont",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[j,a.value.name]])]),e("div",Ge,[s[17]||(s[17]=e("label",{class:"text-sm font-medium"},"Email *",-1)),p(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>a.value.email=t),type:"email",required:"",disabled:!!l.value,placeholder:"jean@example.com",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50"},null,8,Re),[[j,a.value.email]])])]),l.value?v("",!0):(n(),r("div",He,[s[18]||(s[18]=e("label",{class:"text-sm font-medium"},"Mot de passe *",-1)),p(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>a.value.password=t),type:"password",required:!l.value,placeholder:"Minimum 8 caractères",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,8,Te),[[j,a.value.password]]),s[19]||(s[19]=e("p",{class:"text-xs text-muted-foreground"},"Laissez vide pour ne pas modifier (mode édition)",-1))])),e("div",Je,[e("div",Oe,[s[21]||(s[21]=e("label",{class:"text-sm font-medium"},"Rôle *",-1)),p(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>a.value.role=t),required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...s[20]||(s[20]=[e("option",{value:"admin"},"Admin (tous les droits)",-1),e("option",{value:"manager"},"Manager (gestion avancée)",-1),e("option",{value:"sender"},"Sender (envoi SMS)",-1),e("option",{value:"viewer"},"Viewer (consultation uniquement)",-1)])],512),[[D,a.value.role]])]),e("div",Ke,[s[23]||(s[23]=e("label",{class:"text-sm font-medium"},"Statut",-1)),p(e("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>a.value.status=t),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...s[22]||(s[22]=[e("option",{value:"active"},"Actif",-1),e("option",{value:"suspended"},"Suspendu",-1),e("option",{value:"inactive"},"Inactif",-1)])],512),[[D,a.value.status]])])]),e("div",Qe,[s[25]||(s[25]=e("label",{class:"text-sm font-medium"},"Limite de crédits SMS",-1)),e("div",We,[p(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>a.value.sms_credit_limit=t),type:"number",min:"0",disabled:g.value,placeholder:"1000",class:"flex h-10 flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50"},null,8,Xe),[[j,a.value.sms_credit_limit,void 0,{number:!0}]]),e("label",Ye,[p(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>g.value=t),type:"checkbox",class:"rounded border-gray-300"},null,512),[[F,g.value]]),s[24]||(s[24]=e("span",{class:"text-sm"},"Illimité",-1))])]),s[26]||(s[26]=e("p",{class:"text-xs text-muted-foreground"},"Nombre maximum de SMS que ce compte peut envoyer",-1))]),e("div",es,[e("button",{type:"button",onClick:M,class:"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Annuler "),e("button",{type:"submit",disabled:_.value,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[_.value?(n(),r("div",ts)):v("",!0),e("span",null,d(_.value?"Enregistrement...":l.value?"Modifier":"Créer"),1)],8,ss)])],32)])])):v("",!0),q.value?(n(),r("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:P(S,["self"])},[e("div",is,[e("div",os,[e("div",ns,[s[27]||(s[27]=e("h2",{class:"text-xl font-bold"},"Permissions",-1)),e("button",{onClick:S,class:"hover:bg-accent rounded-full p-1"},[m(f(I),{class:"w-5 h-5"})])]),e("p",rs,d((o=l.value)==null?void 0:o.name),1)]),e("div",ls,[(n(),r(U,null,z(G,t=>e("div",{key:t.value,class:"flex items-start gap-3"},[p(e("input",{"onUpdate:modelValue":s[7]||(s[7]=c=>C.value=c),value:t.value,type:"checkbox",id:"perm-"+t.value,class:"mt-1 rounded border-gray-300"},null,8,as),[[F,C.value]]),e("label",{for:"perm-"+t.value,class:"flex-1 cursor-pointer"},[e("div",us,d(t.label),1),e("div",cs,d(t.description),1)],8,ds)])),64))]),e("div",ms,[e("button",{type:"button",onClick:S,class:"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Annuler "),e("button",{onClick:O,disabled:k.value,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[k.value?(n(),r("div",vs)):v("",!0),e("span",null,d(k.value?"Enregistrement...":"Enregistrer"),1)],8,fs)])])])):v("",!0)]}),_:1}))}});export{_s as default};
