import{d as G,r as v,j as $,l as P,m as W,n as X,o as i,b as e,s as b,x as c,A as I,t as a,c as m,p as S,F as A,z as L,q as J,w as M,f as D,v as N,D as K,g as O}from"./main-B4xPymR6.js";import{f as u,_ as Q,o as V,j as Y,v as Z}from"./api-DDJSZ9vy.js";import{b as f,a as h,s as ee}from"./notifications-CHQAjgV4.js";import{r as te}from"./CheckCircleIcon-D6_0-N-6.js";import{r as se}from"./ExclamationTriangleIcon-BGp7EBuj.js";import{r as oe}from"./ShieldCheckIcon-BMqsywzj.js";import{r as re}from"./ArrowPathIcon-D7h3k2qB.js";const x={async getAll(){const r=await u.get("/webhooks");return r.data.data||r.data},async getById(r){const n=await u.get(`/webhooks/${r}`);return n.data.data||n.data},async create(r){const n=await u.post("/webhooks",r);return n.data.data||n.data},async update(r,n){const d=await u.put(`/webhooks/${r}`,n);return d.data.data||d.data},async delete(r){await u.delete(`/webhooks/${r}`)},async toggle(r){const n=await u.post(`/webhooks/${r}/toggle`);return n.data.data||n.data},async test(r){return(await u.post(`/webhooks/${r}/test`)).data},async getLogs(r,n){const d=await u.get(`/webhooks/${r}/logs`,{params:n});return d.data.data||d.data},async getStats(r){const n=await u.get(`/webhooks/${r}/stats`);return n.data.data||n.data},async getEvents(){const r=await u.get("/webhooks/events");return r.data.data||r.data}},ne={class:"p-4 sm:p-6 lg:p-8"},ae={class:"mb-4 sm:mb-8 flex flex-col sm:flex-row justify-between sm:items-center gap-3 sm:gap-4"},de={class:"grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 mb-4 sm:mb-8"},le={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-4 sm:p-6"},ie={class:"flex items-center justify-between mb-2"},ue={class:"text-2xl sm:text-3xl font-bold"},ce={class:"text-xs text-muted-foreground mt-1 sm:mt-2"},me={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-4 sm:p-6"},pe={class:"flex items-center justify-between mb-2"},be={class:"text-2xl sm:text-3xl font-bold text-success"},fe={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-4 sm:p-6"},ve={class:"flex items-center justify-between mb-2"},xe={class:"text-2xl sm:text-3xl font-bold text-destructive"},ge={class:"rounded-lg border bg-card shadow-sm mb-4 sm:mb-8"},he={class:"p-4 sm:p-6"},ye={class:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2 sm:gap-3"},we={class:"rounded-lg border bg-card shadow-sm"},ke={class:"p-6"},_e={key:0,class:"text-center py-12"},Ce={key:1,class:"text-center py-12"},$e={key:2,class:"overflow-x-auto"},We={class:"w-full"},Se={class:"p-4"},Ae={class:"p-4"},De={class:"text-sm font-mono text-muted-foreground truncate block max-w-xs"},Ee={class:"p-4"},je={class:"p-4"},Ie={class:"p-4 text-success font-medium"},Le={class:"p-4 text-destructive font-medium"},Me={class:"p-4"},Ne={class:"flex gap-2"},Ve=["onClick"],ze=["onClick","title"],Te=["onClick"],qe=["onClick"],Be={class:"rounded-lg border bg-card shadow-sm mt-8"},Ue={class:"p-6 space-y-4 text-sm"},Re={class:"flex items-center gap-2 mb-2"},Fe={class:"flex items-center gap-2 mb-2"},He={class:"flex items-center gap-2 mb-2"},Ge={class:"bg-card rounded-lg shadow-xl max-w-2xl w-full m-4 max-h-[90vh] overflow-y-auto"},Pe={class:"p-6 border-b border-border"},Xe={class:"text-xl font-semibold"},Je={class:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto p-2 border border-border rounded-lg"},Ke=["value"],Oe={class:"text-sm"},Qe={class:"flex gap-3 pt-4"},Ye=["disabled"],at=G({__name:"Webhooks",setup(r){const n=Z,d=v([]),_=v(!1),y=v(!1),w=v(!1),p=v(null),l=v({name:"",url:"",events:[]}),E=["message.sent","message.delivered","message.failed","campaign.started","campaign.completed","campaign.failed","contact.created","contact.updated","contact.deleted","sub_account.created","sub_account.suspended","blacklist.added"],z=$(()=>d.value.filter(o=>o.is_active).length),T=$(()=>d.value.reduce((o,t)=>o+t.success_count,0)),q=$(()=>d.value.reduce((o,t)=>o+t.failure_count,0));async function k(){_.value=!0;try{d.value=await x.getAll()}catch(o){console.error("Error loading webhooks:",o),f("Impossible de charger les webhooks")}finally{_.value=!1}}function j(){p.value=null,l.value={name:"",url:"",events:[]},w.value=!0}function B(o){p.value=o,l.value={name:o.name,url:o.url,events:[...o.events]},w.value=!0}function C(){w.value=!1,p.value=null}async function U(){if(l.value.events.length===0){f("Veuillez sélectionner au moins un événement");return}y.value=!0;try{p.value?(await x.update(p.value.id,l.value),h("Webhook modifié avec succès")):(await x.create(l.value),h("Webhook créé avec succès")),await k(),C()}catch(o){console.error("Error saving webhook:",o),f("Impossible de sauvegarder le webhook")}finally{y.value=!1}}async function R(o){try{const t=await x.test(o.id);t.success?h(`Test réussi (Code: ${t.response_code})`):f(`Test échoué (Code: ${t.response_code})`)}catch(t){console.error("Error testing webhook:",t),f("Impossible de tester le webhook")}}async function F(o){try{await x.toggle(o.id),h(`Webhook ${o.is_active?"désactivé":"activé"} avec succès`),await k()}catch(t){console.error("Error toggling webhook:",t),f("Impossible de modifier le statut du webhook")}}async function H(o){if(await ee("Êtes-vous sûr de vouloir supprimer ce webhook ?",`Le webhook "${o.name}" sera définitivement supprimé.`))try{await x.delete(o.id),h("Webhook supprimé avec succès"),await k()}catch(s){console.error("Error deleting webhook:",s),f("Impossible de supprimer le webhook")}}return P(()=>{k()}),(o,t)=>(i(),W(Q,null,{default:X(()=>[e("div",ne,[e("div",ae,[t[5]||(t[5]=e("div",null,[e("h1",{class:"text-xl sm:text-3xl font-bold text-foreground"},"Webhooks"),e("p",{class:"text-sm text-muted-foreground mt-1 sm:mt-2"},"Intégrez SendWave Pro avec vos applications tierces")],-1)),e("button",{onClick:j,class:"inline-flex items-center justify-center gap-2 px-3 sm:px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors text-sm font-medium h-9 sm:h-10"},[b(c(V),{class:"w-4 h-4 sm:w-5 sm:h-5"}),t[3]||(t[3]=e("span",{class:"hidden sm:inline"},"Nouveau Webhook",-1)),t[4]||(t[4]=e("span",{class:"sm:hidden"},"Nouveau",-1))])]),e("div",de,[e("div",le,[e("div",ie,[t[6]||(t[6]=e("h3",{class:"text-xs sm:text-sm font-medium text-muted-foreground"},"Webhooks Actifs",-1)),(i(),W(I(c(n)),{class:"w-6 h-6 sm:w-8 sm:h-8 text-primary"}))]),e("p",ue,a(z.value),1),e("p",ce,"sur "+a(d.value.length)+" total",1)]),e("div",me,[e("div",pe,[t[7]||(t[7]=e("h3",{class:"text-xs sm:text-sm font-medium text-muted-foreground"},"Livraisons Réussies",-1)),b(c(te),{class:"w-6 h-6 sm:w-8 sm:h-8 text-success"})]),e("p",be,a(T.value),1),t[8]||(t[8]=e("p",{class:"text-xs text-muted-foreground mt-1 sm:mt-2"},"au total",-1))]),e("div",fe,[e("div",ve,[t[9]||(t[9]=e("h3",{class:"text-xs sm:text-sm font-medium text-muted-foreground"},"Échecs",-1)),b(c(se),{class:"w-6 h-6 sm:w-8 sm:h-8 text-destructive"})]),e("p",xe,a(q.value),1),t[10]||(t[10]=e("p",{class:"text-xs text-muted-foreground mt-1 sm:mt-2"},"au total",-1))])]),e("div",ge,[t[11]||(t[11]=e("div",{class:"p-4 sm:p-6 border-b border-border"},[e("h2",{class:"text-base sm:text-xl font-semibold"},"Événements Disponibles"),e("p",{class:"text-xs sm:text-sm text-muted-foreground mt-1"},"12 types d'événements pour déclencher vos webhooks")],-1)),e("div",he,[e("div",ye,[(i(),m(A,null,S(E,s=>e("div",{key:s,class:"px-3 py-2 bg-secondary rounded-lg text-sm font-medium text-center"},a(s),1)),64))])])]),e("div",we,[t[17]||(t[17]=e("div",{class:"p-6 border-b border-border"},[e("h2",{class:"text-xl font-semibold"},"Vos Webhooks"),e("p",{class:"text-sm text-muted-foreground mt-1"},"Gérez vos endpoints de webhooks et surveillez leur statut")],-1)),e("div",ke,[_.value?(i(),m("div",_e,[...t[12]||(t[12]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"},null,-1),e("p",{class:"text-muted-foreground"},"Chargement des webhooks...",-1)])])):d.value.length===0?(i(),m("div",Ce,[(i(),W(I(c(n)),{class:"w-12 h-12 text-muted-foreground mx-auto mb-4"})),t[14]||(t[14]=e("h3",{class:"text-lg font-medium mb-2"},"Aucun webhook configuré",-1)),t[15]||(t[15]=e("p",{class:"text-muted-foreground mb-4"},"Commencez par créer votre premier webhook pour recevoir des événements",-1)),e("button",{onClick:j,class:"px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors inline-flex items-center gap-2"},[b(c(V),{class:"w-5 h-5"}),t[13]||(t[13]=L(" Créer un Webhook ",-1))])])):(i(),m("div",$e,[e("table",We,[t[16]||(t[16]=e("thead",null,[e("tr",{class:"border-b border-border"},[e("th",{class:"text-left p-4 font-medium text-muted-foreground"},"Nom"),e("th",{class:"text-left p-4 font-medium text-muted-foreground"},"URL"),e("th",{class:"text-left p-4 font-medium text-muted-foreground"},"Événements"),e("th",{class:"text-left p-4 font-medium text-muted-foreground"},"Statut"),e("th",{class:"text-left p-4 font-medium text-muted-foreground"},"Succès"),e("th",{class:"text-left p-4 font-medium text-muted-foreground"},"Échecs"),e("th",{class:"text-left p-4 font-medium text-muted-foreground"},"Actions")])],-1)),e("tbody",null,[(i(!0),m(A,null,S(d.value,s=>(i(),m("tr",{key:s.id,class:"border-b border-border hover:bg-muted/50"},[e("td",Se,a(s.name),1),e("td",Ae,[e("span",De,a(s.url),1)]),e("td",Ee,a(s.events.length)+" événement(s)",1),e("td",je,[e("span",{class:J(["px-2 py-1 rounded-full text-xs font-medium",s.is_active?"bg-success/10 text-success":"bg-muted text-muted-foreground"])},a(s.is_active?"Actif":"Inactif"),3)]),e("td",Ie,a(s.success_count),1),e("td",Le,a(s.failure_count),1),e("td",Me,[e("div",Ne,[e("button",{onClick:g=>R(s),class:"px-3 py-1 text-sm border border-border rounded hover:bg-muted transition-colors",title:"Tester"}," Tester ",8,Ve),e("button",{onClick:g=>F(s),class:"px-3 py-1 text-sm border border-border rounded hover:bg-muted transition-colors",title:s.is_active?"Désactiver":"Activer"},a(s.is_active?"Désactiver":"Activer"),9,ze),e("button",{onClick:g=>B(s),class:"px-3 py-1 text-sm border border-border rounded hover:bg-muted transition-colors",title:"Modifier"}," Modifier ",8,Te),e("button",{onClick:g=>H(s),class:"px-3 py-1 text-sm border border-destructive text-destructive rounded hover:bg-destructive/10 transition-colors",title:"Supprimer"}," Supprimer ",8,qe)])])]))),128))])])]))])]),e("div",Be,[t[24]||(t[24]=e("div",{class:"p-6 border-b border-border"},[e("h2",{class:"text-xl font-semibold"},"Documentation")],-1)),e("div",Ue,[e("div",null,[e("div",Re,[b(c(oe),{class:"w-5 h-5 text-primary"}),t[18]||(t[18]=e("h4",{class:"font-semibold"},"Sécurité",-1))]),t[19]||(t[19]=e("p",{class:"text-muted-foreground"},[L(" Tous les webhooks incluent une signature HMAC-SHA256 dans le header "),e("code",{class:"px-1 py-0.5 bg-secondary rounded"},"X-Webhook-Signature")],-1))]),e("div",null,[e("div",Fe,[b(c(re),{class:"w-5 h-5 text-primary"}),t[20]||(t[20]=e("h4",{class:"font-semibold"},"Retry Logic",-1))]),t[21]||(t[21]=e("p",{class:"text-muted-foreground"}," Les webhooks échoués sont automatiquement retry jusqu'à 3 fois avec un délai exponentiel (1s, 2s, 4s) ",-1))]),e("div",null,[e("div",He,[b(c(Y),{class:"w-5 h-5 text-primary"}),t[22]||(t[22]=e("h4",{class:"font-semibold"},"Timeout",-1))]),t[23]||(t[23]=e("p",{class:"text-muted-foreground"}," Le timeout par défaut est de 30 secondes, configurable entre 5 et 120 secondes ",-1))])])])]),w.value?(i(),m("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:M(C,["self"])},[e("div",Ge,[e("div",Pe,[e("h2",Xe,a(p.value?"Modifier le webhook":"Créer un nouveau webhook"),1)]),e("form",{onSubmit:M(U,["prevent"]),class:"p-6 space-y-4"},[e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium mb-2"},"Nom du webhook",-1)),D(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.value.name=s),type:"text",required:"",class:"w-full px-3 py-2 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Ex: Notification Slack"},null,512),[[N,l.value.name]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium mb-2"},"URL du webhook",-1)),D(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.url=s),type:"url",required:"",class:"w-full px-3 py-2 border border-border rounded-lg bg-background focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"https://example.com/webhook"},null,512),[[N,l.value.url]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium mb-2"},"Événements à écouter",-1)),e("div",Je,[(i(),m(A,null,S(E,s=>e("label",{key:s,class:"flex items-center gap-2 p-2 hover:bg-muted rounded cursor-pointer"},[D(e("input",{type:"checkbox",value:s,"onUpdate:modelValue":t[2]||(t[2]=g=>l.value.events=g),class:"w-4 h-4"},null,8,Ke),[[K,l.value.events]]),e("span",Oe,a(s),1)])),64))])]),e("div",Qe,[e("button",{type:"submit",disabled:y.value,class:"flex-1 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors disabled:opacity-50"},a(y.value?"Enregistrement...":p.value?"Modifier":"Créer"),9,Ye),e("button",{type:"button",onClick:C,class:"px-4 py-2 border border-border rounded-lg hover:bg-muted transition-colors"}," Annuler ")])],32)])])):O("",!0)]),_:1}))}});export{at as default};
