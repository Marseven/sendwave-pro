import{o as n,c as r,b as e,d as Y,r as d,k as j,m as Z,n as H,p as I,x as f,y as b,t as i,f as C,v as A,F as J,q as K,g,w as N,s as S}from"./main-ODyDuZU1.js";import{_ as W,f as B,i as X,s as E}from"./api-DihchNZ1.js";import{b as p,a as L,s as ee}from"./notifications-CHQAjgV4.js";import{r as te}from"./TrashIcon-CaajGn2x.js";import{r as R}from"./XMarkIcon-DrfkshMi.js";function se(V,m){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function oe(V,m){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}const ne={class:"p-8"},re={class:"mb-8 flex items-center justify-between"},ie={class:"flex gap-3"},le={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},ae={class:"rounded-lg border bg-card p-4"},de={class:"text-2xl font-bold mt-1"},ue={class:"rounded-lg border bg-card p-4"},ce={class:"text-2xl font-bold mt-1 text-destructive"},fe={class:"rounded-lg border bg-card p-4"},be={class:"text-2xl font-bold mt-1 text-success"},me={class:"rounded-lg border bg-card shadow-sm mb-6 p-6"},ve={class:"flex gap-4"},ge={class:"flex-1"},pe={class:"rounded-lg border bg-card shadow-sm"},xe={key:0,class:"flex items-center justify-center py-12"},he={key:1,class:"flex flex-col items-center justify-center py-12"},we={key:2,class:"overflow-x-auto"},ye={class:"w-full"},ke={class:"p-4 font-medium font-mono"},_e={class:"p-4 text-sm text-muted-foreground"},je={class:"p-4 text-sm text-muted-foreground"},Ce={class:"p-4"},Ae=["onClick"],Be={key:0,class:"flex items-center justify-between mt-6"},Pe={class:"text-sm text-muted-foreground"},$e={class:"flex gap-2"},Me=["disabled"],Ne=["disabled"],Ve={class:"bg-background rounded-lg shadow-lg w-full max-w-md p-6"},qe={class:"flex items-center justify-between mb-6"},De={class:"space-y-2"},Se={class:"space-y-2"},Ee={class:"flex gap-3 pt-4 border-t"},Le=["disabled"],Re={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Fe={class:"bg-background rounded-lg shadow-lg w-full max-w-md p-6"},ze={class:"flex items-center justify-between mb-6"},Te={class:"space-y-4"},Ue={class:"space-y-2"},Ge={class:"flex gap-2"},Oe=["disabled"],Qe={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Ye={class:"flex items-center gap-3"},Ze={key:0,class:"w-10 h-10 rounded-full bg-destructive/20 flex items-center justify-center"},He={key:1,class:"w-10 h-10 rounded-full bg-success/20 flex items-center justify-center"},Ie={class:"text-sm text-muted-foreground"},tt=Y({__name:"Blacklist",setup(V){const m=d(""),v=d([]),P=d(!1),x=d(!1),h=d(!1),$=d(!1),y=d(!1),w=d(""),u=d(null),l=d({currentPage:1,lastPage:1,total:0}),c=d({phone_number:"",reason:""}),q=j(()=>{if(!m.value)return v.value;const o=m.value.toLowerCase();return v.value.filter(t=>t.phone_number.toLowerCase().includes(o)||t.reason&&t.reason.toLowerCase().includes(o))}),D=j(()=>l.value.total),F=j(()=>{const o=new Date,t=new Date(o.getFullYear(),o.getMonth(),1);return v.value.filter(s=>new Date(s.added_at||s.created_at)>=t).length}),z=j(()=>D.value*5);function T(o){return o?new Date(o).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"}async function k(o=1){var t,s;P.value=!0;try{const a=await B.get("/blacklist",{params:{page:o}});v.value=a.data.data,l.value={currentPage:a.data.current_page,lastPage:a.data.last_page,total:a.data.total}}catch(a){p(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Erreur lors du chargement"),console.error("Error loading blacklist:",a)}finally{P.value=!1}}function U(){c.value={phone_number:"",reason:""},$.value=!0}function _(){$.value=!1,c.value={phone_number:"",reason:""}}async function G(){var o,t;if(!c.value.phone_number.trim()){p("Le numéro de téléphone est requis");return}x.value=!0;try{await B.post("/blacklist",c.value),L("Numéro ajouté à la liste noire"),_(),await k()}catch(s){p(((t=(o=s.response)==null?void 0:o.data)==null?void 0:t.message)||"Erreur lors de l'ajout")}finally{x.value=!1}}async function O(o){var s,a;if(await ee("Retirer de la liste noire ?",`Êtes-vous sûr de vouloir débloquer ${o.phone_number} ?`))try{await B.delete(`/blacklist/${o.id}`),L("Numéro retiré de la liste noire"),v.value=v.value.filter(M=>M.id!==o.id),l.value.total--}catch(M){p(((a=(s=M.response)==null?void 0:s.data)==null?void 0:a.message)||"Erreur lors de la suppression")}}async function Q(){var o,t;if(!w.value.trim()){p("Veuillez entrer un numéro");return}h.value=!0,u.value=null;try{const s=await B.post("/blacklist/check",{phone_number:w.value});u.value=s.data.is_blacklisted}catch(s){p(((t=(o=s.response)==null?void 0:o.data)==null?void 0:t.message)||"Erreur lors de la vérification")}finally{h.value=!1}}return Z(()=>{k()}),(o,t)=>(n(),H(W,null,{default:I(()=>[e("div",ne,[e("div",re,[t[11]||(t[11]=e("div",null,[e("h1",{class:"text-3xl font-bold"},"Liste Noire"),e("p",{class:"text-muted-foreground mt-2"},"Gérez les numéros bloqués pour l'envoi de SMS")],-1)),e("div",ie,[e("button",{onClick:t[0]||(t[0]=s=>y.value=!0),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"},[f(b(oe),{class:"w-4 h-4"}),t[9]||(t[9]=e("span",null,"Vérifier un numéro",-1))]),e("button",{onClick:U,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[f(b(X),{class:"w-4 h-4"}),t[10]||(t[10]=e("span",null,"Ajouter un numéro",-1))])])]),e("div",le,[e("div",ae,[t[12]||(t[12]=e("div",{class:"text-sm text-muted-foreground"},"Total bloqués",-1)),e("div",de,i(D.value),1)]),e("div",ue,[t[13]||(t[13]=e("div",{class:"text-sm text-muted-foreground"},"Ajoutés ce mois",-1)),e("div",ce,i(F.value),1)]),e("div",fe,[t[14]||(t[14]=e("div",{class:"text-sm text-muted-foreground"},"SMS évités",-1)),e("div",be,i(z.value),1)])]),e("div",me,[e("div",ve,[e("div",ge,[C(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>m.value=s),type:"text",placeholder:"Rechercher par numéro ou raison...",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},null,512),[[A,m.value]])])])]),e("div",pe,[P.value?(n(),r("div",xe,[...t[15]||(t[15]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):q.value.length===0?(n(),r("div",he,[f(b(E),{class:"w-16 h-16 text-muted-foreground mb-4"}),t[16]||(t[16]=e("p",{class:"text-lg font-medium"},"Aucun numéro bloqué",-1)),t[17]||(t[17]=e("p",{class:"text-sm text-muted-foreground mt-1"},"La liste noire est vide",-1))])):(n(),r("div",we,[e("table",ye,[t[18]||(t[18]=e("thead",{class:"border-b bg-muted/50"},[e("tr",null,[e("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Numéro"),e("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Raison"),e("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Date d'ajout"),e("th",{class:"h-12 px-4 text-left align-middle font-medium text-muted-foreground"},"Actions")])],-1)),e("tbody",null,[(n(!0),r(J,null,K(q.value,s=>(n(),r("tr",{key:s.id,class:"border-b transition-colors hover:bg-muted/50"},[e("td",ke,i(s.phone_number),1),e("td",_e,i(s.reason||"-"),1),e("td",je,i(T(s.added_at||s.created_at)),1),e("td",Ce,[e("button",{onClick:a=>O(s),class:"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 hover:bg-destructive/10 hover:text-destructive h-8 w-8",title:"Retirer de la liste noire"},[f(b(te),{class:"w-4 h-4"})],8,Ae)])]))),128))])])]))]),l.value.lastPage>1?(n(),r("div",Be,[e("p",Pe," Page "+i(l.value.currentPage)+" sur "+i(l.value.lastPage)+" ("+i(l.value.total)+" numéros) ",1),e("div",$e,[e("button",{onClick:t[2]||(t[2]=s=>k(l.value.currentPage-1)),disabled:l.value.currentPage<=1,class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"}," Précédent ",8,Me),e("button",{onClick:t[3]||(t[3]=s=>k(l.value.currentPage+1)),disabled:l.value.currentPage>=l.value.lastPage,class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"}," Suivant ",8,Ne)])])):g("",!0)]),$.value?(n(),r("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:N(_,["self"])},[e("div",Ve,[e("div",qe,[t[19]||(t[19]=e("h2",{class:"text-xl font-bold"},"Ajouter à la liste noire",-1)),e("button",{onClick:_,class:"hover:bg-accent rounded-full p-1"},[f(b(R),{class:"w-5 h-5"})])]),e("form",{onSubmit:N(G,["prevent"]),class:"space-y-4"},[e("div",De,[t[20]||(t[20]=e("label",{class:"text-sm font-medium"},"Numéro de téléphone *",-1)),C(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>c.value.phone_number=s),type:"tel",required:"",placeholder:"+24177000000",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[A,c.value.phone_number]])]),e("div",Se,[t[21]||(t[21]=e("label",{class:"text-sm font-medium"},"Raison (optionnel)",-1)),C(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=s=>c.value.reason=s),rows:"3",placeholder:"Ex: Demande de désinscription, spam...",class:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[A,c.value.reason]])]),e("div",Ee,[e("button",{type:"button",onClick:_,class:"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Annuler "),e("button",{type:"submit",disabled:x.value,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-destructive text-destructive-foreground hover:bg-destructive/90 h-10 px-4 py-2"},[x.value?(n(),r("div",Re)):g("",!0),e("span",null,i(x.value?"Ajout...":"Bloquer ce numéro"),1)],8,Le)])],32)])])):g("",!0),y.value?(n(),r("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:t[8]||(t[8]=N(s=>y.value=!1,["self"]))},[e("div",Fe,[e("div",ze,[t[22]||(t[22]=e("h2",{class:"text-xl font-bold"},"Vérifier un numéro",-1)),e("button",{onClick:t[6]||(t[6]=s=>y.value=!1),class:"hover:bg-accent rounded-full p-1"},[f(b(R),{class:"w-5 h-5"})])]),e("div",Te,[e("div",Ue,[t[23]||(t[23]=e("label",{class:"text-sm font-medium"},"Numéro de téléphone",-1)),e("div",Ge,[C(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>w.value=s),type:"tel",placeholder:"+24177000000",class:"flex-1 h-10 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[A,w.value]]),e("button",{onClick:Q,disabled:h.value||!w.value,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[h.value?(n(),r("div",Qe)):g("",!0),e("span",null,i(h.value?"Vérification...":"Vérifier"),1)],8,Oe)])]),u.value!==null?(n(),r("div",{key:0,class:S(["p-4 rounded-lg",u.value?"bg-destructive/10":"bg-success/10"])},[e("div",Ye,[u.value?(n(),r("div",Ze,[f(b(E),{class:"w-5 h-5 text-destructive"})])):(n(),r("div",He,[f(b(se),{class:"w-5 h-5 text-success"})])),e("div",null,[e("p",{class:S(["font-medium",u.value?"text-destructive":"text-success"])},i(u.value?"Numéro bloqué":"Numéro autorisé"),3),e("p",Ie,i(u.value?"Ce numéro est dans la liste noire":"Ce numéro peut recevoir des SMS"),1)])])],2)):g("",!0)])])])):g("",!0)]),_:1}))}});export{tt as default};
