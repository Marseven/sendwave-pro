import{d as ce,u as me,k as ue,r as I,l as xe,m as ge,n as W,o as i,p as fe,b as e,t as n,c as a,q,s as g,F as z,x as v,y as _,z as Y,i as Z,A as ve}from"./main-D5SOzsMG.js";import{r as G,a as _e,b as pe,_ as be}from"./api-CuXQ3mux.js";import{a as he}from"./analyticsService-BM8O3O_Q.js";import{c as ye}from"./campaignService-Br3jKVi2.js";import{r as ee}from"./CheckCircleIcon-C794lZ0h.js";const we={class:"p-4 sm:p-6 lg:p-8"},ke={class:"mb-4 sm:mb-6 lg:mb-8"},Ce={class:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4"},$e={class:"text-sm text-muted-foreground mt-1 sm:mt-2"},Ae={class:"flex flex-wrap gap-2"},je=["onClick"],De={key:0,class:"flex items-center justify-center py-8 sm:py-12"},Fe={key:1},Se={class:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6 mb-4 sm:mb-6 lg:mb-8"},Te={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-3 sm:p-4 lg:p-6"},Le={class:"flex items-center justify-between mb-1 sm:mb-2"},Re={class:"text-xl sm:text-2xl lg:text-3xl font-bold"},Be={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-3 sm:p-4 lg:p-6"},Me={class:"flex items-center justify-between mb-1 sm:mb-2"},Ee={class:"text-xl sm:text-2xl lg:text-3xl font-bold"},Ie={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-3 sm:p-4 lg:p-6"},Ne={class:"flex items-center justify-between mb-1 sm:mb-2"},Pe={class:"text-xl sm:text-2xl lg:text-3xl font-bold"},qe={class:"rounded-lg border bg-card text-card-foreground shadow-sm p-3 sm:p-4 lg:p-6"},ze={class:"flex items-center justify-between mb-1 sm:mb-2"},Ve={class:"text-xl sm:text-2xl lg:text-3xl font-bold"},Ke={class:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 lg:gap-6 mb-4 sm:mb-6 lg:mb-8"},Oe={class:"rounded-lg border bg-card shadow-sm"},Ue={class:"p-4 sm:p-6"},Xe={key:0,class:"space-y-3 sm:space-y-4"},Ge={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1"},He={class:"font-medium text-sm sm:text-base"},Je={class:"text-xs sm:text-sm text-muted-foreground"},Qe={class:"w-full bg-muted rounded-full h-2"},We={class:"flex flex-col sm:flex-row sm:justify-between gap-1 text-xs text-muted-foreground"},Ye={key:1,class:"text-center text-muted-foreground py-6 sm:py-8"},Ze={class:"rounded-lg border bg-card shadow-sm"},et={class:"p-4 sm:p-6"},tt={key:0,class:"space-y-3 sm:space-y-4"},st={class:"text-center"},rt={class:"text-3xl sm:text-4xl lg:text-5xl font-bold text-primary"},ot={class:"w-full bg-muted rounded-full h-2 sm:h-3"},nt={class:"flex flex-col sm:flex-row sm:justify-between gap-1 text-xs text-muted-foreground"},lt={key:1,class:"text-center text-muted-foreground py-6 sm:py-8"},it={class:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4 lg:gap-6"},dt={class:"rounded-lg border bg-card text-card-foreground shadow-sm"},at={class:"p-4 sm:p-6"},ct={key:0},mt={class:"flex items-start justify-between gap-2 mb-1 sm:mb-2"},ut={class:"font-medium text-sm sm:text-base truncate"},xt={class:"flex flex-wrap items-center gap-2 sm:gap-4 text-xs sm:text-sm text-muted-foreground"},gt={class:"flex items-center gap-1"},ft={class:"flex items-center gap-1"},vt={key:1,class:"text-center text-muted-foreground py-6 sm:py-8"},_t={class:"rounded-lg border bg-card text-card-foreground shadow-sm"},pt={class:"p-4 sm:p-6"},bt={key:0},ht={class:"flex-1 min-w-0"},yt={class:"text-xs sm:text-sm font-medium truncate"},wt={class:"text-xs text-muted-foreground mt-0.5 sm:mt-1"},kt={key:1,class:"text-center text-muted-foreground py-6 sm:py-8"},St=ce({__name:"Dashboard",setup(Ct){const te=me(),N=ue(()=>te.user),se=[{value:"today",label:"Aujourd'hui"},{value:"week",label:"Cette semaine"},{value:"month",label:"Ce mois"},{value:"year",label:"Cette année"}],P=I("today"),r=I(null),V=I([]),K=I([]),O=I(!1);function f(s){return s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(1)}K`:s.toString()}function H(s){return`${s.toLocaleString("fr-FR")} XAF`}function U(s){return s?s>0?"text-success":s<0?"text-destructive":"text-muted-foreground":"text-muted-foreground"}function X(s){return s?`${s>0?"+":""}${s.toFixed(1)}% vs période précédente`:"Aucun changement"}function re(s){return s?s>=95?"text-success":s>=85?"text-warning":"text-destructive":"text-muted-foreground"}function oe(s){return s?s>=95?"Excellent":s>=85?"Bon":"À améliorer":"Aucune donnée"}function J(s,t){return t?s/t*100:0}function ne(s,t){const d=J(s,t);return d>50?"bg-success":d>20?"bg-warning":"bg-destructive"}async function Q(){var s,t,d,m,c,u,p,b,h,y,w,k,C,$,A,j,D,F,S,T,L,R,B,M,o;O.value=!0;try{const[x,E]=await Promise.all([he.getDashboard(P.value),ye.getAll()]),l=x.data;r.value={total_sent:((s=l.overview)==null?void 0:s.sms_sent)||0,total_delivered:((t=l.overview)==null?void 0:t.sms_delivered)||0,total_failed:((d=l.overview)==null?void 0:d.sms_failed)||0,delivery_rate:((m=l.overview)==null?void 0:m.success_rate)||0,total_cost:((c=l.overview)==null?void 0:c.total_cost)||0,campaigns_executed:((u=l.overview)==null?void 0:u.campaigns_executed)||0,contacts_added:((p=l.overview)==null?void 0:p.contacts_added)||0,trends:{sent:((b=l.trends)==null?void 0:b.sms_sent_change)||0,delivered:((h=l.trends)==null?void 0:h.success_rate_change)||0,cost:((y=l.trends)==null?void 0:y.cost_change)||0,campaigns:((w=l.trends)==null?void 0:w.campaigns_change)||0},by_provider:{Airtel:{sent:((C=(k=l.providers)==null?void 0:k.airtel)==null?void 0:C.count)||0,delivered_rate:((A=($=l.providers)==null?void 0:$.airtel)==null?void 0:A.percentage)||0,total_cost:((j=l.cost_analysis)==null?void 0:j.airtel_cost)||0},Moov:{sent:((F=(D=l.providers)==null?void 0:D.moov)==null?void 0:F.count)||0,delivered_rate:((T=(S=l.providers)==null?void 0:S.moov)==null?void 0:T.percentage)||0,total_cost:((L=l.cost_analysis)==null?void 0:L.moov_cost)||0}},credits_remaining:((R=N.value)==null?void 0:R.credits)||0,initial_credits:((B=N.value)==null?void 0:B.initial_credits)||((M=N.value)==null?void 0:M.credits)||1e3},V.value=((o=l.campaigns)==null?void 0:o.length)>0?l.campaigns.slice(0,3):E.slice(0,3),K.value=le(E)}catch(x){console.error("Error loading dashboard data:",x)}finally{O.value=!1}}xe(P,()=>{Q()});function le(s){const t=[];return s.slice(0,4).forEach(d=>{(d.messages_sent||d.sent)&&t.push({id:`campaign-${d.id}`,icon:G,title:`Campagne "${d.name}" envoyée à ${d.messages_sent||d.sent} contacts`,time:ie(d.created_at)})}),t.slice(0,4)}function ie(s){if(!s)return"Récemment";const t=new Date(s),m=new Date().getTime()-t.getTime(),c=Math.floor(m/(1e3*60*60)),u=Math.floor(m/(1e3*60*60*24));return c<1?"Il y a quelques minutes":c<24?`Il y a ${c} heure${c>1?"s":""}`:u===1?"Il y a 1 jour":`Il y a ${u} jours`}function de(s){const t=s==null?void 0:s.toLowerCase();return t==="active"||t==="actif"?"bg-success/10 text-success":t==="scheduled"||t==="planifié"?"bg-warning/10 text-warning":"bg-muted text-muted-foreground"}function ae(s){const t=s==null?void 0:s.toLowerCase();return t==="active"||t==="actif"?"Active":t==="scheduled"||t==="planifié"?"Planifiée":t==="completed"||t==="terminé"?"Terminée":s||"Inconnu"}return ge(()=>{Q()}),(s,t)=>(i(),W(be,null,{default:fe(()=>{var d,m,c,u,p,b,h,y,w,k,C,$,A,j,D,F,S,T,L,R,B,M;return[e("div",we,[e("div",ke,[e("div",Ce,[e("div",null,[t[0]||(t[0]=e("h1",{class:"text-2xl sm:text-3xl font-bold text-foreground"},"Tableau de bord",-1)),e("p",$e,"Bienvenue "+n((d=N.value)==null?void 0:d.name),1)]),e("div",Ae,[(i(),a(z,null,q(se,o=>e("button",{key:o.value,onClick:x=>P.value=o.value,class:g(["px-3 sm:px-4 py-1.5 sm:py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors whitespace-nowrap",P.value===o.value?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"])},n(o.label),11,je)),64))])])]),O.value?(i(),a("div",De,[...t[1]||(t[1]=[e("div",{class:"animate-spin rounded-full h-10 w-10 sm:h-12 sm:w-12 border-b-2 border-primary"},null,-1)])])):(i(),a("div",Fe,[e("div",Se,[e("div",Te,[e("div",Le,[t[2]||(t[2]=e("h3",{class:"text-xs sm:text-sm font-medium text-muted-foreground"},"Messages Envoyés",-1)),v(_(G),{class:"w-5 h-5 sm:w-6 sm:h-6 lg:w-8 lg:h-8 text-primary flex-shrink-0"})]),e("p",Re,n(f(((m=r.value)==null?void 0:m.total_sent)||0)),1),e("p",{class:g(["text-xs mt-1 sm:mt-2 hidden sm:block",U((u=(c=r.value)==null?void 0:c.trends)==null?void 0:u.sent)])},n(X((b=(p=r.value)==null?void 0:p.trends)==null?void 0:b.sent)),3)]),e("div",Be,[e("div",Me,[t[3]||(t[3]=e("h3",{class:"text-xs sm:text-sm font-medium text-muted-foreground"},"Messages Livrés",-1)),v(_(ee),{class:"w-5 h-5 sm:w-6 sm:h-6 lg:w-8 lg:h-8 text-success flex-shrink-0"})]),e("p",Ee,n(f(((h=r.value)==null?void 0:h.total_delivered)||0)),1),e("p",{class:g(["text-xs mt-1 sm:mt-2 hidden sm:block",U((w=(y=r.value)==null?void 0:y.trends)==null?void 0:w.delivered)])},n(X((C=(k=r.value)==null?void 0:k.trends)==null?void 0:C.delivered)),3)]),e("div",Ie,[e("div",Ne,[t[4]||(t[4]=e("h3",{class:"text-xs sm:text-sm font-medium text-muted-foreground"},"Taux Livraison",-1)),v(_(_e),{class:"w-5 h-5 sm:w-6 sm:h-6 lg:w-8 lg:h-8 text-primary flex-shrink-0"})]),e("p",Pe,n(((A=($=r.value)==null?void 0:$.delivery_rate)==null?void 0:A.toFixed(1))||0)+"%",1),e("p",{class:g(["text-xs mt-1 sm:mt-2 hidden sm:block",re((j=r.value)==null?void 0:j.delivery_rate)])},n(oe((D=r.value)==null?void 0:D.delivery_rate)),3)]),e("div",qe,[e("div",ze,[t[5]||(t[5]=e("h3",{class:"text-xs sm:text-sm font-medium text-muted-foreground"},"Coût Total",-1)),v(_(pe),{class:"w-5 h-5 sm:w-6 sm:h-6 lg:w-8 lg:h-8 text-primary flex-shrink-0"})]),e("p",Ve,n(H(((F=r.value)==null?void 0:F.total_cost)||0)),1),e("p",{class:g(["text-xs mt-1 sm:mt-2 hidden sm:block",U((T=(S=r.value)==null?void 0:S.trends)==null?void 0:T.cost)])},n(X((R=(L=r.value)==null?void 0:L.trends)==null?void 0:R.cost)),3)])]),e("div",Ke,[e("div",Oe,[t[7]||(t[7]=e("div",{class:"p-4 sm:p-6 border-b border-border"},[e("h2",{class:"text-base sm:text-lg lg:text-xl font-semibold"},"Répartition par Fournisseur")],-1)),e("div",Ue,[(B=r.value)!=null&&B.by_provider&&Object.keys(r.value.by_provider).length>0?(i(),a("div",Xe,[(i(!0),a(z,null,q(r.value.by_provider,(o,x)=>{var E;return i(),a("div",{key:x,class:"space-y-1.5 sm:space-y-2"},[e("div",Ge,[e("span",He,n(x),1),e("span",Je,n(f(o.sent))+" messages",1)]),e("div",Qe,[e("div",{class:g(["h-2 rounded-full",x==="Airtel"?"bg-red-500":"bg-yellow-500"]),style:Y({width:`${(o.sent/r.value.total_sent*100).toFixed(1)}%`})},null,6)]),e("div",We,[e("span",null,"Livrés: "+n((E=o.delivered_rate)==null?void 0:E.toFixed(1))+"%",1),e("span",null,"Coût: "+n(H(o.total_cost)),1)])])}),128))])):(i(),a("div",Ye,[...t[6]||(t[6]=[e("p",{class:"text-xs sm:text-sm"},"Aucune donnée disponible",-1)])]))])]),e("div",Ze,[t[10]||(t[10]=e("div",{class:"p-4 sm:p-6 border-b border-border"},[e("h2",{class:"text-base sm:text-lg lg:text-xl font-semibold"},"Crédits Restants")],-1)),e("div",et,[((M=r.value)==null?void 0:M.credits_remaining)!==void 0?(i(),a("div",tt,[e("div",st,[e("p",rt,n(f(r.value.credits_remaining)),1),t[8]||(t[8]=e("p",{class:"text-xs sm:text-sm text-muted-foreground mt-1 sm:mt-2"},"crédits disponibles",-1))]),e("div",ot,[e("div",{class:g(["h-full rounded-full transition-all",ne(r.value.credits_remaining,r.value.initial_credits)]),style:Y({width:`${J(r.value.credits_remaining,r.value.initial_credits)}%`})},null,6)]),e("div",nt,[e("span",null,"Utilisés: "+n(f((r.value.initial_credits||0)-r.value.credits_remaining)),1),e("span",null,"Total: "+n(f(r.value.initial_credits||0)),1)])])):(i(),a("div",lt,[...t[9]||(t[9]=[e("p",{class:"text-xs sm:text-sm"},"Aucune donnée disponible",-1)])]))])])]),e("div",it,[e("div",dt,[t[12]||(t[12]=e("div",{class:"p-4 sm:p-6 border-b border-border"},[e("h2",{class:"text-base sm:text-lg lg:text-xl font-semibold"},"Campagnes Récentes")],-1)),e("div",at,[V.value.length>0?(i(),a("div",ct,[(i(!0),a(z,null,q(V.value,o=>(i(),a("div",{key:o.id,class:"mb-3 sm:mb-4 last:mb-0 pb-3 sm:pb-4 last:pb-0 border-b last:border-b-0 border-border"},[e("div",mt,[e("h3",ut,n(o.name),1),e("span",{class:g(["text-xs px-2 py-0.5 sm:py-1 rounded-full flex-shrink-0",de(o.status)])},n(ae(o.status)),3)]),e("div",xt,[e("span",gt,[v(_(G),{class:"w-3 h-3 sm:w-4 sm:h-4"}),Z(" "+n(o.messages_sent||o.sent||0)+" envoyés ",1)]),e("span",ft,[v(_(ee),{class:"w-3 h-3 sm:w-4 sm:h-4"}),Z(" "+n(o.delivery_rate||o.delivered||0)+"% livrés ",1)])])]))),128))])):(i(),a("div",vt,[...t[11]||(t[11]=[e("p",{class:"text-xs sm:text-sm"},"Aucune campagne récente",-1)])]))])]),e("div",_t,[t[14]||(t[14]=e("div",{class:"p-4 sm:p-6 border-b border-border"},[e("h2",{class:"text-base sm:text-lg lg:text-xl font-semibold"},"Activité Récente")],-1)),e("div",pt,[K.value.length>0?(i(),a("div",bt,[(i(!0),a(z,null,q(K.value,o=>(i(),a("div",{key:o.id,class:"mb-3 sm:mb-4 last:mb-0 flex items-start gap-2 sm:gap-3"},[(i(),W(ve(o.icon),{class:"w-4 h-4 sm:w-5 sm:h-5 text-muted-foreground flex-shrink-0 mt-0.5"})),e("div",ht,[e("p",yt,n(o.title),1),e("p",wt,n(o.time),1)])]))),128))])):(i(),a("div",kt,[...t[13]||(t[13]=[e("p",{class:"text-xs sm:text-sm"},"Aucune activité récente",-1)])]))])])])]))])]}),_:1}))}});export{St as default};
