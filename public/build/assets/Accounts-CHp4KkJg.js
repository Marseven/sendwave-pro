import{o as r,c as n,b as t,d as Xe,u as Be,r as u,l as De,m as Ie,n as Pe,p as Ge,y as i,x as a,i as w,s as A,g as m,F as _,q as C,t as d,f as c,C as ne,w as G,v as x,D as He}from"./main-UaaAXq3j.js";import{_ as Ze,f,c as fe,m as le,q as be,h as H}from"./api-BJ6p3KSv.js";import{b as g,a as h,s as Z}from"./notifications-CHQAjgV4.js";import{r as ve}from"./BuildingOfficeIcon-BZm7gVlG.js";import{r as Je}from"./ShieldCheckIcon-CO19I65R.js";import{r as xe}from"./KeyIcon-DJxB1Bqt.js";import{r as ie}from"./PencilIcon-QercQTqG.js";import{r as Ke}from"./BanknotesIcon-B65GC1X4.js";import{r as ge}from"./CheckCircleIcon-GJHpKaSm.js";import{r as ye}from"./TrashIcon-DLe5lLvn.js";import{r as Oe}from"./DocumentDuplicateIcon-B0ZCTnJb.js";import{r as we}from"./InformationCircleIcon-MNFWTZxt.js";function he(ke,b){return r(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11.42 15.17 17.25 21A2.652 2.652 0 0 0 21 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 1 1-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 0 0 4.486-6.336l-3.276 3.277a3.004 3.004 0 0 1-2.25-2.25l3.276-3.276a4.5 4.5 0 0 0-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437 1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008Z"})])}const Qe={class:"p-4 sm:p-6 lg:p-8"},We={class:"mb-6 border-b overflow-x-auto"},Ye={class:"flex gap-2 sm:gap-4 -mb-px min-w-max"},et={key:0},tt={class:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3"},st={key:0,class:"flex items-center justify-center py-8"},ot={key:1,class:"flex flex-col items-center justify-center py-12 rounded-lg border bg-card"},rt={key:2,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"},nt={class:"p-4 sm:p-5"},lt={class:"flex items-start justify-between gap-2 mb-3"},it={class:"flex-1 min-w-0"},dt={class:"font-semibold text-base truncate"},at={class:"text-xs text-muted-foreground mt-0.5 truncate"},ut={class:"grid grid-cols-2 gap-3 text-sm mb-4"},mt={class:"font-semibold text-primary"},pt={class:"font-semibold"},ct={class:"font-semibold"},ft={class:"font-semibold"},bt={class:"flex flex-wrap gap-2 pt-3 border-t"},vt=["onClick"],xt=["onClick"],gt=["onClick"],yt=["onClick"],wt={key:1},ht={class:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3"},kt={class:"flex items-center gap-3"},_t={class:"text-sm text-muted-foreground"},Ct=["value"],jt={key:0,class:"flex items-center justify-center py-8"},$t={key:1,class:"flex flex-col items-center justify-center py-12 rounded-lg border bg-card"},At={key:2,class:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"},Ut={class:"p-4 sm:p-5"},St={class:"flex items-start justify-between gap-2 mb-3"},Mt={class:"flex-1 min-w-0"},Rt={class:"font-semibold text-base truncate"},Et={class:"text-xs text-muted-foreground mt-0.5 truncate"},Nt={key:0,class:"text-xs text-primary mt-0.5 truncate"},Vt={class:"flex items-center gap-2 mb-3"},zt={class:"flex flex-wrap gap-2 pt-3 border-t"},qt=["onClick"],Lt=["onClick"],Tt=["onClick"],Ft=["onClick"],Xt={key:2},Bt={class:"mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3"},Dt={key:0,class:"flex items-center justify-center py-8"},It={key:1,class:"flex flex-col items-center justify-center py-12 rounded-lg border bg-card"},Pt={key:2,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"},Gt={class:"p-4 sm:p-5"},Ht={class:"flex items-start justify-between gap-2 mb-2"},Zt={class:"font-semibold text-base"},Jt={key:0,class:"text-xs px-2 py-0.5 rounded-full bg-muted"},Kt={class:"text-xs text-muted-foreground mb-3"},Ot={class:"flex flex-wrap gap-1 mb-3"},Qt={key:0,class:"text-xs px-1.5 py-0.5 rounded bg-muted"},Wt={class:"flex flex-wrap gap-2 pt-3 border-t"},Yt=["onClick"],es=["onClick"],ts=["onClick"],ss={key:3},os={class:"mb-4"},rs={class:"flex items-center gap-2 mb-2"},ns={key:0,class:"flex items-center justify-center py-8"},ls={key:1,class:"grid grid-cols-1 md:grid-cols-3 gap-4"},is={class:"p-4 sm:p-5"},ds={class:"flex items-start justify-between gap-2 mb-2"},as={class:"font-semibold text-base"},us={class:"text-xs px-2 py-0.5 rounded-full bg-muted"},ms={class:"text-xs text-muted-foreground mb-3"},ps={class:"mb-2"},cs={class:"flex flex-wrap gap-1 max-h-24 overflow-y-auto"},fs={key:4},bs={class:"mb-4"},vs={class:"flex items-center gap-2 mb-2"},xs={key:0,class:"flex items-center justify-center py-8"},gs={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},ys={class:"p-4 sm:p-5"},ws={class:"font-semibold text-base mb-3 capitalize"},hs={class:"space-y-2"},ks={class:"text-sm font-medium"},_s={class:"text-xs text-muted-foreground"},Cs={key:5,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},js={class:"relative bg-background rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto"},$s={class:"sticky top-0 bg-background border-b p-4 flex items-center justify-between"},As={class:"text-lg font-semibold"},Us={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ss={key:0,class:"border-t pt-4 mt-4"},Ms={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Rs={class:"md:col-span-2"},Es={class:"flex justify-end gap-3 pt-4 border-t"},Ns=["disabled"],Vs={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},zs={key:6,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},qs={class:"relative bg-background rounded-lg shadow-lg w-full max-w-md"},Ls={class:"p-4 border-b flex items-center justify-between"},Ts={class:"text-sm text-muted-foreground"},Fs={class:"text-sm"},Xs={class:"font-semibold text-primary"},Bs={class:"flex justify-end gap-3 pt-4 border-t"},Ds=["disabled"],Is={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Ps={key:7,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},Gs={class:"relative bg-background rounded-lg shadow-lg w-full max-w-lg max-h-[90vh] overflow-y-auto"},Hs={class:"sticky top-0 bg-background border-b p-4 flex items-center justify-between"},Zs={class:"text-lg font-semibold"},Js={key:0},Ks={key:1},Os=["value"],Qs=["value"],Ws={class:"flex justify-end gap-3 pt-4 border-t"},Ys=["disabled"],eo={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},to={key:8,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},so={class:"relative bg-background rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto"},oo={class:"sticky top-0 bg-background border-b p-4 flex items-center justify-between"},ro={class:"text-lg font-semibold"},no={class:"border rounded-lg p-3 max-h-64 overflow-y-auto"},lo={class:"text-xs font-semibold uppercase text-muted-foreground mb-2"},io={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},ao=["value"],uo={class:"text-sm"},mo={class:"flex justify-end gap-3 pt-4 border-t"},po=["disabled"],co={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Ao=Xe({__name:"Accounts",setup(ke){const b=Be(),v=u(b.isSuperAdmin?"accounts":b.canManageUsers?"users":"system-roles");De(()=>b.isSuperAdmin,o=>{o&&v.value==="users"&&(v.value="accounts")},{immediate:!0});const J=u(!1),K=u(!1),O=u(!1),Q=u(!1),W=u(!1),z=u(!1),q=u(!1),L=u(!1),T=u(!1),M=u([]),Y=u([]),ee=u([]),de=u([]),te=u({}),ae=u([]),F=u(""),se=u(!1),oe=u(!1),re=u(!1),R=u(!1),U=u(null),S=u(null),E=u(null),p=u({name:"",email:"",phone:"",company_id:"",sms_credits:0,monthly_budget:null,admin_name:"",admin_email:"",admin_password:""}),k=u({name:"",email:"",password:"",role:"agent",account_id:""}),$=u({name:"",description:"",permissions:[]}),j=u({accountId:0,accountName:"",currentCredits:0,amount:0,note:""}),ue={active:"Actif",suspended:"Suspendu",pending:"En attente"},_e={super_admin:"Super Admin",admin:"Admin",agent:"Agent"};function X(o){return new Intl.NumberFormat("fr-FR").format(o)}async function V(){if(b.isSuperAdmin){J.value=!0;try{const o=await f.get("/accounts");M.value=o.data.data||[]}catch{g("Erreur lors du chargement des comptes")}finally{J.value=!1}}}async function N(){K.value=!0;try{const o={};F.value&&(o.account_id=F.value);const s=(await f.get("/users",{params:o})).data.data;Y.value=Array.isArray(s)?s:(s==null?void 0:s.data)||[]}catch{g("Erreur lors du chargement des utilisateurs")}finally{K.value=!1}}async function B(){if(b.isSuperAdmin){O.value=!0;try{const o=await f.get("/custom-roles");ee.value=o.data.data||[]}catch{g("Erreur lors du chargement des rôles personnalisés")}finally{O.value=!1}}}async function Ce(){Q.value=!0;try{const o=await f.get("/system-roles");de.value=o.data.data||[]}catch{g("Erreur lors du chargement des rôles système")}finally{Q.value=!1}}async function je(){W.value=!0;try{const o=await f.get("/system-permissions");te.value=o.data.data||{}}catch{g("Erreur lors du chargement des permissions")}finally{W.value=!1}}async function $e(){try{const o=await f.get("/users/available-roles");ae.value=o.data.data||[]}catch(o){console.error("Error loading roles:",o)}}function me(o){U.value=o||null,o?p.value={name:o.name,email:o.email,phone:o.phone||"",company_id:o.company_id||"",sms_credits:o.sms_credits||0,monthly_budget:o.monthly_budget,admin_name:"",admin_email:"",admin_password:""}:p.value={name:"",email:"",phone:"",company_id:"",sms_credits:0,monthly_budget:null,admin_name:"",admin_email:"",admin_password:""},se.value=!0}function D(){se.value=!1,U.value=null}async function Ae(){var o,e;z.value=!0;try{U.value?(await f.put(`/accounts/${U.value.id}`,p.value),h("Compte mis à jour avec succès")):(await f.post("/accounts",p.value),h("Compte créé avec succès")),D(),await V()}catch(s){g(((e=(o=s.response)==null?void 0:o.data)==null?void 0:e.message)||"Erreur lors de la sauvegarde")}finally{z.value=!1}}function Ue(o){j.value={accountId:o.id,accountName:o.name,currentCredits:o.sms_credits,amount:0,note:""},R.value=!0}async function Se(){var o,e;T.value=!0;try{await f.post(`/accounts/${j.value.accountId}/credits`,{amount:j.value.amount,note:j.value.note}),h(`${j.value.amount} crédits ajoutés avec succès`),R.value=!1,await V()}catch(s){g(((e=(o=s.response)==null?void 0:o.data)==null?void 0:e.message)||"Erreur lors de l'ajout des crédits")}finally{T.value=!1}}async function Me(o){var s,l;if(await Z("Suspendre ce compte ?","Tous les utilisateurs de ce compte seront également suspendus."))try{await f.post(`/accounts/${o.id}/suspend`),h("Compte suspendu"),await V()}catch(y){g(((l=(s=y.response)==null?void 0:s.data)==null?void 0:l.message)||"Erreur lors de la suspension")}}async function Re(o){var e,s;try{await f.post(`/accounts/${o.id}/activate`),h("Compte activé"),await V()}catch(l){g(((s=(e=l.response)==null?void 0:e.data)==null?void 0:s.message)||"Erreur lors de l'activation")}}function pe(o){var e;S.value=o||null,o?k.value={name:o.name,email:o.email,password:"",role:o.role,account_id:o.account_id||""}:k.value={name:"",email:"",password:"",role:"agent",account_id:((e=b.user)==null?void 0:e.account_id)||""},oe.value=!0}function I(){oe.value=!1,S.value=null}async function Ee(){var o,e;q.value=!0;try{const s={...k.value};s.password||delete s.password,s.account_id||delete s.account_id,S.value?(await f.put(`/users/${S.value.id}`,s),h("Utilisateur mis à jour")):(await f.post("/users",s),h("Utilisateur créé")),I(),await N()}catch(s){g(((e=(o=s.response)==null?void 0:o.data)==null?void 0:e.message)||"Erreur lors de la sauvegarde")}finally{q.value=!1}}async function Ne(o){var s,l;if(await Z("Suspendre cet utilisateur ?"))try{await f.post(`/users/${o.id}/suspend`),h("Utilisateur suspendu"),await N()}catch(y){g(((l=(s=y.response)==null?void 0:s.data)==null?void 0:l.message)||"Erreur lors de la suspension")}}async function Ve(o){var e,s;try{await f.post(`/users/${o.id}/activate`),h("Utilisateur activé"),await N()}catch(l){g(((s=(e=l.response)==null?void 0:e.data)==null?void 0:s.message)||"Erreur lors de l'activation")}}async function ze(o){var s,l;if(await Z("Supprimer cet utilisateur ?","Cette action est irréversible."))try{await f.delete(`/users/${o.id}`),h("Utilisateur supprimé"),await N()}catch(y){g(((l=(s=y.response)==null?void 0:s.data)==null?void 0:l.message)||"Erreur lors de la suppression")}}function ce(o){E.value=o||null,o?$.value={name:o.name,description:o.description||"",permissions:[...o.permissions||[]]}:$.value={name:"",description:"",permissions:[]},re.value=!0}function P(){re.value=!1,E.value=null}async function qe(){var o,e;L.value=!0;try{E.value?(await f.put(`/custom-roles/${E.value.id}`,$.value),h("Rôle mis à jour")):(await f.post("/custom-roles",$.value),h("Rôle créé")),P(),await B()}catch(s){g(((e=(o=s.response)==null?void 0:o.data)==null?void 0:e.message)||"Erreur lors de la sauvegarde")}finally{L.value=!1}}async function Le(o){var e,s;try{await f.post(`/custom-roles/${o.id}/duplicate`),h("Rôle dupliqué"),await B()}catch(l){g(((s=(e=l.response)==null?void 0:e.data)==null?void 0:s.message)||"Erreur lors de la duplication")}}async function Te(o){var s,l;if(await Z("Supprimer ce rôle ?"))try{await f.delete(`/custom-roles/${o.id}`),h("Rôle supprimé"),await B()}catch(y){g(((l=(s=y.response)==null?void 0:s.data)==null?void 0:l.message)||"Erreur lors de la suppression")}}return Ie(async()=>{await Promise.all([V(),N(),B(),Ce(),je(),$e()])}),(o,e)=>(r(),Pe(Ze,null,{default:Ge(()=>[t("div",Qe,[e[89]||(e[89]=t("div",{class:"mb-4 sm:mb-6 lg:mb-8"},[t("h1",{class:"text-2xl sm:text-3xl font-bold"},"Gestion des comptes"),t("p",{class:"text-sm text-muted-foreground mt-1 sm:mt-2"}," Gérez les comptes, utilisateurs et rôles de la plateforme ")],-1)),t("div",We,[t("nav",Ye,[i(b).isSuperAdmin?(r(),n("button",{key:0,onClick:e[0]||(e[0]=s=>v.value="accounts"),class:A(["py-3 px-2 sm:px-3 text-xs sm:text-sm font-medium border-b-2 transition-colors whitespace-nowrap",v.value==="accounts"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])},[a(i(ve),{class:"w-4 h-4 inline mr-1 sm:mr-2"}),e[31]||(e[31]=w(" Comptes ",-1))],2)):m("",!0),i(b).canManageUsers?(r(),n("button",{key:1,onClick:e[1]||(e[1]=s=>v.value="users"),class:A(["py-3 px-2 sm:px-3 text-xs sm:text-sm font-medium border-b-2 transition-colors whitespace-nowrap",v.value==="users"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])},[a(i(fe),{class:"w-4 h-4 inline mr-1 sm:mr-2"}),e[32]||(e[32]=w(" Utilisateurs ",-1))],2)):m("",!0),i(b).isSuperAdmin?(r(),n("button",{key:2,onClick:e[2]||(e[2]=s=>v.value="custom-roles"),class:A(["py-3 px-2 sm:px-3 text-xs sm:text-sm font-medium border-b-2 transition-colors whitespace-nowrap",v.value==="custom-roles"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])},[a(i(he),{class:"w-4 h-4 inline mr-1 sm:mr-2"}),e[33]||(e[33]=w(" Rôles personnalisés ",-1))],2)):m("",!0),t("button",{onClick:e[3]||(e[3]=s=>v.value="system-roles"),class:A(["py-3 px-2 sm:px-3 text-xs sm:text-sm font-medium border-b-2 transition-colors whitespace-nowrap",v.value==="system-roles"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])},[a(i(Je),{class:"w-4 h-4 inline mr-1 sm:mr-2"}),e[34]||(e[34]=w(" Rôles système ",-1))],2),t("button",{onClick:e[4]||(e[4]=s=>v.value="permissions"),class:A(["py-3 px-2 sm:px-3 text-xs sm:text-sm font-medium border-b-2 transition-colors whitespace-nowrap",v.value==="permissions"?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground"])},[a(i(xe),{class:"w-4 h-4 inline mr-1 sm:mr-2"}),e[35]||(e[35]=w(" Permissions ",-1))],2)])]),v.value==="accounts"&&i(b).isSuperAdmin?(r(),n("div",et,[t("div",tt,[e[37]||(e[37]=t("p",{class:"text-sm text-muted-foreground"}," Gérez les comptes (entreprises/organisations) de la plateforme ",-1)),t("button",{onClick:e[5]||(e[5]=s=>me()),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-xs sm:text-sm font-medium transition-colors bg-primary text-primary-foreground hover:bg-primary/90 h-9 sm:h-10 px-3 sm:px-4 py-2"},[a(i(le),{class:"w-4 h-4"}),e[36]||(e[36]=t("span",null,"Nouveau compte",-1))])]),J.value?(r(),n("div",st,[...e[38]||(e[38]=[t("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"},null,-1)])])):M.value.length===0?(r(),n("div",ot,[a(i(ve),{class:"w-12 h-12 text-muted-foreground mb-4"}),e[39]||(e[39]=t("p",{class:"text-lg font-medium"},"Aucun compte",-1)),e[40]||(e[40]=t("p",{class:"text-sm text-muted-foreground mt-1"},"Créez votre premier compte",-1))])):(r(),n("div",rt,[(r(!0),n(_,null,C(M.value,s=>(r(),n("div",{key:s.id,class:"rounded-lg border bg-card shadow-sm hover:shadow-md transition-shadow"},[t("div",nt,[t("div",lt,[t("div",it,[t("h3",dt,d(s.name),1),t("p",at,d(s.email),1)]),t("span",{class:A(["text-xs px-2 py-0.5 rounded-full font-medium flex-shrink-0",{"bg-green-100 text-green-700":s.status==="active","bg-red-100 text-red-700":s.status==="suspended","bg-yellow-100 text-yellow-700":s.status==="pending"}])},d(ue[s.status]),3)]),t("div",ut,[t("div",null,[e[41]||(e[41]=t("p",{class:"text-xs text-muted-foreground"},"Crédits SMS",-1)),t("p",mt,d(X(s.sms_credits)),1)]),t("div",null,[e[42]||(e[42]=t("p",{class:"text-xs text-muted-foreground"},"Utilisateurs",-1)),t("p",pt,d(s.users_count||0),1)]),t("div",null,[e[43]||(e[43]=t("p",{class:"text-xs text-muted-foreground"},"SMS envoyés",-1)),t("p",ct,d(X(s.sms_sent_total)),1)]),t("div",null,[e[44]||(e[44]=t("p",{class:"text-xs text-muted-foreground"},"Budget mensuel",-1)),t("p",ft,d(s.monthly_budget?X(s.monthly_budget):"Illimité"),1)])]),t("div",bt,[t("button",{onClick:l=>me(s),class:"flex-1 inline-flex items-center justify-center gap-1 text-xs font-medium rounded-md border px-2 py-1.5 hover:bg-accent"},[a(i(ie),{class:"w-3 h-3"}),e[45]||(e[45]=w(" Modifier ",-1))],8,vt),t("button",{onClick:l=>Ue(s),class:"flex-1 inline-flex items-center justify-center gap-1 text-xs font-medium rounded-md border px-2 py-1.5 hover:bg-accent"},[a(i(Ke),{class:"w-3 h-3"}),e[46]||(e[46]=w(" Crédits ",-1))],8,xt),s.status==="active"?(r(),n("button",{key:0,onClick:l=>Me(s),class:"inline-flex items-center justify-center gap-1 text-xs font-medium rounded-md border border-destructive text-destructive px-2 py-1.5 hover:bg-destructive/10"},[a(i(be),{class:"w-3 h-3"})],8,gt)):(r(),n("button",{key:1,onClick:l=>Re(s),class:"inline-flex items-center justify-center gap-1 text-xs font-medium rounded-md border border-success text-success px-2 py-1.5 hover:bg-success/10"},[a(i(ge),{class:"w-3 h-3"})],8,yt))])])]))),128))]))])):m("",!0),v.value==="users"&&i(b).canManageUsers?(r(),n("div",wt,[t("div",ht,[t("div",kt,[t("p",_t,d(i(b).isSuperAdmin?"Gérez tous les utilisateurs":"Gérez les utilisateurs de votre compte"),1),i(b).isSuperAdmin&&M.value.length>0?c((r(),n("select",{key:0,"onUpdate:modelValue":e[6]||(e[6]=s=>F.value=s),onChange:N,class:"text-sm rounded-md border border-input bg-background px-2 py-1"},[e[47]||(e[47]=t("option",{value:""},"Tous les comptes",-1)),(r(!0),n(_,null,C(M.value,s=>(r(),n("option",{key:s.id,value:s.id},d(s.name),9,Ct))),128))],544)),[[ne,F.value]]):m("",!0)]),i(b).canCreateAgents?(r(),n("button",{key:0,onClick:e[7]||(e[7]=s=>pe()),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-xs sm:text-sm font-medium transition-colors bg-primary text-primary-foreground hover:bg-primary/90 h-9 sm:h-10 px-3 sm:px-4 py-2"},[a(i(le),{class:"w-4 h-4"}),t("span",null,d(i(b).isSuperAdmin?"Nouvel utilisateur":"Nouvel agent"),1)])):m("",!0)]),K.value?(r(),n("div",jt,[...e[48]||(e[48]=[t("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"},null,-1)])])):Y.value.length===0?(r(),n("div",$t,[a(i(fe),{class:"w-12 h-12 text-muted-foreground mb-4"}),e[49]||(e[49]=t("p",{class:"text-lg font-medium"},"Aucun utilisateur",-1)),e[50]||(e[50]=t("p",{class:"text-sm text-muted-foreground mt-1"},"Créez votre premier utilisateur",-1))])):(r(),n("div",At,[(r(!0),n(_,null,C(Y.value,s=>(r(),n("div",{key:s.id,class:"rounded-lg border bg-card shadow-sm hover:shadow-md transition-shadow"},[t("div",Ut,[t("div",St,[t("div",Mt,[t("h3",Rt,d(s.name),1),t("p",Et,d(s.email),1),s.account?(r(),n("p",Nt,d(s.account.name),1)):m("",!0)]),t("span",{class:A(["text-xs px-2 py-0.5 rounded-full font-medium flex-shrink-0",{"bg-green-100 text-green-700":s.status==="active","bg-red-100 text-red-700":s.status==="suspended","bg-yellow-100 text-yellow-700":s.status==="pending"}])},d(ue[s.status]),3)]),t("div",Vt,[t("span",{class:A(["text-xs px-2 py-0.5 rounded-md font-medium",{"bg-purple-100 text-purple-700":s.role==="super_admin","bg-blue-100 text-blue-700":s.role==="admin","bg-teal-100 text-teal-700":s.role==="agent"}])},d(_e[s.role]),3)]),t("div",zt,[t("button",{onClick:l=>pe(s),class:"flex-1 inline-flex items-center justify-center gap-1 text-xs font-medium rounded-md border px-2 py-1.5 hover:bg-accent"},[a(i(ie),{class:"w-3 h-3"}),e[51]||(e[51]=w(" Modifier ",-1))],8,qt),s.status==="active"?(r(),n("button",{key:0,onClick:l=>Ne(s),class:"inline-flex items-center justify-center gap-1 text-xs font-medium rounded-md border border-destructive text-destructive px-2 py-1.5 hover:bg-destructive/10"},[a(i(be),{class:"w-3 h-3"})],8,Lt)):(r(),n("button",{key:1,onClick:l=>Ve(s),class:"inline-flex items-center justify-center gap-1 text-xs font-medium rounded-md border border-success text-success px-2 py-1.5 hover:bg-success/10"},[a(i(ge),{class:"w-3 h-3"})],8,Tt)),t("button",{onClick:l=>ze(s),class:"inline-flex items-center justify-center gap-1 text-xs font-medium rounded-md border border-destructive text-destructive px-2 py-1.5 hover:bg-destructive/10"},[a(i(ye),{class:"w-3 h-3"})],8,Ft)])])]))),128))]))])):m("",!0),v.value==="custom-roles"&&i(b).isSuperAdmin?(r(),n("div",Xt,[t("div",Bt,[e[53]||(e[53]=t("p",{class:"text-sm text-muted-foreground"}," Créez et gérez des rôles personnalisés avec des permissions spécifiques ",-1)),t("button",{onClick:e[8]||(e[8]=s=>ce()),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-xs sm:text-sm font-medium transition-colors bg-primary text-primary-foreground hover:bg-primary/90 h-9 sm:h-10 px-3 sm:px-4 py-2"},[a(i(le),{class:"w-4 h-4"}),e[52]||(e[52]=t("span",null,"Nouveau rôle",-1))])]),O.value?(r(),n("div",Dt,[...e[54]||(e[54]=[t("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"},null,-1)])])):ee.value.length===0?(r(),n("div",It,[a(i(he),{class:"w-12 h-12 text-muted-foreground mb-4"}),e[55]||(e[55]=t("p",{class:"text-lg font-medium"},"Aucun rôle personnalisé",-1)),e[56]||(e[56]=t("p",{class:"text-sm text-muted-foreground mt-1"},"Créez votre premier rôle personnalisé",-1))])):(r(),n("div",Pt,[(r(!0),n(_,null,C(ee.value,s=>(r(),n("div",{key:s.id,class:"rounded-lg border bg-card shadow-sm"},[t("div",Gt,[t("div",Ht,[t("h3",Zt,d(s.name),1),s.is_system?(r(),n("span",Jt,"Système")):m("",!0)]),t("p",Kt,d(s.description||"Aucune description"),1),t("div",Ot,[(r(!0),n(_,null,C((s.permissions||[]).slice(0,4),l=>(r(),n("span",{key:l,class:"text-xs px-1.5 py-0.5 rounded bg-primary/10 text-primary"},d(l),1))),128)),(s.permissions||[]).length>4?(r(),n("span",Qt," +"+d(s.permissions.length-4),1)):m("",!0)]),t("div",Wt,[s.is_system?m("",!0):(r(),n("button",{key:0,onClick:l=>ce(s),class:"flex-1 inline-flex items-center justify-center gap-1 text-xs font-medium rounded-md border px-2 py-1.5 hover:bg-accent"},[a(i(ie),{class:"w-3 h-3"}),e[57]||(e[57]=w(" Modifier ",-1))],8,Yt)),t("button",{onClick:l=>Le(s),class:"flex-1 inline-flex items-center justify-center gap-1 text-xs font-medium rounded-md border px-2 py-1.5 hover:bg-accent"},[a(i(Oe),{class:"w-3 h-3"}),e[58]||(e[58]=w(" Dupliquer ",-1))],8,es),!s.is_system&&(s.users_count||0)===0?(r(),n("button",{key:1,onClick:l=>Te(s),class:"inline-flex items-center justify-center gap-1 text-xs font-medium rounded-md border border-destructive text-destructive px-2 py-1.5 hover:bg-destructive/10"},[a(i(ye),{class:"w-3 h-3"})],8,ts)):m("",!0)])])]))),128))]))])):m("",!0),v.value==="system-roles"?(r(),n("div",ss,[t("div",os,[t("div",rs,[a(i(we),{class:"w-5 h-5 text-muted-foreground"}),e[59]||(e[59]=t("p",{class:"text-sm text-muted-foreground"}," Les rôles système sont prédéfinis et ne peuvent pas être modifiés ",-1))])]),Q.value?(r(),n("div",ns,[...e[60]||(e[60]=[t("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"},null,-1)])])):(r(),n("div",ls,[(r(!0),n(_,null,C(de.value,s=>(r(),n("div",{key:s.value,class:"rounded-lg border bg-card shadow-sm"},[t("div",is,[t("div",ds,[t("h3",as,d(s.label),1),t("span",us,"Niveau "+d(s.level),1)]),t("p",ms,d(s.description),1),t("div",ps,[e[61]||(e[61]=t("p",{class:"text-xs font-medium mb-1"},"Permissions par défaut :",-1)),t("div",cs,[(r(!0),n(_,null,C(s.default_permissions,l=>(r(),n("span",{key:l,class:"text-xs px-1.5 py-0.5 rounded bg-primary/10 text-primary"},d(l),1))),128))])])])]))),128))]))])):m("",!0),v.value==="permissions"?(r(),n("div",fs,[t("div",bs,[t("div",vs,[a(i(we),{class:"w-5 h-5 text-muted-foreground"}),e[62]||(e[62]=t("p",{class:"text-sm text-muted-foreground"}," Liste de toutes les permissions disponibles dans le système ",-1))])]),W.value?(r(),n("div",xs,[...e[63]||(e[63]=[t("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary"},null,-1)])])):(r(),n("div",gs,[(r(!0),n(_,null,C(te.value,(s,l)=>(r(),n("div",{key:l,class:"rounded-lg border bg-card shadow-sm"},[t("div",ys,[t("h3",ws,d(l),1),t("div",hs,[(r(!0),n(_,null,C(s,y=>(r(),n("div",{key:y.value,class:"flex items-start gap-2 p-2 rounded-md bg-muted/50"},[a(i(xe),{class:"w-4 h-4 text-primary flex-shrink-0 mt-0.5"}),t("div",null,[t("p",ks,d(y.label),1),t("p",_s,d(y.value),1)])]))),128))])])]))),128))]))])):m("",!0),se.value?(r(),n("div",Cs,[t("div",{class:"absolute inset-0 bg-black/50",onClick:D}),t("div",js,[t("div",$s,[t("h2",As,d(U.value?"Modifier le compte":"Nouveau compte"),1),t("button",{onClick:D,class:"hover:bg-accent rounded-full p-1"},[a(i(H),{class:"w-5 h-5"})])]),t("form",{onSubmit:G(Ae,["prevent"]),class:"p-4 space-y-4"},[t("div",Us,[t("div",null,[e[64]||(e[64]=t("label",{class:"text-sm font-medium"},"Nom du compte *",-1)),c(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>p.value.name=s),type:"text",required:"",class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Nom de l'entreprise"},null,512),[[x,p.value.name]])]),t("div",null,[e[65]||(e[65]=t("label",{class:"text-sm font-medium"},"Email *",-1)),c(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>p.value.email=s),type:"email",required:"",class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"contact@entreprise.com"},null,512),[[x,p.value.email]])]),t("div",null,[e[66]||(e[66]=t("label",{class:"text-sm font-medium"},"Téléphone",-1)),c(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>p.value.phone=s),type:"text",class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"+229 XX XX XX XX"},null,512),[[x,p.value.phone]])]),t("div",null,[e[67]||(e[67]=t("label",{class:"text-sm font-medium"},"N° Entreprise (SIRET, etc.)",-1)),c(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>p.value.company_id=s),type:"text",class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},null,512),[[x,p.value.company_id]])]),t("div",null,[e[68]||(e[68]=t("label",{class:"text-sm font-medium"},"Crédits SMS initiaux",-1)),c(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>p.value.sms_credits=s),type:"number",min:"0",class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},null,512),[[x,p.value.sms_credits,void 0,{number:!0}]])]),t("div",null,[e[69]||(e[69]=t("label",{class:"text-sm font-medium"},"Budget mensuel",-1)),c(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>p.value.monthly_budget=s),type:"number",min:"0",class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",placeholder:"Laisser vide pour illimité"},null,512),[[x,p.value.monthly_budget,void 0,{number:!0}]])])]),U.value?m("",!0):(r(),n("div",Ss,[e[73]||(e[73]=t("h3",{class:"text-sm font-semibold mb-3"},"Administrateur du compte",-1)),t("div",Ms,[t("div",null,[e[70]||(e[70]=t("label",{class:"text-sm font-medium"},"Nom *",-1)),c(t("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>p.value.admin_name=s),type:"text",required:"",class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},null,512),[[x,p.value.admin_name]])]),t("div",null,[e[71]||(e[71]=t("label",{class:"text-sm font-medium"},"Email *",-1)),c(t("input",{"onUpdate:modelValue":e[16]||(e[16]=s=>p.value.admin_email=s),type:"email",required:"",class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},null,512),[[x,p.value.admin_email]])]),t("div",Rs,[e[72]||(e[72]=t("label",{class:"text-sm font-medium"},"Mot de passe *",-1)),c(t("input",{"onUpdate:modelValue":e[17]||(e[17]=s=>p.value.admin_password=s),type:"password",required:"",minlength:"8",class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},null,512),[[x,p.value.admin_password]])])])])),t("div",Es,[t("button",{type:"button",onClick:D,class:"inline-flex items-center justify-center rounded-md text-sm font-medium border border-input bg-background hover:bg-accent h-10 px-4"}," Annuler "),t("button",{type:"submit",disabled:z.value,class:"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 disabled:opacity-50"},[z.value?(r(),n("div",Vs)):m("",!0),w(" "+d(U.value?"Mettre à jour":"Créer le compte"),1)],8,Ns)])],32)])])):m("",!0),R.value?(r(),n("div",zs,[t("div",{class:"absolute inset-0 bg-black/50",onClick:e[18]||(e[18]=s=>R.value=!1)}),t("div",qs,[t("div",Ls,[e[74]||(e[74]=t("h2",{class:"text-lg font-semibold"},"Ajouter des crédits",-1)),t("button",{onClick:e[19]||(e[19]=s=>R.value=!1),class:"hover:bg-accent rounded-full p-1"},[a(i(H),{class:"w-5 h-5"})])]),t("form",{onSubmit:G(Se,["prevent"]),class:"p-4 space-y-4"},[t("div",null,[e[76]||(e[76]=t("label",{class:"text-sm font-medium"},"Compte",-1)),t("p",Ts,d(j.value.accountName),1),t("p",Fs,[e[75]||(e[75]=w("Solde actuel: ",-1)),t("span",Xs,d(X(j.value.currentCredits)),1)])]),t("div",null,[e[77]||(e[77]=t("label",{class:"text-sm font-medium"},"Montant à ajouter *",-1)),c(t("input",{"onUpdate:modelValue":e[20]||(e[20]=s=>j.value.amount=s),type:"number",min:"1",required:"",class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},null,512),[[x,j.value.amount,void 0,{number:!0}]])]),t("div",null,[e[78]||(e[78]=t("label",{class:"text-sm font-medium"},"Note (optionnel)",-1)),c(t("textarea",{"onUpdate:modelValue":e[21]||(e[21]=s=>j.value.note=s),rows:"2",class:"mt-1 flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm resize-none"},null,512),[[x,j.value.note]])]),t("div",Bs,[t("button",{type:"button",onClick:e[22]||(e[22]=s=>R.value=!1),class:"inline-flex items-center justify-center rounded-md text-sm font-medium border border-input bg-background hover:bg-accent h-10 px-4"}," Annuler "),t("button",{type:"submit",disabled:T.value,class:"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium bg-success text-success-foreground hover:bg-success/90 h-10 px-4 disabled:opacity-50"},[T.value?(r(),n("div",Is)):m("",!0),e[79]||(e[79]=w(" Ajouter ",-1))],8,Ds)])],32)])])):m("",!0),oe.value?(r(),n("div",Ps,[t("div",{class:"absolute inset-0 bg-black/50",onClick:I}),t("div",Gs,[t("div",Hs,[t("h2",Zs,d(S.value?"Modifier l'utilisateur":"Nouvel utilisateur"),1),t("button",{onClick:I,class:"hover:bg-accent rounded-full p-1"},[a(i(H),{class:"w-5 h-5"})])]),t("form",{onSubmit:G(Ee,["prevent"]),class:"p-4 space-y-4"},[t("div",null,[e[80]||(e[80]=t("label",{class:"text-sm font-medium"},"Nom *",-1)),c(t("input",{"onUpdate:modelValue":e[23]||(e[23]=s=>k.value.name=s),type:"text",required:"",class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},null,512),[[x,k.value.name]])]),t("div",null,[e[81]||(e[81]=t("label",{class:"text-sm font-medium"},"Email *",-1)),c(t("input",{"onUpdate:modelValue":e[24]||(e[24]=s=>k.value.email=s),type:"email",required:"",class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},null,512),[[x,k.value.email]])]),S.value?m("",!0):(r(),n("div",Js,[e[82]||(e[82]=t("label",{class:"text-sm font-medium"},"Mot de passe *",-1)),c(t("input",{"onUpdate:modelValue":e[25]||(e[25]=s=>k.value.password=s),type:"password",required:"",minlength:"8",class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},null,512),[[x,k.value.password]])])),i(b).isSuperAdmin?(r(),n("div",Ks,[e[84]||(e[84]=t("label",{class:"text-sm font-medium"},"Compte",-1)),c(t("select",{"onUpdate:modelValue":e[26]||(e[26]=s=>k.value.account_id=s),class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},[e[83]||(e[83]=t("option",{value:""},"Aucun compte",-1)),(r(!0),n(_,null,C(M.value,s=>(r(),n("option",{key:s.id,value:s.id},d(s.name),9,Os))),128))],512),[[ne,k.value.account_id]])])):m("",!0),t("div",null,[e[85]||(e[85]=t("label",{class:"text-sm font-medium"},"Rôle *",-1)),c(t("select",{"onUpdate:modelValue":e[27]||(e[27]=s=>k.value.role=s),required:"",class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},[(r(!0),n(_,null,C(ae.value,s=>(r(),n("option",{key:s.value,value:s.value},d(s.label),9,Qs))),128))],512),[[ne,k.value.role]])]),t("div",Ws,[t("button",{type:"button",onClick:I,class:"inline-flex items-center justify-center rounded-md text-sm font-medium border border-input bg-background hover:bg-accent h-10 px-4"}," Annuler "),t("button",{type:"submit",disabled:q.value,class:"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 disabled:opacity-50"},[q.value?(r(),n("div",eo)):m("",!0),w(" "+d(S.value?"Mettre à jour":"Créer"),1)],8,Ys)])],32)])])):m("",!0),re.value?(r(),n("div",to,[t("div",{class:"absolute inset-0 bg-black/50",onClick:P}),t("div",so,[t("div",oo,[t("h2",ro,d(E.value?"Modifier le rôle":"Nouveau rôle personnalisé"),1),t("button",{onClick:P,class:"hover:bg-accent rounded-full p-1"},[a(i(H),{class:"w-5 h-5"})])]),t("form",{onSubmit:G(qe,["prevent"]),class:"p-4 space-y-4"},[t("div",null,[e[86]||(e[86]=t("label",{class:"text-sm font-medium"},"Nom du rôle *",-1)),c(t("input",{"onUpdate:modelValue":e[28]||(e[28]=s=>$.value.name=s),type:"text",required:"",class:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},null,512),[[x,$.value.name]])]),t("div",null,[e[87]||(e[87]=t("label",{class:"text-sm font-medium"},"Description",-1)),c(t("textarea",{"onUpdate:modelValue":e[29]||(e[29]=s=>$.value.description=s),rows:"2",class:"mt-1 flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm resize-none"},null,512),[[x,$.value.description]])]),t("div",null,[e[88]||(e[88]=t("label",{class:"text-sm font-medium mb-2 block"},"Permissions",-1)),t("div",no,[(r(!0),n(_,null,C(te.value,(s,l)=>(r(),n("div",{key:l,class:"mb-4 last:mb-0"},[t("p",lo,d(l),1),t("div",io,[(r(!0),n(_,null,C(s,y=>(r(),n("label",{key:y.value,class:"flex items-center gap-2 p-2 rounded hover:bg-accent cursor-pointer"},[c(t("input",{type:"checkbox",value:y.value,"onUpdate:modelValue":e[30]||(e[30]=Fe=>$.value.permissions=Fe),class:"rounded"},null,8,ao),[[He,$.value.permissions]]),t("span",uo,d(y.label),1)]))),128))])]))),128))])]),t("div",mo,[t("button",{type:"button",onClick:P,class:"inline-flex items-center justify-center rounded-md text-sm font-medium border border-input bg-background hover:bg-accent h-10 px-4"}," Annuler "),t("button",{type:"submit",disabled:L.value,class:"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 disabled:opacity-50"},[L.value?(r(),n("div",co)):m("",!0),w(" "+d(E.value?"Mettre à jour":"Créer"),1)],8,po)])],32)])])):m("",!0)])]),_:1}))}});export{Ao as default};
