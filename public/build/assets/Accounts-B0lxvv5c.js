import{o as n,c as r,b as e,d as se,r as f,l as te,m as ie,n as oe,p as ne,x as v,y as g,F as z,q as D,t as c,s as B,z as re,g as x,w as U,f as y,v as E,C as F,D as I}from"./main-O15x8ipR.js";import{f as b,_ as le,i as ae}from"./api-Btj27xra.js";import{b as _,a as k,s as L}from"./notifications-CHQAjgV4.js";import{r as de}from"./UserGroupIcon-C1RtCXHM.js";import{r as ue}from"./PencilIcon-BgholsTl.js";import{r as ce}from"./KeyIcon-BYXogAto.js";import{r as me}from"./TrashIcon-3grKhQhm.js";import{r as N}from"./XMarkIcon-Bm-MPaTR.js";function fe(d,u){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"})])}function pe(d,u){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 10.5V6.75a4.5 4.5 0 1 1 9 0v3.75M3.75 21.75h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H3.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"})])}const $={async getAll(){const d=await b.get("/sub-accounts");return d.data.data||d.data},async getById(d){const u=await b.get(`/sub-accounts/${d}`);return u.data.data||u.data},async create(d){const u=await b.post("/sub-accounts",d);return u.data.data||u.data},async update(d,u){const p=await b.put(`/sub-accounts/${d}`,u);return p.data.data||p.data},async delete(d){await b.delete(`/sub-accounts/${d}`)},async recharge(d,u){const p=await b.post(`/sub-accounts/${d}/recharge`,{amount:u});return p.data.data||p.data}},ve={class:"p-8"},ge={class:"mb-8 flex items-center justify-between"},be={key:0,class:"flex items-center justify-center py-12"},xe={key:1,class:"flex flex-col items-center justify-center py-12 rounded-lg border bg-card"},ye={key:2,class:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6"},he={class:"p-6"},we={class:"flex items-start justify-between mb-4"},_e={class:"flex-1"},ke={class:"font-semibold text-lg"},Ce={class:"text-sm text-muted-foreground mt-1"},Se={class:"flex items-center gap-2 mb-4"},Me={class:"space-y-3 mb-4"},je={class:"flex justify-between items-center text-sm"},Ae={class:"font-semibold"},Ee={class:"flex justify-between items-center text-sm"},$e={key:0,class:"w-full bg-gray-200 rounded-full h-2"},Ve={key:1,class:"text-xs text-muted-foreground"},qe={class:"border-t p-4 bg-muted/30 flex gap-2"},Pe=["onClick"],Ue=["onClick"],ze=["onClick"],De=["onClick"],Be=["onClick"],Fe={class:"bg-background rounded-lg shadow-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto"},Ie={class:"sticky top-0 bg-background border-b p-6"},Le={class:"flex items-center justify-between"},Ne={class:"text-xl font-bold"},Ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Re={class:"space-y-2"},He={class:"space-y-2"},Te=["disabled"],Ze={key:0,class:"space-y-2"},Je=["required"],Oe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ke={class:"space-y-2"},Qe={class:"space-y-2"},We={class:"space-y-2"},Xe={class:"flex gap-2"},Ye=["disabled"],es={class:"inline-flex items-center gap-2 px-4 py-2 border rounded-md cursor-pointer hover:bg-accent"},ss={class:"flex gap-3 pt-4 border-t"},ts=["disabled"],is={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},os={class:"bg-background rounded-lg shadow-lg w-full max-w-lg"},ns={class:"border-b p-6"},rs={class:"flex items-center justify-between"},ls={class:"text-sm text-muted-foreground mt-1"},as={class:"p-6 space-y-4"},ds=["value","id"],us=["for"],cs={class:"font-medium"},ms={class:"text-sm text-muted-foreground"},fs={class:"border-t p-6 flex gap-3"},ps=["disabled"],vs={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Cs=se({__name:"Accounts",setup(d){const u=f([]),p=f(!1),C=f(!1),S=f(!1),V=f(!1),q=f(!1),P=f(!1),l=f(null),h=f(!1),M=f([]),a=f({name:"",email:"",password:"",role:"sender",status:"active",sms_credit_limit:null}),G={admin:"Administrateur",manager:"Manager",sender:"Expéditeur",viewer:"Observateur"},R={active:"Actif",suspended:"Suspendu",inactive:"Inactif"},H=[{value:"send_sms",label:"Envoyer SMS",description:"Permet d'envoyer des SMS individuels et en masse"},{value:"view_history",label:"Voir l'historique",description:"Consulter l'historique des SMS envoyés"},{value:"manage_contacts",label:"Gérer les contacts",description:"Ajouter, modifier et supprimer des contacts"},{value:"manage_groups",label:"Gérer les groupes",description:"Créer et gérer des groupes de contacts"},{value:"create_campaigns",label:"Créer des campagnes",description:"Créer et lancer des campagnes SMS"},{value:"view_analytics",label:"Voir les statistiques",description:"Accéder aux rapports et statistiques"},{value:"manage_templates",label:"Gérer les modèles",description:"Créer et modifier des modèles de messages"},{value:"export_data",label:"Exporter les données",description:"Exporter les données en CSV/Excel"}];te(h,i=>{i&&(a.value.sms_credit_limit=null)});async function w(){var i,s;p.value=!0;try{const o=await $.getAll();u.value=o}catch(o){_(((s=(i=o.response)==null?void 0:i.data)==null?void 0:s.message)||"Erreur lors du chargement"),console.error("Error loading accounts:",o)}finally{p.value=!1}}function T(){l.value=null,a.value={name:"",email:"",password:"",role:"sender",status:"active",sms_credit_limit:null},h.value=!0,V.value=!0}function Z(i){l.value=i,a.value={name:i.name,email:i.email,password:"",role:i.role,status:i.status,sms_credit_limit:i.sms_credit_limit},h.value=i.sms_credit_limit===null,q.value=!0}function J(i){l.value=i,M.value=[...i.permissions||[]],P.value=!0}function j(){V.value=!1,q.value=!1,l.value=null}function A(){P.value=!1,l.value=null,M.value=[]}async function O(){var i,s;C.value=!0;try{const o={...a.value};h.value&&(o.sms_credit_limit=null),l.value&&!o.password&&delete o.password,l.value?(await $.update(l.value.id,o),k("Sous-compte modifié avec succès")):(await $.create(o),k("Sous-compte créé avec succès")),j(),await w()}catch(o){_(((s=(i=o.response)==null?void 0:i.data)==null?void 0:s.message)||"Erreur lors de l'enregistrement"),console.error("Error saving account:",o)}finally{C.value=!1}}async function K(){var i,s;if(l.value){S.value=!0;try{await b.post(`/sub-accounts/${l.value.id}/permissions`,{permissions:M.value}),k("Permissions mises à jour avec succès"),A(),await w()}catch(o){_(((s=(i=o.response)==null?void 0:i.data)==null?void 0:s.message)||"Erreur lors de la mise à jour")}finally{S.value=!1}}}async function Q(i){var o,t;if(await L("Suspendre le compte ?",`Voulez-vous vraiment suspendre "${i.name}" ? Il ne pourra plus se connecter.`))try{await b.post(`/sub-accounts/${i.id}/suspend`),k("Compte suspendu avec succès"),await w()}catch(m){_(((t=(o=m.response)==null?void 0:o.data)==null?void 0:t.message)||"Erreur lors de la suspension")}}async function W(i){var s,o;try{await b.post(`/sub-accounts/${i.id}/activate`),k("Compte activé avec succès"),await w()}catch(t){_(((o=(s=t.response)==null?void 0:s.data)==null?void 0:o.message)||"Erreur lors de l'activation")}}async function X(i){var o,t;if(await L("Supprimer le compte ?",`Êtes-vous sûr de vouloir supprimer "${i.name}" ? Cette action est irréversible.`))try{await $.delete(i.id),k("Compte supprimé avec succès"),await w()}catch(m){_(((t=(o=m.response)==null?void 0:o.data)==null?void 0:t.message)||"Erreur lors de la suppression"),console.error("Error deleting account:",m)}}function Y(i){return i.sms_credit_limit===null?0:Math.min(100,i.sms_used/i.sms_credit_limit*100)}function ee(i){const s=new Date(i);return new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(s)}return ie(()=>{w()}),(i,s)=>(n(),oe(le,null,{default:ne(()=>{var o;return[e("div",ve,[e("div",ge,[s[9]||(s[9]=e("div",null,[e("h1",{class:"text-3xl font-bold"},"Sous-comptes"),e("p",{class:"text-muted-foreground mt-2"},"Gérez les accès cloisonnés avec permissions et crédits SMS")],-1)),e("button",{onClick:T,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[v(g(ae),{class:"w-4 h-4"}),s[8]||(s[8]=e("span",null,"Ajouter un sous-compte",-1))])]),p.value?(n(),r("div",be,[...s[10]||(s[10]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):u.value.length===0?(n(),r("div",xe,[v(g(de),{class:"w-16 h-16 text-muted-foreground mb-4"}),s[11]||(s[11]=e("p",{class:"text-lg font-medium"},"Aucun sous-compte trouvé",-1)),s[12]||(s[12]=e("p",{class:"text-sm text-muted-foreground mt-1"},"Créez des comptes avec accès cloisonné",-1))])):(n(),r("div",ye,[(n(!0),r(z,null,D(u.value,t=>(n(),r("div",{key:t.id,class:"rounded-lg border bg-card shadow-sm hover:shadow-md transition-shadow"},[e("div",he,[e("div",we,[e("div",_e,[e("h3",ke,c(t.name),1),e("p",Ce,c(t.email),1)]),e("span",{class:B(["text-xs px-2.5 py-1 rounded-full font-medium",{"bg-green-100 text-green-700":t.status==="active","bg-red-100 text-red-700":t.status==="suspended","bg-gray-100 text-gray-700":t.status==="inactive"}])},c(R[t.status]),3)]),e("div",Se,[e("span",{class:B(["text-xs px-2.5 py-1 rounded-md font-medium",{"bg-purple-100 text-purple-700":t.role==="admin","bg-blue-100 text-blue-700":t.role==="manager","bg-teal-100 text-teal-700":t.role==="sender","bg-gray-100 text-gray-700":t.role==="viewer"}])},c(G[t.role]),3)]),e("div",Me,[e("div",je,[s[13]||(s[13]=e("span",{class:"text-muted-foreground"},"Crédits SMS",-1)),e("span",Ae,c(t.remaining_credits===null?"Illimité":t.remaining_credits.toLocaleString("fr-FR")),1)]),e("div",Ee,[s[14]||(s[14]=e("span",{class:"text-muted-foreground"},"Utilisés",-1)),e("span",null,c((t.sms_used||0).toLocaleString("fr-FR")),1)]),t.remaining_credits!==null?(n(),r("div",$e,[e("div",{class:"bg-primary h-2 rounded-full transition-all",style:re({width:Y(t)+"%"})},null,4)])):x("",!0),t.last_connection?(n(),r("div",Ve," Dernière connexion: "+c(ee(t.last_connection)),1)):x("",!0)])]),e("div",qe,[e("button",{onClick:m=>Z(t),class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9"},[v(g(ue),{class:"w-4 h-4"}),s[15]||(s[15]=e("span",null,"Modifier",-1))],8,Pe),e("button",{onClick:m=>J(t),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"},[v(g(ce),{class:"w-4 h-4"})],8,Ue),t.status==="active"?(n(),r("button",{key:0,onClick:m=>Q(t),class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 hover:bg-destructive/10 hover:text-destructive h-9 w-9"},[v(g(fe),{class:"w-4 h-4"})],8,ze)):t.status==="suspended"?(n(),r("button",{key:1,onClick:m=>W(t),class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 hover:bg-success/10 hover:text-success h-9 w-9"},[v(g(pe),{class:"w-4 h-4"})],8,De)):x("",!0),e("button",{onClick:m=>X(t),class:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 hover:bg-destructive/10 hover:text-destructive h-9 w-9"},[v(g(me),{class:"w-4 h-4"})],8,Be)])]))),128))]))]),V.value||q.value?(n(),r("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:U(j,["self"])},[e("div",Fe,[e("div",Ie,[e("div",Le,[e("h2",Ne,c(l.value?"Modifier le sous-compte":"Nouveau sous-compte"),1),e("button",{onClick:j,class:"hover:bg-accent rounded-full p-1"},[v(g(N),{class:"w-5 h-5"})])])]),e("form",{onSubmit:U(O,["prevent"]),class:"p-6 space-y-6"},[e("div",Ge,[e("div",Re,[s[16]||(s[16]=e("label",{class:"text-sm font-medium"},"Nom complet *",-1)),y(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>a.value.name=t),type:"text",required:"",placeholder:"Jean Dupont",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[E,a.value.name]])]),e("div",He,[s[17]||(s[17]=e("label",{class:"text-sm font-medium"},"Email *",-1)),y(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>a.value.email=t),type:"email",required:"",disabled:!!l.value,placeholder:"jean@example.com",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50"},null,8,Te),[[E,a.value.email]])])]),l.value?x("",!0):(n(),r("div",Ze,[s[18]||(s[18]=e("label",{class:"text-sm font-medium"},"Mot de passe *",-1)),y(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>a.value.password=t),type:"password",required:!l.value,placeholder:"Minimum 8 caractères",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,8,Je),[[E,a.value.password]]),s[19]||(s[19]=e("p",{class:"text-xs text-muted-foreground"},"Laissez vide pour ne pas modifier (mode édition)",-1))])),e("div",Oe,[e("div",Ke,[s[21]||(s[21]=e("label",{class:"text-sm font-medium"},"Rôle *",-1)),y(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>a.value.role=t),required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...s[20]||(s[20]=[e("option",{value:"admin"},"Admin (tous les droits)",-1),e("option",{value:"manager"},"Manager (gestion avancée)",-1),e("option",{value:"sender"},"Sender (envoi SMS)",-1),e("option",{value:"viewer"},"Viewer (consultation uniquement)",-1)])],512),[[F,a.value.role]])]),e("div",Qe,[s[23]||(s[23]=e("label",{class:"text-sm font-medium"},"Statut",-1)),y(e("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>a.value.status=t),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...s[22]||(s[22]=[e("option",{value:"active"},"Actif",-1),e("option",{value:"suspended"},"Suspendu",-1),e("option",{value:"inactive"},"Inactif",-1)])],512),[[F,a.value.status]])])]),e("div",We,[s[25]||(s[25]=e("label",{class:"text-sm font-medium"},"Limite de crédits SMS",-1)),e("div",Xe,[y(e("input",{"onUpdate:modelValue":s[5]||(s[5]=t=>a.value.sms_credit_limit=t),type:"number",min:"0",disabled:h.value,placeholder:"1000",class:"flex h-10 flex-1 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50"},null,8,Ye),[[E,a.value.sms_credit_limit,void 0,{number:!0}]]),e("label",es,[y(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>h.value=t),type:"checkbox",class:"rounded border-gray-300"},null,512),[[I,h.value]]),s[24]||(s[24]=e("span",{class:"text-sm"},"Illimité",-1))])]),s[26]||(s[26]=e("p",{class:"text-xs text-muted-foreground"},"Nombre maximum de SMS que ce compte peut envoyer",-1))]),e("div",ss,[e("button",{type:"button",onClick:j,class:"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Annuler "),e("button",{type:"submit",disabled:C.value,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[C.value?(n(),r("div",is)):x("",!0),e("span",null,c(C.value?"Enregistrement...":l.value?"Modifier":"Créer"),1)],8,ts)])],32)])])):x("",!0),P.value?(n(),r("div",{key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:U(A,["self"])},[e("div",os,[e("div",ns,[e("div",rs,[s[27]||(s[27]=e("h2",{class:"text-xl font-bold"},"Permissions",-1)),e("button",{onClick:A,class:"hover:bg-accent rounded-full p-1"},[v(g(N),{class:"w-5 h-5"})])]),e("p",ls,c((o=l.value)==null?void 0:o.name),1)]),e("div",as,[(n(),r(z,null,D(H,t=>e("div",{key:t.value,class:"flex items-start gap-3"},[y(e("input",{"onUpdate:modelValue":s[7]||(s[7]=m=>M.value=m),value:t.value,type:"checkbox",id:"perm-"+t.value,class:"mt-1 rounded border-gray-300"},null,8,ds),[[I,M.value]]),e("label",{for:"perm-"+t.value,class:"flex-1 cursor-pointer"},[e("div",cs,c(t.label),1),e("div",ms,c(t.description),1)],8,us)])),64))]),e("div",fs,[e("button",{type:"button",onClick:A,class:"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Annuler "),e("button",{onClick:K,disabled:S.value,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[S.value?(n(),r("div",vs)):x("",!0),e("span",null,c(S.value?"Enregistrement...":"Enregistrer"),1)],8,ps)])])])):x("",!0)]}),_:1}))}});export{Cs as default};
