import{o,c as r,b as t,d as he,r as b,j as _,l as xe,m as be,n as _e,i as we,s as u,x as c,F as y,p as k,q as M,t as a,g as p,w as P,f as Z,v as E}from"./main-P2kAjlXA.js";import{_ as ye,q as ke,o as De,j as R,c as Se,i as z}from"./api-D4p5c542.js";import{c as Y}from"./campaignService-DZ0hyg6f.js";import{a as U,b as W,s as Me}from"./notifications-CHQAjgV4.js";import{r as I}from"./ChevronLeftIcon-DZOwl7N3.js";import{r as K}from"./ChevronRightIcon-DWYRpvI6.js";import{r as Ce}from"./PencilIcon-C9yOHJ6e.js";function $e(J,D){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0M3.124 7.5A8.969 8.969 0 0 1 5.292 3m13.416 0a8.969 8.969 0 0 1 2.168 4.5"})])}function G(J,D){return o(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z"})])}const je={class:"p-4 sm:p-6 lg:p-8"},Ae={key:0,class:"flex items-center justify-center py-12"},Te={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Ve={class:"lg:col-span-2 rounded-lg border bg-card p-4 sm:p-6"},Fe={class:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-4"},He={class:"flex items-center gap-2"},Ne={class:"flex items-center gap-1 sm:gap-2"},Ze=["onClick"],Ee={key:0,class:"flex items-center justify-between mb-4"},Ye={class:"font-semibold text-lg"},Je={key:1,class:"mb-6"},Oe={class:"sm:hidden text-center py-8"},Be={class:"hidden sm:block"},Le={class:"grid grid-cols-7 gap-1 mb-2"},qe={class:"grid grid-cols-7 gap-1"},Pe=["onClick"],Re={key:0,class:"space-y-0.5"},ze=["title"],Ue={key:0,class:"text-[10px] text-muted-foreground"},We={key:2,class:"mb-6"},Ie={class:"flex items-center justify-between mb-4"},Ke={class:"font-semibold text-sm sm:text-base"},Ge={class:"overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0"},Qe={class:"grid grid-cols-7 gap-1 sm:gap-2 min-w-[600px] sm:min-w-0"},Xe={class:"text-center mb-2"},et={class:"text-[10px] sm:text-xs text-muted-foreground"},tt={key:0,class:"space-y-1"},st=["onClick"],nt={class:"font-medium truncate"},ot={class:"text-[8px] sm:text-[10px] text-muted-foreground"},rt={key:1,class:"text-[10px] sm:text-xs text-muted-foreground text-center mt-4"},at={key:3,class:"flex items-center gap-2 mb-4"},it={key:4,class:"text-center py-12"},lt={key:5,class:"space-y-2 sm:space-y-3"},dt={class:"flex items-center gap-3 sm:gap-4"},ut={class:"w-10 h-10 sm:w-12 sm:h-12 rounded-lg bg-primary/10 flex items-center justify-center font-semibold flex-shrink-0"},ct={class:"text-center"},mt={class:"text-[10px] sm:text-xs"},gt={class:"text-sm sm:text-lg"},pt={class:"flex-1 min-w-0"},ft={class:"font-medium text-sm sm:text-base truncate"},vt={class:"flex flex-wrap items-center gap-1 sm:gap-2 text-xs sm:text-sm text-muted-foreground"},ht={class:"flex items-center gap-1"},xt={class:"flex items-center gap-1"},bt={class:"flex items-center gap-2 sm:ml-auto pl-13 sm:pl-0"},_t={class:"text-[10px] sm:text-xs px-2 py-1 rounded-full bg-warning/10 text-warning flex items-center gap-1"},wt=["onClick"],yt=["onClick"],kt={class:"rounded-lg border bg-card p-4 sm:p-6"},Dt={class:"flex items-center gap-2 mb-3 sm:mb-4"},St={class:"text-xl sm:text-2xl font-bold mb-1 sm:mb-2"},Mt={class:"mt-4 sm:mt-6 space-y-2"},Ct={class:"flex items-center justify-between text-xs sm:text-sm"},$t={class:"font-semibold"},jt={class:"flex items-center justify-between text-xs sm:text-sm"},At={class:"font-semibold"},Tt={class:"bg-background rounded-lg shadow-lg w-full max-w-sm sm:max-w-md max-h-[90vh] overflow-y-auto p-4 sm:p-6"},Vt={class:"flex items-center justify-between mb-4 sm:mb-6"},Ft={class:"space-y-2"},Ht={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4"},Nt={class:"space-y-2"},Zt={class:"space-y-2"},Et={class:"flex gap-3 pt-4 border-t"},Yt=["disabled"],Jt={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"},Ut=he({__name:"Calendar",setup(J){we();const D=b(!0),S=b(!1),T=b(!1),O=b([]),C=b(null),Q=[{label:"Liste",value:"list"},{label:"Semaine",value:"week"},{label:"Mois",value:"month"}],f=b("month"),l=b(new Date),B=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],V=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],X=_(()=>V[l.value.getMonth()]),ee=_(()=>l.value.getFullYear()),v=b({name:"",scheduled_date:"",scheduled_time:""}),w=_(()=>{const n=["Planifié","planifié","scheduled","draft"];return O.value.filter(e=>{var s;return n.includes(((s=e.status)==null?void 0:s.toLowerCase())||"")||n.includes(e.status||"")}).filter(e=>e.scheduled_at).sort((e,s)=>new Date(e.scheduled_at).getTime()-new Date(s.scheduled_at).getTime())}),L=_(()=>{const n=new Date,e=new Date(n.getTime()+7*24*60*60*1e3);return w.value.filter(s=>{const i=new Date(s.scheduled_at);return i>=n&&i<=e}).length}),te=_(()=>{const n=new Date;return w.value.filter(e=>{const s=new Date(e.scheduled_at);return s.getMonth()===n.getMonth()&&s.getFullYear()===n.getFullYear()}).length}),se=_(()=>{const n=l.value.getFullYear(),e=l.value.getMonth(),s=new Date(n,e,1),i=new Date(n,e+1,0),g=new Date;let h=s.getDay()-1;h<0&&(h=6);const m=[],pe=new Date(n,e,0);for(let d=h-1;d>=0;d--){const x=pe.getDate()-d,N=`${n}-${String(e).padStart(2,"0")}-${String(x).padStart(2,"0")}`;m.push({date:x,dateStr:N,isCurrentMonth:!1,isToday:!1,campaigns:j(new Date(n,e-1,x))})}for(let d=1;d<=i.getDate();d++){const x=new Date(n,e,d),N=x.toDateString()===g.toDateString(),ve=`${n}-${String(e+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;m.push({date:d,dateStr:ve,isCurrentMonth:!0,isToday:N,campaigns:j(x)})}const fe=42-m.length;for(let d=1;d<=fe;d++){const x=`${n}-${String(e+2).padStart(2,"0")}-${String(d).padStart(2,"0")}`;m.push({date:d,dateStr:x,isCurrentMonth:!1,isToday:!1,campaigns:j(new Date(n,e+1,d))})}return m}),$=_(()=>{const n=new Date,e=new Date(l.value),s=e.getDay(),i=e.getDate()-s+(s===0?-6:1);e.setDate(i);const g=[];for(let h=0;h<7;h++){const m=new Date(e);m.setDate(e.getDate()+h),g.push({date:m.getDate(),dateStr:m.toISOString().split("T")[0],dayName:B[h],isToday:m.toDateString()===n.toDateString(),campaigns:j(m)})}return g}),ne=_(()=>{if($.value.length<2)return"";const n=$.value[0],e=$.value[6],s=new Date(n.dateStr),i=new Date(e.dateStr);return`${n.date} ${V[s.getMonth()].slice(0,3)} - ${e.date} ${V[i.getMonth()].slice(0,3)} ${i.getFullYear()}`});function j(n){return w.value.filter(e=>new Date(e.scheduled_at).toDateString()===n.toDateString())}function oe(){l.value=new Date(l.value.getFullYear(),l.value.getMonth()-1,1)}function re(){l.value=new Date(l.value.getFullYear(),l.value.getMonth()+1,1)}function ae(){l.value=new Date(l.value.getTime()-7*24*60*60*1e3)}function ie(){l.value=new Date(l.value.getTime()+7*24*60*60*1e3)}function le(n){n.campaigns.length===1&&H(n.campaigns[0])}function de(n){return n?["Jan","Fév","Mar","Avr","Mai","Juin","Juil","Aoû","Sep","Oct","Nov","Déc"][new Date(n).getMonth()]:""}function ue(n){return n?new Date(n).getDate().toString().padStart(2,"0"):""}function q(n){if(!n)return"";const e=new Date(n);return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}function ce(n){return n>=1e3?`${(n/1e3).toFixed(1)}K`:n.toString()}async function F(){try{D.value=!0,O.value=await Y.getAll()}catch(n){console.error("Error loading campaigns:",n)}finally{D.value=!1}}function H(n){C.value=n;const e=new Date(n.scheduled_at);v.value={name:n.name,scheduled_date:e.toISOString().split("T")[0],scheduled_time:`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`},T.value=!0}function A(){T.value=!1,C.value=null}async function me(){var n,e;if(C.value){S.value=!0;try{const s=`${v.value.scheduled_date} ${v.value.scheduled_time}`;await Y.update(C.value.id,{scheduled_at:s}),U("Campagne reprogrammée avec succès"),A(),await F()}catch(s){W(((e=(n=s.response)==null?void 0:n.data)==null?void 0:e.message)||s.message||"Erreur lors de la reprogrammation")}finally{S.value=!1}}}async function ge(n){if(await Me("Annuler la campagne ?",`Êtes-vous sûr de vouloir annuler la campagne "${n.name}" ?`))try{await Y.delete(n.id),U("Campagne annulée avec succès"),await F()}catch(s){W(s.message||"Erreur lors de l'annulation")}}return xe(()=>{F()}),(n,e)=>(o(),be(ye,null,{default:_e(()=>[t("div",je,[e[17]||(e[17]=t("div",{class:"mb-4 sm:mb-8"},[t("h1",{class:"text-xl sm:text-3xl font-bold"},"Calendrier"),t("p",{class:"text-sm text-muted-foreground mt-1 sm:mt-2"},"Planifiez vos campagnes SMS")],-1)),D.value?(o(),r("div",Ae,[...e[5]||(e[5]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):(o(),r("div",Te,[t("div",Ve,[t("div",Fe,[t("div",He,[u(c(ke),{class:"w-5 h-5 text-primary"}),e[6]||(e[6]=t("h3",{class:"font-semibold text-sm sm:text-base"},"Campagnes planifiées",-1))]),t("div",Ne,[(o(),r(y,null,k(Q,s=>t("button",{key:s.value,onClick:i=>f.value=s.value,class:M(["px-2 sm:px-3 py-1 sm:py-1.5 text-xs font-medium rounded-md transition-colors",f.value===s.value?"bg-primary text-primary-foreground":"bg-muted hover:bg-accent"])},a(s.label),11,Ze)),64))])]),f.value==="month"?(o(),r("div",Ee,[t("button",{onClick:oe,class:"p-2 hover:bg-accent rounded-md"},[u(c(I),{class:"w-5 h-5"})]),t("h4",Ye,a(X.value)+" "+a(ee.value),1),t("button",{onClick:re,class:"p-2 hover:bg-accent rounded-md"},[u(c(K),{class:"w-5 h-5"})])])):p("",!0),f.value==="month"?(o(),r("div",Je,[t("div",Oe,[u(c(G),{class:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),e[7]||(e[7]=t("p",{class:"text-sm text-muted-foreground mb-3"},"Vue mensuelle non disponible sur mobile",-1)),t("button",{onClick:e[0]||(e[0]=s=>f.value="list"),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 py-2"}," Voir la liste ")]),t("div",Be,[t("div",Le,[(o(),r(y,null,k(B,s=>t("div",{key:s,class:"text-center text-xs font-medium text-muted-foreground py-2"},a(s),1)),64))]),t("div",qe,[(o(!0),r(y,null,k(se.value,(s,i)=>(o(),r("div",{key:i,class:M(["min-h-[80px] p-1 border rounded-md transition-colors",[s.isCurrentMonth?"bg-background":"bg-muted/30",s.isToday?"border-primary border-2":"border-border",s.campaigns.length>0?"cursor-pointer hover:bg-accent/50":""]]),onClick:g=>s.campaigns.length>0&&le(s)},[t("div",{class:M(["text-xs font-medium mb-1",s.isToday?"text-primary":s.isCurrentMonth?"":"text-muted-foreground"])},a(s.date),3),s.campaigns.length>0?(o(),r("div",Re,[(o(!0),r(y,null,k(s.campaigns.slice(0,2),g=>(o(),r("div",{key:g.id,class:"text-[10px] px-1 py-0.5 rounded bg-primary/10 text-primary truncate",title:g.name},a(g.name),9,ze))),128)),s.campaigns.length>2?(o(),r("div",Ue," +"+a(s.campaigns.length-2)+" autres ",1)):p("",!0)])):p("",!0)],10,Pe))),128))])])])):p("",!0),f.value==="week"?(o(),r("div",We,[t("div",Ie,[t("button",{onClick:ae,class:"p-2 hover:bg-accent rounded-md"},[u(c(I),{class:"w-5 h-5"})]),t("h4",Ke,a(ne.value),1),t("button",{onClick:ie,class:"p-2 hover:bg-accent rounded-md"},[u(c(K),{class:"w-5 h-5"})])]),t("div",Ge,[t("div",Qe,[(o(!0),r(y,null,k($.value,s=>(o(),r("div",{key:s.dateStr,class:M(["border rounded-lg p-1.5 sm:p-2 min-h-[100px] sm:min-h-[120px]",s.isToday?"border-primary border-2":"border-border"])},[t("div",Xe,[t("div",et,a(s.dayName),1),t("div",{class:M(["text-sm sm:text-lg font-semibold",s.isToday?"text-primary":""])},a(s.date),3)]),s.campaigns.length>0?(o(),r("div",tt,[(o(!0),r(y,null,k(s.campaigns,i=>(o(),r("div",{key:i.id,class:"text-[10px] sm:text-xs p-1 sm:p-1.5 rounded bg-primary/10 text-primary cursor-pointer hover:bg-primary/20",onClick:g=>H(i)},[t("div",nt,a(i.name),1),t("div",ot,a(q(i.scheduled_at)),1)],8,st))),128))])):(o(),r("div",rt," Aucune "))],2))),128))])])])):p("",!0),f.value==="list"?(o(),r("div",at,[...e[8]||(e[8]=[t("h4",{class:"font-medium text-sm text-muted-foreground"},"Liste des campagnes",-1)])])):p("",!0),f.value==="list"&&w.value.length===0?(o(),r("div",it,[u(c(G),{class:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e[10]||(e[10]=t("p",{class:"text-muted-foreground"},"Aucune campagne planifiée",-1)),t("button",{onClick:e[1]||(e[1]=s=>n.$router.push("/campaign/create")),class:"mt-4 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},[u(c(De),{class:"w-4 h-4"}),e[9]||(e[9]=t("span",null,"Planifier une campagne",-1))])])):p("",!0),f.value==="list"&&w.value.length>0?(o(),r("div",lt,[(o(!0),r(y,null,k(w.value,s=>(o(),r("div",{key:s.id,class:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4 p-3 sm:p-4 border rounded-lg hover:bg-muted/50 transition-colors group"},[t("div",dt,[t("div",ut,[t("div",ct,[t("div",mt,a(de(s.scheduled_at)),1),t("div",gt,a(ue(s.scheduled_at)),1)])]),t("div",pt,[t("div",ft,a(s.name),1),t("div",vt,[t("div",ht,[u(c(R),{class:"w-3 h-3 sm:w-4 sm:h-4"}),t("span",null,a(q(s.scheduled_at)),1)]),e[11]||(e[11]=t("span",{class:"hidden sm:inline"},"•",-1)),t("div",xt,[u(c(Se),{class:"w-3 h-3 sm:w-4 sm:h-4"}),t("span",null,a(ce(s.messages_sent||0))+" dest.",1)])])])]),t("div",bt,[t("span",_t,[u(c(R),{class:"w-3 h-3"}),e[12]||(e[12]=t("span",null,"Planifiée",-1))]),t("button",{onClick:i=>H(s),class:"sm:opacity-0 sm:group-hover:opacity-100 transition-opacity inline-flex items-center justify-center rounded-md text-sm font-medium hover:bg-accent h-8 w-8",title:"Modifier"},[u(c(Ce),{class:"w-4 h-4"})],8,wt),t("button",{onClick:i=>ge(s),class:"sm:opacity-0 sm:group-hover:opacity-100 transition-opacity inline-flex items-center justify-center rounded-md text-sm font-medium hover:bg-destructive/10 hover:text-destructive h-8 w-8",title:"Annuler"},[u(c(z),{class:"w-4 h-4"})],8,yt)])]))),128))])):p("",!0)]),t("div",kt,[t("div",Dt,[u(c($e),{class:"w-4 h-4 sm:w-5 sm:h-5 text-primary"}),e[13]||(e[13]=t("h3",{class:"font-semibold text-sm sm:text-base"},"À venir",-1))]),t("div",St,a(L.value)+" campagne"+a(L.value>1?"s":""),1),e[16]||(e[16]=t("p",{class:"text-xs sm:text-sm text-muted-foreground"},"dans les 7 prochains jours",-1)),t("div",Mt,[t("div",Ct,[e[14]||(e[14]=t("span",{class:"text-muted-foreground"},"Ce mois-ci",-1)),t("span",$t,a(te.value),1)]),t("div",jt,[e[15]||(e[15]=t("span",{class:"text-muted-foreground"},"Total planifiées",-1)),t("span",At,a(w.value.length),1)])])])]))]),T.value?(o(),r("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-3 sm:p-4",onClick:P(A,["self"])},[t("div",Tt,[t("div",Vt,[e[18]||(e[18]=t("h2",{class:"text-lg sm:text-xl font-bold"},"Reprogrammer la campagne",-1)),t("button",{onClick:A,class:"hover:bg-accent rounded-full p-1"},[u(c(z),{class:"w-5 h-5"})])]),t("form",{onSubmit:P(me,["prevent"]),class:"space-y-4"},[t("div",Ft,[e[19]||(e[19]=t("label",{class:"text-sm font-medium"},"Nom de la campagne",-1)),Z(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>v.value.name=s),type:"text",readonly:"",class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-muted px-3 py-2 text-sm"},null,512),[[E,v.value.name]])]),t("div",Ht,[t("div",Nt,[e[20]||(e[20]=t("label",{class:"text-sm font-medium"},"Date *",-1)),Z(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>v.value.scheduled_date=s),type:"date",required:"",class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[E,v.value.scheduled_date]])]),t("div",Zt,[e[21]||(e[21]=t("label",{class:"text-sm font-medium"},"Heure *",-1)),Z(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>v.value.scheduled_time=s),type:"time",required:"",class:"flex h-9 sm:h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[E,v.value.scheduled_time]])])]),t("div",Et,[t("button",{type:"button",onClick:A,class:"flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 sm:h-10 px-4 py-2"}," Annuler "),t("button",{type:"submit",disabled:S.value,class:"flex-1 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 sm:h-10 px-4 py-2"},[S.value?(o(),r("div",Jt)):p("",!0),t("span",null,a(S.value?"Enregistrement...":"Reprogrammer"),1)],8,Yt)])],32)])])):p("",!0)]),_:1}))}});export{Ut as default};
