import{d as J,r as g,k as C,l as K,m as T,n as $,G as O,o as c,b as e,p as a,q as u,t as i,f as b,v as D,A as P,c as m,F as Q,x as W,s as y,y as z,i as B,g as x,w as Y}from"./main-CoGMHHt9.js";import{e as _,_ as Z,c as I,r as U,n as ee,m as F}from"./api-Cjgg3nLh.js";import{b as te}from"./notifications-CHQAjgV4.js";import{r as N}from"./CheckCircleIcon-CWAwbvpF.js";import{r as se,a as oe}from"./XCircleIcon-CKEbHkzw.js";import{r as ne}from"./BanknotesIcon-CJC9QUWH.js";import{r as ie}from"./PhoneIcon-rWgKPIvo.js";import{r as re}from"./EyeIcon-CfOjMuca.js";import{r as le,a as ae}from"./ChevronRightIcon-BoHDEIG_.js";import{r as de}from"./XMarkIcon-C9QblEve.js";const ue={async getAll(f){const d=await _.get("/messages/history",{params:f});return d.data.data||d.data},async getById(f){const d=await _.get(`/messages/${f}`);return d.data.data||d.data},async getStats(){const f=await _.get("/messages/stats");return f.data.data||f.data},async exportToCsv(f){return(await _.get("/messages/export",{params:f,responseType:"blob"})).data}},ce={class:"p-8"},me={class:"mb-8 flex items-center justify-between"},fe={class:"flex items-center gap-2"},pe={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},ve={class:"rounded-lg border bg-card p-6"},ge={class:"flex items-center justify-between"},be={class:"text-2xl font-bold"},xe={class:"rounded-lg border bg-card p-6"},he={class:"flex items-center justify-between"},ye={class:"text-2xl font-bold text-success"},_e={class:"rounded-lg border bg-card p-6"},we={class:"flex items-center justify-between"},ke={class:"text-2xl font-bold text-destructive"},Ce={class:"rounded-lg border bg-card p-6"},Te={class:"flex items-center justify-between"},$e={class:"text-2xl font-bold text-primary"},De={class:"mb-6 grid grid-cols-1 md:grid-cols-5 gap-4"},Fe={key:0,class:"flex justify-center items-center py-12"},je={key:1,class:"text-center py-16"},Se={class:"text-muted-foreground mb-6"},Le={key:2,class:"rounded-lg border bg-card shadow-sm overflow-hidden"},Me={class:"overflow-x-auto"},Ae={class:"w-full"},Ee={class:"divide-y"},Ve={class:"p-4 text-sm"},Pe={class:"flex items-center gap-2"},ze={class:"text-xs text-muted-foreground"},Be={class:"p-4 text-sm"},Ie={class:"flex items-center gap-2"},Ue={class:"font-medium"},Ne={class:"text-xs text-muted-foreground font-mono"},He={class:"p-4 text-sm max-w-xs"},Re={class:"truncate font-mono text-xs"},Xe={class:"p-4 text-sm"},qe={class:"p-4 text-sm"},Ge={class:"p-4 text-sm font-semibold text-primary"},Je={class:"p-4 text-sm"},Ke=["onClick"],Oe={key:3,class:"mt-6 flex justify-center gap-2"},Qe=["disabled"],We={class:"inline-flex items-center px-4 text-sm"},Ye=["disabled"],Ze={class:"bg-background rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},et={class:"p-6 border-b flex items-center justify-between"},tt={class:"p-6 space-y-6"},st={class:"grid grid-cols-2 gap-4"},ot={class:"text-muted-foreground"},nt={class:"text-sm text-muted-foreground font-mono mt-1"},it={class:"text-muted-foreground"},rt={class:"text-sm text-muted-foreground mt-1"},lt={class:"p-4 bg-muted/50 rounded-lg font-mono text-sm whitespace-pre-wrap"},at={class:"text-xs text-muted-foreground mt-2"},dt={class:"grid grid-cols-3 gap-4"},ut={class:"text-2xl font-bold text-primary"},ct={key:0},mt={class:"text-muted-foreground"},ft={key:1},pt={class:"text-muted-foreground uppercase"},vt={key:2,class:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg"},gt={class:"text-sm text-destructive"},bt={class:"p-6 border-t flex justify-end"},j=20,Ft=J({__name:"MessageHistory",setup(f){const d=g([]),w=g(!1),r=g(null),v=g(1),n=g({search:"",status:"",type:"",dateFrom:"",dateTo:""}),h=C(()=>({total:d.value.length,delivered:d.value.filter(o=>o.status==="delivered").length,failed:d.value.filter(o=>o.status==="failed").length,totalCost:d.value.reduce((o,t)=>o+t.cost,0)})),S=C(()=>{let o=d.value;if(n.value.search){const s=n.value.search.toLowerCase();o=o.filter(p=>p.recipient_phone.includes(s)||p.recipient_name&&p.recipient_name.toLowerCase().includes(s)||p.content.toLowerCase().includes(s))}n.value.status&&(o=o.filter(s=>s.status===n.value.status)),n.value.type&&(o=o.filter(s=>s.type===n.value.type)),n.value.dateFrom&&(o=o.filter(s=>s.sent_at>=n.value.dateFrom)),n.value.dateTo&&(o=o.filter(s=>s.sent_at<=n.value.dateTo));const t=(v.value-1)*j,l=t+j;return o.slice(t,l)}),k=C(()=>{let o=d.value;if(n.value.search||n.value.status||n.value.type||n.value.dateFrom||n.value.dateTo){const t=n.value.search.toLowerCase();o=o.filter(l=>{const s=!n.value.search||l.recipient_phone.includes(t)||l.recipient_name&&l.recipient_name.toLowerCase().includes(t)||l.content.toLowerCase().includes(t),p=!n.value.status||l.status===n.value.status,X=!n.value.type||l.type===n.value.type,q=!n.value.dateFrom||l.sent_at>=n.value.dateFrom,G=!n.value.dateTo||l.sent_at<=n.value.dateTo;return s&&p&&X&&q&&G})}return Math.ceil(o.length/j)});function L(o){return{delivered:"bg-success/10 text-success",pending:"bg-warning/10 text-warning",failed:"bg-destructive/10 text-destructive"}[o]||"bg-muted text-muted-foreground"}function M(o){return{delivered:"Livré",pending:"En attente",failed:"Échoué"}[o]||o}function A(o){return{delivered:N,pending:F,failed:oe}[o]||F}function E(o){return new Date(o).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"})}function V(o){return new Date(o).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}function H(o){r.value=o}async function R(){var o,t;w.value=!0;try{d.value=await ue.getAll()}catch(l){console.error("Error loading messages:",l),te(((t=(o=l.response)==null?void 0:o.data)==null?void 0:t.message)||"Erreur lors du chargement des messages")}finally{w.value=!1}}return K(()=>{R()}),(o,t)=>{const l=O("router-link");return c(),T(Z,null,{default:$(()=>[e("div",ce,[e("div",me,[e("div",null,[e("div",fe,[a(u(I),{class:"w-8 h-8 text-primary"}),t[10]||(t[10]=e("h1",{class:"text-3xl font-bold"},"Historique des messages",-1))]),t[11]||(t[11]=e("p",{class:"text-muted-foreground mt-2"},"Consultez tous les messages SMS envoyés",-1))]),a(l,{to:"/send-message",class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},{default:$(()=>[a(u(U),{class:"w-4 h-4"}),t[12]||(t[12]=e("span",null,"Envoyer un message",-1))]),_:1})]),e("div",pe,[e("div",ve,[e("div",ge,[e("div",null,[t[13]||(t[13]=e("p",{class:"text-sm text-muted-foreground mb-1"},"Total envoyé",-1)),e("p",be,i(h.value.total),1)]),a(u(I),{class:"w-10 h-10 text-primary/20"})])]),e("div",xe,[e("div",he,[e("div",null,[t[14]||(t[14]=e("p",{class:"text-sm text-muted-foreground mb-1"},"Livrés",-1)),e("p",ye,i(h.value.delivered),1)]),a(u(N),{class:"w-10 h-10 text-success/20"})])]),e("div",_e,[e("div",we,[e("div",null,[t[15]||(t[15]=e("p",{class:"text-sm text-muted-foreground mb-1"},"Échecs",-1)),e("p",ke,i(h.value.failed),1)]),a(u(se),{class:"w-10 h-10 text-destructive/20"})])]),e("div",Ce,[e("div",Te,[e("div",null,[t[16]||(t[16]=e("p",{class:"text-sm text-muted-foreground mb-1"},"Coût total",-1)),e("p",$e,i(h.value.totalCost)+" XAF",1)]),a(u(ne),{class:"w-10 h-10 text-primary/20"})])])]),e("div",De,[e("div",null,[b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>n.value.search=s),type:"text",placeholder:"Rechercher destinataire...",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[D,n.value.search]])]),e("div",null,[b(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>n.value.status=s),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...t[17]||(t[17]=[e("option",{value:""},"Tous les statuts",-1),e("option",{value:"delivered"},"Livré",-1),e("option",{value:"pending"},"En attente",-1),e("option",{value:"failed"},"Échoué",-1)])],512),[[P,n.value.status]])]),e("div",null,[b(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.value.type=s),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},[...t[18]||(t[18]=[e("option",{value:""},"Tous les types",-1),e("option",{value:"immediate"},"Immédiat",-1),e("option",{value:"campaign"},"Campagne",-1)])],512),[[P,n.value.type]])]),e("div",null,[b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.value.dateFrom=s),type:"date",placeholder:"Date de début",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[D,n.value.dateFrom]])]),e("div",null,[b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>n.value.dateTo=s),type:"date",placeholder:"Date de fin",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"},null,512),[[D,n.value.dateTo]])])]),w.value?(c(),m("div",Fe,[...t[19]||(t[19]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"},null,-1)])])):S.value.length===0?(c(),m("div",je,[a(u(ee),{class:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),t[21]||(t[21]=e("h3",{class:"text-lg font-semibold mb-2"},"Aucun message trouvé",-1)),e("p",Se,i(n.value.search||n.value.status?"Essayez de modifier vos filtres":"Commencez par envoyer votre premier message"),1),a(l,{to:"/send-message",class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"},{default:$(()=>[a(u(U),{class:"w-4 h-4"}),t[20]||(t[20]=e("span",null,"Envoyer un message",-1))]),_:1})])):(c(),m("div",Le,[e("div",Me,[e("table",Ae,[t[22]||(t[22]=e("thead",{class:"bg-muted/50"},[e("tr",null,[e("th",{class:"text-left p-4 text-sm font-semibold"},"Date"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Destinataire"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Message"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Type"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Statut"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Coût"),e("th",{class:"text-left p-4 text-sm font-semibold"},"Actions")])],-1)),e("tbody",Ee,[(c(!0),m(Q,null,W(S.value,s=>(c(),m("tr",{key:s.id,class:"hover:bg-muted/30 transition-colors"},[e("td",Ve,[e("div",Pe,[a(u(F),{class:"w-4 h-4 text-muted-foreground"}),e("div",null,[e("div",null,i(E(s.sent_at)),1),e("div",ze,i(V(s.sent_at)),1)])])]),e("td",Be,[e("div",Ie,[a(u(ie),{class:"w-4 h-4 text-muted-foreground"}),e("div",null,[e("div",Ue,i(s.recipient_name||"Anonyme"),1),e("div",Ne,i(s.recipient_phone),1)])])]),e("td",He,[e("div",Re,i(s.content),1)]),e("td",Xe,[e("span",{class:y(["px-2.5 py-0.5 rounded-full text-xs font-medium",s.type==="campaign"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"])},i(s.type==="campaign"?"Campagne":"Immédiat"),3)]),e("td",qe,[e("span",{class:y(["inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium",L(s.status)])},[(c(),T(z(A(s.status)),{class:"w-3.5 h-3.5"})),B(" "+i(M(s.status)),1)],2)]),e("td",Ge,i(s.cost)+" XAF",1),e("td",Je,[e("button",{onClick:p=>H(s),class:"text-primary hover:text-primary/80 transition-colors"},[a(u(re),{class:"w-5 h-5"})],8,Ke)])]))),128))])])])])),k.value>1?(c(),m("div",Oe,[e("button",{onClick:t[5]||(t[5]=s=>v.value--),disabled:v.value===1,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"},[a(u(le),{class:"w-4 h-4"})],8,Qe),e("span",We," Page "+i(v.value)+" sur "+i(k.value),1),e("button",{onClick:t[6]||(t[6]=s=>v.value++),disabled:v.value===k.value,class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-3"},[a(u(ae),{class:"w-4 h-4"})],8,Ye)])):x("",!0)]),r.value?(c(),m("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:t[9]||(t[9]=Y(s=>r.value=null,["self"]))},[e("div",Ze,[e("div",et,[t[23]||(t[23]=e("h2",{class:"text-2xl font-bold"},"Détails du message",-1)),e("button",{onClick:t[7]||(t[7]=s=>r.value=null),class:"text-muted-foreground hover:text-foreground transition-colors"},[a(u(de),{class:"w-6 h-6"})])]),e("div",tt,[e("div",st,[e("div",null,[t[24]||(t[24]=e("h3",{class:"font-semibold mb-2"},"Destinataire",-1)),e("p",ot,i(r.value.recipient_name||"Anonyme"),1),e("p",nt,i(r.value.recipient_phone),1)]),e("div",null,[t[25]||(t[25]=e("h3",{class:"font-semibold mb-2"},"Date d'envoi",-1)),e("p",it,i(E(r.value.sent_at)),1),e("p",rt,i(V(r.value.sent_at)),1)])]),e("div",null,[t[26]||(t[26]=e("h3",{class:"font-semibold mb-2"},"Message",-1)),e("div",lt,i(r.value.content),1),e("p",at,i(r.value.content.length)+" caractères",1)]),e("div",dt,[e("div",null,[t[27]||(t[27]=e("h3",{class:"font-semibold mb-2"},"Type",-1)),e("span",{class:y(["inline-block px-3 py-1 rounded-full text-sm font-medium",r.value.type==="campaign"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"])},i(r.value.type==="campaign"?"Campagne":"Immédiat"),3)]),e("div",null,[t[28]||(t[28]=e("h3",{class:"font-semibold mb-2"},"Statut",-1)),e("span",{class:y(["inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium",L(r.value.status)])},[(c(),T(z(A(r.value.status)),{class:"w-4 h-4"})),B(" "+i(M(r.value.status)),1)],2)]),e("div",null,[t[29]||(t[29]=e("h3",{class:"font-semibold mb-2"},"Coût",-1)),e("p",ut,i(r.value.cost)+" XAF",1)])]),r.value.campaign_name?(c(),m("div",ct,[t[30]||(t[30]=e("h3",{class:"font-semibold mb-2"},"Campagne associée",-1)),e("p",mt,i(r.value.campaign_name),1)])):x("",!0),r.value.provider?(c(),m("div",ft,[t[31]||(t[31]=e("h3",{class:"font-semibold mb-2"},"Provider",-1)),e("p",pt,i(r.value.provider),1)])):x("",!0),r.value.error_message?(c(),m("div",vt,[t[32]||(t[32]=e("h3",{class:"font-semibold mb-2 text-destructive"},"Erreur",-1)),e("p",gt,i(r.value.error_message),1)])):x("",!0)]),e("div",bt,[e("button",{onClick:t[8]||(t[8]=s=>r.value=null),class:"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"}," Fermer ")])])])):x("",!0)]),_:1})}}});export{Ft as default};
